!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("ontimize-web-ngx"),require("rxjs"),require("@angular/material"),require("@angular/common/http"),require("rxjs/operators"),require("@angular/cdk/drag-drop"),require("@angular/material/dialog"),require("@angular/cdk/collections"),require("@angular/forms"),require("@angular/flex-layout"),require("ngx-extended-pdf-viewer"),require("@angular/common"),require("@angular/router")):"function"==typeof define&&define.amd?define("ontimize-web-ngx-report",["exports","@angular/core","ontimize-web-ngx","rxjs","@angular/material","@angular/common/http","rxjs/operators","@angular/cdk/drag-drop","@angular/material/dialog","@angular/cdk/collections","@angular/forms","@angular/flex-layout","ngx-extended-pdf-viewer","@angular/common","@angular/router"],t):t((e=e||self)["ontimize-web-ngx-report"]={},e.ng.core,e["ontimize-web-ngx"],e.rxjs,e.ng.material,e.ng.common.http,e.rxjs.operators,e.ng.cdk["drag-drop"],e.ng.material.dialog,e.ng.cdk.collections,e.ng.forms,e.ng["flex-layout"],e["ngx-extended-pdf-viewer"],e.ng.common,e.ng.router)}(this,(function(e,t,n,o,r,a,i,s,l,c,u,d,p,m,f){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function h(e,t){function n(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var v=function(){function e(){this.alertSource=new o.Subject,this.alert$=this.alertSource.asObservable()}return e.prototype.announceAlert=function(e){this.alertSource.next(e)},e.decorators=[{type:t.Injectable}],e}();var D=function(e){function o(t){var o=e.call(this,t)||this;return o.injector=t,e.prototype.configureService.call(o,o.getDefaultServiceConfiguration()),o.oErrorDialogManager=t.get(n.OErrorDialogManager),o}return h(o,e),o.prototype.createReport=function(e){var t=JSON.stringify(e),n=this.urlBase+"/dynamicjasper/report";return this.doRequest({method:"POST",url:n,body:t})},o.prototype.saveAsPreferences=function(e){var t=JSON.stringify(e),n=this.urlBase+"/preferences/save";return this.doRequest({method:"POST",url:n,body:t})},o.prototype.savePreferences=function(e,t){var n=JSON.stringify(t),o=this.urlBase+"/preferences/update/"+e;return this.doRequest({method:"PUT",url:o,body:n})},o.prototype.getPreferences=function(e,t){var n=this.urlBase+"/preferences/preferences?entity="+e+"&service="+t+"&type=REPORT";return this.doRequest({method:"GET",url:n})},o.prototype.getFunctions=function(e){var t=JSON.stringify(e),n=this.urlBase+"/dynamicjasper/functionsName";return this.doRequest({method:"POST",url:n,body:t})},o.prototype.deletePreferences=function(e){var t=this.urlBase+"/preferences/remove/"+e;return this.doRequest({method:"DELETE",url:t})},o.prototype.doRequest=function(t){return e.prototype.doRequest.call(this,{method:t.method,url:t.url,body:t.body,errorCallBack:this.errorCallBack})},o.prototype.errorCallBack=function(e){var t=e.error;n.Util.isObject(t)&&1===t.code&&n.Util.isDefined(t.message)?this.showNotificationError(t.message):this.showNotificationError("MESSAGES.ERROR_QUERY")},o.prototype.showNotificationError=function(e){this.oErrorDialogManager.openErrorDialog(e)},o.prototype.upload=function(e,t,o){var r=this;return new n.Observable((function(n){var i=r.urlBase+"/reportstore/"+t,s=new FormData;e.forEach((function(e){e.prepareToUpload(),e.isUploading=!0,s.append("name",e.name),s.append("file",e.file)})),o&&s.append("data",JSON.stringify(o));var l=new a.HttpRequest("POST",i,s,{headers:r.buildHeadersReport(),reportProgress:!0});r.httpClient.request(l).subscribe((function(e){if(a.HttpEventType.UploadProgress===e.type){var t={loaded:e.loaded,total:e.total};n.next(t)}else a.HttpEventType.Response===e.type&&(e.body?r.bodyCode(e,n):n.next(e.body))}),(function(e){console.error(e),401===e.status?r.authService.logout():n.error(e)}),(function(){return n.complete()}))})).pipe(i.share())},o.prototype.bodyCode=function(e,t){3===e.body.code?this.authService.logout():1===e.body.code?t.error(e.body.message):0===e.body.code?t.next(e.body):t.error("Service unavailable")},o.prototype.advancedQuery=function(e,t,o,r,a,i,s){a=n.Util.isDefined(a)?a:this.offset;var l=0;n.Util.isDefined(a)&&(l=Math.trunc(a/10)+1);var c=this.urlBase+"/reportstore/"+o+"/?format=json&page="+l;return this.doRequest({method:"GET",url:c})},o.prototype.query=function(e,t,n,o){var r=e.UUID,a="";return a=0===Object.keys(e).length?this.urlBase+"/reportstore/"+n:this.urlBase+"/reportstore/"+n+"/"+r,this.doRequest({method:"GET",url:a})},o.prototype.fillReport=function(e,t,n,o){for(var r=e[0],a="",i=1;i<e.length;i++)a=a+e[i].toString()+",";var s=JSON.stringify({params:a,filter:o}),l=this.urlBase+"/reportstore/"+t+"/"+r;return this.doRequest({method:"POST",url:l,body:s})},o.prototype.delete=function(e,t,n){var o=e.valueOf()[Object.keys(e)[0]],r=this.urlBase+"/reportstore/removeReport/"+o;return this.doRequest({method:"DELETE",url:r})},o.prototype.update=function(e,t,n,o){var r=e.valueOf()[Object.keys(e)[0]],a=this.urlBase+"/reportstore/updateReport/"+r;return this.doRequest({method:"PUT",url:a,body:t})},o.prototype.buildHeadersReport=function(){var e=new a.HttpHeaders({"Access-Control-Allow-Origin":"*"}),t=this.authService.getSessionInfo().id;return n.Util.isDefined(t)&&(e=e.append("Authorization","Bearer "+t)),e},o.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],o.ctorParameters=function(){return[{type:t.Injector}]},o.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new o(t.ɵɵinject(t.INJECTOR))},token:o,providedIn:"root"}),o}(n.OntimizeEEService);var I=function(){function e(){}return e.DEFAULT_WIDTH_DIALOG="70%",e.DEFAULT_HEIGHT_DIALOG="90%",e.DEFAULT_WIDTH_COLUMN_STYLE=85,e.DEFAULT_ALIGNMENT_COLUMN_STYLE="left",e.DEFAULT_COLUMN_FUNCTION={columnName:"TOTAL",type:"TOTAL"},e}();var A=function(){function e(){}return e.setFullscreenDialog=function(e,t){e?t.updateSize(I.DEFAULT_WIDTH_DIALOG,I.DEFAULT_HEIGHT_DIALOG):t.updateSize("100%","100%")},e.cloneObject=function(e){return JSON.parse(JSON.stringify(e))},e.openModalVisor=function(e,t,n){e.open(t,{maxWidth:"100vw",maxHeight:"100vh",height:I.DEFAULT_HEIGHT_DIALOG,width:I.DEFAULT_WIDTH_DIALOG,panelClass:["o-dialog-class","o-table-dialog","o-report"],data:n})},e}(),T=function(){function e(e,t,n,o){var r=this;this.dialogRef=e,this.reportService=t,this.dialogService=n,this.data=o,this.pdf="",this.name="",this.fullscreen=!1,this.reportService.configureService(this.reportService.getDefaultServiceConfiguration()),this.reportService.configureAdapter(),this.name=this.data.name,this.reportService.fillReport(this.data.params,"fillReport",{},this.data.filter).subscribe((function(e){e&&e.data.length&&0===e.code&&(r.pdf=e.data[0].file)}),(function(e){r.dialogService&&r.dialogService.error("ERROR","SERVER_ERROR_MESSAGE"),console.log(e)}))}return e.prototype.setFullscreenDialog=function(){A.setFullscreenDialog(this.fullscreen,this.dialogRef),this.fullscreen=!this.fullscreen},e.decorators=[{type:t.Component,args:[{selector:"o-report-viewer",template:'<div mat-dialog-title class="dialog-title" fxLayout="row" fxLayoutAlign="space-between center">\n  {{ name }}\n  <div>\n    <mat-icon aria-label="fullscreen dialog" (click)="setFullscreenDialog()">\n      <ng-container *ngIf="fullscreen">fullscreen_exit</ng-container>\n      <ng-container *ngIf="!fullscreen">fullscreen</ng-container>\n    </mat-icon>\n    <mat-icon svgIcon="ontimize:close" [mat-dialog-close]="true"></mat-icon>\n  </div>\n</div>\n<div #dialog mat-dialog-content class="dialog-container">\n  <ngx-extended-pdf-viewer [base64Src]="pdf" [filenameForDownload]="name" [showBookmarkButton]="false" [showPropertiesButton]="false"\n    [showOpenFileButton]="false" useBrowserLocale="true" delayFirstView="1000" [textLayer]="true"></ngx-extended-pdf-viewer>\n</div>\n',encapsulation:t.ViewEncapsulation.None,host:{"[class.o-report-viewer]":"true"},styles:[".o-dialog-class .mat-dialog-container .o-report-viewer .mat-dialog-title .mat-icon{cursor:pointer}.o-dialog-class .mat-dialog-container .o-report-viewer .mat-dialog-content{max-height:calc(100% - 36px - 8px);height:100%;padding-top:8px;padding-bottom:0}.o-dialog-class .mat-dialog-container .o-report-viewer ngx-extended-pdf-viewer .zoom{height:100%}"]}]}],e.ctorParameters=function(){return[{type:r.MatDialogRef},{type:D},{type:n.DialogService},{type:void 0,decorators:[{type:t.Inject,args:[r.MAT_DIALOG_DATA]}]}]},e}();var O=function(){function e(e){this.injector=e,this.dialogService=this.injector.get(n.DialogService),this.dialog=this.injector.get(r.MatDialog),this.reportService=this.injector.get(D)}return e.prototype.openFillReport=function(e,t,n){var o=this;this.reportService.configureService(this.reportService.getDefaultServiceConfiguration()),this.reportService.configureAdapter();var r={UUID:e};this.reportService.query(r,null,"getReport",{}).subscribe((function(r){var a,i;if(r&&r.data.length&&0===r.code){var s=r.data[0].PARAMETERS,l=r.data[0].NAME,c=[];if(s.length>0){c=[e];var u=Object.values(t);try{for(var d=y(u),p=d.next();!p.done;p=d.next()){var m=p.value;c.push(m)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}}else c=[e];var f={params:c,filter:n,name:l};A.openModalVisor(o.dialog,T,f)}}),(function(e){o.dialogService&&o.dialogService.error("ERROR","SERVER_ERROR_MESSAGE"),console.log(e)}))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:t.Injector}]},e}();var C=function(){this.title="",this.subtitle="",this.vertical=!0,this.columns=[],this.groups=[],this.functions=[],this.style={grid:!1,rowNumber:!1,columnName:!0,backgroundOnOddRows:!1,hideGroupDetails:!1,groupNewPage:!1,firstGroupNewPage:!1},this.orderBy=[],this.entity="",this.service=""};var b=function(){function e(e,t,n,o){this.dialogService=e,this.reportsService=t,this.dialogo=n,this.data=o,this.configurationListData=[],this.getConfigurations()}return e.prototype.ngOnInit=function(){this.configurationList.selectedOptions=new c.SelectionModel(!1)},e.prototype.loadConfiguration=function(){this.dialogo.close(this.selectedConfiguration)},e.prototype.remove=function(){var e=this;this.dialogService.confirm("CONFIRM","TABLE.DIALOG.CONFIRM_REMOVE_CONFIGURATION").then((function(t){t&&e.reportsService.deletePreferences(e.selectedConfiguration.ID).subscribe((function(t){t&&0===t.code&&e.getConfigurations()}))}))},e.prototype.onClickConfigurationList=function(e){this.selectedConfiguration=e},e.prototype.getConfigurations=function(){var e=this;this.reportsService.getPreferences(this.data.entity,this.data.service).subscribe((function(t){t.isSuccessful()&&e.setDataArray(t.data)}))},e.prototype.setDataArray=function(e){n.Util.isArray(e)?this.configurationListData=e:this.configurationListData=[]},e.decorators=[{type:t.Component,args:[{selector:"apply-configuration-dialog",template:'<span mat-dialog-title>{{ \'TABLE.BUTTONS.APPLY_CONFIGURATION\' | oTranslate }}</span>\n<mat-dialog-content fxLayout="column">\n  <div mat-subheader>{{ \'TABLE.DIALOG.APPLY_CONFIGURATION\' | oTranslate }}</div>\n  <mat-selection-list #configurationList dense class="apply-configuration-dialog-list">\n    <mat-list-option (click)="onClickConfigurationList(configuration)" checkboxPosition="before"\n      *ngFor="let configuration of configurationListData" [value]="configuration">\n      <span matLine>{{ configuration.NAME }}</span>\n      <span matLine>{{ configuration.DESCRIPTION }}</span>\n    </mat-list-option>\n  </mat-selection-list>\n</mat-dialog-content>\n\n<mat-dialog-actions align="end">\n  <button type="button" (click)="remove()" mat-stroked-button [disabled]="configurationList.selectedOptions.selected.length!==1"\n    class="o-button-danger">\n    {{ \'DELETE\' | oTranslate }}\n  </button>\n  <span fxFlex></span>\n  <button type="button" mat-stroked-button [mat-dialog-close]="false" class="o-button-default">{{ \'CANCEL\' | oTranslate }}</button>\n  <button type="button" (click)="loadConfiguration()" mat-stroked-button [mat-dialog-close]="true"\n    [disabled]="configurationList.selectedOptions.selected.length!==1" class="o-button-primary">{{ \'OK\' | oTranslate}}</button>\n</mat-dialog-actions>\n'}]}],e.ctorParameters=function(){return[{type:n.DialogService},{type:D},{type:r.MatDialogRef},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[r.MAT_DIALOG_DATA]}]}]},e.propDecorators={configurationList:[{type:t.ViewChild,args:[r.MatSelectionList,{static:!0}]}]},e}();var R=function(e){function n(t,n){var o=e.call(this,n)||this;return o.dialogo=t,o.injector=n,o.formGroup=new u.FormGroup({name:new u.FormControl("",[u.Validators.required]),description:new u.FormControl("")}),o.setFormControl(o.formGroup.get("name")),o}return h(n,e),n.prototype.save=function(){this.dialogo.close({name:this.name,description:this.description})},n.decorators=[{type:t.Component,args:[{selector:"app-save-preferences-dialog",template:'<span mat-dialog-title>{{ \'TABLE.BUTTONS.SAVE_CONFIGURATION\' | oTranslate }}</span>\n\n<mat-dialog-content>\n  <div mat-subheader>{{ \'TABLE.DIALOG.SAVE_CONFIGURATION\' | oTranslate }}</div>\n  <form #form [formGroup]="formGroup" fxLayout="column">\n    <mat-form-field>\n      <input [(ngModel)]="name" matInput [matTooltip]="tooltipText" [matTooltipClass]="tooltipClass"\n        placeholder="{{ \'TABLE.DIALOG.CONFIGURATION_NAME\' | oTranslate }}" formControlName="name" required>\n      <mat-error *oMatError="hasError(formGroup.controls[\'name\'], \'required\')">{{ \'FORM_VALIDATION.REQUIRED\' | oTranslate }}</mat-error>\n    </mat-form-field>\n\n    <mat-form-field>\n      <textarea [(ngModel)]="description" matInput placeholder="{{ \'TABLE.DIALOG.CONFIGURATION_DESCRIPTION\' | oTranslate }}"\n        formControlName="description" rows="4" cols="50"></textarea>\n    </mat-form-field>\n\n  </form>\n</mat-dialog-content>\n\n<mat-dialog-actions align="end">\n  <button type="button" mat-stroked-button class="mat-primary" [mat-dialog-close]="false" class="o-button-default">\n    {{ \'CANCEL\' | oTranslate }}</button>\n  <button type="button" mat-stroked-button class="mat-primary" (click)="save()" [mat-dialog-close]="true" [disabled]="formGroup.invalid">\n    {{ \'SAVE\' | oTranslate }}</button>\n</mat-dialog-actions>\n'}]}],n.ctorParameters=function(){return[{type:r.MatDialogRef},{type:t.Injector}]},n}(n.OTableBaseDialogClass);var S=function(){function e(e,t){this.dialogo=e,this.reportFunction=t,this.functions=[{id:"SUM",value:"DIALOG.SELECT_FUNCTION.SUM"},{id:"AVERAGE",value:"DIALOG.SELECT_FUNCTION.AVG"},{id:"MAX",value:"DIALOG.SELECT_FUNCTION.MAX"},{id:"MIN",value:"DIALOG.SELECT_FUNCTION.MIN"}],this.selectedFunction=t.type}return e.prototype.save=function(){this.dialogo.close({columnName:this.reportFunction.columnName,type:this.selectedFunction})},e.decorators=[{type:t.Component,args:[{selector:"app-select-function-dialog",template:'<span mat-dialog-title> {{ \'DIALOG.SELECT_FUNCTION.TITLE\' | oReportsTranslate }}</span>\n\n<mat-dialog-content>\n  <div mat-subheader>{{ \'DIALOG.SELECT_FUNCTION.DESCRIPTION\' | oReportsTranslate }}</div>\n\n  <mat-radio-group name="Function" [(ngModel)]="selectedFunction" fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="12px">\n    <mat-radio-button *ngFor="let function of functions" [value]="function.id">\n      {{ function.value | oReportsTranslate }}\n    </mat-radio-button>\n  </mat-radio-group>\n\n</mat-dialog-content>\n\n<mat-dialog-actions align="end">\n  <button type="button" mat-stroked-button class="mat-primary" [mat-dialog-close]="false" class="o-button-default">\n    {{ \'CANCEL\' | oTranslate }}</button>\n  <button type="button" mat-stroked-button class="mat-primary" (click)="save()" [mat-dialog-close]="true" [disabled]="!selectedFunction">\n    {{\'SAVE\' | oTranslate }}</button>\n</mat-dialog-actions>\n',styles:[".mat-radio-group{margin:0 12px}"]}]}],e.ctorParameters=function(){return[{type:r.MatDialogRef},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[r.MAT_DIALOG_DATA]}]}]},e}();var E=function(){function e(e,t){this.dialogo=e,this.data=t,this.dataAlignment=[{name:"left",icon:"format_align_left"},{name:"center",icon:"format_align_center"},{name:"right",icon:"format_align_right"}],this.reportColumn=A.cloneObject(t),this.reportColumn.columnStyle&&!n.Util.isDefined(this.reportColumn.columnStyle.width)&&(this.reportColumn.columnStyle.width=I.DEFAULT_WIDTH_COLUMN_STYLE),this.reportColumn.columnStyle&&!n.Util.isDefined(this.reportColumn.columnStyle.alignment)&&(this.reportColumn.columnStyle.alignment=I.DEFAULT_ALIGNMENT_COLUMN_STYLE),this.reportColumn.columnStyle||(this.reportColumn.columnStyle={width:I.DEFAULT_WIDTH_COLUMN_STYLE,alignment:I.DEFAULT_ALIGNMENT_COLUMN_STYLE})}return e.prototype.confirm=function(){this.dialogo.close(this.reportColumn)},e.decorators=[{type:t.Component,args:[{selector:"app-style-dialog",template:'<span mat-dialog-title>{{ \'COLUMN_CONFIGURATION\' | oReportsTranslate }}</span>\n<mat-dialog-content>\n  <div mat-subheader>{{ \'SAVE_COLUMN_CONFIGURATION\' | oReportsTranslate }}</div>\n  <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="12px">\n    <form #form>\n      <mat-form-field fxFill>\n        <mat-label>{{ \'COLUMN_NAME\' | oReportsTranslate }}</mat-label>\n        <input id="columnNameInput" name="columnNameInput" matInput placeholder="{{ \'COLUMN_NAME\' | oReportsTranslate }}" required\n          [(ngModel)]="reportColumn.name" #columnNameInput="ngModel" [ngModelOptions]="{standalone: true}">\n      </mat-form-field>\n      <mat-form-field fxFill>\n        <input id="widthColumnInput" name="widthColumnInput" matInput type="number" placeholder="{{ \'COLUMN_WIDTH\' | oReportsTranslate }}" required\n          [(ngModel)]="reportColumn.columnStyle.width" #widthColumnInput="ngModel" [ngModelOptions]="{standalone: true}">\n        <span matSuffix>px</span>\n        <mat-hint></mat-hint>\n      </mat-form-field>\n      <mat-radio-group [(ngModel)]="reportColumn.columnStyle.alignment" fxFill fxLayout="row" fxLayoutAlign="space-between center"\n        [ngModelOptions]="{standalone: true}">\n        <mat-radio-button *ngFor="let aligmentItem of dataAlignment" [value]="aligmentItem.name" [checked]="reportColumn.columnStyle.alignment === aligmentItem">\n          <mat-icon fxFlex>\n            {{ aligmentItem.icon }}\n          </mat-icon>\n        </mat-radio-button>\n      </mat-radio-group>\n    </form>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions align="end">\n  <button type="button" mat-stroked-button class="mat-primary" [mat-dialog-close]="false" class="o-button-default">\n    {{ \'CANCEL\' | oTranslate }}</button>\n  <button type="button" mat-stroked-button class="mat-primary" (click)="confirm()" [mat-dialog-close]="true"\n    [disabled]="columnNameInput.invalid || widthColumnInput.invalid">\n    {{ \'SAVE\' | oTranslate }}</button>\n</mat-dialog-actions>\n'}]}],e.ctorParameters=function(){return[{type:l.MatDialogRef,decorators:[{type:t.Optional}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[l.MAT_DIALOG_DATA]}]}]},e}();var x=function(){function e(e,t,o){this.injector=e,this.dialogRef=t,this.data=o,this.orientations=[{text:"vertical",value:!0},{text:"horizontal",value:!1}],this.functionsData=[],this.initialFunctionsData=[],this.appliedConfiguration=!1,this.selectedFunctions=[],this.stylesArray=[{value:"grid",viewValue:"GRID"},{value:"rowNumber",viewValue:"ROW_NUMBER"},{value:"columnName",viewValue:"COLUMNS_NAMES"},{value:"backgroundOnOddRows",viewValue:"BACKGROUND_ODD_ROWS"},{value:"hideGroupDetails",viewValue:"GROUP_DETAILS"},{value:"groupNewPage",viewValue:"GROUP_PAGE"},{value:"firstGroupNewPage",viewValue:"FIRST_GROUP_PAGE"}],this.columnsOrderBy=[],this.openedSidenav=!0,this.fullscreen=!1,this.blankPdf="JVBERi0xLjYKJcOkw7zDtsOfCjIgMCBvYmoKPDwvTGVuZ3RoIDMgMCBSL0ZpbHRlci9GbGF0ZURlY29kZT4+CnN0cmVhbQp4nDPQM1Qo5ypUMFAw0DMwslAwtTTVMzI3VbAwMdSzMDNUKErlCtdSyOMKVAAAtxIIrgplbmRzdHJlYW0KZW5kb2JqCgozIDAgb2JqCjUwCmVuZG9iagoKNSAwIG9iago8PAo+PgplbmRvYmoKCjYgMCBvYmoKPDwvRm9udCA1IDAgUgovUHJvY1NldFsvUERGL1RleHRdCj4+CmVuZG9iagoKMSAwIG9iago8PC9UeXBlL1BhZ2UvUGFyZW50IDQgMCBSL1Jlc291cmNlcyA2IDAgUi9NZWRpYUJveFswIDAgNTk1LjMwMzkzNzAwNzg3NCA4NDEuODg5NzYzNzc5NTI4XS9Hcm91cDw8L1MvVHJhbnNwYXJlbmN5L0NTL0RldmljZVJHQi9JIHRydWU+Pi9Db250ZW50cyAyIDAgUj4+CmVuZG9iagoKNCAwIG9iago8PC9UeXBlL1BhZ2VzCi9SZXNvdXJjZXMgNiAwIFIKL01lZGlhQm94WyAwIDAgNTk1IDg0MSBdCi9LaWRzWyAxIDAgUiBdCi9Db3VudCAxPj4KZW5kb2JqCgo3IDAgb2JqCjw8L1R5cGUvQ2F0YWxvZy9QYWdlcyA0IDAgUgovT3BlbkFjdGlvblsxIDAgUiAvWFlaIG51bGwgbnVsbCAwXQovTGFuZyhlcy1FUykKPj4KZW5kb2JqCgo4IDAgb2JqCjw8L0F1dGhvcjxGRUZGMDA1MDAwNjEwMDc0MDA3MjAwNjkwMDYzMDA2OTAwNjEwMDIwMDA0RDAwNjEwMDcyMDA3NDAwRUQwMDZFMDA2NTAwN0EwMDIwMDA1NDAwNjkwMDZDMDA3NjAwNjU+Ci9DcmVhdG9yPEZFRkYwMDU3MDA3MjAwNjkwMDc0MDA2NTAwNzI+Ci9Qcm9kdWNlcjxGRUZGMDA0QzAwNjkwMDYyMDA3MjAwNjUwMDRGMDA2NjAwNjYwMDY5MDA2MzAwNjUwMDIwMDAzNzAwMkUwMDMxPgovQ3JlYXRpb25EYXRlKEQ6MjAyMjA1MTAxNDUyMDYrMDInMDAnKT4+CmVuZG9iagoKeHJlZgowIDkKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMjM0IDAwMDAwIG4gCjAwMDAwMDAwMTkgMDAwMDAgbiAKMDAwMDAwMDE0MCAwMDAwMCBuIAowMDAwMDAwNDAyIDAwMDAwIG4gCjAwMDAwMDAxNTkgMDAwMDAgbiAKMDAwMDAwMDE4MSAwMDAwMCBuIAowMDAwMDAwNTAwIDAwMDAwIG4gCjAwMDAwMDA1OTYgMDAwMDAgbiAKdHJhaWxlcgo8PC9TaXplIDkvUm9vdCA3IDAgUgovSW5mbyA4IDAgUgovSUQgWyA8RDdBODhCRTRFREFDRkU1RDFGMTIwMzNFMDUyN0JERkU+CjxEN0E4OEJFNEVEQUNGRTVEMUYxMjAzM0UwNTI3QkRGRT4gXQovRG9jQ2hlY2tzdW0gLzgwNTA5NDU4QjgyN0RCRDQ2QzlEODdBMjY4NjdCNEFDCj4+CnN0YXJ0eHJlZgo4NzYKJSVFT0YK",this.appConfig=this.injector.get(n.AppConfig),this.translateService=this.injector.get(n.OTranslateService),this.snackBarService=this.injector.get(n.SnackBarService),this.reportService=this.injector.get(D),this.dialogService=this.injector.get(n.DialogService),this.dialog=this.injector.get(l.MatDialog)}return e.prototype.ngOnInit=function(){this.initialize()},e.prototype.initialize=function(){this.table=this.data,this.language=this.translateService.getCurrentLang(),this.service=this.table.service,this.columnsArray=this.parseColumnsVisible(),this.initialColumnsData=this.parseReportColumn(this.columnsArray),this.initialColumnsToGroupData=this.columnsArray,this.currentConfiguration={ENTITY:this.table.entity},this.initializeReportPreferences(),this.getFunctions()},e.prototype.getDefaultServiceConfiguration=function(e){var t=this.appConfig.getServiceConfiguration(),n={};return e&&t.hasOwnProperty(e)&&(n=t[e]),n},e.prototype.previewReport=function(){this.openReport()},e.prototype.clearCurrentPreferences=function(){this.initializeReportPreferences(),this.columnsList&&this.columnsList.deselectAll(),this.functionsList&&this.functionsList.deselectAll(),this.orderByList&&this.orderByList.deselectAll()},e.prototype.initializeReportPreferences=function(){this.columnsData=A.cloneObject(this.initialColumnsData),this.functionsData=A.cloneObject(this.initialFunctionsData),this.columnsToGroupData=A.cloneObject(this.initialColumnsToGroupData),this.columnsOrderBy=[],this.pdf=this.blankPdf,this.currentPreference=new C,this.currentPreference.entity=this.table.entity,this.currentPreference.service=this.table.service},e.prototype.parseColumnsVisible=function(){var e=n.Util.parseArray(this.table.columns);return this.table.oTableOptions.columns.filter((function(t){return"image"!==t.type&&t.visible&&e.findIndex((function(e){return e===t.attr}))>-1})).map((function(e){return e.attr}))},e.prototype.parseReportColumn=function(e){var t=this;return e.map((function(e){var o={id:e,name:t.translateService.get(e)},r=t.parseColumnStyle(e);return n.Util.isObject(r)&&Object.keys(r).length>0&&(o.columnStyle=r),o}))},e.prototype.parseColumnStyle=function(e){var t={},o=this.createRenderer(e);return n.Util.isDefined(o)&&n.Util.isDefined(o.type)&&(t.renderer=o),t},e.prototype.parseColumnsOrderBy=function(e){return e.map((function(e){return{columnId:e.columnId,columnName:e.name,ascendent:e.ascendent}}))},e.prototype.openReport=function(){var e,t=this,o=this.getDefaultServiceConfiguration(this.currentPreference.service);n.Util.isObject(o)&&o.hasOwnProperty("path")&&(e=o.path),this.reportService.createReport({title:this.currentPreference.title,groups:this.currentPreference.groups,entity:this.currentPreference.entity,path:e,service:this.currentPreference.service,vertical:this.currentPreference.vertical,functions:this.currentPreference.functions,style:this.currentPreference.style,subtitle:this.currentPreference.subtitle,columns:this.currentPreference.columns,orderBy:this.currentPreference.orderBy,language:this.language}).subscribe((function(e){e&&e.data.length&&0===e.code&&(t.pdf=e.data[0].file)}))},e.prototype.getFunctions=function(){var e=this;this.reportService.getFunctions({columns:this.columnsArray,entity:this.currentPreference.entity,service:this.currentPreference.service,language:this.language}).subscribe((function(t){t&&t.data.length&&0===t.code&&(e.functionsData=e.parseDefaultFunctionsData(t.data[0].functions),e.initialFunctionsData=A.cloneObject(e.functionsData))}))},e.prototype.parseDefaultFunctionsData=function(e){var t=this;return e.filter((function(e){return-1===t.columnsData.findIndex((function(t){return t.columnStyle&&t.columnStyle.renderer&&"service"===t.columnStyle.renderer.type&&t.id===e.columnName}))}))},e.prototype.checkPreferenceData=function(){var e=this;this.currentPreference.columns=this.currentPreference.columns.filter((function(t){return e.initialColumnsData.findIndex((function(e){return e.id===t.id}))>-1})),this.currentPreference.groups=this.currentPreference.groups.filter((function(t){return e.initialColumnsToGroupData.findIndex((function(e){return e===t}))>-1})),this.currentPreference.functions=this.currentPreference.functions.filter((function(t){return e.initialFunctionsData.findIndex((function(e){return e.columnName===t.columnName}))>-1})),this.currentPreference.orderBy=this.currentPreference.orderBy.filter((function(t){return e.columnsOrderBy.findIndex((function(e){return e.columnId===t.columnId}))>-1}))},e.prototype.applyConfiguration=function(e){var t=this;this.clearCurrentPreferences(),this.currentConfiguration=e,this.currentPreference=JSON.parse(this.currentConfiguration.PREFERENCES),this.currentPreference.columns.forEach((function(e){return t.updateColumnsOrderByData(e.id)})),this.checkPreferenceData(),this.functionsData=this.functionsData.map((function(e){var n=t.currentPreference.functions.findIndex((function(t){return t.columnName===e.columnName}));return n>-1&&(e.type=t.currentPreference.functions[n].type),e})),this.columnsData.sort((function(e,n){var o=t.currentPreference.columns.findIndex((function(t){return t.id===e.id})),r=t.currentPreference.columns.findIndex((function(e){return e.id===n.id}));return t.getSortIndex(o,r)})),this.columnsOrderBy.sort((function(e,n){var o=t.currentPreference.orderBy.findIndex((function(t){return t.columnId===e.columnId})),r=t.currentPreference.orderBy.findIndex((function(e){return e.columnId===n.columnId}));return t.getSortIndex(o,r)})),this.columnsToGroupData.sort((function(e,n){var o=t.currentPreference.groups.findIndex((function(t){return t===e})),r=t.currentPreference.groups.findIndex((function(e){return e===n}));return t.getSortIndex(o,r)}))},e.prototype.getSortIndex=function(e,t){return-1===e?0:-1===t?t:e-t},e.prototype.showColumnStyleDialog=function(e,t){var o=this;e.stopPropagation();var r=Object.assign({},this.currentPreference.columns.find((function(e){return e.id===t})));n.Util.isDefined(r)&&this.dialog.open(E,{data:r,panelClass:["o-dialog-class","o-table-dialog"]}).afterClosed().subscribe((function(e){if(n.Util.isDefined(e)&&e){var t=A.cloneObject(e);o.updateColumnStyleConfigurationData(t)}}))},e.prototype.updateColumnStyleConfigurationData=function(e){var t=A.cloneObject(this.currentPreference.columns);this.currentPreference.columns=[];var n=this.columnsData.findIndex((function(t){return t.id===e.id}));n>-1&&(this.columnsData[n]=e);var o=t.findIndex((function(t){return t.id===e.id}));o>-1&&(t[o]=e),this.currentPreference.columns=t},e.prototype.selectFunction=function(e,t){var n=this;e.stopPropagation(),"TOTAL"!=t.columnName&&this.dialog.open(S,{data:t,panelClass:["o-dialog-class","o-table-dialog"]}).afterClosed().subscribe((function(e){e&&(n.updatedFunctionData(e),n.updatedSelectFunction(e))}))},e.prototype.updatedFunctionData=function(e){var t=this.functionsData.findIndex((function(t){return t.columnName===e.columnName}));-1===t?this.functionsData.push(e):this.functionsData[t]=e},e.prototype.updatedSelectFunction=function(e){var t=this;this.currentPreference.functions.forEach((function(n,o){n.columnName===e.columnName&&(t.currentPreference.functions[o]=n)}))},e.prototype.openSaveAsPreferences=function(){var e=this;this.dialog.open(R,{panelClass:["o-dialog-class","o-table-dialog"]}).afterClosed().subscribe((function(t){n.Util.isDefined(t)&&t&&e.savePreferences(t)}))},e.prototype.dropColumns=function(e){s.moveItemInArray(this.columnsData,e.previousIndex,e.currentIndex),this.updateColumnsSort()},e.prototype.dropGroups=function(e){s.moveItemInArray(this.columnsToGroupData,e.previousIndex,e.currentIndex),this.updateColumnToGroupSort()},e.prototype.dropColumnsOrderBy=function(e){s.moveItemInArray(this.columnsOrderBy,e.previousIndex,e.currentIndex),this.updateColumnGroupBySort()},e.prototype.updateColumnsSort=function(){var e=this;this.currentPreference.columns.sort((function(t,n){return e.columnsData.findIndex((function(e){return e.id===t.id}))-e.columnsData.findIndex((function(e){return e.id===n.id}))}))},e.prototype.updateColumnGroupBySort=function(){var e=this;this.currentPreference.orderBy.sort((function(t,n){return e.columnsOrderBy.findIndex((function(e){return e.columnId===t.columnId}))-e.columnsOrderBy.findIndex((function(e){return e.columnId===n.columnId}))}))},e.prototype.updateColumnToGroupSort=function(){var e=this;this.currentPreference.groups.sort((function(t,n){return e.columnsToGroupData.findIndex((function(e){return e===t}))-e.columnsToGroupData.findIndex((function(e){return e===n}))}))},e.prototype.onApplyConfigurationClicked=function(){var e=this;this.dialog.open(b,{width:"calc((75em - 100%) * 1000)",maxWidth:"65vw",minWidth:"30vw",disableClose:!0,panelClass:["o-dialog-class","o-table-dialog"],data:{entity:this.currentPreference.entity,service:this.currentPreference.service}}).afterClosed().subscribe((function(t){n.Util.isDefined(t)&&t&&(e.applyConfiguration(t),e.appliedConfiguration=!0)}),(function(t){e.appliedConfiguration=!1}))},e.prototype.openSavePreferences=function(){var e=this;n.Util.isDefined(this.currentConfiguration.ID)?this.savePreferences({name:this.currentConfiguration.NAME,description:this.currentConfiguration.DESCRIPTION},!0):this.dialog.open(R,{panelClass:["o-dialog-class","o-table-dialog"]}).afterClosed().subscribe((function(t){n.Util.isDefined(t)&&t&&e.savePreferences(t,!0)}))},e.prototype.savePreferences=function(e,t){var n=this,o={name:e.name,description:e.description,entity:this.currentPreference.entity,service:this.currentPreference.service,type:"REPORT",params:{title:this.currentPreference.title,groups:this.currentPreference.groups,vertical:this.currentPreference.vertical,functions:this.currentPreference.functions,style:this.currentPreference.style,subtitle:this.currentPreference.subtitle,columns:this.currentPreference.columns,orderBy:this.currentPreference.orderBy,entity:this.currentPreference.entity,service:this.currentPreference.service}};t?this.reportService.savePreferences(this.currentConfiguration.ID,o).subscribe((function(e){n.showConfirmOperatinInSnackBar(e)})):this.reportService.saveAsPreferences(o).subscribe((function(e){e&&0===e.code&&n.showConfirmOperatinInSnackBar(e)}))},e.prototype.showConfirmOperatinInSnackBar=function(e){e&&0===e.code&&this.snackBarService.open("MESSAGES.SAVED",{icon:"check_circle"})},e.prototype.setFullscreenDialog=function(){A.setFullscreenDialog(this.fullscreen,this.dialogRef),this.fullscreen=!this.fullscreen},e.prototype.onSelectionChangeColumns=function(e){var t=e.option.value.id;this.updateColumnsOrderByData(t,e)},e.prototype.onSelectionChangeGroups=function(e){if(e.option.selected){var t=e.option.value;if(this.updateColumnsOrderByData(t,e),e.option.selected&&-1===this.currentPreference.columns.findIndex((function(e){return e.id===t}))){var n=this.columnsData.filter((function(e){return e.id===t}));n.length>0&&this.addColumnData(n[0])}}},e.prototype.updateColumnsOrderByData=function(e,t){if(!t&&-1===this.columnsArray.findIndex((function(t){return t===e})))return void console.warn("The loaded configuration has the column "+e+" configured but this column does not exist as a table column");var n={columnId:e,ascendent:!0},o=this.columnsOrderBy.findIndex((function(t){return t.columnId===e}));!t||t&&t.option.selected?-1===o&&this.columnsOrderBy.push(n):o>-1&&this.columnsOrderBy.splice(o)},e.prototype.addColumnData=function(e){var t=A.cloneObject(this.currentPreference);t.columns.push(e),this.currentPreference=t,this.updateColumnsSort()},e.prototype.onSelectionChangeFunctions=function(e){if(e.option.selected&&"TOTAL"!==e.option.value.columnName){var t=e.option.value.columnName;if(e.option.selected&&-1===this.currentPreference.columns.findIndex((function(e){return e.id===t}))){var n=this.columnsData.find((function(e){return e.id===t}));this.addColumnData(n)}}},e.prototype.changeOrder=function(e,t){var n=this.columnsOrderBy.find((function(t){return t.columnId===e.columnId}));n&&(n.ascendent=!n.ascendent),t.stopPropagation()},e.prototype.isCheckedColumn=function(e){return this.currentPreference.columns.length>0&&this.currentPreference.columns.filter((function(t){return t.id===e.id})).length>0},e.prototype.isCheckedFunction=function(e){return this.currentPreference.functions.length>0&&this.currentPreference.functions.filter((function(t){return t.columnName===e.columnName&&t.type===e.type&&"TOTAL"!==t.type})).length>0},e.prototype.columnsOrderByCompareFunction=function(e,t){return e.columnId===t.columnId},e.prototype.onCheckboxStyleClick=function(e){this.currentPreference.style[e]?this.currentPreference.style[e]=!1:this.currentPreference.style[e]=!0},e.prototype.columnsCompareFunction=function(e,t){return e.id===t.id},e.prototype.functionsCompareFunction=function(e,t){return e.columnName===t.columnName},e.prototype.createRenderer=function(e){var t,o=this.table.oTableOptions.columns.find((function(t){return t.attr===e}));if(n.Util.isDefined(o)&&n.Util.isDefined(o.type)&&"string"!==o.type){var r=o.type;t={};var a=o.renderer;switch(r){case"currency":t.type=r,t.currencySymbol=a.currencySymbol,t.currencySymbolPosition=a.currencySymbolPosition;break;case"date":t.type=r,t.format=a.format;break;case"integer":t.type=r,t.grouping=a.grouping,t.thousandSeparator=a.thousandSeparator;break;case"real":t.type=r,t.decimalSeparator=a.decimalSeparator,t.grouping=a.grouping,t.thousandSeparator=a.thousandSeparator;break;case"service":t.type=r,t.entity=a.entity,t.service=a.service,t.keyColumn=o.attr,t.columns=n.Util.parseArray(a.columns),t.valueColumn=a.valueColumn,t.parentKeys=n.Util.parseArray(a.parentKeys);var i=this.getDefaultServiceConfiguration(a.service);n.Util.isObject(i)&&Object.hasOwnProperty(i.path)&&(t.path=i.path)}}return t},e.decorators=[{type:t.Component,args:[{selector:"o-report-on-demand",template:'<div mat-dialog-title class="dialog-title" fxLayout="row" fxLayoutAlign="space-between center">\n  {{ \'REPORT_ON_DEMAND_TITLE\' | oReportsTranslate }}\n  <div>\n    <mat-icon svgIcon="ontimize:settings" #configurationMenuButton [matMenuTriggerFor]="configurationMenu"></mat-icon>\n    <mat-icon aria-label="fullscreen dialog" (click)="setFullscreenDialog()">\n      <ng-container *ngIf="fullscreen">fullscreen_exit</ng-container>\n      <ng-container *ngIf="!fullscreen">fullscreen</ng-container>\n    </mat-icon>\n    <mat-icon svgIcon="ontimize:close" [mat-dialog-close]="true"></mat-icon>\n\n    <mat-menu #configurationMenu="matMenu" class="o-mat-menu">\n      <button type="button" [disabled]="!appliedConfiguration" mat-menu-item (click)="openSavePreferences()">\n        {{ \'BUTTONS.SAVE_CONFIGURATION\' | oReportsTranslate }}\n      </button>\n      <button type="button" mat-menu-item (click)="openSaveAsPreferences()">\n        {{ \'BUTTONS.SAVEAS_CONFIGURATION\' | oReportsTranslate }}\n      </button>\n      <button type="button" mat-menu-item (click)="onApplyConfigurationClicked()">\n        {{\'BUTTONS.APPLY_CONFIGURATION\'| oReportsTranslate }}\n      </button>\n    </mat-menu>\n  </div>\n</div>\n<div #dialog mat-dialog-content class="dialog-container">\n  <mat-sidenav-container class="mat-sidenav-container" [class.opened]="openedSidenav" fxFill>\n    <mat-sidenav #sidenav [(opened)]="openedSidenav" mode="side" class="report-on-demand-sidenav">\n      <div fxLayout="column" fxFill fxLayoutGap="20px">\n        <o-button (click)="openedSidenav=!openedSidenav" svg-icon="ontimize:menu" type="ICON" label=""\n          [matTooltip]="(sidenav.opened?\'HIDE_FILTERS\':\'SHOW_FILTERS\') | oTranslate">\n        </o-button>\n\n        <div fxLayout="column" *ngIf="openedSidenav" class="container-title" fxLayoutGap="10px">\n          <mat-form-field>\n            <input [(ngModel)]="currentPreference.title" matInput placeholder="{{ \'TITLE\' | oReportsTranslate }}">\n          </mat-form-field>\n          <mat-form-field>\n            <input [(ngModel)]="currentPreference.subtitle" matInput placeholder="{{ \'SUBTITLE\' | oReportsTranslate }}">\n          </mat-form-field>\n        </div>\n\n        <mat-accordion multi="true" displayMode="flat" fxFlex="1 1 auto" *ngIf="openedSidenav" [@.disabled]="true">\n          <mat-expansion-panel class="acordions">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'ORIENTATION\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-radio-group name="Orientation" [(ngModel)]="currentPreference.vertical" fxLayout="column" fxLayoutGap="12px">\n              <mat-radio-button *ngFor="let orientation of orientations" name="Orientation" [value]="orientation.value"\n                [checked]="currentPreference.vertical === orientation.value">\n                {{ orientation.text | oReportsTranslate}}\n              </mat-radio-button>\n            </mat-radio-group>\n          </mat-expansion-panel>\n\n          <mat-expansion-panel class="acordions">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'STYLE\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-selection-list dense #settings>\n              <mat-list-option checkboxPosition="before" [selected]="currentPreference.style[choice.value]" *ngFor="let choice of stylesArray"\n                [value]="choice.value" (click)="onCheckboxStyleClick(choice.value)">\n                <div fxLayout="row">\n                  <span fxFlex>\n                    {{choice.viewValue | oReportsTranslate}}\n                  </span>\n                </div>\n              </mat-list-option>\n            </mat-selection-list>\n          </mat-expansion-panel>\n\n          <mat-expansion-panel class="acordions" expanded="true">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'COLUMNS\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-selection-list dense #columnsList cdkDropList [cdkDropListData]="columnsData" (cdkDropListDropped)="dropColumns($event)"\n              class="columns" [(ngModel)]="currentPreference.columns" (selectionChange)="onSelectionChangeColumns($event)"\n              [compareWith]="columnsCompareFunction">\n              <mat-list-option checkboxPosition="before" *ngFor="let column of columnsData" [value]="column" cdkDrag>\n                <div fxLayout="row" fxLayoutAlign="space-around center">\n                  <span mat-line fxFlex>\n                    {{column.id | oReportsTranslate}}\n                  </span>\n                  <mat-icon mat-list-icon *ngIf="isCheckedColumn(column)" (click)="showColumnStyleDialog($event, column.id)" class="button-edit">\n                    edit\n                  </mat-icon>\n                  <mat-icon mat-list-icon class="button-edit">drag_handle</mat-icon>\n                </div>\n              </mat-list-option>\n            </mat-selection-list>\n          </mat-expansion-panel>\n          <mat-expansion-panel class="acordions" *ngIf="columnsOrderBy.length > 0">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'ORDER_BY\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-selection-list dense #orderByList cdkDropList [cdkDropListData]="columnsOrderBy" (cdkDropListDropped)="dropColumnsOrderBy($event)"\n              class="columns" [(ngModel)]="currentPreference.orderBy" [compareWith]="columnsOrderByCompareFunction">\n              <mat-list-option checkboxPosition="before" *ngFor="let column of columnsOrderBy" [value]="column" cdkDrag>\n                <div fxLayout="row" fxLayoutAlign="space-around center">\n                  <span mat-line fxFlex>\n                    {{column.columnId | oReportsTranslate}}\n                  </span>\n                  <mat-icon *ngIf="column.ascendent" (click)="changeOrder(column, $event)" mat-list-icon svgIcon="ontimize:sort_by_alpha_asc"\n                    class="button-edit"></mat-icon>\n                  <mat-icon *ngIf="!column.ascendent" (click)="changeOrder(column, $event)" mat-list-icon svgIcon="ontimize:sort_by_alpha_desc"\n                    class="button-edit"></mat-icon>\n                  <mat-icon mat-list-icon class="button-edit">drag_handle</mat-icon>\n                </div>\n              </mat-list-option>\n            </mat-selection-list>\n          </mat-expansion-panel>\n          <mat-expansion-panel class="acordions">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'GROUPS\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-selection-list dense cdkDropList [cdkDropListData]="columnsToGroupData" (cdkDropListDropped)="dropGroups($event)"\n              [(ngModel)]="currentPreference.groups" (selectionChange)="onSelectionChangeGroups($event)">\n              <mat-list-option checkboxPosition="before" *ngFor="let column of columnsToGroupData" [value]="column" cdkDrag>\n                <div fxLayout="row" fxLayoutAlign="space-around center">\n                  <span mat-line fxFlex>\n                    {{ column | oTranslate }}\n                  </span>\n                  <mat-icon mat-list-icon class="button-edit">drag_handle</mat-icon>\n                </div>\n              </mat-list-option>\n            </mat-selection-list>\n          </mat-expansion-panel>\n\n          <mat-expansion-panel class="acordions" *ngIf="functionsData.length>0">\n            <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px">\n              <mat-panel-title>\n                {{ \'FUNCTIONS\' | oReportsTranslate }}\n              </mat-panel-title>\n            </mat-expansion-panel-header>\n            <mat-selection-list #functionsList dense [(ngModel)]="currentPreference.functions" [compareWith]="functionsCompareFunction"\n              (selectionChange)="onSelectionChangeFunctions($event)">\n              <mat-list-option checkboxPosition="before" *ngFor="let function of functionsData" [value]="function">\n                <div fxLayout="row" fxLayoutAlign="space-around center">\n                  <span mat-line fxFlex>\n                    <ng-container *ngIf="function.columnName===\'TOTAL\'; else functionColumnTemplate">\n                      {{function.type | oReportsTranslate}}\n                    </ng-container>\n                  </span>\n                  <ng-template #functionColumnTemplate>\n                    {{function.type | oReportsTranslate }}({{function.columnName | oReportsTranslate }})\n                  </ng-template>\n\n                  <mat-icon *ngIf="isCheckedFunction(function)" mat-list-icon (click)="selectFunction($event, function)" class="button-edit">\n                    edit\n                  </mat-icon>\n                </div>\n              </mat-list-option>\n            </mat-selection-list>\n          </mat-expansion-panel>\n        </mat-accordion>\n\n        <div mat-dialog-actions fxLayout="row" fxLayoutAlign="center center" *ngIf="openedSidenav">\n          <button type="button" mat-stroked-button class="o-report-on-demand-clear-button" (click)="clearCurrentPreferences()">\n            {{\'CLEAR\' | oReportsTranslate }}</button>\n          <button type="button" mat-stroked-button class="mat-primary" (click)="previewReport()" [disabled]="currentPreference.columns.length===0">\n            {{\'PREVIEW\' | oReportsTranslate }}</button>\n        </div>\n\n      </div>\n    </mat-sidenav>\n    <mat-sidenav-content>\n      <div class="sidenav-container-content">\n        <ngx-extended-pdf-viewer #pdfViewer [base64Src]="pdf" [filenameForDownload]="currentPreference.title" [showBookmarkButton]="false"\n          [showPropertiesButton]="false" [showOpenFileButton]="false" useBrowserLocale="true" delayFirstView="1000" [textLayer]="true">\n        </ngx-extended-pdf-viewer>\n      </div>\n    </mat-sidenav-content>\n  </mat-sidenav-container>\n</div>\n',encapsulation:t.ViewEncapsulation.None,host:{"[class.o-report-on-demand]":"true"},styles:[".o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-title .mat-icon{cursor:pointer}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content{max-height:calc(100% - 36px - 16px);height:100%;padding-top:16px;padding-bottom:0}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content ngx-extended-pdf-viewer .zoom{height:100%}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-icon{cursor:pointer}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav{visibility:visible!important;transform:none;top:0;left:0;padding:8px 16px;border:1px solid transparent}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-drawer-inner-container{overflow:hidden}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-dialog-actions{min-height:auto;padding-top:0}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-dialog-actions button.o-report-on-demand-clear-button{min-width:80px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-radio-group{margin:0 12px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion{overflow-y:scroll}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .acordions.mat-expansion-panel{border-radius:0;box-shadow:none;margin-bottom:8px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .acordions.mat-expansion-panel:last-of-type{margin-bottom:0}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .acordions.mat-expansion-panel .mat-expansion-panel-header{padding:0 8px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .acordions.mat-expansion-panel .mat-expansion-panel-body{padding:0}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .mat-list-option .button-edit{cursor:pointer}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .mat-list-option.cdk-drag{cursor:move}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .mat-list-option .mat-list-item-content{padding:0 0 0 8px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav .mat-accordion .mat-list-option .mat-list-item-content .mat-list-text{padding-right:8px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav.mat-drawer-opened{border:1px solid #dee1e6;border-radius:4px;width:256px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav-container{background-color:transparent}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav-container.opened .sidenav-container-content{margin-left:16px}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav-content{overflow:hidden}.o-dialog-class .mat-dialog-container .o-report-on-demand .mat-dialog-content .mat-sidenav-content .sidenav-container-content{margin-left:66px;height:100%}"]}]}],e.ctorParameters=function(){return[{type:t.Injector},{type:l.MatDialogRef},{type:n.OTableComponent,decorators:[{type:t.Inject,args:[l.MAT_DIALOG_DATA]}]}]},e.propDecorators={columnsList:[{type:t.ViewChild,args:["columnsList",{static:!1}]}],functionsList:[{type:t.ViewChild,args:["functionsList",{static:!1}]}],orderByList:[{type:t.ViewChild,args:["orderByList",{static:!1}]}]},e}();var N=function(){function e(e){this.injector=e,this.dialogService=this.injector.get(n.DialogService),this.dialog=this.injector.get(r.MatDialog)}return e.prototype.openReportOnDemand=function(e){A.openModalVisor(this.dialog,x,e)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.Injector}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(t.INJECTOR))},token:e,providedIn:"root"}),e}();function M(e){return new D(e)}var L=[{provide:n.O_REPORT_SERVICE,useClass:N},{provide:"report",useFactory:M,deps:[t.Injector]},v,O],P=function(){function e(e){var t=this;this.alertService=e,e.alert$.subscribe((function(e){t.table.refresh()}))}return e.decorators=[{type:t.Component,args:[{selector:"o-report-home",template:'<o-form-layout-manager attr="report" title="{{\'REPORTS\' | oTranslate }}" separator=" " mode="tab" label-columns="NAME">\n  <div fxLayout="column" fxLayoutAlign="start start" fxFill>\n    <o-table #table fxFlex attr="report" service-type="report" entity="listReports" keys="UUID"\n      columns="UUID;NAME;DESCRIPTION;REPORT_TYPE;MAIN_REPORT_FILENAME"\n      visible-columns="NAME;DESCRIPTION;REPORT_TYPE" query-rows="20" show-report-on-demand-option="no">\n      <o-table-column attr="NAME" title="{{\'REPORT_NAME\' | oTranslate }}" orderable="yes" searchable="yes" class="o-table-column-centered"></o-table-column>\n      <o-table-column attr="DESCRIPTION" title="{{\'REPORT_DESCRIPTION\' | oTranslate }}" orderable="yes" searchable="no" class="o-table-column-centered"></o-table-column>\n      <o-table-column attr="REPORT_TYPE" title="{{\'REPORT_TYPE\' | oTranslate }}" orderable="yes" searchable="no" class="o-table-column-centered"></o-table-column>\n    </o-table>\n  </div>\n</o-form-layout-manager>\n'}]}],e.ctorParameters=function(){return[{type:v}]},e.propDecorators={table:[{type:t.ViewChild,args:["table",{static:!0}]}]},e}();var w=function(){function e(e,t){this.alertService=e,this.dialogService=t,this.loading=!1}return e.prototype.getFileData=function(){return{name:this.name.getValue(),type:this.type.getValue(),description:this.description.getValue()}},e.prototype.onUploadFile=function(){this.loading=!1,this.confirm(),this.form._clearAndCloseFormAfterInsert()},e.prototype.onError=function(){this.dialogService&&(this.dialogService.error("ERROR","SERVER_ERROR_MESSAGE"),this.loading=!1)},e.prototype.confirm=function(){this.alertService.announceAlert("alert")},e.prototype.onClickSave=function(e){var t=this;Object.keys(this.form.formGroup.controls).forEach((function(e){t.form.formGroup.controls[e].markAsTouched()})),this.form.formGroup.valid?(this.loading=!0,this.file.onClickUpload(e)):this.dialogService.alert("ERROR","MESSAGES.FORM_VALIDATION_ERROR")},e.decorators=[{type:t.Component,args:[{selector:"o-report-new",template:'<o-form #form service-type="report" entity="addReport" keys="UUID" header-actions="R;I;U;D" show-header-navigation="no">\n  <div o-form-toolbar-buttons>\n    <button type="button" class="o-form-toolbar-button" mat-stroked-button (click)="onClickSave($event)" attr="fillreport">\n      <mat-icon>save</mat-icon>\n      <span>{{ \'SAVE\'| oReportsTranslate}}</span>\n    </button>\n  </div>\n  <o-column attr="row1" title="REPORT_DATA" icon="description" layout-gap="14px" fxFill>\n    <div fxLayout="row wrap" fxLayoutGap="14px" fxLayoutAlign="start start" fxFlex>\n      <o-text-input #name class="input-padding" attr="NAME" label="REPORT_NAME" fxFlex="50" required="yes"></o-text-input>\n      <o-text-input #type class="input-padding" attr="REPORT_TYPE" label="REPORT_TYPE" fxFlex required="yes"></o-text-input>\n    </div>\n    <o-textarea-input #description attr="DESCRIPTION" label="REPORT_DESCRIPTION" fxFlex required="yes"></o-textarea-input>\n    <o-file-input #file attr="file" fxFlex="50" service="report" service-type="report" entity="addReport" label="REPORT_ZIPFOLDER" show-info="yes"\n      workspace-key="id" required="yes" (onUploadFile)="onUploadFile()" accept-file-type=".zip" [additional-data]="getFileData()"\n      (onErrorFile)="onError()">\n    </o-file-input>\n  </o-column>\n</o-form>\n<div class="loading" *ngIf="loading">\n  <div class="spinner">\n    <mat-spinner mode="indeterminate"></mat-spinner>\n  </div>\n</div>\n',encapsulation:t.ViewEncapsulation.None,host:{"[class.app-report-store-new]":"true"},styles:[".o-form-toolbar-button.o-form-toolbar-button-insert{display:none}.loading{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;background-color:#fff;opacity:.5;z-index:1000}.spinner{position:absolute;top:50%;left:50%;margin-top:-20px;margin-left:-25px;width:50px;height:40px;text-align:center;font-size:10px;opacity:1}"]}]}],e.ctorParameters=function(){return[{type:v},{type:n.DialogService}]},e.propDecorators={name:[{type:t.ViewChild,args:["name",{static:!0}]}],type:[{type:t.ViewChild,args:["type",{static:!0}]}],description:[{type:t.ViewChild,args:["description",{static:!0}]}],form:[{type:t.ViewChild,args:["form",{static:!0}]}],file:[{type:t.ViewChild,args:["file",{static:!0}]}]},e}();var U=function(){function e(e,t){this.dialogService=e,this.dialog=t,this.hasParams=!1}return e.prototype.getValues=function(){for(var e=0;e<this.parameters.length;e++){var t=this.paramForm.getFieldValue("value"+e);this.values.push(t)}},e.prototype.fillReport=function(){if(this.values=[],this.av=[this.id.getValue()],this.parameters.length>0){this.getValues();for(var e=this.values.length,t=0;t<e;t++)this.av.push(this.values.shift())}this.dialog.open(T,{height:I.DEFAULT_HEIGHT_DIALOG,width:I.DEFAULT_HEIGHT_DIALOG,data:{params:this.av,filter:{}}})},e.prototype.onDataLoaded=function(e){this.parameters=e.PARAMETERS,this.parameters.length>0&&(this.hasParams=!0)},e.decorators=[{type:t.Component,args:[{selector:"o-report-detail",template:'<o-form #form attr="report" service-type="report" entity="getReport" keys="UUID" header-actions="R;I;U;D" show-header="yes"\n  show-header-navigation="yes" fxLayout="column" (onDataLoaded)="onDataLoaded($event)">\n  <o-column attr="row1" title="REPORT_DATA" icon="description" layout-gap="14px" fxFill>\n    <o-text-input #id attr="UUID" label="REPORT_ID" enabled="no" fxFlex="100"></o-text-input>\n    <div fxLayout="row wrap" fxLayoutGap="14px" fxLayoutAlign="start start" fxFlex>\n      <o-text-input attr="NAME" label="REPORT_NAME" required="yes" fxFlex="50"></o-text-input>\n      <o-text-input attr="REPORT_TYPE" label="REPORT_TYPE" required="yes" fxFlex></o-text-input>\n    </div>\n    <o-text-input class="form-field" attr="MAIN_REPORT_FILENAME" label="REPORT_FILENAME" required="yes" fxFlex></o-text-input>\n    <o-textarea-input class="form-field" attr="DESCRIPTION" label="REPORT_DESCRIPTION" required="yes" fxFlex></o-textarea-input>\n  </o-column>\n\n  <div *ngIf="hasParams">\n    <o-column #params title="PARAMETERS" icon="info" class="vertical-margin-10" layout-align="start stretch" appearance="outline">\n      <o-form #paramForm attr="report" service-type="report" entity="fillReport" keys="id" header-mode="none" show-header="no"\n        layout-direction="column">\n        <ng-container *ngFor="let elem of parameters; let i = index">\n          <o-row fxFlex>\n            <ng-template [ngIf]="elem.valueClass == \'java.sql.Date\' || elem.valueClass == \'java.sql.Timestamp\'" [ngIfElse]="textInput">\n              <o-date-input [attr]="\'value\' + i" [label]="elem.name" required="yes" value-type="string" format="YYYY-MM-DD" fxFlex></o-date-input>\n            </ng-template>\n            <ng-template #textInput>\n              <o-text-input [attr]="\'value\' + i" [label]="elem.description" required="yes" fxFlex></o-text-input>\n            </ng-template>\n          </o-row>\n        </ng-container>\n      </o-form>\n    </o-column>\n  </div>\n  <o-button type="RAISED" (click)="fillReport()" label="{{ \'FILL_REPORT\' | oTranslate }}" icon="download" layout-padding color="accent"\n    [enabled]="form.formGroup?.valid && paramForm?.formGroup?.valid"></o-button>\n</o-form>\n'}]}],e.ctorParameters=function(){return[{type:n.DialogService},{type:r.MatDialog}]},e.propDecorators={id:[{type:t.ViewChild,args:["id",{static:!0}]}],paramForm:[{type:t.ViewChild,args:["paramForm",{static:!1}]}]},e}();var F={en:{REPORT_ON_DEMAND_TITLE:"Dynamic Reports","BUTTONS.SAVE_CONFIGURATION":"Save configuration","BUTTONS.SAVEAS_CONFIGURATION":"Save as configuration","BUTTONS.APPLY_CONFIGURATION":"Load configuration",TITLE:"Title",SUBTITLE:"Subtitle",ORIENTATION:"Orientation",STYLE:"Style",COLUMNS:"Columns to print",GROUPS:"Groups",FUNCTIONS:"Functions",PREVIEW:"Preview",COLUMN_CONFIGURATION:"Column Configuration",SAVE_COLUMN_CONFIGURATION:"Enter a name, a with and a alignment for the column",GRID:"Draw grid",ROW_NUMBER:"Row numbers",COLUMNS_NAMES:"Column names",GROUP_DETAILS:"Hide group details",GROUP_PAGE:"Group in page",BACKGROUND_ODD_ROWS:"Background on odd rows",FIRST_GROUP_PAGE:"First group in page","DIALOG.SELECT_FUNCTION.TITLE":"Select function","DIALOG.SELECT_FUNCTION.DESCRIPTION":"Select one of the following functions",COLUMN_NAME:"Column name",COLUMN_WIDTH:"Column width","DIALOG.SELECT_FUNCTION.MIN":"Minumun","DIALOG.SELECT_FUNCTION.MAX":"Maximun","DIALOG.SELECT_FUNCTION.AVG":"Average","DIALOG.SELECT_FUNCTION.SUM":"Sum",ORDER_BY:"Order by",CLEAR:"Clear",MIN:"Minumun",MAX:"Maximun",AVERAGE:"Average",SUM:"Sum",TOTAL:"Total"},es:{REPORT_ON_DEMAND_TITLE:"Informes Dinámicos","BUTTONS.SAVE_CONFIGURATION":"Guardar configuración","BUTTONS.SAVEAS_CONFIGURATION":"Guardar configuración como","BUTTONS.APPLY_CONFIGURATION":"Aplicar configuración",TITLE:"Título",SUBTITLE:"Subtítulo",ORIENTATION:"Orientación",STYLE:"Estilo",COLUMNS:"Columnas a imprimir",GROUPS:"Grupos",FUNCTIONS:"Funciones",PREVIEW:"Previsualizar",COLUMN_CONFIGURATION:"Configuración de columna",SAVE_COLUMN_CONFIGURATION:"Introduzca un nombre, un ancho y una alineación para la columna",GRID:"Dibujar rejilla",ROW_NUMBER:"Números de fila",COLUMNS_NAMES:"Nombre de columnas",GROUP_DETAILS:"Ocultar detalles grupo",GROUP_PAGE:"Grupo en página",BACKGROUND_ODD_ROWS:"Fondo sobre filas impares",FIRST_GROUP_PAGE:"Primer grupo en página","DIALOG.SELECT_FUNCTION.TITLE":"Seleccionar función","DIALOG.SELECT_FUNCTION.DESCRIPTION":"Seleccione una de las siguientes funciones",COLUMN_NAME:"Nombre de la columna",COLUMN_WIDTH:"Ancho de la columna","DIALOG.SELECT_FUNCTION.MIN":"Mínimo","DIALOG.SELECT_FUNCTION.MAX":"Máximo","DIALOG.SELECT_FUNCTION.AVG":"Media","DIALOG.SELECT_FUNCTION.SUM":"Suma",ORDER_BY:"Ordenar por",CLEAR:"Limpiar",MIN:"Mínimo",MAX:"Máximo",AVERAGE:"Media",SUM:"Suma",TOTAL:"Total"}},_=function(){function e(e){this.injector=e,this.translateService=this.injector.get(n.OTranslateService)}return e.prototype.transform=function(e){var t=F[this.translateService.getCurrentLang()];return t&&t[e]?t[e]:this.translateService.get(e)},e.decorators=[{type:t.Pipe,args:[{name:"oReportsTranslate",pure:!1}]}],e.ctorParameters=function(){return[{type:t.Injector}]},e}();var G=[P,w,U,T,x,E,S,R,b,_],k=[m.CommonModule,n.OntimizeWebModule,p.NgxExtendedPdfViewerModule,d.FlexLayoutModule,s.DragDropModule],j=[T,x,E,S,R,b],B=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:G,imports:k,providers:L,entryComponents:j}]}],e}(),V=[{path:"",component:P},{path:"new",component:w},{path:":UUID",component:U}],Y=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[f.RouterModule.forChild(V)],exports:[f.RouterModule]}]}],e}();e.ApplyConfigurationDialogComponent=b,e.DefaultOReportPreferences=C,e.OReportDetailComponent=U,e.OReportHomeComponent=P,e.OReportModule=B,e.OReportNewComponent=w,e.OReportRoutingModule=Y,e.OReportService=D,e.OReportStoreService=O,e.OReportViewerComponent=T,e.OReportsTranslatePipe=_,e.OntimizeReportService=N,e.ReportOnDemandComponent=x,e.SavePreferencesDialogComponent=R,e.SelectFunctionDialogComponent=S,e.StyleDialogComponent=E,e.ɵa=G,e.ɵb=k,e.ɵc=j,e.ɵd=v,e.ɵe=M,e.ɵf=L,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ontimize-web-ngx-report.umd.min.js.map