import { Util } from '../util';
import * as lpn from 'google-libphonenumber';
var EMAIL_REGEXP = /^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;
var DNI_PATTERN = '^(([0-9]{8})([-]?)([a-zA-Z]{1}))$';
var NIE_PATTERN = '^(([x-zX-Z]{1})([-]?)([0-9]{7})([-]?)([a-zA-Z]{1}))$';
var DNI_CHECK = 'TRWAGMYFPDXBNJZSQVHLCKET';
var NUMBERS = '0123456789';
export var TWELVE_HOUR_FORMAT_PATTERN = '^(([0-9]|([01]?[0-9])):([0-9]|([0-5][0-9])) *([AaPp][Mm])*)$';
export var TWENTY_FOUR_HOUR_FORMAT_PATTERN = '^([0-9]|([01]?[0-9]|2[0-3])):[0-9]|([0-5][0-9])$';
var OValidators = (function () {
    function OValidators() {
    }
    OValidators.twelveHourFormatValidator = function (control) {
        var regExp = new RegExp(TWELVE_HOUR_FORMAT_PATTERN);
        if (control.value && typeof control.value === 'string' && !regExp.test(control.value)) {
            return { invalidFormatHour: true };
        }
        return {};
    };
    OValidators.twentyFourHourFormatValidator = function (control) {
        var regExp = new RegExp(TWENTY_FOUR_HOUR_FORMAT_PATTERN);
        if (control.value && typeof control.value === 'string' && !regExp.test(control.value)) {
            return { invalidFormatHour: true };
        }
        return {};
    };
    OValidators.emailValidator = function (control) {
        if (control.value && control.value.length > 0 && !EMAIL_REGEXP.test(control.value)) {
            return { invalidEmailAddress: true };
        }
        return {};
    };
    OValidators.phoneValidator = function (control, countryCode) {
        if (!control || !control.value) {
            return {};
        }
        var phoneNumberUtilInstance = lpn.PhoneNumberUtil.getInstance();
        var error = { validatePhoneNumber: { valid: false } };
        var number;
        var isValidForRegion = false;
        try {
            number = phoneNumberUtilInstance.parse(control.value, countryCode);
            if (number) {
                isValidForRegion = phoneNumberUtilInstance.isValidNumberForRegion(number, countryCode);
            }
        }
        catch (e) {
            return error;
        }
        if (control.value && (!number || !isValidForRegion)) {
            return error;
        }
        return {};
    };
    OValidators.nifValidator = function (control) {
        var newValue = control.value;
        var regExp = new RegExp(DNI_PATTERN + '|' + NIE_PATTERN);
        var valueWithoutDashes = '';
        for (var i in newValue) {
            if (newValue[i] !== '-') {
                valueWithoutDashes = valueWithoutDashes + newValue[i];
            }
        }
        if (valueWithoutDashes.length > 1) {
            var firstChar = valueWithoutDashes.charAt(0);
            if (NUMBERS.indexOf(firstChar) !== -1) {
                var number = valueWithoutDashes.substring(0, valueWithoutDashes.length - 1);
                var pos = parseInt(number, 10) % 23;
                var expectedLetter = DNI_CHECK.substring(pos, pos + 1);
                var letter = valueWithoutDashes.charAt(valueWithoutDashes.length - 1);
                var dniLetterError = (expectedLetter !== letter.toUpperCase());
                if (dniLetterError) {
                    return { invalidNIFLetter: true };
                }
                else {
                    if (!regExp.test(valueWithoutDashes)) {
                        return { invalidNIF: true };
                    }
                }
            }
            else {
                if (!regExp.test(valueWithoutDashes)) {
                    return { invalidNIF: true };
                }
            }
        }
        return undefined;
    };
    OValidators.patternValidator = function (regex, key) {
        if (!Util.isDefined(regex)) {
            console.warn('Regex param must be defined in patternValidator ');
        }
        if (!Util.isDefined(key)) {
            console.warn('Validation key param must be defined in patternValidator ');
        }
        var validator = function (control) {
            if (!Util.isDefined(regex) || !Util.isDefined(key) || !control.value) {
                return undefined;
            }
            var valid = regex.test(control.value);
            var result = {};
            if (valid) {
                result = undefined;
            }
            else {
                result[key] = !valid;
            }
            return result;
        };
        return validator;
    };
    return OValidators;
}());
export { OValidators };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby12YWxpZGF0b3JzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi92YWxpZGF0b3JzL28tdmFsaWRhdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sS0FBSyxHQUFHLE1BQU0sdUJBQXVCLENBQUM7QUFFN0MsSUFBTSxZQUFZLEdBQUcsaUtBQWlLLENBQUM7QUFHdkwsSUFBTSxXQUFXLEdBQUcsbUNBQW1DLENBQUM7QUFDeEQsSUFBTSxXQUFXLEdBQUcsc0RBQXNELENBQUM7QUFDM0UsSUFBTSxTQUFTLEdBQUcsMEJBQTBCLENBQUM7QUFDN0MsSUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDO0FBQzdCLE1BQU0sQ0FBQyxJQUFNLDBCQUEwQixHQUFHLDhEQUE4RCxDQUFDO0FBQ3pHLE1BQU0sQ0FBQyxJQUFNLCtCQUErQixHQUFHLGtEQUFrRCxDQUFDO0FBRWxHO0lBQUE7SUE4SUEsQ0FBQztJQXpJZSxxQ0FBeUIsR0FBdkMsVUFBd0MsT0FBb0I7UUFDMUQsSUFBTSxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUN0RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxPQUFPLENBQUMsS0FBSyxLQUFLLFFBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3JGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUNwQztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUthLHlDQUE2QixHQUEzQyxVQUE0QyxPQUFvQjtRQUM5RCxJQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1FBQzNELElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxPQUFPLE9BQU8sQ0FBQyxLQUFLLEtBQUssUUFBUSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDckYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLElBQUksRUFBRSxDQUFDO1NBQ3BDO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBS2EsMEJBQWMsR0FBNUIsVUFBNkIsT0FBb0I7UUFDL0MsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2xGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUN0QztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUthLDBCQUFjLEdBQTVCLFVBQTZCLE9BQW9CLEVBQUUsV0FBaUI7UUFDbEUsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDOUIsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELElBQU0sdUJBQXVCLEdBQUcsR0FBRyxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsRSxJQUFNLEtBQUssR0FBRyxFQUFFLG1CQUFtQixFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUM7UUFFeEQsSUFBSSxNQUF1QixDQUFDO1FBQzVCLElBQUksZ0JBQWdCLEdBQVksS0FBSyxDQUFBO1FBQ3JDLElBQUk7WUFDRixNQUFNLEdBQUcsdUJBQXVCLENBQUMsS0FBSyxDQUNwQyxPQUFPLENBQUMsS0FBSyxFQUNiLFdBQVcsQ0FDWixDQUFDO1lBQ0YsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsZ0JBQWdCLEdBQUcsdUJBQXVCLENBQUMsc0JBQXNCLENBQy9ELE1BQU0sRUFDTixXQUFXLENBQ1osQ0FBQTthQUNGO1NBQ0Y7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUU7WUFDbkQsT0FBTyxLQUFLLENBQUE7U0FDYjtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUthLHdCQUFZLEdBQTFCLFVBQTJCLE9BQW9CO1FBQzdDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDL0IsSUFBTSxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsV0FBVyxHQUFHLEdBQUcsR0FBRyxXQUFXLENBQUMsQ0FBQztRQUczRCxJQUFJLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM1QixLQUFLLElBQU0sQ0FBQyxJQUFJLFFBQVEsRUFBRTtZQUN4QixJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUU7Z0JBQ3ZCLGtCQUFrQixHQUFHLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN2RDtTQUNGO1FBQ0QsSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2pDLElBQU0sU0FBUyxHQUFHLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7Z0JBQ3JDLElBQU0sTUFBTSxHQUFHLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUM5RSxJQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDdEMsSUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN6RCxJQUFNLE1BQU0sR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN4RSxJQUFNLGNBQWMsR0FBRyxDQUFDLGNBQWMsS0FBSyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztnQkFDakUsSUFBSSxjQUFjLEVBQUU7b0JBQ2xCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsQ0FBQztpQkFDbkM7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRTt3QkFDcEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQztxQkFDN0I7aUJBQ0Y7YUFDRjtpQkFBTTtnQkFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFO29CQUNwQyxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFDO2lCQUM3QjthQUNGO1NBQ0Y7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBU2EsNEJBQWdCLEdBQTlCLFVBQStCLEtBQWEsRUFBRSxHQUFXO1FBQ3ZELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzFCLE9BQU8sQ0FBQyxJQUFJLENBQUMsa0RBQWtELENBQUMsQ0FBQTtTQUNqRTtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3hCLE9BQU8sQ0FBQyxJQUFJLENBQUMsMkRBQTJELENBQUMsQ0FBQTtTQUMxRTtRQUVELElBQUksU0FBUyxHQUFnQixVQUFDLE9BQW9CO1lBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBRXBFLE9BQU8sU0FBUyxDQUFDO2FBQ2xCO1lBR0QsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEMsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBR2hCLElBQUksS0FBSyxFQUFFO2dCQUNULE1BQU0sR0FBRyxTQUFTLENBQUM7YUFDcEI7aUJBQU07Z0JBQ0wsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO2FBQ3RCO1lBQ0QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxTQUFTLENBQUM7SUFFbkIsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FBQyxBQTlJRCxJQThJQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0aW9uRXJyb3JzLCBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi91dGlsJztcbmltcG9ydCAqIGFzIGxwbiBmcm9tICdnb29nbGUtbGlicGhvbmVudW1iZXInO1xuXG5jb25zdCBFTUFJTF9SRUdFWFAgPSAvXlthLXpBLVowLTkhIyQlJicqKy89P15fYHt8fX4tXSsoPzpcXC5bYS16QS1aMC05ISMkJSYnKisvPT9eX2B7fH1+LV0rKSpAKD86W2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV0qW2EtekEtWjAtOV0pP1xcLikrW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV0qW2EtekEtWjAtOV0pPyQvO1xuXG4vLyBOSUYgUmVndWxhciBFeHByZXNzaW9uc1xuY29uc3QgRE5JX1BBVFRFUk4gPSAnXigoWzAtOV17OH0pKFstXT8pKFthLXpBLVpdezF9KSkkJztcbmNvbnN0IE5JRV9QQVRURVJOID0gJ14oKFt4LXpYLVpdezF9KShbLV0/KShbMC05XXs3fSkoWy1dPykoW2EtekEtWl17MX0pKSQnO1xuY29uc3QgRE5JX0NIRUNLID0gJ1RSV0FHTVlGUERYQk5KWlNRVkhMQ0tFVCc7XG5jb25zdCBOVU1CRVJTID0gJzAxMjM0NTY3ODknO1xuZXhwb3J0IGNvbnN0IFRXRUxWRV9IT1VSX0ZPUk1BVF9QQVRURVJOID0gJ14oKFswLTldfChbMDFdP1swLTldKSk6KFswLTldfChbMC01XVswLTldKSkgKihbQWFQcF1bTW1dKSopJCc7XG5leHBvcnQgY29uc3QgVFdFTlRZX0ZPVVJfSE9VUl9GT1JNQVRfUEFUVEVSTiA9ICdeKFswLTldfChbMDFdP1swLTldfDJbMC0zXSkpOlswLTldfChbMC01XVswLTldKSQnO1xuXG5leHBvcnQgY2xhc3MgT1ZhbGlkYXRvcnMge1xuXG4gIC8qKlxuICAgKiBIb3VyIHZhbGlkYXRvciBoaDptbSBhbS9wbSBmb3JtYXRcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdHdlbHZlSG91ckZvcm1hdFZhbGlkYXRvcihjb250cm9sOiBGb3JtQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMge1xuICAgIGNvbnN0IHJlZ0V4cCA9IG5ldyBSZWdFeHAoVFdFTFZFX0hPVVJfRk9STUFUX1BBVFRFUk4pO1xuICAgIGlmIChjb250cm9sLnZhbHVlICYmIHR5cGVvZiBjb250cm9sLnZhbHVlID09PSAnc3RyaW5nJyAmJiAhcmVnRXhwLnRlc3QoY29udHJvbC52YWx1ZSkpIHtcbiAgICAgIHJldHVybiB7IGludmFsaWRGb3JtYXRIb3VyOiB0cnVlIH07XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIb3VyIHZhbGlkYXRvciBISDptbSBmb3JtYXRcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdHdlbnR5Rm91ckhvdXJGb3JtYXRWYWxpZGF0b3IoY29udHJvbDogRm9ybUNvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHtcbiAgICBjb25zdCByZWdFeHAgPSBuZXcgUmVnRXhwKFRXRU5UWV9GT1VSX0hPVVJfRk9STUFUX1BBVFRFUk4pO1xuICAgIGlmIChjb250cm9sLnZhbHVlICYmIHR5cGVvZiBjb250cm9sLnZhbHVlID09PSAnc3RyaW5nJyAmJiAhcmVnRXhwLnRlc3QoY29udHJvbC52YWx1ZSkpIHtcbiAgICAgIHJldHVybiB7IGludmFsaWRGb3JtYXRIb3VyOiB0cnVlIH07XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWFpbCB2YWxpZGF0b3JcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZW1haWxWYWxpZGF0b3IoY29udHJvbDogRm9ybUNvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHtcbiAgICBpZiAoY29udHJvbC52YWx1ZSAmJiBjb250cm9sLnZhbHVlLmxlbmd0aCA+IDAgJiYgIUVNQUlMX1JFR0VYUC50ZXN0KGNvbnRyb2wudmFsdWUpKSB7XG4gICAgICByZXR1cm4geyBpbnZhbGlkRW1haWxBZGRyZXNzOiB0cnVlIH07XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQaG9uZSB2YWxpZGF0b3JcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcGhvbmVWYWxpZGF0b3IoY29udHJvbDogRm9ybUNvbnRyb2wsIGNvdW50cnlDb2RlPzogYW55KTogVmFsaWRhdGlvbkVycm9ycyB7XG4gICAgaWYgKCFjb250cm9sIHx8ICFjb250cm9sLnZhbHVlKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IHBob25lTnVtYmVyVXRpbEluc3RhbmNlID0gbHBuLlBob25lTnVtYmVyVXRpbC5nZXRJbnN0YW5jZSgpO1xuICAgIGNvbnN0IGVycm9yID0geyB2YWxpZGF0ZVBob25lTnVtYmVyOiB7IHZhbGlkOiBmYWxzZSB9IH07XG5cbiAgICBsZXQgbnVtYmVyOiBscG4uUGhvbmVOdW1iZXI7XG4gICAgbGV0IGlzVmFsaWRGb3JSZWdpb246IGJvb2xlYW4gPSBmYWxzZVxuICAgIHRyeSB7XG4gICAgICBudW1iZXIgPSBwaG9uZU51bWJlclV0aWxJbnN0YW5jZS5wYXJzZShcbiAgICAgICAgY29udHJvbC52YWx1ZSxcbiAgICAgICAgY291bnRyeUNvZGVcbiAgICAgICk7XG4gICAgICBpZiAobnVtYmVyKSB7XG4gICAgICAgIGlzVmFsaWRGb3JSZWdpb24gPSBwaG9uZU51bWJlclV0aWxJbnN0YW5jZS5pc1ZhbGlkTnVtYmVyRm9yUmVnaW9uKFxuICAgICAgICAgIG51bWJlcixcbiAgICAgICAgICBjb3VudHJ5Q29kZVxuICAgICAgICApXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH1cbiAgICBpZiAoY29udHJvbC52YWx1ZSAmJiAoIW51bWJlciB8fCAhaXNWYWxpZEZvclJlZ2lvbikpIHtcbiAgICAgIHJldHVybiBlcnJvclxuICAgIH1cbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogTklGIHZhbGlkYXRvclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBuaWZWYWxpZGF0b3IoY29udHJvbDogRm9ybUNvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGNvbnRyb2wudmFsdWU7XG4gICAgY29uc3QgcmVnRXhwID0gbmV3IFJlZ0V4cChETklfUEFUVEVSTiArICd8JyArIE5JRV9QQVRURVJOKTtcblxuICAgIC8vIHJlbW92aW5nIGRhc2hlc1xuICAgIGxldCB2YWx1ZVdpdGhvdXREYXNoZXMgPSAnJztcbiAgICBmb3IgKGNvbnN0IGkgaW4gbmV3VmFsdWUpIHtcbiAgICAgIGlmIChuZXdWYWx1ZVtpXSAhPT0gJy0nKSB7XG4gICAgICAgIHZhbHVlV2l0aG91dERhc2hlcyA9IHZhbHVlV2l0aG91dERhc2hlcyArIG5ld1ZhbHVlW2ldO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodmFsdWVXaXRob3V0RGFzaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IGZpcnN0Q2hhciA9IHZhbHVlV2l0aG91dERhc2hlcy5jaGFyQXQoMCk7XG4gICAgICBpZiAoTlVNQkVSUy5pbmRleE9mKGZpcnN0Q2hhcikgIT09IC0xKSB7XG4gICAgICAgIGNvbnN0IG51bWJlciA9IHZhbHVlV2l0aG91dERhc2hlcy5zdWJzdHJpbmcoMCwgdmFsdWVXaXRob3V0RGFzaGVzLmxlbmd0aCAtIDEpO1xuICAgICAgICBjb25zdCBwb3MgPSBwYXJzZUludChudW1iZXIsIDEwKSAlIDIzO1xuICAgICAgICBjb25zdCBleHBlY3RlZExldHRlciA9IEROSV9DSEVDSy5zdWJzdHJpbmcocG9zLCBwb3MgKyAxKTtcbiAgICAgICAgY29uc3QgbGV0dGVyID0gdmFsdWVXaXRob3V0RGFzaGVzLmNoYXJBdCh2YWx1ZVdpdGhvdXREYXNoZXMubGVuZ3RoIC0gMSk7XG4gICAgICAgIGNvbnN0IGRuaUxldHRlckVycm9yID0gKGV4cGVjdGVkTGV0dGVyICE9PSBsZXR0ZXIudG9VcHBlckNhc2UoKSk7XG4gICAgICAgIGlmIChkbmlMZXR0ZXJFcnJvcikge1xuICAgICAgICAgIHJldHVybiB7IGludmFsaWROSUZMZXR0ZXI6IHRydWUgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIXJlZ0V4cC50ZXN0KHZhbHVlV2l0aG91dERhc2hlcykpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGludmFsaWROSUY6IHRydWUgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghcmVnRXhwLnRlc3QodmFsdWVXaXRob3V0RGFzaGVzKSkge1xuICAgICAgICAgIHJldHVybiB7IGludmFsaWROSUY6IHRydWUgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhdHRlcm5zIHZhbGlkYXRvclxuICAgKiBAcGFyYW0gcmVnZXhcbiAgICogQHBhcmFtIGtleVxuICAgKiBAcmV0dXJucyB2YWxpZGF0b3JcbiAgICpcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcGF0dGVyblZhbGlkYXRvcihyZWdleDogUmVnRXhwLCBrZXk6IHN0cmluZyk6IFZhbGlkYXRvckZuIHtcbiAgICBpZiAoIVV0aWwuaXNEZWZpbmVkKHJlZ2V4KSkge1xuICAgICAgY29uc29sZS53YXJuKCdSZWdleCBwYXJhbSBtdXN0IGJlIGRlZmluZWQgaW4gcGF0dGVyblZhbGlkYXRvciAnKVxuICAgIH1cblxuICAgIGlmICghVXRpbC5pc0RlZmluZWQoa2V5KSkge1xuICAgICAgY29uc29sZS53YXJuKCdWYWxpZGF0aW9uIGtleSBwYXJhbSBtdXN0IGJlIGRlZmluZWQgaW4gcGF0dGVyblZhbGlkYXRvciAnKVxuICAgIH1cblxuICAgIGxldCB2YWxpZGF0b3I6IFZhbGlkYXRvckZuID0gKGNvbnRyb2w6IEZvcm1Db250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9PiB7XG4gICAgICBpZiAoIVV0aWwuaXNEZWZpbmVkKHJlZ2V4KSB8fCAhVXRpbC5pc0RlZmluZWQoa2V5KSB8fCAhY29udHJvbC52YWx1ZSkge1xuICAgICAgICAvLyBpZiByZWdleCBpcyBub3QgZGVmaW5lZCBvciBrZXkgaXMgbm90IGRlZmluZWQgb3IgY29udHJvbCBpcyBlbXB0eSByZXR1cm4gbm8gZXJyb3JcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gdGVzdCB0aGUgdmFsdWUgb2YgdGhlIGNvbnRyb2wgYWdhaW5zdCB0aGUgcmVnZXhwIHN1cHBsaWVkXG4gICAgICBjb25zdCB2YWxpZCA9IHJlZ2V4LnRlc3QoY29udHJvbC52YWx1ZSk7XG5cbiAgICAgIGxldCByZXN1bHQgPSB7fTtcblxuICAgICAgLy8gaWYgdHJ1ZSwgcmV0dXJuIG5vIGVycm9yIChubyBlcnJvciksIGVsc2UgcmV0dXJuIGVycm9yIHBhc3NlZCBpbiB0aGUgc2Vjb25kIHBhcmFtZXRlclxuICAgICAgaWYgKHZhbGlkKSB7XG4gICAgICAgIHJlc3VsdCA9IHVuZGVmaW5lZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdFtrZXldID0gIXZhbGlkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICAgIHJldHVybiB2YWxpZGF0b3I7XG5cbiAgfVxufVxuIl19