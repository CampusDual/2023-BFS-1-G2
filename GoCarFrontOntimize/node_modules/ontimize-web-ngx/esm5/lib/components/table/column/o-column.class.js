import { BehaviorSubject } from 'rxjs';
import { Codes, Util } from '../../../util';
var OColumn = (function () {
    function OColumn() {
        this._editing = false;
        this.multilineSubject = new BehaviorSubject(this.multiline);
        this.isMultiline = this.multilineSubject.asObservable();
    }
    Object.defineProperty(OColumn.prototype, "editing", {
        get: function () {
            return this._editing;
        },
        set: function (val) {
            if (this.type === 'boolean' && this.editor && this.editor.autoCommit) {
                this._editing = false;
            }
            this._editing = this.editor != null && val;
            this.editor.setEditingRowClass(this._editing);
        },
        enumerable: true,
        configurable: true
    });
    OColumn.prototype.setDefaultProperties = function (args) {
        this.type = 'string';
        this.className = 'o-column-' + (this.type) + ' ';
        this.orderable = args.orderable;
        this.resizable = args.resizable;
        this.groupable = args.groupable;
        this.searchable = true;
        this.searching = true;
        this.name = this.attr;
        this.title = this.attr;
        this.multiline = false;
    };
    OColumn.prototype.setColumnProperties = function (column) {
        this.title = Util.isDefined(column.title) ? column.title : column.attr;
        this.definition = column;
        this.multiline = column.multiline;
        if (Util.isDefined(column.minWidth)) {
            this.minWidth = column.minWidth;
        }
        if (Util.isDefined(column.maxWidth)) {
            this.maxWidth = column.maxWidth;
        }
        if (Util.isDefined(column.orderable)) {
            this.orderable = column.orderable;
        }
        if (Util.isDefined(column.resizable)) {
            this.resizable = column.resizable;
        }
        if (Util.isDefined(column.searchable)) {
            this.searchable = column.searchable;
        }
        if (Util.isDefined(column.groupable)) {
            this.groupable = column.groupable;
        }
        if (Util.isDefined(column.renderer)) {
            this.renderer = column.renderer;
        }
        if (Util.isDefined(column.editor)) {
            this.editor = column.editor;
        }
        if (Util.isDefined(column.type)) {
            this.type = column.type;
            this.className = 'o-column-' + (this.type) + ' ';
        }
        if (Util.isDefined(column.getSQLType)) {
            this.sqlType = column.getSQLType();
        }
        if (Util.isDefined(column.class)) {
            this.className = Util.isDefined(this.className) ? (this.className + ' ' + column.class) : column.class;
        }
        if (Util.isDefined(column.operation) || Util.isDefined(column.functionOperation)) {
            this.calculate = column.operation ? column.operation : column.functionOperation;
        }
        if (Util.isDefined(column.tooltip) && column.tooltip) {
            this.tooltip = {
                value: column.tooltipValue,
                function: column.tooltipFunction
            };
        }
        if (Util.isDefined(column.filterExpressionFunction)) {
            this.filterExpressionFunction = column.filterExpressionFunction;
        }
    };
    Object.defineProperty(OColumn.prototype, "searchable", {
        get: function () {
            return this._searchable;
        },
        set: function (val) {
            this._searchable = val;
            this.searching = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OColumn.prototype, "multiline", {
        get: function () {
            return this._multiline;
        },
        set: function (val) {
            val = Util.parseBoolean(String(val));
            this._multiline = val;
            this.multilineSubject.next(this._multiline);
        },
        enumerable: true,
        configurable: true
    });
    OColumn.prototype.hasTooltip = function () {
        return Util.isDefined(this.tooltip);
    };
    OColumn.prototype.getTooltip = function (rowData) {
        if (!this.hasTooltip()) {
            return undefined;
        }
        var tooltip;
        if (Util.isDefined(this.tooltip.value)) {
            tooltip = this.tooltip.value;
        }
        else if (Util.isDefined(this.tooltip.function)) {
            try {
                tooltip = this.tooltip.function(rowData);
            }
            catch (e) {
                console.warn('o-table-column tooltip-function didnt worked');
            }
        }
        else {
            tooltip = Util.isDefined(this.renderer) ? this.renderer.getTooltip(rowData[this.name], rowData) : rowData[this.name];
        }
        return tooltip;
    };
    OColumn.prototype.getMinWidth = function () {
        if (Util.isDefined(this.width)) {
            return this.width;
        }
        return this.minWidth;
    };
    OColumn.prototype.getMinWidthValue = function () {
        return Util.extractPixelsValue(this.minWidth, Codes.DEFAULT_COLUMN_MIN_WIDTH);
    };
    OColumn.prototype.getMaxWidthValue = function () {
        var value = Util.extractPixelsValue(this.maxWidth);
        return value ? value : undefined;
    };
    OColumn.prototype.setRenderWidth = function (horizontalScrolled, clientWidth) {
        if (Util.isDefined(this.width)) {
            return;
        }
        var defaultWidth = (horizontalScrolled) ? undefined : 'auto';
        this.width = Util.isDefined(this.DOMWidth) ? (this.getDOMWidth(clientWidth) + 'px') : defaultWidth;
    };
    OColumn.prototype.getDOMWidth = function (val) {
        var DOMWidth;
        var pxVal = Util.extractPixelsValue(val);
        if (Util.isDefined(pxVal)) {
            DOMWidth = pxVal;
            var minValue = this.getMinWidthValue();
            if (Util.isDefined(minValue) && pxVal > 0 && pxVal < minValue) {
                DOMWidth = minValue;
            }
            if (Util.isDefined(this.maxWidth)) {
                var maxValue = Util.extractPixelsValue(this.maxWidth);
                if (Util.isDefined(maxValue) && pxVal > maxValue) {
                    DOMWidth = maxValue;
                }
            }
        }
        return DOMWidth;
    };
    Object.defineProperty(OColumn.prototype, "width", {
        get: function () {
            return this._width;
        },
        set: function (val) {
            var widthVal = val;
            var DOMWidth = this.getDOMWidth(val);
            var pxVal = Util.extractPixelsValue(DOMWidth);
            if (Util.isDefined(pxVal)) {
                this.DOMWidth = pxVal;
                widthVal = pxVal + 'px';
            }
            this._width = widthVal;
        },
        enumerable: true,
        configurable: true
    });
    OColumn.prototype.getWidthToStore = function () {
        return this._width;
    };
    OColumn.prototype.setWidth = function (val) {
        this.width = val + 'px';
        this.DOMWidth = val;
    };
    OColumn.prototype.getTitleAlignClass = function () {
        if (Util.isDefined(this.definition)) {
            return this.definition.titleAlign || Codes.COLUMN_TITLE_ALIGN_CENTER;
        }
        return Codes.COLUMN_TITLE_ALIGN_CENTER;
    };
    OColumn.prototype.getFilterValue = function (cellValue, rowValue) {
        if (this.renderer) {
            return this.renderer.getFilter(cellValue, rowValue);
        }
        else {
            return [cellValue];
        }
    };
    OColumn.prototype.useCustomFilterFunction = function () {
        return this.searching && this.visible && this.renderer != null && this.renderer.filterFunction != null;
    };
    OColumn.prototype.useQuickfilterFunction = function () {
        return this.searching && this.visible && !(this.renderer != null && this.renderer.filterFunction != null);
    };
    return OColumn;
}());
export { OColumn };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1jb2x1bW4uY2xhc3MuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vbnRpbWl6ZS13ZWItbmd4LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGFibGUvY29sdW1uL28tY29sdW1uLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFRbkQsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHNUM7SUFBQTtRQWNZLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFZNUIscUJBQWdCLEdBQTZCLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRixnQkFBVyxHQUF3QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLENBQUM7SUErTmpGLENBQUM7SUE1TkMsc0JBQUksNEJBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN2QixDQUFDO2FBRUQsVUFBWSxHQUFZO1lBQ3RCLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRTtnQkFDcEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7YUFDdkI7WUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxJQUFJLEdBQUcsQ0FBQztZQUMzQyxJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUMvQyxDQUFDOzs7T0FSQTtJQVVELHNDQUFvQixHQUFwQixVQUFxQixJQUFTO1FBQzVCLElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxH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QUksQ0FBQyxRQUFRLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxDQUFDO0lBQzVHLENBQUM7SUFFSCxjQUFDO0FBQUQsQ0FBQyxBQTFQRCxJQTBQQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBPVGFibGVDb2x1bW5DYWxjdWxhdGVkIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9vLXRhYmxlLWNvbHVtbi1jYWxjdWxhdGVkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBPVGFibGVDb2x1bW4gfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL28tdGFibGUtY29sdW1uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBFeHByZXNzaW9uIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvZXhwcmVzc2lvbi50eXBlJztcbmltcG9ydCB7IE9wZXJhdG9yRnVuY3Rpb24gfSBmcm9tICcuLi8uLi8uLi90eXBlcy9vcGVyYXRpb24tZnVuY3Rpb24udHlwZSc7XG5pbXBvcnQgeyBPQ29sdW1uQWdncmVnYXRlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvdGFibGUvby1jb2x1bW4tYWdncmVnYXRlLnR5cGUnO1xuaW1wb3J0IHsgT0NvbHVtblRvb2x0aXAgfSBmcm9tICcuLi8uLi8uLi90eXBlcy90YWJsZS9vLWNvbHVtbi10b29sdGlwLnR5cGUnO1xuaW1wb3J0IHsgQ29kZXMsIFV0aWwgfSBmcm9tICcuLi8uLi8uLi91dGlsJztcbmltcG9ydCB7IE9CYXNlVGFibGVDZWxsUmVuZGVyZXIgfSBmcm9tICcuL2NlbGwtcmVuZGVyZXIvby1iYXNlLXRhYmxlLWNlbGwtcmVuZGVyZXIuY2xhc3MnO1xuXG5leHBvcnQgY2xhc3MgT0NvbHVtbiB7XG4gIGF0dHI6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICB0eXBlOiBzdHJpbmc7XG4gIHNxbFR5cGU6IG51bWJlcjtcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG4gIG9yZGVyYWJsZTogYm9vbGVhbjtcbiAgZ3JvdXBhYmxlOiBib29sZWFuO1xuICBfc2VhcmNoYWJsZTogYm9vbGVhbjtcbiAgc2VhcmNoaW5nOiBib29sZWFuOyAvLyB0aGlzIGNvbHVtbiBpcyB1c2VkIHRvIGZpbHRlciBpbiBxdWlja2ZpbHRlclxuICB2aXNpYmxlOiBib29sZWFuO1xuICByZW5kZXJlcjogT0Jhc2VUYWJsZUNlbGxSZW5kZXJlcjtcbiAgZWRpdG9yOiBhbnk7XG4gIHByb3RlY3RlZCBfZWRpdGluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBfd2lkdGg6IHN0cmluZztcbiAgbWluV2lkdGg6IHN0cmluZztcbiAgbWF4V2lkdGg6IHN0cmluZztcbiAgYWdncmVnYXRlOiBPQ29sdW1uQWdncmVnYXRlO1xuICBjYWxjdWxhdGU6IHN0cmluZyB8IE9wZXJhdG9yRnVuY3Rpb247XG4gIGRlZmluaXRpb246IE9UYWJsZUNvbHVtbjtcbiAgdG9vbHRpcDogT0NvbHVtblRvb2x0aXA7XG4gIHJlc2l6YWJsZTogYm9vbGVhbjtcbiAgRE9NV2lkdGg6IG51bWJlcjtcbiAgZmlsdGVyRXhwcmVzc2lvbkZ1bmN0aW9uOiAoY29sdW1uQXR0cjogc3RyaW5nLCBxdWlja0ZpbHRlcj86IHN0cmluZykgPT4gRXhwcmVzc2lvbjtcblxuICBwcml2YXRlIG11bHRpbGluZVN1YmplY3Q6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPiA9IG5ldyBCZWhhdmlvclN1YmplY3QodGhpcy5tdWx0aWxpbmUpO1xuICBwdWJsaWMgaXNNdWx0aWxpbmU6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzLm11bHRpbGluZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIHByaXZhdGUgX211bHRpbGluZTogYm9vbGVhbjtcblxuICBnZXQgZWRpdGluZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZWRpdGluZztcbiAgfVxuXG4gIHNldCBlZGl0aW5nKHZhbDogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLnR5cGUgPT09ICdib29sZWFuJyAmJiB0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5hdXRvQ29tbWl0KSB7XG4gICAgICB0aGlzLl9lZGl0aW5nID0gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuX2VkaXRpbmcgPSB0aGlzLmVkaXRvciAhPSBudWxsICYmIHZhbDtcbiAgICB0aGlzLmVkaXRvci5zZXRFZGl0aW5nUm93Q2xhc3ModGhpcy5fZWRpdGluZylcbiAgfVxuXG4gIHNldERlZmF1bHRQcm9wZXJ0aWVzKGFyZ3M6IGFueSkge1xuICAgIHRoaXMudHlwZSA9ICdzdHJpbmcnO1xuICAgIHRoaXMuY2xhc3NOYW1lID0gJ28tY29sdW1uLScgKyAodGhpcy50eXBlKSArICcgJztcbiAgICB0aGlzLm9yZGVyYWJsZSA9IGFyZ3Mub3JkZXJhYmxlO1xuICAgIHRoaXMucmVzaXphYmxlID0gYXJncy5yZXNpemFibGU7XG4gICAgdGhpcy5ncm91cGFibGUgPSBhcmdzLmdyb3VwYWJsZTtcbiAgICB0aGlzLnNlYXJjaGFibGUgPSB0cnVlO1xuICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICAvLyBjb2x1bW4gd2l0aG91dCAnYXR0cicgc2hvdWxkIGNvbnRhaW4gb25seSByZW5kZXJlcnMgdGhhdCBkbyBub3QgZGVwZW5kIG9uIGNlbGwgZGF0YSwgYnV0IHJvdyBkYXRhIChlLmcuIGFjdGlvbnMpXG4gICAgdGhpcy5uYW1lID0gdGhpcy5hdHRyO1xuICAgIHRoaXMudGl0bGUgPSB0aGlzLmF0dHI7XG4gICAgdGhpcy5tdWx0aWxpbmUgPSBmYWxzZTtcbiAgfVxuXG4gIHNldENvbHVtblByb3BlcnRpZXMoY29sdW1uOiBPVGFibGVDb2x1bW4gJiBPVGFibGVDb2x1bW5DYWxjdWxhdGVkKSB7XG4gICAgdGhpcy50aXRsZSA9IFV0aWwuaXNEZWZpbmVkKGNvbHVtbi50aXRsZSkgPyBjb2x1bW4udGl0bGUgOiBjb2x1bW4uYXR0cjtcbiAgICB0aGlzLmRlZmluaXRpb24gPSBjb2x1bW47XG4gICAgdGhpcy5tdWx0aWxpbmUgPSBjb2x1bW4ubXVsdGlsaW5lO1xuXG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKGNvbHVtbi5taW5XaWR0aCkpIHtcbiAgICAgIHRoaXMubWluV2lkdGggPSBjb2x1bW4ubWluV2lkdGg7XG4gICAgfVxuICAgIGlmIChVdGlsLmlzRGVmaW5lZChjb2x1bW4ubWF4V2lkdGgpKSB7XG4gICAgICB0aGlzLm1heFdpZHRoID0gY29sdW1uLm1heFdpZHRoO1xuICAgIH1cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoY29sdW1uLm9yZGVyYWJsZSkpIHtcbiAgICAgIHRoaXMub3JkZXJhYmxlID0gY29sdW1uLm9yZGVyYWJsZTtcbiAgICB9XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKGNvbHVtbi5yZXNpemFibGUpKSB7XG4gICAgICB0aGlzLnJlc2l6YWJsZSA9IGNvbHVtbi5yZXNpemFibGU7XG4gICAgfVxuICAgIGlmIChVdGlsLmlzRGVmaW5lZChjb2x1bW4uc2VhcmNoYWJsZSkpIHtcbiAgICAgIHRoaXMuc2VhcmNoYWJsZSA9IGNvbHVtbi5zZWFyY2hhYmxlO1xuICAgIH1cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoY29sdW1uLmdyb3VwYWJsZSkpIHtcbiAgICAgIHRoaXMuZ3JvdXBhYmxlID0gY29sdW1uLmdyb3VwYWJsZTtcbiAgICB9XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKGNvbHVtbi5yZW5kZXJlcikpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIgPSBjb2x1bW4ucmVuZGVyZXI7XG4gICAgfVxuICAgIGlmIChVdGlsLmlzRGVmaW5lZChjb2x1bW4uZWRpdG9yKSkge1xuICAgICAgdGhpcy5lZGl0b3IgPSBjb2x1bW4uZWRpdG9yO1xuICAgIH1cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoY29sdW1uLnR5cGUpKSB7XG4gICAgICB0aGlzLnR5cGUgPSBjb2x1bW4udHlwZTtcbiAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ28tY29sdW1uLScgKyAodGhpcy50eXBlKSArICcgJztcbiAgICB9XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKGNvbHVtbi5nZXRTUUxUeXBlKSkge1xuICAgICAgdGhpcy5zcWxUeXBlID0gY29sdW1uLmdldFNRTFR5cGUoKTtcbiAgICB9XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKGNvbHVtbi5jbGFzcykpIHtcbiAgICAgIHRoaXMuY2xhc3NOYW1lID0gVXRpbC5pc0RlZmluZWQodGhpcy5jbGFzc05hbWUpID8gKHRoaXMuY2xhc3NOYW1lICsgJyAnICsgY29sdW1uLmNsYXNzKSA6IGNvbHVtbi5jbGFzcztcbiAgICB9XG4gICAgLy8gaWYgKGNvbHVtbiBpbnN0YW5jZW9mIE9UYWJsZUNvbHVtbkNhbGN1bGF0ZWRDb21wb25lbnQpIHtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoY29sdW1uLm9wZXJhdGlvbikgfHwgVXRpbC5pc0RlZmluZWQoY29sdW1uLmZ1bmN0aW9uT3BlcmF0aW9uKSkge1xuICAgICAgdGhpcy5jYWxjdWxhdGUgPSBjb2x1bW4ub3BlcmF0aW9uID8gY29sdW1uLm9wZXJhdGlvbiA6IGNvbHVtbi5mdW5jdGlvbk9wZXJhdGlvbjtcbiAgICB9XG4gICAgLy8gfVxuICAgIGlmIChVdGlsLmlzRGVmaW5lZChjb2x1bW4udG9vbHRpcCkgJiYgY29sdW1uLnRvb2x0aXApIHtcbiAgICAgIHRoaXMudG9vbHRpcCA9IHtcbiAgICAgICAgdmFsdWU6IGNvbHVtbi50b29sdGlwVmFsdWUsXG4gICAgICAgIGZ1bmN0aW9uOiBjb2x1bW4udG9vbHRpcEZ1bmN0aW9uXG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoY29sdW1uLmZpbHRlckV4cHJlc3Npb25GdW5jdGlvbikpIHtcbiAgICAgIHRoaXMuZmlsdGVyRXhwcmVzc2lvbkZ1bmN0aW9uID0gY29sdW1uLmZpbHRlckV4cHJlc3Npb25GdW5jdGlvbjtcbiAgICB9XG4gIH1cblxuICBzZXQgc2VhcmNoYWJsZSh2YWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zZWFyY2hhYmxlID0gdmFsO1xuICAgIHRoaXMuc2VhcmNoaW5nID0gdmFsO1xuICB9XG5cbiAgZ2V0IHNlYXJjaGFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3NlYXJjaGFibGU7XG4gIH1cblxuICBzZXQgbXVsdGlsaW5lKHZhbDogYm9vbGVhbikge1xuICAgIHZhbCA9IFV0aWwucGFyc2VCb29sZWFuKFN0cmluZyh2YWwpKTtcbiAgICB0aGlzLl9tdWx0aWxpbmUgPSB2YWw7XG4gICAgdGhpcy5tdWx0aWxpbmVTdWJqZWN0Lm5leHQodGhpcy5fbXVsdGlsaW5lKTtcbiAgfVxuXG4gIGdldCBtdWx0aWxpbmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX211bHRpbGluZTtcbiAgfVxuXG4gIGhhc1Rvb2x0aXAoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIFV0aWwuaXNEZWZpbmVkKHRoaXMudG9vbHRpcCk7XG4gIH1cblxuICBnZXRUb29sdGlwKHJvd0RhdGE6IGFueSk6IGFueSB7XG4gICAgaWYgKCF0aGlzLmhhc1Rvb2x0aXAoKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgbGV0IHRvb2x0aXA7XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKHRoaXMudG9vbHRpcC52YWx1ZSkpIHtcbiAgICAgIHRvb2x0aXAgPSB0aGlzLnRvb2x0aXAudmFsdWU7XG4gICAgfSBlbHNlIGlmIChVdGlsLmlzRGVmaW5lZCh0aGlzLnRvb2x0aXAuZnVuY3Rpb24pKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0b29sdGlwID0gdGhpcy50b29sdGlwLmZ1bmN0aW9uKHJvd0RhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ28tdGFibGUtY29sdW1uIHRvb2x0aXAtZnVuY3Rpb24gZGlkbnQgd29ya2VkJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvb2x0aXAgPSBVdGlsLmlzRGVmaW5lZCh0aGlzLnJlbmRlcmVyKSA/IHRoaXMucmVuZGVyZXIuZ2V0VG9vbHRpcChyb3dEYXRhW3RoaXMubmFtZV0sIHJvd0RhdGEpIDogcm93RGF0YVt0aGlzLm5hbWVdO1xuICAgIH1cbiAgICByZXR1cm4gdG9vbHRpcDtcbiAgfVxuXG4gIGdldE1pbldpZHRoKCkge1xuICAgIGlmIChVdGlsLmlzRGVmaW5lZCh0aGlzLndpZHRoKSkge1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGg7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm1pbldpZHRoO1xuICB9XG5cbiAgZ2V0TWluV2lkdGhWYWx1ZSgpIHtcbiAgICByZXR1cm4gVXRpbC5leHRyYWN0UGl4ZWxzVmFsdWUodGhpcy5taW5XaWR0aCwgQ29kZXMuREVGQVVMVF9DT0xVTU5fTUlOX1dJRFRIKTtcbiAgfVxuXG4gIGdldE1heFdpZHRoVmFsdWUoKSB7XG4gICAgY29uc3QgdmFsdWUgPSBVdGlsLmV4dHJhY3RQaXhlbHNWYWx1ZSh0aGlzLm1heFdpZHRoKTtcbiAgICByZXR1cm4gdmFsdWUgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNldFJlbmRlcldpZHRoKGhvcml6b250YWxTY3JvbGxlZDogYm9vbGVhbiwgY2xpZW50V2lkdGg6IG51bWJlcikge1xuICAgIGlmIChVdGlsLmlzRGVmaW5lZCh0aGlzLndpZHRoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGRlZmF1bHRXaWR0aCA9IChob3Jpem9udGFsU2Nyb2xsZWQpID8gdW5kZWZpbmVkIDogJ2F1dG8nO1xuICAgIHRoaXMud2lkdGggPSBVdGlsLmlzRGVmaW5lZCh0aGlzLkRPTVdpZHRoKSA/ICh0aGlzLmdldERPTVdpZHRoKGNsaWVudFdpZHRoKSArICdweCcpIDogZGVmYXVsdFdpZHRoO1xuICB9XG5cbiAgZ2V0RE9NV2lkdGgodmFsOiBhbnkpOiBudW1iZXIge1xuICAgIGxldCBET01XaWR0aDtcbiAgICBjb25zdCBweFZhbCA9IFV0aWwuZXh0cmFjdFBpeGVsc1ZhbHVlKHZhbCk7XG5cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQocHhWYWwpKSB7XG4gICAgICBET01XaWR0aCA9IHB4VmFsO1xuICAgICAgY29uc3QgbWluVmFsdWUgPSB0aGlzLmdldE1pbldpZHRoVmFsdWUoKTtcbiAgICAgIGlmIChVdGlsLmlzRGVmaW5lZChtaW5WYWx1ZSkgJiYgcHhWYWwgPiAwICYmIHB4VmFsIDwgbWluVmFsdWUpIHtcbiAgICAgICAgRE9NV2lkdGggPSBtaW5WYWx1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKFV0aWwuaXNEZWZpbmVkKHRoaXMubWF4V2lkdGgpKSB7XG4gICAgICAgIGNvbnN0IG1heFZhbHVlID0gVXRpbC5leHRyYWN0UGl4ZWxzVmFsdWUodGhpcy5tYXhXaWR0aCk7XG4gICAgICAgIGlmIChVdGlsLmlzRGVmaW5lZChtYXhWYWx1ZSkgJiYgcHhWYWwgPiBtYXhWYWx1ZSkge1xuICAgICAgICAgIERPTVdpZHRoID0gbWF4VmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cbiAgICByZXR1cm4gRE9NV2lkdGg7XG4gIH1cblxuICBzZXQgd2lkdGgodmFsOiBzdHJpbmcpIHtcbiAgICBsZXQgd2lkdGhWYWwgPSB2YWw7XG4gICAgbGV0IERPTVdpZHRoID0gdGhpcy5nZXRET01XaWR0aCh2YWwpO1xuICAgIGNvbnN0IHB4VmFsID0gVXRpbC5leHRyYWN0UGl4ZWxzVmFsdWUoRE9NV2lkdGgpO1xuICAgIGlmIChVdGlsLmlzRGVmaW5lZChweFZhbCkpIHtcbiAgICAgIHRoaXMuRE9NV2lkdGggPSBweFZhbDtcbiAgICAgIHdpZHRoVmFsID0gcHhWYWwgKyAncHgnO1xuICAgIH1cblxuICAgIHRoaXMuX3dpZHRoID0gd2lkdGhWYWw7XG4gIH1cblxuICBnZXQgd2lkdGgoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fd2lkdGg7XG4gIH1cblxuXG4gIGdldFdpZHRoVG9TdG9yZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl93aWR0aDtcbiAgfVxuXG4gIHNldFdpZHRoKHZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy53aWR0aCA9IHZhbCArICdweCc7XG4gICAgdGhpcy5ET01XaWR0aCA9IHZhbDtcbiAgfVxuXG4gIGdldFRpdGxlQWxpZ25DbGFzcygpIHtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5kZWZpbml0aW9uKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVmaW5pdGlvbi50aXRsZUFsaWduIHx8IENvZGVzLkNPTFVNTl9USVRMRV9BTElHTl9DRU5URVI7XG4gICAgfVxuICAgIC8vIGRlZmF1bHQgdGl0bGUgYWxpZ25cbiAgICByZXR1cm4gQ29kZXMuQ09MVU1OX1RJVExFX0FMSUdOX0NFTlRFUjtcbiAgfVxuXG4gIGdldEZpbHRlclZhbHVlKGNlbGxWYWx1ZTogYW55LCByb3dWYWx1ZT86IGFueSk6IGFueVtdIHtcbiAgICBpZiAodGhpcy5yZW5kZXJlcikge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZXIuZ2V0RmlsdGVyKGNlbGxWYWx1ZSwgcm93VmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gW2NlbGxWYWx1ZV07XG4gICAgfVxuICB9XG5cbiAgdXNlQ3VzdG9tRmlsdGVyRnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoaW5nICYmIHRoaXMudmlzaWJsZSAmJiB0aGlzLnJlbmRlcmVyICE9IG51bGwgJiYgdGhpcy5yZW5kZXJlci5maWx0ZXJGdW5jdGlvbiAhPSBudWxsO1xuICB9XG5cbiAgdXNlUXVpY2tmaWx0ZXJGdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hpbmcgJiYgdGhpcy52aXNpYmxlICYmICEodGhpcy5yZW5kZXJlciAhPSBudWxsICYmIHRoaXMucmVuZGVyZXIuZmlsdGVyRnVuY3Rpb24gIT0gbnVsbCk7XG4gIH1cblxufVxuIl19