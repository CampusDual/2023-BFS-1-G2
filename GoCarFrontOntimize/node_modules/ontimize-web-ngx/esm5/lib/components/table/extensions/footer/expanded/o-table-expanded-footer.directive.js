import { Directive, ElementRef, Injector, Input, Renderer2 } from '@angular/core';
import { Subscription } from 'rxjs';
import { distinctUntilChanged, filter } from 'rxjs/operators';
import { OTranslateService } from '../../../../../services/translate/o-translate.service';
import { Util } from '../../../../../util';
import { OTableComponent } from './../../../o-table.component';
var OTableExpandedFooterDirective = (function () {
    function OTableExpandedFooterDirective(table, element, renderer, injector) {
        this.table = table;
        this.element = element;
        this.renderer = renderer;
        this.injector = injector;
        this.subscription = new Subscription();
        this.translateService = this.injector.get(OTranslateService);
    }
    Object.defineProperty(OTableExpandedFooterDirective.prototype, "display", {
        set: function (val) {
            this.showMessage(val);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OTableExpandedFooterDirective.prototype, "colspan", {
        get: function () {
            return this._colspan;
        },
        set: function (value) {
            this._colspan = value;
            if (this.tdTableWithMessage) {
                this.tdTableWithMessage.setAttribute('colspan', value);
            }
        },
        enumerable: true,
        configurable: true
    });
    OTableExpandedFooterDirective.prototype.ngAfterViewInit = function () {
        if (this.element.nativeElement.childNodes[2]) {
            this.tableBody = this.element.nativeElement.childNodes[1];
        }
        this.registerContentChange();
    };
    OTableExpandedFooterDirective.prototype.registerContentChange = function () {
        var _this = this;
        var tr = this.renderer.createElement('tr');
        this.tdTableWithMessage = this.renderer.createElement('td');
        this.renderer.addClass(tr, 'o-table-no-results');
        tr.appendChild(this.tdTableWithMessage);
        this.renderer.appendChild(this.tableBody, tr);
        this.subscription.add(this.table.onContentChange.pipe(distinctUntilChanged(function (prev, curr) { return prev.length === curr.length; }), filter(function () { return !!_this.table.staticData; })).subscribe(function () { return _this.showMessage(true); }));
        if (this.table.oTableQuickFilterComponent) {
            this.subscription.add(this.table.oTableQuickFilterComponent.onChange.pipe().subscribe(function () { return _this.showMessage(true); }));
        }
    };
    OTableExpandedFooterDirective.prototype.showMessage = function (display) {
        this.removeMessageSpan();
        if (display && this.table && this.table.dataSource && this.table.dataSource.renderedData.length === 0) {
            this.createMessageSpan();
        }
    };
    OTableExpandedFooterDirective.prototype.removeMessageSpan = function () {
        if (this.spanMessageNotResults) {
            this.renderer.removeChild(this.element.nativeElement, this.spanMessageNotResults);
        }
    };
    OTableExpandedFooterDirective.prototype.destroy = function () {
        this.subscription.unsubscribe();
    };
    OTableExpandedFooterDirective.prototype.buildMessage = function () {
        var message = '';
        message = this.translateService.get('TABLE.EMPTY');
        if (this.tableHasQuickFilter() && this.table.oTableQuickFilterComponent.value) {
            message += this.translateService.get('TABLE.EMPTY_USING_FILTER', [(this.table.oTableQuickFilterComponent.value)]);
        }
        return message;
    };
    OTableExpandedFooterDirective.prototype.tableHasQuickFilter = function () {
        return this.table.quickFilter && Util.isDefined(this.table.oTableQuickFilterComponent);
    };
    OTableExpandedFooterDirective.prototype.createMessageSpan = function () {
        var message = this.buildMessage();
        this.spanMessageNotResults = this.renderer.createElement('span');
        var messageNotResults = this.renderer.createText(message);
        if (this.tdTableWithMessage) {
            this.tdTableWithMessage.setAttribute('colspan', this.colspan);
            this.renderer.appendChild(this.spanMessageNotResults, messageNotResults);
            this.renderer.appendChild(this.tdTableWithMessage, this.spanMessageNotResults);
        }
    };
    OTableExpandedFooterDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[oTableExpandedFooter]'
                },] }
    ];
    OTableExpandedFooterDirective.ctorParameters = function () { return [
        { type: OTableComponent },
        { type: ElementRef },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    OTableExpandedFooterDirective.propDecorators = {
        display: [{ type: Input, args: ['oTableExpandedFooter',] }],
        colspan: [{ type: Input, args: ['oTableExpandedFooterColspan',] }]
    };
    return OTableExpandedFooterDirective;
}());
export { OTableExpandedFooterDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby10YWJsZS1leHBhbmRlZC1mb290ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhYmxlL2V4dGVuc2lvbnMvZm9vdGVyL2V4cGFuZGVkL28tdGFibGUtZXhwYW5kZWQtZm9vdGVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakcsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdURBQXVELENBQUM7QUFDMUYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUUvRDtJQStCRSx1Q0FDUyxLQUFzQixFQUN0QixPQUFtQixFQUNsQixRQUFtQixFQUNqQixRQUFrQjtRQUhyQixVQUFLLEdBQUwsS0FBSyxDQUFpQjtRQUN0QixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQ2xCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQTFCdEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBNEJ4QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBeEJELHNCQUNJLGtEQUFPO2FBRFgsVUFDWSxHQUFZO1lBQ3RCLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsQ0FB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QUFDLENBQUM7WUFDekUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1NBQ2hGO0lBQ0gsQ0FBQzs7Z0JBakhGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsd0JBQXdCO2lCQUNuQzs7O2dCQUpRLGVBQWU7Z0JBTlcsVUFBVTtnQkFBbUIsU0FBUztnQkFBMUIsUUFBUTs7OzBCQXNCcEQsS0FBSyxTQUFDLHNCQUFzQjswQkFLNUIsS0FBSyxTQUFDLDZCQUE2Qjs7SUFnR3RDLG9DQUFDO0NBQUEsQUFuSEQsSUFtSEM7U0FoSFksNkJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbmplY3RvciwgSW5wdXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBPVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NlcnZpY2VzL3RyYW5zbGF0ZS9vLXRyYW5zbGF0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi91dGlsJztcbmltcG9ydCB7IE9UYWJsZUNvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vLi4vby10YWJsZS5jb21wb25lbnQnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbb1RhYmxlRXhwYW5kZWRGb290ZXJdJ1xufSlcbmV4cG9ydCBjbGFzcyBPVGFibGVFeHBhbmRlZEZvb3RlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuXG4gIHByaXZhdGUgc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzOiBhbnk7XG4gIHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogT1RyYW5zbGF0ZVNlcnZpY2U7XG4gIHByaXZhdGUgdGFibGVCb2R5OiBhbnk7XG4gIHByaXZhdGUgdGRUYWJsZVdpdGhNZXNzYWdlOiBhbnk7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG4gIC8qKlxuICAgKiBTaG93L0hpZGUgbWVzc2FnZSB3aGVuIHRoZSBxdWVyeSBpcyBsYXVuY2hlZC9jYWxsYmFja2VkXG4gICAqL1xuICBASW5wdXQoJ29UYWJsZUV4cGFuZGVkRm9vdGVyJylcbiAgc2V0IGRpc3BsYXkodmFsOiBib29sZWFuKSB7XG4gICAgdGhpcy5zaG93TWVzc2FnZSh2YWwpO1xuICB9XG5cbiAgQElucHV0KCdvVGFibGVFeHBhbmRlZEZvb3RlckNvbHNwYW4nKVxuICBzZXQgY29sc3Bhbih2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fY29sc3BhbiA9IHZhbHVlO1xuICAgIGlmICh0aGlzLnRkVGFibGVXaXRoTWVzc2FnZSkge1xuICAgICAgdGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2Uuc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgdmFsdWUpO1xuICAgIH1cbiAgfVxuICBnZXQgY29sc3BhbigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9jb2xzcGFuO1xuICB9XG4gIHByaXZhdGUgX2NvbHNwYW46IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgdGFibGU6IE9UYWJsZUNvbXBvbmVudCxcbiAgICBwdWJsaWMgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChPVHJhbnNsYXRlU2VydmljZSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXNbMl0pIHtcbiAgICAgIHRoaXMudGFibGVCb2R5ID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2hpbGROb2Rlc1sxXTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RlckNvbnRlbnRDaGFuZ2UoKTtcbiAgfVxuXG4gIHJlZ2lzdGVyQ29udGVudENoYW5nZSgpIHtcbiAgICAvLyBDcmVhdGUgYSB0ciB3aXRoIGEgdGQgYW5kIGluc2lkZSBwdXQgdGhlIG1lc3NhZ2UgYW5kIGFkZCB0byB0Ym9keVxuICAgIC8vIDx0cj48dGQ+PHNwYW4+e21lc3NhZ2V9PC9zcGFuPjx0ZD48dHI+XG4gICAgY29uc3QgdHIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgdGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2UgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0ciwgJ28tdGFibGUtbm8tcmVzdWx0cycpO1xuICAgIHRyLmFwcGVuZENoaWxkKHRoaXMudGRUYWJsZVdpdGhNZXNzYWdlKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMudGFibGVCb2R5LCB0cik7XG5cbiAgICAvKiBTaG93L0hpZGUgbWVzc2FnZSBXaGVuIHRoZSByZW5kZXJlciBkYXRhIGlzIGNoYW5nZWQgd2l0aCBzdGF0aWMgZGF0YSovXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKHRoaXMudGFibGUub25Db250ZW50Q2hhbmdlLnBpcGUoXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgocHJldiwgY3VycikgPT4gcHJldi5sZW5ndGggPT09IGN1cnIubGVuZ3RoKSxcbiAgICAgIGZpbHRlcigoKSA9PiAhIXRoaXMudGFibGUuc3RhdGljRGF0YSlcbiAgICApLnN1YnNjcmliZSgoKSA9PiB0aGlzLnNob3dNZXNzYWdlKHRydWUpKSk7XG5cbiAgICAvKiAgU2hvdy9IaWRlIG1lc3NhZ2Ugd2hlbiB0aGUgcXVpY2tmaWx0ZXIgaXMgY2hhbmdlZCAqL1xuICAgIGlmICh0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50KSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQodGhpcy50YWJsZS5vVGFibGVRdWlja0ZpbHRlckNvbXBvbmVudC5vbkNoYW5nZS5waXBlKCkuc3Vic2NyaWJlKCgpID0+IHRoaXMuc2hvd01lc3NhZ2UodHJ1ZSkpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2hvd01lc3NhZ2UoZGlzcGxheTogYm9vbGVhbik6IHZvaWQge1xuICAgIC8vIHJlc2V0IHNwYW4gbWVzc2FnZVxuICAgIHRoaXMucmVtb3ZlTWVzc2FnZVNwYW4oKTtcblxuICAgIGlmIChkaXNwbGF5ICYmIHRoaXMudGFibGUgJiYgdGhpcy50YWJsZS5kYXRhU291cmNlICYmIHRoaXMudGFibGUuZGF0YVNvdXJjZS5yZW5kZXJlZERhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBnZW5lcmF0ZSBuZXcgbWVzc2FnZVxuICAgICAgdGhpcy5jcmVhdGVNZXNzYWdlU3BhbigpO1xuICAgIH1cbiAgfVxuXG5cbiAgcmVtb3ZlTWVzc2FnZVNwYW4oKSB7XG4gICAgaWYgKHRoaXMuc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCB0aGlzLnNwYW5NZXNzYWdlTm90UmVzdWx0cyk7XG4gICAgfVxuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGJ1aWxkTWVzc2FnZSgpOiBzdHJpbmcge1xuICAgIGxldCBtZXNzYWdlID0gJyc7XG4gICAgbWVzc2FnZSA9IHRoaXMudHJhbnNsYXRlU2VydmljZS5nZXQoJ1RBQkxFLkVNUFRZJyk7XG4gICAgaWYgKHRoaXMudGFibGVIYXNRdWlja0ZpbHRlcigpICYmIHRoaXMudGFibGUub1RhYmxlUXVpY2tGaWx0ZXJDb21wb25lbnQudmFsdWUpIHtcbiAgICAgIG1lc3NhZ2UgKz0gdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmdldCgnVEFCTEUuRU1QVFlfVVNJTkdfRklMVEVSJywgWyh0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50LnZhbHVlKV0pO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0YWJsZUhhc1F1aWNrRmlsdGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRhYmxlLnF1aWNrRmlsdGVyICYmIFV0aWwuaXNEZWZpbmVkKHRoaXMudGFibGUub1RhYmxlUXVpY2tGaWx0ZXJDb21wb25lbnQpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZU1lc3NhZ2VTcGFuKCkge1xuICAgIC8vIDEgQnVpbGQgbWVzc2FnZVxuICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLmJ1aWxkTWVzc2FnZSgpO1xuICAgIC8vIDIgQ3JlYXRlIG1lc3NhZ2VcbiAgICB0aGlzLnNwYW5NZXNzYWdlTm90UmVzdWx0cyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIGNvbnN0IG1lc3NhZ2VOb3RSZXN1bHRzID0gdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KG1lc3NhZ2UpO1xuICAgIGlmICh0aGlzLnRkVGFibGVXaXRoTWVzc2FnZSkge1xuICAgICAgdGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2Uuc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgdGhpcy5jb2xzcGFuKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zcGFuTWVzc2FnZU5vdFJlc3VsdHMsIG1lc3NhZ2VOb3RSZXN1bHRzKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2UsIHRoaXMuc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzKTtcbiAgICB9XG4gIH1cblxufVxuIl19