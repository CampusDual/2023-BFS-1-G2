import { Directive, ElementRef, Injector, Input, Renderer2 } from '@angular/core';
import { Subscription } from 'rxjs';
import { distinctUntilChanged, filter } from 'rxjs/operators';
import { OTranslateService } from '../../../../../services/translate/o-translate.service';
import { Util } from '../../../../../util';
import { OTableComponent } from './../../../o-table.component';
var OTableExpandedFooterDirective = (function () {
    function OTableExpandedFooterDirective(table, element, renderer, injector) {
        this.table = table;
        this.element = element;
        this.renderer = renderer;
        this.injector = injector;
        this.subscription = new Subscription();
        this.translateService = this.injector.get(OTranslateService);
    }
    Object.defineProperty(OTableExpandedFooterDirective.prototype, "display", {
        set: function (val) {
            this.showMessage(val);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OTableExpandedFooterDirective.prototype, "colspan", {
        get: function () {
            return this._colspan;
        },
        set: function (value) {
            this._colspan = value;
            if (this.tdTableWithMessage) {
                this.tdTableWithMessage.setAttribute('colspan', value);
            }
        },
        enumerable: true,
        configurable: true
    });
    OTableExpandedFooterDirective.prototype.ngAfterViewInit = function () {
        if (this.element.nativeElement.childNodes[2]) {
            this.tableBody = this.element.nativeElement.childNodes[1];
        }
        this.registerContentChange();
    };
    OTableExpandedFooterDirective.prototype.registerContentChange = function () {
        var _this = this;
        var tr = this.renderer.createElement('tr');
        this.tdTableWithMessage = this.renderer.createElement('td');
        this.renderer.addClass(tr, 'o-table-no-results');
        tr.appendChild(this.tdTableWithMessage);
        this.renderer.appendChild(this.tableBody, tr);
        this.subscription.add(this.table.onContentChange.pipe(distinctUntilChanged(function (prev, curr) { return prev.length === curr.length; }), filter(function () { return !!_this.table.staticData; })).subscribe(function () { return _this.showMessage(true); }));
        if (this.table.oTableQuickFilterComponent) {
            this.subscription.add(this.table.oTableQuickFilterComponent.onChange.pipe(filter(function (qfValue) { return !!qfValue; })).subscribe(function () { return _this.updateMessage(); }));
        }
    };
    OTableExpandedFooterDirective.prototype.showMessage = function (display) {
        if (this.spanMessageNotResults) {
            this.renderer.removeChild(this.element.nativeElement, this.spanMessageNotResults);
        }
        if (display && this.table && this.table.dataSource && this.table.dataSource.renderedData.length === 0) {
            this.createMessageSpan();
        }
    };
    OTableExpandedFooterDirective.prototype.updateMessage = function () {
        if (this.table && this.table.staticData && this.table.dataSource && this.table.dataSource.renderedData.length === 0 && !this.spanMessageNotResults) {
            this.createMessageSpan();
        }
        else {
            var message = this.buildMessage();
            if (Util.isDefined(this.spanMessageNotResults)) {
                this.spanMessageNotResults.innerHTML = message;
            }
        }
    };
    OTableExpandedFooterDirective.prototype.destroy = function () {
        this.subscription.unsubscribe();
    };
    OTableExpandedFooterDirective.prototype.buildMessage = function () {
        var message = '';
        message = this.translateService.get('TABLE.EMPTY');
        if (this.tableHasQuickFilter() && this.table.oTableQuickFilterComponent.value) {
            message += this.translateService.get('TABLE.EMPTY_USING_FILTER', [(this.table.oTableQuickFilterComponent.value)]);
        }
        return message;
    };
    OTableExpandedFooterDirective.prototype.tableHasQuickFilter = function () {
        return this.table.quickFilter && Util.isDefined(this.table.oTableQuickFilterComponent);
    };
    OTableExpandedFooterDirective.prototype.createMessageSpan = function () {
        var message = this.buildMessage();
        this.spanMessageNotResults = this.renderer.createElement('span');
        var messageNotResults = this.renderer.createText(message);
        if (this.tdTableWithMessage) {
            this.tdTableWithMessage.setAttribute('colspan', this.colspan);
            this.renderer.appendChild(this.spanMessageNotResults, messageNotResults);
            this.renderer.appendChild(this.tdTableWithMessage, this.spanMessageNotResults);
        }
    };
    OTableExpandedFooterDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[oTableExpandedFooter]'
                },] }
    ];
    OTableExpandedFooterDirective.ctorParameters = function () { return [
        { type: OTableComponent },
        { type: ElementRef },
        { type: Renderer2 },
        { type: Injector }
    ]; };
    OTableExpandedFooterDirective.propDecorators = {
        display: [{ type: Input, args: ['oTableExpandedFooter',] }],
        colspan: [{ type: Input, args: ['oTableExpandedFooterColspan',] }]
    };
    return OTableExpandedFooterDirective;
}());
export { OTableExpandedFooterDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby10YWJsZS1leHBhbmRlZC1mb290ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhYmxlL2V4dGVuc2lvbnMvZm9vdGVyL2V4cGFuZGVkL28tdGFibGUtZXhwYW5kZWQtZm9vdGVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakcsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdURBQXVELENBQUM7QUFDMUYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUUvRDtJQTRCRSx1Q0FDUyxLQUFzQixFQUN0QixPQUFtQixFQUNsQixRQUFtQixFQUNqQixRQUFrQjtRQUhyQixVQUFLLEdBQUwsS0FBSyxDQUFpQjtRQUN0QixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQ2xCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCdEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBeUJ4QyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBeEJELHNCQUNJLGtEQUFPO2FBRFgsVUFDWSxHQUFZO1lBQ3RCLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsQ0FB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MEJBQTBCLENBQUMsQ0FBQztJQUN6RixDQUFDO0lBRVMseURBQWlCLEdBQTNCO1FBQ0UsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqRSxJQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVELElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFO1lBQzNCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5RCxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUN6RSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7U0FDaEY7SUFDSCxDQUFDOztnQkEvR0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSx3QkFBd0I7aUJBQ25DOzs7Z0JBSlEsZUFBZTtnQkFOVyxVQUFVO2dCQUFtQixTQUFTO2dCQUExQixRQUFROzs7MEJBbUJwRCxLQUFLLFNBQUMsc0JBQXNCOzBCQUs1QixLQUFLLFNBQUMsNkJBQTZCOztJQWlHdEMsb0NBQUM7Q0FBQSxBQWpIRCxJQWlIQztTQTlHWSw2QkFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEluamVjdG9yLCBJbnB1dCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IE9UcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2VydmljZXMvdHJhbnNsYXRlL28tdHJhbnNsYXRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3V0aWwnO1xuaW1wb3J0IHsgT1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi8uLi9vLXRhYmxlLmNvbXBvbmVudCc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tvVGFibGVFeHBhbmRlZEZvb3Rlcl0nXG59KVxuZXhwb3J0IGNsYXNzIE9UYWJsZUV4cGFuZGVkRm9vdGVyRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgcHJpdmF0ZSBzcGFuTWVzc2FnZU5vdFJlc3VsdHM6IGFueTtcbiAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBPVHJhbnNsYXRlU2VydmljZTtcbiAgcHJpdmF0ZSB0YWJsZUJvZHk6IGFueTtcbiAgcHJpdmF0ZSB0ZFRhYmxlV2l0aE1lc3NhZ2U6IGFueTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgQElucHV0KCdvVGFibGVFeHBhbmRlZEZvb3RlcicpXG4gIHNldCBkaXNwbGF5KHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuc2hvd01lc3NhZ2UodmFsKTtcbiAgfVxuXG4gIEBJbnB1dCgnb1RhYmxlRXhwYW5kZWRGb290ZXJDb2xzcGFuJylcbiAgc2V0IGNvbHNwYW4odmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuX2NvbHNwYW4gPSB2YWx1ZTtcbiAgICBpZiAodGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2UpIHtcbiAgICAgIHRoaXMudGRUYWJsZVdpdGhNZXNzYWdlLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIHZhbHVlKTtcbiAgICB9XG4gIH1cbiAgZ2V0IGNvbHNwYW4oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fY29sc3BhbjtcbiAgfVxuICBwcml2YXRlIF9jb2xzcGFuOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHRhYmxlOiBPVGFibGVDb21wb25lbnQsXG4gICAgcHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7XG4gICAgdGhpcy50cmFuc2xhdGVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoT1RyYW5zbGF0ZVNlcnZpY2UpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmICh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzWzJdKSB7XG4gICAgICB0aGlzLnRhYmxlQm9keSA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXNbMV07XG4gICAgfVxuICAgIHRoaXMucmVnaXN0ZXJDb250ZW50Q2hhbmdlKCk7XG4gIH1cblxuICByZWdpc3RlckNvbnRlbnRDaGFuZ2UoKSB7XG4gICAgLy8gQ3JlYXRlIGEgdHIgd2l0aCBhIHRkIGFuZCBpbnNpZGUgcHV0IHRoZSBtZXNzYWdlIGFuZCBhZGQgdG8gdGJvZHlcbiAgICAvLyA8dHI+PHRkPjxzcGFuPnttZXNzYWdlfTwvc3Bhbj48dGQ+PHRyPlxuICAgIGNvbnN0IHRyID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgIHRoaXMudGRUYWJsZVdpdGhNZXNzYWdlID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModHIsICdvLXRhYmxlLW5vLXJlc3VsdHMnKTtcbiAgICB0ci5hcHBlbmRDaGlsZCh0aGlzLnRkVGFibGVXaXRoTWVzc2FnZSk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnRhYmxlQm9keSwgdHIpO1xuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKHRoaXMudGFibGUub25Db250ZW50Q2hhbmdlLnBpcGUoXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgocHJldiwgY3VycikgPT4gcHJldi5sZW5ndGggPT09IGN1cnIubGVuZ3RoKSxcbiAgICAgIGZpbHRlcigoKSA9PiAhIXRoaXMudGFibGUuc3RhdGljRGF0YSlcbiAgICApLnN1YnNjcmliZSgoKSA9PiB0aGlzLnNob3dNZXNzYWdlKHRydWUpKSk7XG4gICAgaWYgKHRoaXMudGFibGUub1RhYmxlUXVpY2tGaWx0ZXJDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZCh0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50Lm9uQ2hhbmdlLnBpcGUoZmlsdGVyKHFmVmFsdWUgPT4gISFxZlZhbHVlKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMudXBkYXRlTWVzc2FnZSgpKSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNob3dNZXNzYWdlKGRpc3BsYXk6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAvLyByZXNldCBzcGFuIG1lc3NhZ2VcbiAgICBpZiAodGhpcy5zcGFuTWVzc2FnZU5vdFJlc3VsdHMpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsIHRoaXMuc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzKTtcbiAgICB9XG5cbiAgICBpZiAoZGlzcGxheSAmJiB0aGlzLnRhYmxlICYmIHRoaXMudGFibGUuZGF0YVNvdXJjZSAmJiB0aGlzLnRhYmxlLmRhdGFTb3VyY2UucmVuZGVyZWREYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gZ2VuZXJhdGUgbmV3IG1lc3NhZ2VcbiAgICAgIHRoaXMuY3JlYXRlTWVzc2FnZVNwYW4oKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTWVzc2FnZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy50YWJsZSAmJiB0aGlzLnRhYmxlLnN0YXRpY0RhdGEgJiYgdGhpcy50YWJsZS5kYXRhU291cmNlICYmIHRoaXMudGFibGUuZGF0YVNvdXJjZS5yZW5kZXJlZERhdGEubGVuZ3RoID09PSAwICYmICF0aGlzLnNwYW5NZXNzYWdlTm90UmVzdWx0cykge1xuICAgICAgdGhpcy5jcmVhdGVNZXNzYWdlU3BhbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5idWlsZE1lc3NhZ2UoKTtcbiAgICAgIGlmKFV0aWwuaXNEZWZpbmVkKHRoaXMuc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzKSkge1xuICAgICAgICB0aGlzLnNwYW5NZXNzYWdlTm90UmVzdWx0cy5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBidWlsZE1lc3NhZ2UoKTogc3RyaW5nIHtcbiAgICBsZXQgbWVzc2FnZSA9ICcnO1xuICAgIG1lc3NhZ2UgPSB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UuZ2V0KCdUQUJMRS5FTVBUWScpO1xuICAgIGlmICh0aGlzLnRhYmxlSGFzUXVpY2tGaWx0ZXIoKSAmJiB0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50LnZhbHVlKSB7XG4gICAgICBtZXNzYWdlICs9IHRoaXMudHJhbnNsYXRlU2VydmljZS5nZXQoJ1RBQkxFLkVNUFRZX1VTSU5HX0ZJTFRFUicsIFsodGhpcy50YWJsZS5vVGFibGVRdWlja0ZpbHRlckNvbXBvbmVudC52YWx1ZSldKTtcbiAgICB9XG4gICAgcmV0dXJuIG1lc3NhZ2U7XG4gIH1cblxuICBwcm90ZWN0ZWQgdGFibGVIYXNRdWlja0ZpbHRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50YWJsZS5xdWlja0ZpbHRlciAmJiBVdGlsLmlzRGVmaW5lZCh0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVNZXNzYWdlU3BhbigpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5idWlsZE1lc3NhZ2UoKTtcbiAgICB0aGlzLnNwYW5NZXNzYWdlTm90UmVzdWx0cyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIGNvbnN0IG1lc3NhZ2VOb3RSZXN1bHRzID0gdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KG1lc3NhZ2UpO1xuICAgIGlmICh0aGlzLnRkVGFibGVXaXRoTWVzc2FnZSkge1xuICAgICAgdGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2Uuc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgdGhpcy5jb2xzcGFuKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zcGFuTWVzc2FnZU5vdFJlc3VsdHMsIG1lc3NhZ2VOb3RSZXN1bHRzKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy50ZFRhYmxlV2l0aE1lc3NhZ2UsIHRoaXMuc3Bhbk1lc3NhZ2VOb3RSZXN1bHRzKTtcbiAgICB9XG4gIH1cblxufVxuIl19