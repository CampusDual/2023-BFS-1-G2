import { Component, Inject, Injector, ViewChild, ViewEncapsulation } from '@angular/core';
import { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material';
import { Util } from '../../../util/util';
import { OSearchInputComponent } from '../../input/search-input/o-search-input.component';
export var DEFAULT_INPUTS_O_LIST_PICKER_DIALOG = [
    'data',
    'visibleColumns: visible-columns',
    'filter'
];
var OListPickerDialogComponent = (function () {
    function OListPickerDialogComponent(dialogRef, injector, data) {
        this.dialogRef = dialogRef;
        this.injector = injector;
        this.filter = true;
        this.visibleData = [];
        this.itemSize = 30;
        this.data = [];
        if (data.data && Util.isArray(data.data)) {
            this.data = data.data;
            this.visibleData = this.data;
        }
        if (data.visibleColumns && Util.isArray(data.visibleColumns)) {
            this.visibleColsArray = data.visibleColumns;
        }
        if (data.filter !== undefined) {
            this.filter = data.filter;
        }
        if (data.menuColumns) {
            this.menuColumns = data.menuColumns;
        }
        if (data.renderer) {
            this.renderer = data.renderer;
        }
        this.searchVal = data.searchVal;
    }
    OListPickerDialogComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (Util.isDefined(this.searchVal) && this.searchInput !== undefined && this.searchVal.length > 0) {
            this.searchInput.getFormControl().setValue(this.searchVal, {
                emitEvent: false
            });
            setTimeout(function () { return _this.searchInput.onSearch.emit(_this.searchVal); });
        }
    };
    OListPickerDialogComponent.prototype.onClickListItem = function (e, value) {
        this.dialogRef.close(value);
    };
    OListPickerDialogComponent.prototype.trackByFn = function (index, item) {
        return index;
    };
    OListPickerDialogComponent.prototype.onFilterList = function (searchVal) {
        this.visibleData = this.transform(this.data, {
            filtervalue: searchVal,
            filtercolumns: this.visibleColsArray
        });
    };
    OListPickerDialogComponent.prototype.isEmptyData = function () {
        return Util.isDefined(this.visibleData) ? this.visibleData.length === 0 : true;
    };
    OListPickerDialogComponent.prototype.transform = function (value, args) {
        var _this = this;
        if (!args || args.length <= 1) {
            return value;
        }
        var filterValue = args['filtervalue'] ? args['filtervalue'] : '';
        var filterColumns = args['filtercolumns'];
        if (!filterColumns || !filterValue || filterValue.length === 0) {
            return value;
        }
        if (value === undefined || value === null) {
            return value;
        }
        return value.filter(function (item) {
            for (var i = 0; i < filterColumns.length; i++) {
                var colName = filterColumns[i];
                if (_this._isBlank(colName)) {
                    continue;
                }
                var origValue = item[colName];
                if (origValue) {
                    origValue = origValue.toString();
                    if (_this._isBlank(origValue)) {
                        continue;
                    }
                    if (origValue.toUpperCase().indexOf(filterValue.toUpperCase()) > -1) {
                        return item;
                    }
                }
            }
        });
    };
    OListPickerDialogComponent.prototype._isBlank = function (value) {
        return !Util.isDefined(value) || value.length === 0;
    };
    OListPickerDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'o-list-picker-dialog',
                    template: "<div mat-dialog-title *ngIf=\"filter\">\n  <o-search-input #searchInput [columns]=\"menuColumns\" show-menu=\"no\" float-label=\"never\"\n    (onSearch)=\"onFilterList($event)\" class=\"o-list-picker-search\" appearance=\"legacy\"></o-search-input>\n</div>\n<div mat-dialog-content [class.o-list-picker-has-filter]=\"filter\" fxFlex>\n  <cdk-virtual-scroll-viewport [itemSize]=\"itemSize\">\n    <mat-list>\n      <mat-list-item *ngIf=\"isEmptyData()\">\n        {{ 'LIST.EMPTY' | oTranslate }}\n        <ng-container *ngIf=\"filter && searchInput && searchInput.getValue() && searchInput.getValue().length > 0\">\n          {{ 'LIST.EMPTY_USING_FILTER' | oTranslate : { values: [searchInput.getValue()] } }}\n        </ng-container>\n      </mat-list-item>\n      <mat-list-item (click)=\"onClickListItem($event, item)\"\n        *cdkVirtualFor=\"let item of visibleData; trackBy: trackByFn\">\n\n        <ng-container *ngIf=\"renderer\">\n          <ng-template *ngTemplateOutlet=\"renderer?.templateref; context:{ value: item }\">\n          </ng-template>\n        </ng-container>\n        <ng-container *ngIf=\"!renderer\">\n          <span>{{ item['_parsedVisibleColumnText'] }}</span>\n        </ng-container>\n\n        <mat-divider></mat-divider>\n      </mat-list-item>\n\n    </mat-list>\n  </cdk-virtual-scroll-viewport>\n\n</div>\n<mat-dialog-actions align=\"end\">\n  <button type=\"button\" mat-stroked-button mat-dialog-close class=\"o-button-default cancel\">{{ 'CANCEL' | oTranslate }}</button>\n</mat-dialog-actions>",
                    inputs: DEFAULT_INPUTS_O_LIST_PICKER_DIALOG,
                    encapsulation: ViewEncapsulation.None,
                    host: {
                        '[class.o-list-picker-dialog]': 'true'
                    },
                    styles: [".cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog{display:flex;flex-direction:column;height:100%}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title{margin-top:-16px}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper{padding-bottom:0}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-prefix{border:0}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-prefix .mat-icon{vertical-align:middle}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-label{position:static;padding:0 4px}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-underline{display:none}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-content .cdk-virtual-scroll-viewport{height:100%}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-content .cdk-virtual-scroll-viewport mat-list mat-list-item{cursor:pointer}"]
                }] }
    ];
    OListPickerDialogComponent.ctorParameters = function () { return [
        { type: MatDialogRef },
        { type: Injector },
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    OListPickerDialogComponent.propDecorators = {
        searchInput: [{ type: ViewChild, args: ['searchInput', { static: false },] }]
    };
    return OListPickerDialogComponent;
}());
export { OListPickerDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2lucHV0L2xpc3RwaWNrZXIvby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pHLE9BQU8sRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBRzFGLE1BQU0sQ0FBQyxJQUFNLG1DQUFtQyxHQUFHO0lBQ2pELE1BQU07SUFDTixpQ0FBaUM7SUFDakMsUUFBUTtDQUNULENBQUM7QUFFRjtJQXlCRSxvQ0FDUyxTQUFtRCxFQUNoRCxRQUFrQixFQUNILElBQVM7UUFGM0IsY0FBUyxHQUFULFNBQVMsQ0FBMEM7UUFDaEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWZ2QixXQUFNLEdBQVksSUFBSSxDQUFDO1FBQ3ZCLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBRXRCLGFBQVEsR0FBVyxFQUFFLENBQUM7UUFNbkIsU0FBSSxHQUFVLEVBQUUsQ0FBQztRQVN6QixJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDeEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztTQUM5QjtRQUNELElBQUksSUFBSSxDQUFDLGNBQWMs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SyxFQUFFOztJQXVHN0MsaUNBQUM7Q0FBQSxBQXpIRCxJQXlIQztTQS9HWSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEluamVjdCwgSW5qZWN0b3IsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1BVF9ESUFMT0dfREFUQSwgTWF0RGlhbG9nUmVmIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IE9TZWFyY2hJbnB1dENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2lucHV0L3NlYXJjaC1pbnB1dC9vLXNlYXJjaC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgT0xpc3RQaWNrZXJDdXN0b21SZW5kZXJlciB9IGZyb20gJy4vbGlzdHBpY2tlci1yZW5kZXJlci9vLWxpc3QtcGlja2VyLXJlbmRlcmVyLmNsYXNzJztcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfSU5QVVRTX09fTElTVF9QSUNLRVJfRElBTE9HID0gW1xuICAnZGF0YScsXG4gICd2aXNpYmxlQ29sdW1uczogdmlzaWJsZS1jb2x1bW5zJyxcbiAgJ2ZpbHRlcidcbl07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ28tbGlzdC1waWNrZXItZGlhbG9nJyxcbiAgdGVtcGxhdGVVcmw6ICcuL28tbGlzdC1waWNrZXItZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50LnNjc3MnXSxcbiAgaW5wdXRzOiBERUZBVUxUX0lOUFVUU19PX0xJU1RfUElDS0VSX0RJQUxPRyxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgaG9zdDoge1xuICAgICdbY2xhc3Muby1saXN0LXBpY2tlci1kaWFsb2ddJzogJ3RydWUnXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgT0xpc3RQaWNrZXJEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcblxuICBwdWJsaWMgZmlsdGVyOiBib29sZWFuID0gdHJ1ZTtcbiAgcHVibGljIHZpc2libGVEYXRhOiBhbnkgPSBbXTtcbiAgcHVibGljIHNlYXJjaFZhbDogc3RyaW5nO1xuICBwdWJsaWMgaXRlbVNpemU6IG51bWJlciA9IDMwO1xuICBwdWJsaWMgcmVuZGVyZXI6IE9MaXN0UGlja2VyQ3VzdG9tUmVuZGVyZXI7XG5cbiAgQFZpZXdDaGlsZCgnc2VhcmNoSW5wdXQnLCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgcHVibGljIHNlYXJjaElucHV0OiBPU2VhcmNoSW5wdXRDb21wb25lbnQ7XG5cbiAgcHJvdGVjdGVkIGRhdGE6IGFueVtdID0gW107XG4gIHB1YmxpYyBtZW51Q29sdW1uczogc3RyaW5nO1xuICBwcm90ZWN0ZWQgdmlzaWJsZUNvbHNBcnJheTogc3RyaW5nW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPE9MaXN0UGlja2VyRGlhbG9nQ29tcG9uZW50PixcbiAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBkYXRhOiBhbnlcbiAgKSB7XG4gICAgaWYgKGRhdGEuZGF0YSAmJiBVdGlsLmlzQXJyYXkoZGF0YS5kYXRhKSkge1xuICAgICAgdGhpcy5kYXRhID0gZGF0YS5kYXRhO1xuICAgICAgdGhpcy52aXNpYmxlRGF0YSA9IHRoaXMuZGF0YTtcbiAgICB9XG4gICAgaWYgKGRhdGEudmlzaWJsZUNvbHVtbnMgJiYgVXRpbC5pc0FycmF5KGRhdGEudmlzaWJsZUNvbHVtbnMpKSB7XG4gICAgICB0aGlzLnZpc2libGVDb2xzQXJyYXkgPSBkYXRhLnZpc2libGVDb2x1bW5zO1xuICAgIH1cblxuICAgIGlmIChkYXRhLmZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmZpbHRlciA9IGRhdGEuZmlsdGVyO1xuICAgIH1cbiAgICBpZiAoZGF0YS5tZW51Q29sdW1ucykge1xuICAgICAgdGhpcy5tZW51Q29sdW1ucyA9IGRhdGEubWVudUNvbHVtbnM7XG4gICAgfVxuICAgIGlmIChkYXRhLnJlbmRlcmVyKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyID0gZGF0YS5yZW5kZXJlcjtcbiAgICB9XG4gICAgdGhpcy5zZWFyY2hWYWwgPSBkYXRhLnNlYXJjaFZhbDtcbiAgfVxuXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKFV0aWwuaXNEZWZpbmVkKHRoaXMuc2VhcmNoVmFsKSAmJiB0aGlzLnNlYXJjaElucHV0ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zZWFyY2hWYWwubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZWFyY2hJbnB1dC5nZXRGb3JtQ29udHJvbCgpLnNldFZhbHVlKHRoaXMuc2VhcmNoVmFsLCB7XG4gICAgICAgIGVtaXRFdmVudDogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgLy9UT0RPIGltcHJvdmU6IEFkZGVkIHNldFRpbWVvdXQgZm9yIHJlc29sdmluZyBFeHByZXNzaW9uQ2hhbmdlZEFmdGVySXRIYXNCZWVuQ2hlY2tlZEVycm9yIGVycm9yIGJlY2F1c2UgdGhlIG9ic2VydmFibGVzIGRvbnQgd29ya1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNlYXJjaElucHV0Lm9uU2VhcmNoLmVtaXQodGhpcy5zZWFyY2hWYWwpKTtcbiAgICB9XG4gIH1cblxuXG4gIHB1YmxpYyBvbkNsaWNrTGlzdEl0ZW0oZTogYW55LCB2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UodmFsdWUpO1xuICB9XG5cbiAgcHVibGljIHRyYWNrQnlGbihpbmRleDogbnVtYmVyLCBpdGVtOiBhbnkpOiBudW1iZXIge1xuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIHB1YmxpYyBvbkZpbHRlckxpc3Qoc2VhcmNoVmFsOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnZpc2libGVEYXRhID0gdGhpcy50cmFuc2Zvcm0odGhpcy5kYXRhLCB7XG4gICAgICBmaWx0ZXJ2YWx1ZTogc2VhcmNoVmFsLFxuICAgICAgZmlsdGVyY29sdW1uczogdGhpcy52aXNpYmxlQ29sc0FycmF5XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgaXNFbXB0eURhdGEoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIFV0aWwuaXNEZWZpbmVkKHRoaXMudmlzaWJsZURhdGEpID8gdGhpcy52aXNpYmxlRGF0YS5sZW5ndGggPT09IDAgOiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSB0cmFuc2Zvcm0odmFsdWU6IGFueVtdLCBhcmdzOiBhbnkpOiBhbnkge1xuICAgIGlmICghYXJncyB8fCBhcmdzLmxlbmd0aCA8PSAxKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgY29uc3QgZmlsdGVyVmFsdWUgPSBhcmdzWydmaWx0ZXJ2YWx1ZSddID8gYXJnc1snZmlsdGVydmFsdWUnXSA6ICcnO1xuICAgIGNvbnN0IGZpbHRlckNvbHVtbnMgPSBhcmdzWydmaWx0ZXJjb2x1bW5zJ107XG5cbiAgICBpZiAoIWZpbHRlckNvbHVtbnMgfHwgIWZpbHRlclZhbHVlIHx8IGZpbHRlclZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlLmZpbHRlcihpdGVtID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyQ29sdW1ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjb2xOYW1lID0gZmlsdGVyQ29sdW1uc1tpXTtcbiAgICAgICAgaWYgKHRoaXMuX2lzQmxhbmsoY29sTmFtZSkpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3JpZ1ZhbHVlID0gaXRlbVtjb2xOYW1lXTtcbiAgICAgICAgaWYgKG9yaWdWYWx1ZSkge1xuICAgICAgICAgIG9yaWdWYWx1ZSA9IG9yaWdWYWx1ZS50b1N0cmluZygpO1xuICAgICAgICAgIGlmICh0aGlzLl9pc0JsYW5rKG9yaWdWYWx1ZSkpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChvcmlnVmFsdWUudG9VcHBlckNhc2UoKS5pbmRleE9mKGZpbHRlclZhbHVlLnRvVXBwZXJDYXNlKCkpID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfaXNCbGFuayh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICFVdGlsLmlzRGVmaW5lZCh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID09PSAwO1xuICB9XG5cbn1cbiJdfQ==