import { ElementRef, Inject, Injector, Optional, ViewChild } from '@angular/core';
import { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material';
import { Util } from '../../util/util';
export var DEFAULT_INPUTS_O_CONTAINER = [
    'oattr: attr',
    'title',
    'layoutAlign: layout-align',
    'elevation',
    'icon',
    'appearance',
    'layoutGap: layout-gap'
];
var OContainerComponent = (function () {
    function OContainerComponent(elRef, injector, matFormDefaultOption) {
        var _this = this;
        this.elRef = elRef;
        this.injector = injector;
        this.matFormDefaultOption = matFormDefaultOption;
        this._elevation = 0;
        this.defaultLayoutAlign = 'start start';
        this._outlineGapCalculationNeededImmediately = false;
        this.titleObserver = new MutationObserver(function () { return _this.updateOutlineGap(); });
    }
    Object.defineProperty(OContainerComponent.prototype, "containerTitle", {
        set: function (elem) {
            this._titleEl = elem;
            if (this._titleEl) {
                this.registerObserver();
                this.updateOutlineGap();
            }
            else {
                this.unRegisterObserver();
            }
        },
        enumerable: true,
        configurable: true
    });
    OContainerComponent.prototype.ngAfterViewInit = function () {
        if (this.elRef) {
            this.elRef.nativeElement.removeAttribute('title');
        }
        this.registerObserver();
    };
    OContainerComponent.prototype.ngAfterContentChecked = function () {
        if (this._outlineGapCalculationNeededImmediately) {
            this.updateOutlineGap();
        }
    };
    OContainerComponent.prototype.ngOnDestroy = function () {
        this.unRegisterObserver();
    };
    OContainerComponent.prototype.getAttribute = function () {
        if (this.oattr) {
            return this.oattr;
        }
        else if (this.elRef && this.elRef.nativeElement.attributes.attr) {
            return this.elRef.nativeElement.attributes.attr.value;
        }
    };
    Object.defineProperty(OContainerComponent.prototype, "appearance", {
        get: function () {
            return this._appearance;
        },
        set: function (value) {
            var _this = this;
            this._appearance = value;
            setTimeout(function () { _this.updateOutlineGap(); }, 0);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OContainerComponent.prototype, "elevation", {
        get: function () {
            return this._elevation;
        },
        set: function (elevation) {
            this._elevation = elevation;
            this.propagateElevationToDOM();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OContainerComponent.prototype, "layoutAlign", {
        get: function () {
            return this._layoutAlign;
        },
        set: function (align) {
            if (!align || align.length === 0) {
                align = this.defaultLayoutAlign;
            }
            this._layoutAlign = align;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OContainerComponent.prototype, "layoutGap", {
        get: function () {
            return this._layoutGap;
        },
        set: function (layoutGap) {
            this._layoutGap = layoutGap;
        },
        enumerable: true,
        configurable: true
    });
    OContainerComponent.prototype.hasHeader = function () {
        return !!this.title || !!this.icon;
    };
    OContainerComponent.prototype.isAppearanceOutlineSetted = function () {
        var isAppearanceSetted = false;
        if (Util.isDefined(this.appearance)) {
            isAppearanceSetted = this.appearance === OContainerComponent.APPEARANCE_OUTLINE;
        }
        return isAppearanceSetted;
    };
    OContainerComponent.prototype.hasHeaderOrAppearanceOutlineSetted = function () {
        return this.isAppearanceOutlineSetted() || this.hasHeader();
    };
    OContainerComponent.prototype.hasHeaderAndAppearanceOutline = function () {
        return this.isAppearanceOutline() && this.hasHeader();
    };
    OContainerComponent.prototype.isAppearanceOutline = function () {
        var isAppearanceOutline = (this.matFormDefaultOption && this.matFormDefaultOption.appearance === OContainerComponent.APPEARANCE_OUTLINE);
        if (Util.isDefined(this.appearance)) {
            isAppearanceOutline = this.appearance === OContainerComponent.APPEARANCE_OUTLINE;
        }
        return isAppearanceOutline;
    };
    OContainerComponent.prototype.hasTitleInAppearanceOutline = function () {
        return this.isAppearanceOutline() && this.hasHeader();
    };
    OContainerComponent.prototype.propagateElevationToDOM = function () {
        this.cleanElevationCSSclasses();
        if (this.elevation > 0 && this.elevation <= 12) {
            this.elRef.nativeElement.classList.add('mat-elevation-z' + this.elevation);
        }
    };
    OContainerComponent.prototype.cleanElevationCSSclasses = function () {
        var _this = this;
        var classList = [].slice.call(this.elRef.nativeElement.classList);
        if (classList && classList.length) {
            classList.forEach(function (item) {
                if (item.startsWith('mat-elevation')) {
                    _this.elRef.nativeElement.classList.remove(item);
                }
            });
        }
    };
    OContainerComponent.prototype.updateOutlineGap = function () {
        if (this.isAppearanceOutline()) {
            var titleEl = this._titleEl ? this._titleEl.nativeElement : null;
            if (!this._containerRef) {
                return;
            }
            if (document.documentElement && !document.documentElement.contains(this.elRef.nativeElement)) {
                this._outlineGapCalculationNeededImmediately = true;
                return;
            }
            var container = this._containerRef.nativeElement;
            var containerRect = container.getBoundingClientRect();
            if (containerRect.width === 0 && containerRect.height === 0) {
                return;
            }
            var containerStart = containerRect.left;
            var labelStart = titleEl.getBoundingClientRect().left;
            var labelWidth = this.hasHeader() ? titleEl.offsetWidth : 0;
            var startWidth = labelStart - containerStart;
            var startEls = container.querySelectorAll('.o-container-outline-start');
            var gapEls = container.querySelectorAll('.o-container-outline-gap');
            gapEls[0].style.width = labelWidth + "px";
            startEls[0].style.width = startWidth + "px";
            this._outlineGapCalculationNeededImmediately = false;
        }
    };
    OContainerComponent.prototype.registerObserver = function () {
        if (this._titleEl) {
            this.titleObserver.observe(this._titleEl.nativeElement, {
                childList: true,
                characterData: true,
                subtree: true
            });
        }
    };
    OContainerComponent.prototype.unRegisterObserver = function () {
        if (this.titleObserver) {
            this.titleObserver.disconnect();
        }
    };
    OContainerComponent.APPEARANCE_OUTLINE = 'outline';
    OContainerComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [MAT_FORM_FIELD_DEFAULT_OPTIONS,] }] }
    ]; };
    OContainerComponent.propDecorators = {
        containerTitle: [{ type: ViewChild, args: ['containerTitle', { static: false },] }],
        _containerRef: [{ type: ViewChild, args: ['container', { static: true },] }]
    };
    return OContainerComponent;
}());
export { OContainerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1jb250YWluZXItY29tcG9uZW50LmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnRhaW5lci9vLWNvbnRhaW5lci1jb21wb25lbnQuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFzQyxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBYSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pJLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2QyxNQUFNLENBQUMsSUFBTSwwQkFBMEIsR0FBRztJQUN4QyxhQUFhO0lBQ2IsT0FBTztJQUNQLDJCQUEyQjtJQUMzQixXQUFXO0lBQ1gsTUFBTTtJQUNOLFlBQVk7SUFDWix1QkFBdUI7Q0FDeEIsQ0FBQztBQUVGO0lBNkJFLDZCQUNZLEtBQWlCLEVBQ2pCLFFBQWtCLEVBQ2tDLG9CQUFvQjtRQUhwRixpQkFJSztRQUhPLFVBQUssR0FBTCxLQUFLLENBQVk7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNrQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQUE7UUF6QjFFLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsdUJBQWtCLEdBQVcsYUFBYSxDQUFDO1FBSzdDLDRDQUF1QyxHQUFHLEtBQUssQ0FBQztRQUU5QyxrQkFBYSxHQUFHLElBQUksZ0JBQWdCLENBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUF2QixDQUF1QixDQUFDLENBQUM7SUFrQjFFLENBQUM7SUFmTCxzQkFBb0QsK0NBQWM7YUFBbEUsVUFBbUUsSUFBZ0I7WUFDakYsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDckIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFF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QUFJLEVBQUU7O0lBdUsxQywwQkFBQztDQUFBLEFBbE1ELElBa01DO1NBbE1ZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyQ29udGVudENoZWNrZWQsIEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYsIEluamVjdCwgSW5qZWN0b3IsIE9uRGVzdHJveSwgT3B0aW9uYWwsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTUFUX0ZPUk1fRklFTERfREVGQVVMVF9PUFRJT05TIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbC91dGlsJztcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfSU5QVVRTX09fQ09OVEFJTkVSID0gW1xuICAnb2F0dHI6IGF0dHInLFxuICAndGl0bGUnLFxuICAnbGF5b3V0QWxpZ246IGxheW91dC1hbGlnbicsXG4gICdlbGV2YXRpb24nLFxuICAnaWNvbicsXG4gICdhcHBlYXJhbmNlJyxcbiAgJ2xheW91dEdhcDogbGF5b3V0LWdhcCdcbl07XG5cbmV4cG9ydCBjbGFzcyBPQ29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBBZnRlckNvbnRlbnRDaGVja2VkIHtcblxuICBwdWJsaWMgc3RhdGljIEFQUEVBUkFOQ0VfT1VUTElORSA9ICdvdXRsaW5lJztcblxuICBwdWJsaWMgb2F0dHI6IHN0cmluZztcblxuICBwdWJsaWMgdGl0bGU6IHN0cmluZztcbiAgcHJvdGVjdGVkIF9lbGV2YXRpb246IG51bWJlciA9IDA7XG4gIHByb3RlY3RlZCBkZWZhdWx0TGF5b3V0QWxpZ246IHN0cmluZyA9ICdzdGFydCBzdGFydCc7XG4gIHByb3RlY3RlZCBfbGF5b3V0QWxpZ246IHN0cmluZztcbiAgcHVibGljIGljb246IHN0cmluZztcbiAgcHJvdGVjdGVkIF9hcHBlYXJhbmNlOiBzdHJpbmc7XG4gIHByb3RlY3RlZCBfbGF5b3V0R2FwOiBzdHJpbmc7XG4gIHByaXZhdGUgX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5ID0gZmFsc2U7XG5cbiAgcHJvdGVjdGVkIHRpdGxlT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB0aGlzLnVwZGF0ZU91dGxpbmVHYXAoKSk7XG5cbiAgcHJvdGVjdGVkIF90aXRsZUVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjb250YWluZXJUaXRsZScsIHsgc3RhdGljOiBmYWxzZSB9KSBzZXQgY29udGFpbmVyVGl0bGUoZWxlbTogRWxlbWVudFJlZikge1xuICAgIHRoaXMuX3RpdGxlRWwgPSBlbGVtO1xuICAgIGlmICh0aGlzLl90aXRsZUVsKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyT2JzZXJ2ZXIoKTtcbiAgICAgIHRoaXMudXBkYXRlT3V0bGluZUdhcCgpOyAvLyBUaGlzIG11c3QgYmUgdHJpZ2dlcmVkIHdoZW4gdGl0bGUgY29udGFpbmVyIGlzIHJlLXJlZ2lzdGVyZWRcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51blJlZ2lzdGVyT2JzZXJ2ZXIoKTtcbiAgICB9XG4gIH1cbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgcHJvdGVjdGVkIF9jb250YWluZXJSZWY6IEVsZW1lbnRSZWY7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGVsUmVmOiBFbGVtZW50UmVmLFxuICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChNQVRfRk9STV9GSUVMRF9ERUZBVUxUX09QVElPTlMpIHByb3RlY3RlZCBtYXRGb3JtRGVmYXVsdE9wdGlvblxuICApIHsgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lbFJlZikge1xuICAgICAgdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgndGl0bGUnKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3Rlck9ic2VydmVyKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5KSB7XG4gICAgICB0aGlzLnVwZGF0ZU91dGxpbmVHYXAoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnVuUmVnaXN0ZXJPYnNlcnZlcigpO1xuICB9XG5cbiAgcHVibGljIGdldEF0dHJpYnV0ZSgpIHtcbiAgICBpZiAodGhpcy5vYXR0cikge1xuICAgICAgcmV0dXJuIHRoaXMub2F0dHI7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVsUmVmICYmIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLmF0dHIpIHtcbiAgICAgIHJldHVybiB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcy5hdHRyLnZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBhcHBlYXJhbmNlKCkge1xuICAgIHJldHVybiB0aGlzLl9hcHBlYXJhbmNlO1xuICB9XG5cbiAgc2V0IGFwcGVhcmFuY2UodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuX2FwcGVhcmFuY2UgPSB2YWx1ZTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy51cGRhdGVPdXRsaW5lR2FwKCk7IH0sIDApO1xuICB9XG5cbiAgZ2V0IGVsZXZhdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZWxldmF0aW9uO1xuICB9XG5cbiAgc2V0IGVsZXZhdGlvbihlbGV2YXRpb246IG51bWJlcikge1xuICAgIHRoaXMuX2VsZXZhdGlvbiA9IGVsZXZhdGlvbjtcbiAgICB0aGlzLnByb3BhZ2F0ZUVsZXZhdGlvblRvRE9NKCk7XG4gIH1cblxuICBnZXQgbGF5b3V0QWxpZ24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xheW91dEFsaWduO1xuICB9XG5cbiAgc2V0IGxheW91dEFsaWduKGFsaWduOiBzdHJpbmcpIHtcbiAgICBpZiAoIWFsaWduIHx8IGFsaWduLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYWxpZ24gPSB0aGlzLmRlZmF1bHRMYXlvdXRBbGlnbjtcbiAgICB9XG4gICAgdGhpcy5fbGF5b3V0QWxpZ24gPSBhbGlnbjtcbiAgfVxuXG4gIGdldCBsYXlvdXRHYXAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xheW91dEdhcDtcbiAgfVxuXG4gIHNldCBsYXlvdXRHYXAobGF5b3V0R2FwOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9sYXlvdXRHYXAgPSBsYXlvdXRHYXA7XG4gIH1cblxuICBwdWJsaWMgaGFzSGVhZGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMudGl0bGUgfHwgISF0aGlzLmljb247XG4gIH1cblxuICBpc0FwcGVhcmFuY2VPdXRsaW5lU2V0dGVkKCk6IGJvb2xlYW4ge1xuICAgIGxldCBpc0FwcGVhcmFuY2VTZXR0ZWQgPSBmYWxzZTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5hcHBlYXJhbmNlKSkge1xuICAgICAgaXNBcHBlYXJhbmNlU2V0dGVkID0gdGhpcy5hcHBlYXJhbmNlID09PSBPQ29udGFpbmVyQ29tcG9uZW50LkFQUEVBUkFOQ0VfT1VUTElORTtcbiAgICB9XG4gICAgcmV0dXJuIGlzQXBwZWFyYW5jZVNldHRlZDtcbiAgfVxuXG4gIHB1YmxpYyBoYXNIZWFkZXJPckFwcGVhcmFuY2VPdXRsaW5lU2V0dGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmVTZXR0ZWQoKSB8fCB0aGlzLmhhc0hlYWRlcigpO1xuICB9XG5cbiAgcHVibGljIGhhc0hlYWRlckFuZEFwcGVhcmFuY2VPdXRsaW5lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmUoKSAmJiB0aGlzLmhhc0hlYWRlcigpO1xuICB9XG5cbiAgcHVibGljIGlzQXBwZWFyYW5jZU91dGxpbmUoKTogYm9vbGVhbiB7XG4gICAgbGV0IGlzQXBwZWFyYW5jZU91dGxpbmUgPSAodGhpcy5tYXRGb3JtRGVmYXVsdE9wdGlvbiAmJiB0aGlzLm1hdEZvcm1EZWZhdWx0T3B0aW9uLmFwcGVhcmFuY2UgPT09IE9Db250YWluZXJDb21wb25lbnQuQVBQRUFSQU5DRV9PVVRMSU5FKTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5hcHBlYXJhbmNlKSkge1xuICAgICAgaXNBcHBlYXJhbmNlT3V0bGluZSA9IHRoaXMuYXBwZWFyYW5jZSA9PT0gT0NvbnRhaW5lckNvbXBvbmVudC5BUFBFQVJBTkNFX09VVExJTkU7XG4gICAgfVxuICAgIHJldHVybiBpc0FwcGVhcmFuY2VPdXRsaW5lO1xuICB9XG5cbiAgcHVibGljIGhhc1RpdGxlSW5BcHBlYXJhbmNlT3V0bGluZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0FwcGVhcmFuY2VPdXRsaW5lKCkgJiYgdGhpcy5oYXNIZWFkZXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwcm9wYWdhdGVFbGV2YXRpb25Ub0RPTSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFuRWxldmF0aW9uQ1NTY2xhc3NlcygpO1xuICAgIGlmICh0aGlzLmVsZXZhdGlvbiA+IDAgJiYgdGhpcy5lbGV2YXRpb24gPD0gMTIpIHtcbiAgICAgIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdtYXQtZWxldmF0aW9uLXonICsgdGhpcy5lbGV2YXRpb24pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBjbGVhbkVsZXZhdGlvbkNTU2NsYXNzZXMoKTogdm9pZCB7XG4gICAgY29uc3QgY2xhc3NMaXN0ID0gW10uc2xpY2UuY2FsbCh0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0KTtcbiAgICBpZiAoY2xhc3NMaXN0ICYmIGNsYXNzTGlzdC5sZW5ndGgpIHtcbiAgICAgIGNsYXNzTGlzdC5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uc3RhcnRzV2l0aCgnbWF0LWVsZXZhdGlvbicpKSB7XG4gICAgICAgICAgdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB1cGRhdGVPdXRsaW5lR2FwKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmUoKSkge1xuICAgICAgY29uc3QgdGl0bGVFbCA9IHRoaXMuX3RpdGxlRWwgPyB0aGlzLl90aXRsZUVsLm5hdGl2ZUVsZW1lbnQgOiBudWxsO1xuXG4gICAgICBpZiAoIXRoaXMuX2NvbnRhaW5lclJlZikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmICFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY29udGFpbnModGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50KSkge1xuICAgICAgICB0aGlzLl9vdXRsaW5lR2FwQ2FsY3VsYXRpb25OZWVkZWRJbW1lZGlhdGVseSA9IHRydWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5fY29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgaWYgKGNvbnRhaW5lclJlY3Qud2lkdGggPT09IDAgJiYgY29udGFpbmVyUmVjdC5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb250YWluZXJTdGFydCA9IGNvbnRhaW5lclJlY3QubGVmdDtcbiAgICAgIGNvbnN0IGxhYmVsU3RhcnQgPSB0aXRsZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICBjb25zdCBsYWJlbFdpZHRoID0gdGhpcy5oYXNIZWFkZXIoKSA/IHRpdGxlRWwub2Zmc2V0V2lkdGggOiAwO1xuICAgICAgY29uc3Qgc3RhcnRXaWR0aCA9IGxhYmVsU3RhcnQgLSBjb250YWluZXJTdGFydDtcblxuICAgICAgY29uc3Qgc3RhcnRFbHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLm8tY29udGFpbmVyLW91dGxpbmUtc3RhcnQnKTtcbiAgICAgIGNvbnN0IGdhcEVscyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuby1jb250YWluZXItb3V0bGluZS1nYXAnKTtcbiAgICAgIGdhcEVsc1swXS5zdHlsZS53aWR0aCA9IGAke2xhYmVsV2lkdGh9cHhgO1xuICAgICAgc3RhcnRFbHNbMF0uc3R5bGUud2lkdGggPSBgJHtzdGFydFdpZHRofXB4YDtcbiAgICAgIHRoaXMuX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHJlZ2lzdGVyT2JzZXJ2ZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3RpdGxlRWwpIHtcbiAgICAgIHRoaXMudGl0bGVPYnNlcnZlci5vYnNlcnZlKHRoaXMuX3RpdGxlRWwubmF0aXZlRWxlbWVudCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB1blJlZ2lzdGVyT2JzZXJ2ZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudGl0bGVPYnNlcnZlcikge1xuICAgICAgdGhpcy50aXRsZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG4gIH1cblxufVxuIl19