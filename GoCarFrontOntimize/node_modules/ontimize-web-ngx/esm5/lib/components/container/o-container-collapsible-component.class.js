import * as tslib_1 from "tslib";
import { ElementRef, EventEmitter, Inject, Injector, Optional, ViewChild } from '@angular/core';
import { MAT_FORM_FIELD_DEFAULT_OPTIONS, MatExpansionPanel } from '@angular/material';
import { Subscription } from 'rxjs';
import { InputConverter } from '../../decorators/input-converter';
import { DEFAULT_INPUTS_O_CONTAINER, OContainerComponent } from './o-container-component.class';
export var DEFAULT_INPUTS_O_CONTAINER_COLLAPSIBLE = tslib_1.__spread(DEFAULT_INPUTS_O_CONTAINER, [
    'expanded',
    'description',
    'collapsedHeight: collapsed-height',
    'expandedHeight: expanded-height'
]);
export var DEFAULT_OUTPUTS_O_CONTAINER_COLLAPSIBLE = [
    'onClosed',
    'onOpened',
    'onAfterCollapse',
    'onAfterExpand'
];
var OContainerCollapsibleComponent = (function (_super) {
    tslib_1.__extends(OContainerCollapsibleComponent, _super);
    function OContainerCollapsibleComponent(elRef, injector, matFormDefaultOption) {
        var _this = _super.call(this, elRef, injector, matFormDefaultOption) || this;
        _this.elRef = elRef;
        _this.injector = injector;
        _this.matFormDefaultOption = matFormDefaultOption;
        _this.expanded = true;
        _this.collapsedHeight = '37px';
        _this.expandedHeight = '37px';
        _this.onClosed = new EventEmitter();
        _this.onOpened = new EventEmitter();
        _this.onAfterCollapse = new EventEmitter();
        _this.onAfterExpand = new EventEmitter();
        _this.expPanelSubscriptions = new Subscription();
        return _this;
    }
    OContainerCollapsibleComponent.prototype.ngAfterViewInit = function () {
        _super.prototype.ngAfterViewInit.call(this);
        this.updateOutlineGap();
        this.subscribeEventsExpPanel();
    };
    OContainerCollapsibleComponent.prototype.subscribeEventsExpPanel = function () {
        var _this = this;
        this.expPanelSubscriptions.add(this.expPanel.afterCollapse.subscribe(function () { return _this.onAfterCollapse.emit(); }));
        this.expPanelSubscriptions.add(this.expPanel.afterExpand.subscribe(function () { return _this.onAfterExpand.emit(); }));
        this.expPanelSubscriptions.add(this.expPanel.closed.subscribe(function () { return _this.onClosed.emit(); }));
        this.expPanelSubscriptions.add(this.expPanel.opened.subscribe(function () { return _this.onOpened.emit(); }));
    };
    OContainerCollapsibleComponent.prototype.updateOutlineGap = function () {
        if (this.isAppearanceOutline()) {
            var exPanelHeader = this._titleEl ? this._titleEl._element.nativeElement : null;
            if (!this.oContainerOutline) {
                return;
            }
            var containerOutline = this.oContainerOutline.nativeElement;
            var containerOutlineRect = containerOutline.getBoundingClientRect();
            if (containerOutlineRect.width === 0 && containerOutlineRect.height === 0) {
                return;
            }
            var titleEl = exPanelHeader.querySelector('.o-container-title.mat-expansion-panel-header-title');
            var descrEl = exPanelHeader.querySelector('.mat-expansion-panel-header-description');
            var containerStart = containerOutlineRect.left;
            var descrStart = descrEl.getBoundingClientRect().left;
            var titleWidth = 0;
            if (this.hasHeader()) {
                titleWidth += this.icon ? titleEl.querySelector('mat-icon').offsetWidth : 0;
                titleWidth += this.title ? titleEl.querySelector('span').offsetWidth : 0;
                titleWidth = titleWidth === 0 ? 0 : titleWidth + 4;
            }
            var labelStart = titleEl.getBoundingClientRect().left;
            var startWidth = labelStart - containerStart - 2;
            var empty1Width = descrStart - containerStart - titleWidth - 24;
            var descrWidth = this.description ? descrEl.querySelector('span').offsetWidth + 8 : 0;
            var startEls = containerOutline.querySelectorAll('.o-container-outline-start');
            var gapTitleEls = containerOutline.querySelectorAll('.o-container-outline-gap-title');
            var gapEmpty1Els = containerOutline.querySelectorAll('.o-container-outline-gap-empty1');
            var gapDescrEls = containerOutline.querySelectorAll('.o-container-outline-gap-description');
            startEls[0].style.width = startWidth + "px";
            gapTitleEls[0].style.width = titleWidth + "px";
            gapEmpty1Els[0].style.width = empty1Width + "px";
            gapDescrEls[0].style.width = descrWidth + "px";
        }
    };
    OContainerCollapsibleComponent.prototype.registerObserver = function () {
        if (this._titleEl) {
            this.titleObserver.observe(this._titleEl._element.nativeElement, {
                childList: true,
                characterData: true,
                subtree: true
            });
        }
    };
    OContainerCollapsibleComponent.prototype.updateInnerHeight = function (height) {
        if (this.containerContent) {
            this.containerContent.nativeElement.style.height = height;
        }
        if (this.oContainerOutline) {
            this.oContainerOutline.nativeElement.style.height = height;
        }
    };
    OContainerCollapsibleComponent.prototype.ngOnDestroy = function () {
        this.expPanelSubscriptions.unsubscribe();
    };
    OContainerCollapsibleComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [MAT_FORM_FIELD_DEFAULT_OPTIONS,] }] }
    ]; };
    OContainerCollapsibleComponent.propDecorators = {
        expPanel: [{ type: ViewChild, args: ['expPanel', { static: false },] }],
        containerContent: [{ type: ViewChild, args: ['containerContent', { static: true },] }],
        oContainerOutline: [{ type: ViewChild, args: ['oContainerOutline', { static: false },] }]
    };
    tslib_1.__decorate([
        InputConverter(),
        tslib_1.__metadata("design:type", Boolean)
    ], OContainerCollapsibleComponent.prototype, "expanded", void 0);
    return OContainerCollapsibleComponent;
}(OContainerComponent));
export { OContainerCollapsibleComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1jb250YWluZXItY29sbGFwc2libGUtY29tcG9uZW50LmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnRhaW5lci9vLWNvbnRhaW5lci1jb2xsYXBzaWJsZS1jb21wb25lbnQuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBaUIsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFhLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUgsT0FBTyxFQUFFLDhCQUE4QixFQUFFLGlCQUFpQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDdEYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVwQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFaEcsTUFBTSxDQUFDLElBQU0sc0NBQXNDLG9CQUM5QywwQkFBMEI7SUFDN0IsVUFBVTtJQUNWLGFBQWE7SUFDYixtQ0FBbUM7SUFDbkMsaUNBQWlDO0VBQ2xDLENBQUM7QUFDRixNQUFNLENBQUMsSUFBTSx1Q0FBdUMsR0FBRztJQUVyRCxVQUFVO0lBRVYsVUFBVTtJQUVWLGlCQUFpQjtJQUVqQixlQUFlO0NBQ2hCLENBQUE7QUFFRDtJQUFvRCwwREFBbUI7SUFvQnJFLHdDQUNZLEtBQWlCLEVBQ2pCLFFBQWtCLEVBQ2tDLG9CQUFvQjtRQUhwRixZQUtFLGtCQUFNLEtBQUssRUFBRSxRQUFRLEVBQUUsb0JBQW9CLENBQUMsU0FDN0M7UUFMVyxXQUFLLEdBQUwsS0FBSyxDQUFZO1FBQ2pCLGNBQVEsR0FBUixRQUFRLENBQVU7UUFDa0MsMEJBQW9CLEdBQXBCLG9CQUFvQixDQUFBO1FBcEI3RSxjQUFRLEdBQVks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LEVBQUU7O0lBWmpEO1FBREMsY0FBYyxFQUFFOztvRUFDZTtJQXVHbEMscUNBQUM7Q0FBQSxBQTFHRCxDQUFvRCxtQkFBbUIsR0EwR3RFO1NBMUdZLDhCQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0LCBJbmplY3RvciwgT25EZXN0cm95LCBPcHRpb25hbCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNQVRfRk9STV9GSUVMRF9ERUZBVUxUX09QVElPTlMsIE1hdEV4cGFuc2lvblBhbmVsIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IElucHV0Q29udmVydGVyIH0gZnJvbSAnLi4vLi4vZGVjb3JhdG9ycy9pbnB1dC1jb252ZXJ0ZXInO1xuaW1wb3J0IHsgREVGQVVMVF9JTlBVVFNfT19DT05UQUlORVIsIE9Db250YWluZXJDb21wb25lbnQgfSBmcm9tICcuL28tY29udGFpbmVyLWNvbXBvbmVudC5jbGFzcyc7XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0lOUFVUU19PX0NPTlRBSU5FUl9DT0xMQVBTSUJMRSA9IFtcbiAgLi4uREVGQVVMVF9JTlBVVFNfT19DT05UQUlORVIsXG4gICdleHBhbmRlZCcsXG4gICdkZXNjcmlwdGlvbicsXG4gICdjb2xsYXBzZWRIZWlnaHQ6IGNvbGxhcHNlZC1oZWlnaHQnLFxuICAnZXhwYW5kZWRIZWlnaHQ6IGV4cGFuZGVkLWhlaWdodCdcbl07XG5leHBvcnQgY29uc3QgREVGQVVMVF9PVVRQVVRTX09fQ09OVEFJTkVSX0NPTExBUFNJQkxFID0gW1xuICAvL29uQ2xvc2VkOiBFdmVudCBlbWl0dGVkIGV2ZXJ5IHRpbWUgdGhlIGNvbXBvbmVudCBjb2xsYXBzaWJsZSBpcyBjbG9zZWQuXG4gICdvbkNsb3NlZCcsXG4gIC8vb25PcGVuZWQ6IEV2ZW50IGVtaXR0ZWQgZXZlcnkgdGltZSB0aGUgY29tcG9uZW50IGNvbGxhcHNpYmxlIGlzIG9wZW5lZC5cbiAgJ29uT3BlbmVkJyxcbiAgLy9vbkFmdGVyQ29sbGFwc2U6IEFuIGV2ZW50IGVtaXR0ZWQgYWZ0ZXIgdGhlIGJvZHkncyBjb2xsYXBzZSBhbmltYXRpb24gaGFwcGVucy5cbiAgJ29uQWZ0ZXJDb2xsYXBzZScsXG4gIC8vb25BZnRlckV4cGFuZDogQW4gZXZlbnQgZW1pdHRlZCBhZnRlciB0aGUgYm9keSdzIGV4cGFuc2lvbiBhbmltYXRpb24gaGFwcGVucy5cbiAgJ29uQWZ0ZXJFeHBhbmQnXG5dXG5cbmV4cG9ydCBjbGFzcyBPQ29udGFpbmVyQ29sbGFwc2libGVDb21wb25lbnQgZXh0ZW5kcyBPQ29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXRDb252ZXJ0ZXIoKVxuICBwdWJsaWMgZXhwYW5kZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBwdWJsaWMgY29sbGFwc2VkSGVpZ2h0ID0gJzM3cHgnO1xuICBwdWJsaWMgZXhwYW5kZWRIZWlnaHQgPSAnMzdweCc7XG4gIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gIG9uQ2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBvbk9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgb25BZnRlckNvbGxhcHNlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBvbkFmdGVyRXhwYW5kID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2V4cFBhbmVsJywgeyBzdGF0aWM6IGZhbHNlIH0pIGV4cFBhbmVsOiBNYXRFeHBhbnNpb25QYW5lbDsgLy8gVXNlZCBpbiBzdWJjb21wb25lbnRzXG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lckNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcm90ZWN0ZWQgY29udGFpbmVyQ29udGVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnb0NvbnRhaW5lck91dGxpbmUnLCB7IHN0YXRpYzogZmFsc2UgfSkgcHJvdGVjdGVkIG9Db250YWluZXJPdXRsaW5lOiBFbGVtZW50UmVmO1xuXG5cbiAgcHJvdGVjdGVkIGV4cFBhbmVsU3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBlbFJlZjogRWxlbWVudFJlZixcbiAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoTUFUX0ZPUk1fRklFTERfREVGQVVMVF9PUFRJT05TKSBwcm90ZWN0ZWQgbWF0Rm9ybURlZmF1bHRPcHRpb25cbiAgKSB7XG4gICAgc3VwZXIoZWxSZWYsIGluamVjdG9yLCBtYXRGb3JtRGVmYXVsdE9wdGlvbik7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XG4gICAgdGhpcy51cGRhdGVPdXRsaW5lR2FwKCk7XG4gICAgdGhpcy5zdWJzY3JpYmVFdmVudHNFeHBQYW5lbCgpO1xuICB9XG5cbiAgc3Vic2NyaWJlRXZlbnRzRXhwUGFuZWwoKSB7XG4gICAgdGhpcy5leHBQYW5lbFN1YnNjcmlwdGlvbnMuYWRkKHRoaXMuZXhwUGFuZWwuYWZ0ZXJDb2xsYXBzZS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vbkFmdGVyQ29sbGFwc2UuZW1pdCgpKSk7XG4gICAgdGhpcy5leHBQYW5lbFN1YnNjcmlwdGlvbnMuYWRkKHRoaXMuZXhwUGFuZWwuYWZ0ZXJFeHBhbmQuc3Vic2NyaWJlKCgpID0+IHRoaXMub25BZnRlckV4cGFuZC5lbWl0KCkpKTtcbiAgICB0aGlzLmV4cFBhbmVsU3Vic2NyaXB0aW9ucy5hZGQodGhpcy5leHBQYW5lbC5jbG9zZWQuc3Vic2NyaWJlKCgpID0+IHRoaXMub25DbG9zZWQuZW1pdCgpKSk7XG4gICAgdGhpcy5leHBQYW5lbFN1YnNjcmlwdGlvbnMuYWRkKHRoaXMuZXhwUGFuZWwub3BlbmVkLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uT3BlbmVkLmVtaXQoKSkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHVwZGF0ZU91dGxpbmVHYXAoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNBcHBlYXJhbmNlT3V0bGluZSgpKSB7XG4gICAgICBjb25zdCBleFBhbmVsSGVhZGVyID0gdGhpcy5fdGl0bGVFbCA/ICh0aGlzLl90aXRsZUVsIGFzIGFueSkuX2VsZW1lbnQubmF0aXZlRWxlbWVudCA6IG51bGw7XG5cbiAgICAgIGlmICghdGhpcy5vQ29udGFpbmVyT3V0bGluZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBjb250YWluZXJPdXRsaW5lID0gdGhpcy5vQ29udGFpbmVyT3V0bGluZS5uYXRpdmVFbGVtZW50O1xuICAgICAgY29uc3QgY29udGFpbmVyT3V0bGluZVJlY3QgPSBjb250YWluZXJPdXRsaW5lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgaWYgKGNvbnRhaW5lck91dGxpbmVSZWN0LndpZHRoID09PSAwICYmIGNvbnRhaW5lck91dGxpbmVSZWN0LmhlaWdodCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRpdGxlRWwgPSBleFBhbmVsSGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5vLWNvbnRhaW5lci10aXRsZS5tYXQtZXhwYW5zaW9uLXBhbmVsLWhlYWRlci10aXRsZScpO1xuICAgICAgY29uc3QgZGVzY3JFbCA9IGV4UGFuZWxIZWFkZXIucXVlcnlTZWxlY3RvcignLm1hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyLWRlc2NyaXB0aW9uJyk7XG5cbiAgICAgIGNvbnN0IGNvbnRhaW5lclN0YXJ0ID0gY29udGFpbmVyT3V0bGluZVJlY3QubGVmdDtcbiAgICAgIGNvbnN0IGRlc2NyU3RhcnQgPSBkZXNjckVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG5cbiAgICAgIGxldCB0aXRsZVdpZHRoID0gMDtcbiAgICAgIGlmICh0aGlzLmhhc0hlYWRlcigpKSB7XG4gICAgICAgIHRpdGxlV2lkdGggKz0gdGhpcy5pY29uID8gdGl0bGVFbC5xdWVyeVNlbGVjdG9yKCdtYXQtaWNvbicpLm9mZnNldFdpZHRoIDogMDsgLy8gaWNvblxuICAgICAgICB0aXRsZVdpZHRoICs9IHRoaXMudGl0bGUgPyB0aXRsZUVsLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKS5vZmZzZXRXaWR0aCA6IDA7IC8vIHRpdGxlXG4gICAgICAgIHRpdGxlV2lkdGggPSB0aXRsZVdpZHRoID09PSAwID8gMCA6IHRpdGxlV2lkdGggKyA0O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBsYWJlbFN0YXJ0ID0gdGl0bGVFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgICAgY29uc3Qgc3RhcnRXaWR0aCA9IGxhYmVsU3RhcnQgLSBjb250YWluZXJTdGFydCAtIDI7XG4gICAgICBjb25zdCBlbXB0eTFXaWR0aCA9IGRlc2NyU3RhcnQgLSBjb250YWluZXJTdGFydCAtIHRpdGxlV2lkdGggLSAyNDtcbiAgICAgIGNvbnN0IGRlc2NyV2lkdGggPSB0aGlzLmRlc2NyaXB0aW9uID8gZGVzY3JFbC5xdWVyeVNlbGVjdG9yKCdzcGFuJykub2Zmc2V0V2lkdGggKyA4IDogMDtcblxuICAgICAgY29uc3Qgc3RhcnRFbHMgPSBjb250YWluZXJPdXRsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJy5vLWNvbnRhaW5lci1vdXRsaW5lLXN0YXJ0Jyk7XG4gICAgICBjb25zdCBnYXBUaXRsZUVscyA9IGNvbnRhaW5lck91dGxpbmUucXVlcnlTZWxlY3RvckFsbCgnLm8tY29udGFpbmVyLW91dGxpbmUtZ2FwLXRpdGxlJyk7XG4gICAgICBjb25zdCBnYXBFbXB0eTFFbHMgPSBjb250YWluZXJPdXRsaW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJy5vLWNvbnRhaW5lci1vdXRsaW5lLWdhcC1lbXB0eTEnKTtcbiAgICAgIGNvbnN0IGdhcERlc2NyRWxzID0gY29udGFpbmVyT3V0bGluZS5xdWVyeVNlbGVjdG9yQWxsKCcuby1jb250YWluZXItb3V0bGluZS1nYXAtZGVzY3JpcHRpb24nKTtcblxuICAgICAgc3RhcnRFbHNbMF0uc3R5bGUud2lkdGggPSBgJHtzdGFydFdpZHRofXB4YDtcbiAgICAgIGdhcFRpdGxlRWxzWzBdLnN0eWxlLndpZHRoID0gYCR7dGl0bGVXaWR0aH1weGA7XG4gICAgICBnYXBFbXB0eTFFbHNbMF0uc3R5bGUud2lkdGggPSBgJHtlbXB0eTFXaWR0aH1weGA7XG4gICAgICBnYXBEZXNjckVsc1swXS5zdHlsZS53aWR0aCA9IGAke2Rlc2NyV2lkdGh9cHhgO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCByZWdpc3Rlck9ic2VydmVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl90aXRsZUVsKSB7XG4gICAgICB0aGlzLnRpdGxlT2JzZXJ2ZXIub2JzZXJ2ZSgodGhpcy5fdGl0bGVFbCBhcyBhbnkpLl9lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsIHtcbiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlLFxuICAgICAgICBzdWJ0cmVlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVJbm5lckhlaWdodChoZWlnaHQ6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbnRhaW5lckNvbnRlbnQpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyQ29udGVudC5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGhlaWdodDtcbiAgICB9XG4gICAgaWYgKHRoaXMub0NvbnRhaW5lck91dGxpbmUpIHtcbiAgICAgIHRoaXMub0NvbnRhaW5lck91dGxpbmUubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgfVxuICB9XG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZXhwUGFuZWxTdWJzY3JpcHRpb25zLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxufVxuIl19