import { Component, Inject, Injector, ViewChild, ViewEncapsulation } from '@angular/core';
import { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material';
import { Util } from '../../../util/util';
import { OSearchInputComponent } from '../../input/search-input/o-search-input.component';
export const DEFAULT_INPUTS_O_LIST_PICKER_DIALOG = [
    'data',
    'visibleColumns: visible-columns',
    'filter'
];
export class OListPickerDialogComponent {
    constructor(dialogRef, injector, data) {
        this.dialogRef = dialogRef;
        this.injector = injector;
        this.filter = true;
        this.visibleData = [];
        this.itemSize = 30;
        this.data = [];
        if (data.data && Util.isArray(data.data)) {
            this.data = data.data;
            this.visibleData = this.data;
        }
        if (data.visibleColumns && Util.isArray(data.visibleColumns)) {
            this.visibleColsArray = data.visibleColumns;
        }
        if (data.filter !== undefined) {
            this.filter = data.filter;
        }
        if (data.menuColumns) {
            this.menuColumns = data.menuColumns;
        }
        if (data.renderer) {
            this.renderer = data.renderer;
        }
        this.searchVal = data.searchVal;
    }
    ngAfterViewInit() {
        if (Util.isDefined(this.searchVal) && this.searchInput !== undefined && this.searchVal.length > 0) {
            this.searchInput.getFormControl().setValue(this.searchVal, {
                emitEvent: false
            });
            setTimeout(() => this.searchInput.onSearch.emit(this.searchVal));
        }
    }
    onClickListItem(e, value) {
        this.dialogRef.close(value);
    }
    trackByFn(index, item) {
        return index;
    }
    onFilterList(searchVal) {
        this.visibleData = this.transform(this.data, {
            filtervalue: searchVal,
            filtercolumns: this.visibleColsArray
        });
    }
    isEmptyData() {
        return Util.isDefined(this.visibleData) ? this.visibleData.length === 0 : true;
    }
    transform(value, args) {
        if (!args || args.length <= 1) {
            return value;
        }
        const filterValue = args['filtervalue'] ? args['filtervalue'] : '';
        const filterColumns = args['filtercolumns'];
        if (!filterColumns || !filterValue || filterValue.length === 0) {
            return value;
        }
        if (value === undefined || value === null) {
            return value;
        }
        return value.filter(item => {
            for (let i = 0; i < filterColumns.length; i++) {
                const colName = filterColumns[i];
                if (this._isBlank(colName)) {
                    continue;
                }
                let origValue = item[colName];
                if (origValue) {
                    origValue = origValue.toString();
                    if (this._isBlank(origValue)) {
                        continue;
                    }
                    if (origValue.toUpperCase().indexOf(filterValue.toUpperCase()) > -1) {
                        return item;
                    }
                }
            }
        });
    }
    _isBlank(value) {
        return !Util.isDefined(value) || value.length === 0;
    }
}
OListPickerDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'o-list-picker-dialog',
                template: "<div mat-dialog-title *ngIf=\"filter\">\n  <o-search-input #searchInput [columns]=\"menuColumns\" show-menu=\"no\" float-label=\"never\"\n    (onSearch)=\"onFilterList($event)\" class=\"o-list-picker-search\" appearance=\"legacy\"></o-search-input>\n</div>\n<div mat-dialog-content [class.o-list-picker-has-filter]=\"filter\" fxFlex>\n  <cdk-virtual-scroll-viewport [itemSize]=\"itemSize\">\n    <mat-list>\n      <mat-list-item *ngIf=\"isEmptyData()\">\n        {{ 'LIST.EMPTY' | oTranslate }}\n        <ng-container *ngIf=\"filter && searchInput && searchInput.getValue() && searchInput.getValue().length > 0\">\n          {{ 'LIST.EMPTY_USING_FILTER' | oTranslate : { values: [searchInput.getValue()] } }}\n        </ng-container>\n      </mat-list-item>\n      <mat-list-item (click)=\"onClickListItem($event, item)\"\n        *cdkVirtualFor=\"let item of visibleData; trackBy: trackByFn\">\n\n        <ng-container *ngIf=\"renderer\">\n          <ng-template *ngTemplateOutlet=\"renderer?.templateref; context:{ value: item }\">\n          </ng-template>\n        </ng-container>\n        <ng-container *ngIf=\"!renderer\">\n          <span>{{ item['_parsedVisibleColumnText'] }}</span>\n        </ng-container>\n\n        <mat-divider></mat-divider>\n      </mat-list-item>\n\n    </mat-list>\n  </cdk-virtual-scroll-viewport>\n\n</div>\n<mat-dialog-actions align=\"end\">\n  <button type=\"button\" mat-stroked-button mat-dialog-close class=\"o-button-default cancel\">{{ 'CANCEL' | oTranslate }}</button>\n</mat-dialog-actions>",
                inputs: DEFAULT_INPUTS_O_LIST_PICKER_DIALOG,
                encapsulation: ViewEncapsulation.None,
                host: {
                    '[class.o-list-picker-dialog]': 'true'
                },
                styles: [".cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog{display:flex;flex-direction:column;height:100%}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title{margin-top:-16px}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper{padding-bottom:0}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-prefix{border:0}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-prefix .mat-icon{vertical-align:middle}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-label{position:static;padding:0 4px}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-title .o-search-input mat-form-field .mat-form-field-wrapper .mat-form-field-underline{display:none}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-content .cdk-virtual-scroll-viewport{height:100%}.cdk-overlay-list-picker .mat-dialog-container .o-list-picker-dialog .mat-dialog-content .cdk-virtual-scroll-viewport mat-list mat-list-item{cursor:pointer}"]
            }] }
];
OListPickerDialogComponent.ctorParameters = () => [
    { type: MatDialogRef },
    { type: Injector },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
OListPickerDialogComponent.propDecorators = {
    searchInput: [{ type: ViewChild, args: ['searchInput', { static: false },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2lucHV0L2xpc3RwaWNrZXIvby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pHLE9BQU8sRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBRzFGLE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHO0lBQ2pELE1BQU07SUFDTixpQ0FBaUM7SUFDakMsUUFBUTtDQUNULENBQUM7QUFZRixNQUFNLE9BQU8sMEJBQTBCO0lBZXJDLFlBQ1MsU0FBbUQsRUFDaEQsUUFBa0IsRUFDSCxJQUFTO1FBRjNCLGNBQVMsR0FBVCxTQUFTLENBQTBDO1FBQ2hELGFBQVEsR0FBUixRQUFRLENBQVU7UUFmdkIsV0FBTSxHQUFZLElBQUksQ0FBQztRQUN2QixnQkFBVyxHQUFRLEVBQUUsQ0FBQztRQUV0QixhQUFRLEdBQVcsRUFBRSxDQUFDO1FBTW5CLFNBQUksR0FBVSxFQUFFLENBQUM7UUFTekIsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUN0QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDOUI7UUFDRCxJQUFJ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ZWN0LCBJbmplY3RvciwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTUFUX0RJQUxPR19EQVRBLCBNYXREaWFsb2dSZWYgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5cbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi8uLi91dGlsL3V0aWwnO1xuaW1wb3J0IHsgT1NlYXJjaElucHV0Q29tcG9uZW50IH0gZnJvbSAnLi4vLi4vaW5wdXQvc2VhcmNoLWlucHV0L28tc2VhcmNoLWlucHV0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBPTGlzdFBpY2tlckN1c3RvbVJlbmRlcmVyIH0gZnJvbSAnLi9saXN0cGlja2VyLXJlbmRlcmVyL28tbGlzdC1waWNrZXItcmVuZGVyZXIuY2xhc3MnO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9JTlBVVFNfT19MSVNUX1BJQ0tFUl9ESUFMT0cgPSBbXG4gICdkYXRhJyxcbiAgJ3Zpc2libGVDb2x1bW5zOiB2aXNpYmxlLWNvbHVtbnMnLFxuICAnZmlsdGVyJ1xuXTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnby1saXN0LXBpY2tlci1kaWFsb2cnLFxuICB0ZW1wbGF0ZVVybDogJy4vby1saXN0LXBpY2tlci1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9vLWxpc3QtcGlja2VyLWRpYWxvZy5jb21wb25lbnQuc2NzcyddLFxuICBpbnB1dHM6IERFRkFVTFRfSU5QVVRTX09fTElTVF9QSUNLRVJfRElBTE9HLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5vLWxpc3QtcGlja2VyLWRpYWxvZ10nOiAndHJ1ZSdcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBPTGlzdFBpY2tlckRpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuXG4gIHB1YmxpYyBmaWx0ZXI6IGJvb2xlYW4gPSB0cnVlO1xuICBwdWJsaWMgdmlzaWJsZURhdGE6IGFueSA9IFtdO1xuICBwdWJsaWMgc2VhcmNoVmFsOiBzdHJpbmc7XG4gIHB1YmxpYyBpdGVtU2l6ZTogbnVtYmVyID0gMzA7XG4gIHB1YmxpYyByZW5kZXJlcjogT0xpc3RQaWNrZXJDdXN0b21SZW5kZXJlcjtcblxuICBAVmlld0NoaWxkKCdzZWFyY2hJbnB1dCcsIHsgc3RhdGljOiBmYWxzZSB9KVxuICBwdWJsaWMgc2VhcmNoSW5wdXQ6IE9TZWFyY2hJbnB1dENvbXBvbmVudDtcblxuICBwcm90ZWN0ZWQgZGF0YTogYW55W10gPSBbXTtcbiAgcHVibGljIG1lbnVDb2x1bW5zOiBzdHJpbmc7XG4gIHByb3RlY3RlZCB2aXNpYmxlQ29sc0FycmF5OiBzdHJpbmdbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8T0xpc3RQaWNrZXJEaWFsb2dDb21wb25lbnQ+LFxuICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQEluamVjdChNQVRfRElBTE9HX0RBVEEpIGRhdGE6IGFueVxuICApIHtcbiAgICBpZiAoZGF0YS5kYXRhICYmIFV0aWwuaXNBcnJheShkYXRhLmRhdGEpKSB7XG4gICAgICB0aGlzLmRhdGEgPSBkYXRhLmRhdGE7XG4gICAgICB0aGlzLnZpc2libGVEYXRhID0gdGhpcy5kYXRhO1xuICAgIH1cbiAgICBpZiAoZGF0YS52aXNpYmxlQ29sdW1ucyAmJiBVdGlsLmlzQXJyYXkoZGF0YS52aXNpYmxlQ29sdW1ucykpIHtcbiAgICAgIHRoaXMudmlzaWJsZUNvbHNBcnJheSA9IGRhdGEudmlzaWJsZUNvbHVtbnM7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEuZmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZmlsdGVyID0gZGF0YS5maWx0ZXI7XG4gICAgfVxuICAgIGlmIChkYXRhLm1lbnVDb2x1bW5zKSB7XG4gICAgICB0aGlzLm1lbnVDb2x1bW5zID0gZGF0YS5tZW51Q29sdW1ucztcbiAgICB9XG4gICAgaWYgKGRhdGEucmVuZGVyZXIpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIgPSBkYXRhLnJlbmRlcmVyO1xuICAgIH1cbiAgICB0aGlzLnNlYXJjaFZhbCA9IGRhdGEuc2VhcmNoVmFsO1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5zZWFyY2hWYWwpICYmIHRoaXMuc2VhcmNoSW5wdXQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnNlYXJjaFZhbC5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNlYXJjaElucHV0LmdldEZvcm1Db250cm9sKCkuc2V0VmFsdWUodGhpcy5zZWFyY2hWYWwsIHtcbiAgICAgICAgZW1pdEV2ZW50OiBmYWxzZVxuICAgICAgfSk7XG4gICAgICAvL1RPRE8gaW1wcm92ZTogQWRkZWQgc2V0VGltZW91dCBmb3IgcmVzb2x2aW5nIEV4cHJlc3Npb25DaGFuZ2VkQWZ0ZXJJdEhhc0JlZW5DaGVja2VkRXJyb3IgZXJyb3IgYmVjYXVzZSB0aGUgb2JzZXJ2YWJsZXMgZG9udCB3b3JrXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc2VhcmNoSW5wdXQub25TZWFyY2guZW1pdCh0aGlzLnNlYXJjaFZhbCkpO1xuICAgIH1cbiAgfVxuXG5cbiAgcHVibGljIG9uQ2xpY2tMaXN0SXRlbShlOiBhbnksIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSh2YWx1ZSk7XG4gIH1cblxuICBwdWJsaWMgdHJhY2tCeUZuKGluZGV4OiBudW1iZXIsIGl0ZW06IGFueSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgcHVibGljIG9uRmlsdGVyTGlzdChzZWFyY2hWYWw6IGFueSk6IHZvaWQge1xuICAgIHRoaXMudmlzaWJsZURhdGEgPSB0aGlzLnRyYW5zZm9ybSh0aGlzLmRhdGEsIHtcbiAgICAgIGZpbHRlcnZhbHVlOiBzZWFyY2hWYWwsXG4gICAgICBmaWx0ZXJjb2x1bW5zOiB0aGlzLnZpc2libGVDb2xzQXJyYXlcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpc0VtcHR5RGF0YSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gVXRpbC5pc0RlZmluZWQodGhpcy52aXNpYmxlRGF0YSkgPyB0aGlzLnZpc2libGVEYXRhLmxlbmd0aCA9PT0gMCA6IHRydWU7XG4gIH1cblxuICBwcml2YXRlIHRyYW5zZm9ybSh2YWx1ZTogYW55W10sIGFyZ3M6IGFueSk6IGFueSB7XG4gICAgaWYgKCFhcmdzIHx8IGFyZ3MubGVuZ3RoIDw9IDEpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IGFyZ3NbJ2ZpbHRlcnZhbHVlJ10gPyBhcmdzWydmaWx0ZXJ2YWx1ZSddIDogJyc7XG4gICAgY29uc3QgZmlsdGVyQ29sdW1ucyA9IGFyZ3NbJ2ZpbHRlcmNvbHVtbnMnXTtcblxuICAgIGlmICghZmlsdGVyQ29sdW1ucyB8fCAhZmlsdGVyVmFsdWUgfHwgZmlsdGVyVmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWUuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJDb2x1bW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNvbE5hbWUgPSBmaWx0ZXJDb2x1bW5zW2ldO1xuICAgICAgICBpZiAodGhpcy5faXNCbGFuayhjb2xOYW1lKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBvcmlnVmFsdWUgPSBpdGVtW2NvbE5hbWVdO1xuICAgICAgICBpZiAob3JpZ1ZhbHVlKSB7XG4gICAgICAgICAgb3JpZ1ZhbHVlID0gb3JpZ1ZhbHVlLnRvU3RyaW5nKCk7XG4gICAgICAgICAgaWYgKHRoaXMuX2lzQmxhbmsob3JpZ1ZhbHVlKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG9yaWdWYWx1ZS50b1VwcGVyQ2FzZSgpLmluZGV4T2YoZmlsdGVyVmFsdWUudG9VcHBlckNhc2UoKSkgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9pc0JsYW5rKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIVV0aWwuaXNEZWZpbmVkKHZhbHVlKSB8fCB2YWx1ZS5sZW5ndGggPT09IDA7XG4gIH1cblxufVxuIl19