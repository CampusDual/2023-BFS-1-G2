import { ElementRef, Inject, Injector, Optional, ViewChild } from '@angular/core';
import { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material';
import { Util } from '../../util/util';
export const DEFAULT_INPUTS_O_CONTAINER = [
    'oattr: attr',
    'title',
    'layoutAlign: layout-align',
    'elevation',
    'icon',
    'appearance',
    'layoutGap: layout-gap'
];
export class OContainerComponent {
    constructor(elRef, injector, matFormDefaultOption) {
        this.elRef = elRef;
        this.injector = injector;
        this.matFormDefaultOption = matFormDefaultOption;
        this._elevation = 0;
        this.defaultLayoutAlign = 'start start';
        this._outlineGapCalculationNeededImmediately = false;
        this.titleObserver = new MutationObserver(() => this.updateOutlineGap());
    }
    set containerTitle(elem) {
        this._titleEl = elem;
        if (this._titleEl) {
            this.registerObserver();
            this.updateOutlineGap();
        }
        else {
            this.unRegisterObserver();
        }
    }
    ngAfterViewInit() {
        if (this.elRef) {
            this.elRef.nativeElement.removeAttribute('title');
        }
        this.registerObserver();
    }
    ngAfterContentChecked() {
        if (this._outlineGapCalculationNeededImmediately) {
            this.updateOutlineGap();
        }
    }
    ngOnDestroy() {
        this.unRegisterObserver();
    }
    getAttribute() {
        if (this.oattr) {
            return this.oattr;
        }
        else if (this.elRef && this.elRef.nativeElement.attributes.attr) {
            return this.elRef.nativeElement.attributes.attr.value;
        }
    }
    get appearance() {
        return this._appearance;
    }
    set appearance(value) {
        this._appearance = value;
        setTimeout(() => { this.updateOutlineGap(); }, 0);
    }
    get elevation() {
        return this._elevation;
    }
    set elevation(elevation) {
        this._elevation = elevation;
        this.propagateElevationToDOM();
    }
    get layoutAlign() {
        return this._layoutAlign;
    }
    set layoutAlign(align) {
        if (!align || align.length === 0) {
            align = this.defaultLayoutAlign;
        }
        this._layoutAlign = align;
    }
    get layoutGap() {
        return this._layoutGap;
    }
    set layoutGap(layoutGap) {
        this._layoutGap = layoutGap;
    }
    hasHeader() {
        return !!this.title || !!this.icon;
    }
    isAppearanceOutlineSetted() {
        let isAppearanceSetted = false;
        if (Util.isDefined(this.appearance)) {
            isAppearanceSetted = this.appearance === OContainerComponent.APPEARANCE_OUTLINE;
        }
        return isAppearanceSetted;
    }
    hasHeaderOrAppearanceOutlineSetted() {
        return this.isAppearanceOutlineSetted() || this.hasHeader();
    }
    hasHeaderAndAppearanceOutline() {
        return this.isAppearanceOutline() && this.hasHeader();
    }
    isAppearanceOutline() {
        let isAppearanceOutline = (this.matFormDefaultOption && this.matFormDefaultOption.appearance === OContainerComponent.APPEARANCE_OUTLINE);
        if (Util.isDefined(this.appearance)) {
            isAppearanceOutline = this.appearance === OContainerComponent.APPEARANCE_OUTLINE;
        }
        return isAppearanceOutline;
    }
    hasTitleInAppearanceOutline() {
        return this.isAppearanceOutline() && this.hasHeader();
    }
    propagateElevationToDOM() {
        this.cleanElevationCSSclasses();
        if (this.elevation > 0 && this.elevation <= 12) {
            this.elRef.nativeElement.classList.add('mat-elevation-z' + this.elevation);
        }
    }
    cleanElevationCSSclasses() {
        const classList = [].slice.call(this.elRef.nativeElement.classList);
        if (classList && classList.length) {
            classList.forEach((item) => {
                if (item.startsWith('mat-elevation')) {
                    this.elRef.nativeElement.classList.remove(item);
                }
            });
        }
    }
    updateOutlineGap() {
        if (this.isAppearanceOutline()) {
            const titleEl = this._titleEl ? this._titleEl.nativeElement : null;
            if (!this._containerRef) {
                return;
            }
            if (document.documentElement && !document.documentElement.contains(this.elRef.nativeElement)) {
                this._outlineGapCalculationNeededImmediately = true;
                return;
            }
            const container = this._containerRef.nativeElement;
            const containerRect = container.getBoundingClientRect();
            if (containerRect.width === 0 && containerRect.height === 0) {
                return;
            }
            const containerStart = containerRect.left;
            const labelStart = titleEl.getBoundingClientRect().left;
            const labelWidth = this.hasHeader() ? titleEl.offsetWidth : 0;
            const startWidth = labelStart - containerStart;
            const startEls = container.querySelectorAll('.o-container-outline-start');
            const gapEls = container.querySelectorAll('.o-container-outline-gap');
            gapEls[0].style.width = `${labelWidth}px`;
            startEls[0].style.width = `${startWidth}px`;
            this._outlineGapCalculationNeededImmediately = false;
        }
    }
    registerObserver() {
        if (this._titleEl) {
            this.titleObserver.observe(this._titleEl.nativeElement, {
                childList: true,
                characterData: true,
                subtree: true
            });
        }
    }
    unRegisterObserver() {
        if (this.titleObserver) {
            this.titleObserver.disconnect();
        }
    }
}
OContainerComponent.APPEARANCE_OUTLINE = 'outline';
OContainerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Injector },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [MAT_FORM_FIELD_DEFAULT_OPTIONS,] }] }
];
OContainerComponent.propDecorators = {
    containerTitle: [{ type: ViewChild, args: ['containerTitle', { static: false },] }],
    _containerRef: [{ type: ViewChild, args: ['container', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1jb250YWluZXItY29tcG9uZW50LmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnRhaW5lci9vLWNvbnRhaW5lci1jb21wb25lbnQuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFzQyxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBYSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pJLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2QyxNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRztJQUN4QyxhQUFhO0lBQ2IsT0FBTztJQUNQLDJCQUEyQjtJQUMzQixXQUFXO0lBQ1gsTUFBTTtJQUNOLFlBQVk7SUFDWix1QkFBdUI7Q0FDeEIsQ0FBQztBQUVGLE1BQU0sT0FBTyxtQkFBbUI7SUE2QjlCLFlBQ1ksS0FBaUIsRUFDakIsUUFBa0IsRUFDa0Msb0JBQW9CO1FBRnhFLFVBQUssR0FBTCxLQUFLLENBQVk7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNrQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQUE7UUF6QjFFLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsdUJBQWtCLEdBQVcsYUFBYSxDQUFDO1FBSzdDLDRDQUF1QyxHQUFHLEtBQUssQ0FBQztRQUU5QyxrQkFBYSxHQUFHLElBQUksZ0JBQWdCLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztJQWtCMUUsQ0FBQztJQWZMLElBQW9ELGNBQWMsQ0FBQyxJQUFnQjtRQUNqRixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7U0FDekI7YUFBTTtZQUNMLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQVNELGVBQWU7UUFDYixJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDbkQ7UUFDRCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRUQscUJBQXFCO1FBQ25CLElBQUksSUFBSSxDQUFDLHVDQUF1QyxFQUFFO1lBQ2hELElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRU0sWUFBWTtRQUNqQixJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDbkI7YUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtZQUNqRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1NBQ3ZEO0lBQ0gsQ0FBQztJQUVELElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUMxQixDQUFDO0lBRUQsSUFBSSxVQUFVLENBQUMsS0FBYTtRQUMxQixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztRQUN6QixVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTLENBQUMsU0FBaUI7UUFDN0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7UUFDNUIsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVELElBQUksV0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0lBRUQsSUFBSSxXQUFXLENBQUMsS0FBYTtRQUMzQixJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLEtBQUssR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUM7U0FDakM7UUFDRCxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztJQUM1QixDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLFNBQVMsQ0FBQyxTQUFpQjtRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztJQUM5QixDQUFDO0lBRU0sU0FBUztRQUNkLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckMsQ0FBQztJQUVELHlCQUF5QjtRQUN2QixJQUFJLGtCQUFrQixHQUFHLEtBQUssQ0FBQztRQUMvQixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQ25DLGtCQUFrQixHQUFHLElBQUksQ0FBQyxVQUFVLEtBQUssbUJBQW1CLENBQUMsa0JBQWtCLENBQUM7U0FDakY7UUFDRCxPQUFPLGtCQUFrQixDQUFDO0lBQzVCLENBQUM7SUFFTSxrQ0FBa0M7UUFDdkMsT0FBTyxJQUFJLENBQUMseUJBQXlCLEVBQUUsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDOUQsQ0FBQztJQUVNLDZCQUE2QjtRQUNsQyxPQUFPLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUN4RCxDQUFDO0lBRU0sbUJBQW1CO1FBQ3hCLElBQUksbUJBQW1CLEdBQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLFVBQVUsS0FBSyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3pJLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDbkMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFVBQVUsS0FBSyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQztTQUNsRjtRQUNELE9BQU8sbUJBQW1CLENBQUM7SUFDN0IsQ0FBQztJQUVNLDJCQUEyQjtRQUNoQyxPQUFPLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUN4RCxDQUFDO0lBRVMsdUJBQXVCO1FBQy9CLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2hDLElBQUksSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxFQUFFLEVBQUU7WUFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDNUU7SUFDSCxDQUFDO0lBRVMsd0JBQXdCO1FBQ2hDLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BFLElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEVBQUU7WUFDakMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFO2dCQUNqQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLEVBQUU7b0JBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQ2pEO1lBQ0gsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFFUyxnQkFBZ0I7UUFDeEIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsRUFBRTtZQUM5QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBRW5FLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN2QixPQUFPO2FBQ1I7WUFDRCxJQUFJLFFBQVEsQ0FBQyxlQUFlLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxFQUFFO2dCQUM1RixJQUFJLENBQUMsdUNBQXVDLEdBQUcsSUFBSSxDQUFDO2dCQUNwRCxPQUFPO2FBQ1I7WUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQztZQUNuRCxNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUN4RCxJQUFJLGFBQWEsQ0FBQyxLQUFLLEtBQUssQ0FBQyxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUMzRCxPQUFPO2FBQ1I7WUFFRCxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO1lBQzFDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLElBQUksQ0FBQztZQUN4RCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5RCxNQUFNLFVBQVUsR0FBRyxVQUFVLEdBQUcsY0FBYyxDQUFDO1lBRS9DLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQzFFLE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEdBQUcsVUFBVSxJQUFJLENBQUM7WUFDMUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsR0FBRyxVQUFVLElBQUksQ0FBQztZQUM1QyxJQUFJLENBQUMsdUNBQXVDLEdBQUcsS0FBSyxDQUFDO1NBQ3REO0lBQ0gsQ0FBQztJQUVTLGdCQUFnQjtRQUN4QixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUU7Z0JBQ3RELFNBQVMsRUFBRSxJQUFJO2dCQUNmLGFBQWEsRUFBRSxJQUFJO2dCQUNuQixPQUFPLEVBQUUsSUFBSTthQUNkLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVTLGtCQUFrQjtRQUMxQixJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNqQztJQUNILENBQUM7O0FBOUxhLHNDQUFrQixHQUFHLFNBQVMsQ0FBQzs7WUFqQkYsVUFBVTtZQUFVLFFBQVE7NENBK0NwRSxRQUFRLFlBQUksTUFBTSxTQUFDLDhCQUE4Qjs7OzZCQWRuRCxTQUFTLFNBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOzRCQVM3QyxTQUFTLFNBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyQ29udGVudENoZWNrZWQsIEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYsIEluamVjdCwgSW5qZWN0b3IsIE9uRGVzdHJveSwgT3B0aW9uYWwsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTUFUX0ZPUk1fRklFTERfREVGQVVMVF9PUFRJT05TIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vdXRpbC91dGlsJztcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfSU5QVVRTX09fQ09OVEFJTkVSID0gW1xuICAnb2F0dHI6IGF0dHInLFxuICAndGl0bGUnLFxuICAnbGF5b3V0QWxpZ246IGxheW91dC1hbGlnbicsXG4gICdlbGV2YXRpb24nLFxuICAnaWNvbicsXG4gICdhcHBlYXJhbmNlJyxcbiAgJ2xheW91dEdhcDogbGF5b3V0LWdhcCdcbl07XG5cbmV4cG9ydCBjbGFzcyBPQ29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBBZnRlckNvbnRlbnRDaGVja2VkIHtcblxuICBwdWJsaWMgc3RhdGljIEFQUEVBUkFOQ0VfT1VUTElORSA9ICdvdXRsaW5lJztcblxuICBwdWJsaWMgb2F0dHI6IHN0cmluZztcblxuICBwdWJsaWMgdGl0bGU6IHN0cmluZztcbiAgcHJvdGVjdGVkIF9lbGV2YXRpb246IG51bWJlciA9IDA7XG4gIHByb3RlY3RlZCBkZWZhdWx0TGF5b3V0QWxpZ246IHN0cmluZyA9ICdzdGFydCBzdGFydCc7XG4gIHByb3RlY3RlZCBfbGF5b3V0QWxpZ246IHN0cmluZztcbiAgcHVibGljIGljb246IHN0cmluZztcbiAgcHJvdGVjdGVkIF9hcHBlYXJhbmNlOiBzdHJpbmc7XG4gIHByb3RlY3RlZCBfbGF5b3V0R2FwOiBzdHJpbmc7XG4gIHByaXZhdGUgX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5ID0gZmFsc2U7XG5cbiAgcHJvdGVjdGVkIHRpdGxlT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB0aGlzLnVwZGF0ZU91dGxpbmVHYXAoKSk7XG5cbiAgcHJvdGVjdGVkIF90aXRsZUVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjb250YWluZXJUaXRsZScsIHsgc3RhdGljOiBmYWxzZSB9KSBzZXQgY29udGFpbmVyVGl0bGUoZWxlbTogRWxlbWVudFJlZikge1xuICAgIHRoaXMuX3RpdGxlRWwgPSBlbGVtO1xuICAgIGlmICh0aGlzLl90aXRsZUVsKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyT2JzZXJ2ZXIoKTtcbiAgICAgIHRoaXMudXBkYXRlT3V0bGluZUdhcCgpOyAvLyBUaGlzIG11c3QgYmUgdHJpZ2dlcmVkIHdoZW4gdGl0bGUgY29udGFpbmVyIGlzIHJlLXJlZ2lzdGVyZWRcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51blJlZ2lzdGVyT2JzZXJ2ZXIoKTtcbiAgICB9XG4gIH1cbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgcHJvdGVjdGVkIF9jb250YWluZXJSZWY6IEVsZW1lbnRSZWY7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGVsUmVmOiBFbGVtZW50UmVmLFxuICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChNQVRfRk9STV9GSUVMRF9ERUZBVUxUX09QVElPTlMpIHByb3RlY3RlZCBtYXRGb3JtRGVmYXVsdE9wdGlvblxuICApIHsgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lbFJlZikge1xuICAgICAgdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgndGl0bGUnKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3Rlck9ic2VydmVyKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5KSB7XG4gICAgICB0aGlzLnVwZGF0ZU91dGxpbmVHYXAoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnVuUmVnaXN0ZXJPYnNlcnZlcigpO1xuICB9XG5cbiAgcHVibGljIGdldEF0dHJpYnV0ZSgpIHtcbiAgICBpZiAodGhpcy5vYXR0cikge1xuICAgICAgcmV0dXJuIHRoaXMub2F0dHI7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVsUmVmICYmIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLmF0dHIpIHtcbiAgICAgIHJldHVybiB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcy5hdHRyLnZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBhcHBlYXJhbmNlKCkge1xuICAgIHJldHVybiB0aGlzLl9hcHBlYXJhbmNlO1xuICB9XG5cbiAgc2V0IGFwcGVhcmFuY2UodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuX2FwcGVhcmFuY2UgPSB2YWx1ZTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy51cGRhdGVPdXRsaW5lR2FwKCk7IH0sIDApO1xuICB9XG5cbiAgZ2V0IGVsZXZhdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fZWxldmF0aW9uO1xuICB9XG5cbiAgc2V0IGVsZXZhdGlvbihlbGV2YXRpb246IG51bWJlcikge1xuICAgIHRoaXMuX2VsZXZhdGlvbiA9IGVsZXZhdGlvbjtcbiAgICB0aGlzLnByb3BhZ2F0ZUVsZXZhdGlvblRvRE9NKCk7XG4gIH1cblxuICBnZXQgbGF5b3V0QWxpZ24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xheW91dEFsaWduO1xuICB9XG5cbiAgc2V0IGxheW91dEFsaWduKGFsaWduOiBzdHJpbmcpIHtcbiAgICBpZiAoIWFsaWduIHx8IGFsaWduLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYWxpZ24gPSB0aGlzLmRlZmF1bHRMYXlvdXRBbGlnbjtcbiAgICB9XG4gICAgdGhpcy5fbGF5b3V0QWxpZ24gPSBhbGlnbjtcbiAgfVxuXG4gIGdldCBsYXlvdXRHYXAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xheW91dEdhcDtcbiAgfVxuXG4gIHNldCBsYXlvdXRHYXAobGF5b3V0R2FwOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9sYXlvdXRHYXAgPSBsYXlvdXRHYXA7XG4gIH1cblxuICBwdWJsaWMgaGFzSGVhZGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMudGl0bGUgfHwgISF0aGlzLmljb247XG4gIH1cblxuICBpc0FwcGVhcmFuY2VPdXRsaW5lU2V0dGVkKCk6IGJvb2xlYW4ge1xuICAgIGxldCBpc0FwcGVhcmFuY2VTZXR0ZWQgPSBmYWxzZTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5hcHBlYXJhbmNlKSkge1xuICAgICAgaXNBcHBlYXJhbmNlU2V0dGVkID0gdGhpcy5hcHBlYXJhbmNlID09PSBPQ29udGFpbmVyQ29tcG9uZW50LkFQUEVBUkFOQ0VfT1VUTElORTtcbiAgICB9XG4gICAgcmV0dXJuIGlzQXBwZWFyYW5jZVNldHRlZDtcbiAgfVxuXG4gIHB1YmxpYyBoYXNIZWFkZXJPckFwcGVhcmFuY2VPdXRsaW5lU2V0dGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmVTZXR0ZWQoKSB8fCB0aGlzLmhhc0hlYWRlcigpO1xuICB9XG5cbiAgcHVibGljIGhhc0hlYWRlckFuZEFwcGVhcmFuY2VPdXRsaW5lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmUoKSAmJiB0aGlzLmhhc0hlYWRlcigpO1xuICB9XG5cbiAgcHVibGljIGlzQXBwZWFyYW5jZU91dGxpbmUoKTogYm9vbGVhbiB7XG4gICAgbGV0IGlzQXBwZWFyYW5jZU91dGxpbmUgPSAodGhpcy5tYXRGb3JtRGVmYXVsdE9wdGlvbiAmJiB0aGlzLm1hdEZvcm1EZWZhdWx0T3B0aW9uLmFwcGVhcmFuY2UgPT09IE9Db250YWluZXJDb21wb25lbnQuQVBQRUFSQU5DRV9PVVRMSU5FKTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5hcHBlYXJhbmNlKSkge1xuICAgICAgaXNBcHBlYXJhbmNlT3V0bGluZSA9IHRoaXMuYXBwZWFyYW5jZSA9PT0gT0NvbnRhaW5lckNvbXBvbmVudC5BUFBFQVJBTkNFX09VVExJTkU7XG4gICAgfVxuICAgIHJldHVybiBpc0FwcGVhcmFuY2VPdXRsaW5lO1xuICB9XG5cbiAgcHVibGljIGhhc1RpdGxlSW5BcHBlYXJhbmNlT3V0bGluZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0FwcGVhcmFuY2VPdXRsaW5lKCkgJiYgdGhpcy5oYXNIZWFkZXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwcm9wYWdhdGVFbGV2YXRpb25Ub0RPTSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFuRWxldmF0aW9uQ1NTY2xhc3NlcygpO1xuICAgIGlmICh0aGlzLmVsZXZhdGlvbiA+IDAgJiYgdGhpcy5lbGV2YXRpb24gPD0gMTIpIHtcbiAgICAgIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdtYXQtZWxldmF0aW9uLXonICsgdGhpcy5lbGV2YXRpb24pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBjbGVhbkVsZXZhdGlvbkNTU2NsYXNzZXMoKTogdm9pZCB7XG4gICAgY29uc3QgY2xhc3NMaXN0ID0gW10uc2xpY2UuY2FsbCh0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0KTtcbiAgICBpZiAoY2xhc3NMaXN0ICYmIGNsYXNzTGlzdC5sZW5ndGgpIHtcbiAgICAgIGNsYXNzTGlzdC5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uc3RhcnRzV2l0aCgnbWF0LWVsZXZhdGlvbicpKSB7XG4gICAgICAgICAgdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB1cGRhdGVPdXRsaW5lR2FwKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQXBwZWFyYW5jZU91dGxpbmUoKSkge1xuICAgICAgY29uc3QgdGl0bGVFbCA9IHRoaXMuX3RpdGxlRWwgPyB0aGlzLl90aXRsZUVsLm5hdGl2ZUVsZW1lbnQgOiBudWxsO1xuXG4gICAgICBpZiAoIXRoaXMuX2NvbnRhaW5lclJlZikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmICFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY29udGFpbnModGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50KSkge1xuICAgICAgICB0aGlzLl9vdXRsaW5lR2FwQ2FsY3VsYXRpb25OZWVkZWRJbW1lZGlhdGVseSA9IHRydWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5fY29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBjb25zdCBjb250YWluZXJSZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgaWYgKGNvbnRhaW5lclJlY3Qud2lkdGggPT09IDAgJiYgY29udGFpbmVyUmVjdC5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb250YWluZXJTdGFydCA9IGNvbnRhaW5lclJlY3QubGVmdDtcbiAgICAgIGNvbnN0IGxhYmVsU3RhcnQgPSB0aXRsZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICBjb25zdCBsYWJlbFdpZHRoID0gdGhpcy5oYXNIZWFkZXIoKSA/IHRpdGxlRWwub2Zmc2V0V2lkdGggOiAwO1xuICAgICAgY29uc3Qgc3RhcnRXaWR0aCA9IGxhYmVsU3RhcnQgLSBjb250YWluZXJTdGFydDtcblxuICAgICAgY29uc3Qgc3RhcnRFbHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLm8tY29udGFpbmVyLW91dGxpbmUtc3RhcnQnKTtcbiAgICAgIGNvbnN0IGdhcEVscyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuby1jb250YWluZXItb3V0bGluZS1nYXAnKTtcbiAgICAgIGdhcEVsc1swXS5zdHlsZS53aWR0aCA9IGAke2xhYmVsV2lkdGh9cHhgO1xuICAgICAgc3RhcnRFbHNbMF0uc3R5bGUud2lkdGggPSBgJHtzdGFydFdpZHRofXB4YDtcbiAgICAgIHRoaXMuX291dGxpbmVHYXBDYWxjdWxhdGlvbk5lZWRlZEltbWVkaWF0ZWx5ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHJlZ2lzdGVyT2JzZXJ2ZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3RpdGxlRWwpIHtcbiAgICAgIHRoaXMudGl0bGVPYnNlcnZlci5vYnNlcnZlKHRoaXMuX3RpdGxlRWwubmF0aXZlRWxlbWVudCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB1blJlZ2lzdGVyT2JzZXJ2ZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudGl0bGVPYnNlcnZlcikge1xuICAgICAgdGhpcy50aXRsZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG4gIH1cblxufVxuIl19