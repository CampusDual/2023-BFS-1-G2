import { DataSource } from '@angular/cdk/collections';
import { EventEmitter } from '@angular/core';
import { BehaviorSubject, merge, Subject, Subscription } from 'rxjs';
import { distinctUntilChanged, map } from 'rxjs/operators';
import { ColumnValueFilterOperator } from '../../../types/table/o-column-value-filter.type';
import { Codes } from '../../../util';
import { Util } from '../../../util/util';
import { OTableGroupedRow } from './row/o-table-row-group.class';
export class OnRangeChangeVirtualScroll {
    constructor(data) {
        this.range = data;
    }
}
export class DefaultOTableDataSource extends DataSource {
    constructor(table) {
        super();
        this.table = table;
        this.dataTotalsChange = new BehaviorSubject([]);
        this._virtualPageChange = new BehaviorSubject(new OnRangeChangeVirtualScroll({ start: 0, end: 0 }));
        this._quickFilterChange = new BehaviorSubject('');
        this._columnValueFilterChange = new BehaviorSubject(null);
        this.groupByColumnChange = new Subject();
        this.filteredData = [];
        this.aggregateData = {};
        this.onRenderedDataChange = new EventEmitter();
        this._renderedData = [];
        this.resultsLength = 0;
        this.columnValueFilters = [];
        this.groupedRowState = [];
        this.activeAggregates = {};
        this.groupedRowsSubscription = new Subscription();
        this.levelsExpansionState = {};
        this._database = table.daoTable;
        if (this._database) {
            this.resultsLength = this._database.data.length;
        }
        if (table.paginator) {
            this._paginator = table.matpaginator;
        }
        if (this.table.virtualScrollViewport) {
            this.table.virtualScrollViewport.renderedRangeStream
                .pipe(distinctUntilChanged())
                .subscribe((value) => {
                this._virtualPageChange.next(new OnRangeChangeVirtualScroll(value));
            });
        }
        this._tableOptions = table.oTableOptions;
        this._sort = table.sort;
    }
    get data() { return this.dataTotalsChange.value; }
    get quickFilter() { return this._quickFilterChange.value || ''; }
    set quickFilter(filter) {
        this._quickFilterChange.next(filter);
    }
    sortFunction(a, b) {
        return this._sort.sortFunction(a, b);
    }
    get renderedData() {
        return this._renderedData;
    }
    set renderedData(arg) {
        this._renderedData = arg;
        this.onRenderedDataChange.emit();
    }
    connect() {
        const displayDataChanges = [
            this._database.dataChange
        ];
        if (!this.table.pageable) {
            if (this._sort) {
                displayDataChanges.push(this._sort.oSortChange);
            }
            if (this._tableOptions.filter) {
                displayDataChanges.push(this._quickFilterChange);
            }
            if (this._paginator) {
                displayDataChanges.push(this._paginator.page);
            }
        }
        if (this.table.virtualScrollViewport) {
            displayDataChanges.push(this._virtualPageChange);
        }
        displayDataChanges.push(this._columnValueFilterChange);
        if (this.table.groupable) {
            displayDataChanges.push(this.groupByColumnChange);
        }
        return merge(...displayDataChanges).pipe(map((x) => {
            let data = Object.assign([], this._database.data);
            if (x instanceof OnRangeChangeVirtualScroll) {
                data = this.getVirtualScrollData(this.renderedData, x);
            }
            else {
                if (this.existsAnyCalculatedColumn()) {
                    data = this.getColumnCalculatedData(data);
                }
                if (!this.table.pageable) {
                    data = this.getColumnValueFilterData(data);
                    data = this.getQuickFilterData(data);
                    data = this.getSortedData(data);
                }
                this.filteredData = Object.assign([], data);
                if (this.table.pageable) {
                    const totalRecordsNumber = this.table.getTotalRecordsNumber();
                    this.resultsLength = totalRecordsNumber !== undefined ? totalRecordsNumber : data.length;
                }
                else {
                    this.resultsLength = data.length;
                    data = this.getPaginationData(data);
                }
                if (this.table.groupable && !Util.isArrayEmpty(this.table.groupedColumnsArray) && data.length > 0) {
                    data = this.getGroupedData(data);
                }
                this.renderedData = data;
                if (this.table.virtualScrollViewport && !this._paginator) {
                    data = this.getVirtualScrollData(data, new OnRangeChangeVirtualScroll({ start: 0, end: Codes.LIMIT_SCROLLVIRTUAL }));
                }
                this.aggregateData = this.getAggregatesData(this.renderedData);
            }
            return data;
        }));
    }
    getGroupedData(data) {
        data = this.getSubGroupsOfGroupedRow(data);
        data = this.filterCollapsedRowGroup(data);
        return data;
    }
    getSubGroupsOfGroupedRow(data) {
        return data = this.getSublevel(data, 0);
    }
    getAggregatesData(data) {
        const obj = {};
        if (typeof this._tableOptions === 'undefined') {
            return obj;
        }
        this._tableOptions.columns.forEach((column) => {
            let totalValue = '';
            if (column.aggregate && column.visible) {
                totalValue = this.calculateAggregate(data, column.attr, column.aggregate.operator);
            }
            const key = column.attr;
            obj[key] = totalValue;
        });
        return obj;
    }
    getColumnCalculatedData(data) {
        const self = this;
        const calculatedCols = this._tableOptions.columns.filter((oCol) => oCol.visible && oCol.calculate !== undefined);
        return data.map((row) => {
            calculatedCols.forEach((oColumn) => {
                let value;
                if (typeof oColumn.calculate === 'string') {
                    value = self.transformFormula(oColumn.calculate, row);
                }
                else if (typeof oColumn.calculate === 'function') {
                    value = oColumn.calculate(row);
                }
                row[oColumn.attr] = isNaN(value) ? 0 : value;
            });
            return row;
        });
    }
    transformFormula(formulaArg, row) {
        let formula = formulaArg;
        const columnsAttr = this._tableOptions.columns.map((oCol) => oCol.attr);
        columnsAttr.forEach((column) => {
            formula = formula.replace(column, row[column]);
        });
        let resultFormula = '';
        try {
            resultFormula = (new Function('return ' + formula))();
        }
        catch (e) {
            console.error('Operation defined in the calculated column is incorrect ');
        }
        return resultFormula;
    }
    getQuickFilterData(data) {
        if (Util.isDefined(this.quickFilter) && this.quickFilter.length > 0) {
            const filterData = !this._tableOptions.filterCaseSensitive ? this.quickFilter.toLowerCase() : this.quickFilter;
            return data.filter((item) => {
                const passCustomFilter = this.fulfillsCustomFilterFunctions(filterData, item);
                const passSearchString = this.fulfillsQuickfilter(filterData, item);
                return passCustomFilter || passSearchString;
            });
        }
        else {
            return data;
        }
    }
    getPaginationData(data) {
        if (!this._paginator || isNaN(this._paginator.pageSize)) {
            return data;
        }
        let startIndex = isNaN(this._paginator.pageSize) ? 0 : this._paginator.pageIndex * this._paginator.pageSize;
        if (data.length > 0 && data.length < startIndex) {
            startIndex = 0;
            this._paginator.pageIndex = 0;
        }
        return data.splice(startIndex, this._paginator.pageSize);
    }
    getVirtualScrollData(data, x) {
        return data.slice(x.range.start, x.range.end);
    }
    disconnect() {
        this.dataTotalsChange.complete();
        this._quickFilterChange.complete();
        this._columnValueFilterChange.complete();
        this.groupByColumnChange.complete();
        this._virtualPageChange.complete();
    }
    fulfillsCustomFilterFunctions(filter, item) {
        const customFilterCols = this.table.oTableOptions.columns.filter(oCol => oCol.useCustomFilterFunction());
        return customFilterCols.some(oCol => oCol.renderer.filterFunction(item[oCol.attr], item, filter));
    }
    fulfillsQuickfilter(filter, item) {
        const columns = this._tableOptions.columns.filter((oCol) => oCol.useQuickfilterFunction());
        let searchStr = columns.map((oCol) => oCol.getFilterValue(item[oCol.attr], item).join(' ')).join(' ');
        if (!this._tableOptions.filterCaseSensitive) {
            searchStr = searchStr.toLowerCase();
        }
        return searchStr.indexOf(filter) !== -1;
    }
    getSortedData(data) {
        return this._sort.getSortedData(data);
    }
    getTableData() {
        return this._database.data;
    }
    getCurrentData() {
        return this.getData();
    }
    getCurrentAllData() {
        return this.getAllData(false, false);
    }
    getCurrentRendererData() {
        return this.getRenderedData(this.renderedData);
    }
    getAllRendererData() {
        return this.getAllData(true, true);
    }
    get sqlTypes() {
        return this._database.sqlTypes;
    }
    getData() {
        return this.renderedData;
    }
    getRenderedData(data) {
        const visibleColumns = this._tableOptions.columns.filter(oCol => oCol.visible);
        return data.map((row) => {
            const obj = {};
            visibleColumns.forEach((oCol) => {
                const useRenderer = oCol.renderer && oCol.renderer.getCellData;
                obj[oCol.attr] = useRenderer ? oCol.renderer.getCellData(row[oCol.attr], row) : row[oCol.attr];
            });
            return obj;
        });
    }
    getAllData(usingRendererers, onlyVisibleColumns) {
        let tableColumns = this._tableOptions.columns;
        if (onlyVisibleColumns) {
            tableColumns = this._tableOptions.columns.filter(oCol => oCol.visible);
        }
        return this.filteredData.map((row) => {
            const obj = {};
            tableColumns.forEach((oCol) => {
                const useRenderer = usingRendererers && oCol.renderer && oCol.renderer.getCellData;
                obj[oCol.attr] = useRenderer ? oCol.renderer.getCellData(row[oCol.attr], row) : row[oCol.attr];
            });
            return obj;
        });
    }
    getRenderersData(data, tableColumns) {
        return data.map((row) => {
            const obj = Object.assign({}, row);
            tableColumns.forEach((oCol) => {
                obj[oCol.attr] = oCol.renderer.getCellData(row[oCol.attr], row);
            });
            return obj;
        });
    }
    getColumnData(ocolumn) {
        return this.renderedData.map((row) => {
            const obj = {};
            if (ocolumn) {
                obj[ocolumn] = row[ocolumn];
            }
            return obj;
        });
    }
    initializeColumnsFilters(filters) {
        this.columnValueFilters = [];
        filters.forEach(filter => {
            this.columnValueFilters.push(filter);
        });
        if (!this.table.pageable) {
            this._columnValueFilterChange.next(null);
        }
    }
    isColumnValueFilterActive() {
        return this.columnValueFilters.length !== 0;
    }
    getColumnValueFilters() {
        return this.columnValueFilters;
    }
    getColumnValueFilterByAttr(attr) {
        return this.columnValueFilters.find(item => item.attr === attr);
    }
    clearColumnFilters(trigger = true, columnsAttr) {
        if (Util.isDefined(columnsAttr)) {
            this.columnValueFilters = this.columnValueFilters.filter(x => !columnsAttr.includes(x.attr));
        }
        else {
            this.columnValueFilters = [];
        }
        if (trigger) {
            this._columnValueFilterChange.next(null);
        }
    }
    clearColumnFilter(attr, trigger = true) {
        this.columnValueFilters = this.columnValueFilters.filter(x => x.attr !== attr);
        if (trigger) {
            this._columnValueFilterChange.next(null);
        }
    }
    addColumnFilter(filter) {
        const existingFilterIndex = this.columnValueFilters.findIndex(item => item.attr === filter.attr);
        if (existingFilterIndex > -1) {
            this.columnValueFilters.splice(existingFilterIndex, 1, filter);
        }
        else {
            let validFilter = Util.isDefined(filter.values);
            if (validFilter) {
                switch (filter.operator) {
                    case ColumnValueFilterOperator.IN:
                        validFilter = filter.values.length > 0;
                        break;
                    case ColumnValueFilterOperator.BETWEEN:
                        validFilter = filter.values.length === 2;
                        break;
                    case ColumnValueFilterOperator.EQUAL:
                    case ColumnValueFilterOperator.LESS_EQUAL:
                    case ColumnValueFilterOperator.MORE_EQUAL:
                        validFilter = true;
                        break;
                    default:
                        validFilter = false;
                }
                if (validFilter) {
                    this.columnValueFilters.push(filter);
                }
            }
        }
        if (!this.table.pageable) {
            this._columnValueFilterChange.next(null);
        }
    }
    getColumnValueFilterData(data) {
        this.columnValueFilters.forEach(filter => {
            const filterColumn = this.table.oTableOptions.columns.find(col => col.attr === filter.attr);
            if (filterColumn) {
                switch (filter.operator) {
                    case ColumnValueFilterOperator.IN:
                        const filterValues = (filter.values || []).reduce((previous, current) => previous.concat(filterColumn.getFilterValue(current).map(f => Util.normalizeString(f))), []);
                        data = data.filter((item) => {
                            if (filterColumn.renderer && filterColumn.renderer.filterFunction) {
                                return filterColumn.renderer.filterFunction(item[filter.attr], item);
                            }
                            else {
                                const colValues = filterColumn.getFilterValue(item[filter.attr], item).map(f => Util.normalizeString(f));
                                return filterValues.some(value => colValues.indexOf(value) !== -1);
                            }
                        });
                        break;
                    case ColumnValueFilterOperator.EQUAL:
                        const normalizedValue = Util.normalizeString(filter.values);
                        data = data.filter(item => {
                            const colValues = filterColumn.getFilterValue(item[filter.attr], item).map(f => Util.normalizeString(f));
                            let regExp;
                            if (normalizedValue.includes('*')) {
                                regExp = new RegExp('^' + normalizedValue.split('*').join('.*') + '$');
                            }
                            return colValues.some(colValue => regExp ? regExp.test(colValue) : colValue.includes(normalizedValue));
                        });
                        break;
                    case ColumnValueFilterOperator.BETWEEN:
                        data = data.filter(item => item[filter.attr] >= filter.values[0] && item[filter.attr] <= filter.values[1]);
                        break;
                    case ColumnValueFilterOperator.MORE_EQUAL:
                        data = data.filter(item => item[filter.attr] >= filter.values);
                        break;
                    case ColumnValueFilterOperator.LESS_EQUAL:
                        data = data.filter(item => item[filter.attr] <= filter.values);
                        break;
                }
            }
        });
        return data;
    }
    getAggregateData(column) {
        const obj = {};
        let totalValue = '';
        if (typeof this._tableOptions === 'undefined') {
            return new Array(obj);
        }
        totalValue = this.aggregateData[column.attr];
        return totalValue;
    }
    calculateAggregate(data, columnAttr, operator) {
        let resultAggregate;
        if (typeof operator === 'string') {
            switch (operator.toLowerCase()) {
                case 'count':
                    resultAggregate = this.count(columnAttr, data);
                    break;
                case 'min':
                    resultAggregate = this.min(columnAttr, data);
                    break;
                case 'max':
                    resultAggregate = this.max(columnAttr, data);
                    break;
                case 'avg':
                    resultAggregate = this.avg(columnAttr, data);
                    break;
                default:
                    resultAggregate = this.sum(columnAttr, data);
                    break;
            }
        }
        else {
            const columnData = this.getColumnData(columnAttr);
            if (typeof operator === 'function') {
                resultAggregate = operator(columnData);
            }
        }
        return resultAggregate;
    }
    sum(column, data) {
        let value = 0;
        if (data) {
            if (data[0] instanceof OTableGroupedRow) {
                this.getDataFromFirstLevelTableGroupRow(data).forEach(x => {
                    value = x.getColumnAggregateData(column).reduce((acumulator, currentValue) => {
                        return acumulator + (isNaN(currentValue[column]) ? 0 : currentValue[column]);
                    }, value);
                });
            }
            else {
                value = data.reduce((acumulator, currentValue) => {
                    return acumulator + (isNaN(currentValue[column]) ? 0 : currentValue[column]);
                }, value);
            }
        }
        return +(value).toFixed(2);
    }
    count(column, data) {
        let value = 0;
        if (data) {
            if (data[0] instanceof OTableGroupedRow) {
                this.getDataFromFirstLevelTableGroupRow(data).forEach(x => {
                    value = x.getColumnAggregateData(column).reduce((acumulator) => {
                        return acumulator + 1;
                    }, value);
                });
            }
            else {
                value = data.reduce((acumulator) => {
                    return acumulator + 1;
                }, 0);
            }
        }
        return value;
    }
    avg(column, data) {
        const totalSum = this.sum(column, data);
        const totalCount = this.count(column, data);
        return +((totalSum === 0 || totalCount === 0) ? 0 : (totalSum / totalCount)).toFixed(2);
    }
    min(column, data) {
        let tempMin = [];
        if (data[0] instanceof OTableGroupedRow) {
            tempMin = this.getDataFromFirstLevelTableGroupRow(data).map(x => {
                return Math.min(...x.getColumnAggregateData(column).map(x => x[column]));
            });
        }
        else {
            tempMin = data.map(x => x[column]);
        }
        return tempMin.length > 0 ? Math.min(...tempMin) : 0;
    }
    max(column, data) {
        let tempMax = [];
        if (data[0] instanceof OTableGroupedRow) {
            tempMax = this.getDataFromFirstLevelTableGroupRow(data).map(x => {
                return Math.max(...x.getColumnAggregateData(column).map(x => x[column]));
            });
        }
        else {
            tempMax = data.map(x => x[column]);
        }
        return tempMax.length > 0 ? Math.max(...tempMax) : 0;
    }
    isFirstLevelTableGroupRow(tableRowGroupData) {
        return tableRowGroupData instanceof OTableGroupedRow && tableRowGroupData.level === 1;
    }
    getDataFromFirstLevelTableGroupRow(data) {
        return data.filter(x => this.isFirstLevelTableGroupRow(x));
    }
    existsAnyCalculatedColumn() {
        return this._tableOptions.columns.find((oCol) => oCol.calculate !== undefined) !== undefined;
    }
    updateRenderedRowData(rowData) {
        const tableKeys = this.table.getKeys();
        const record = this.renderedData.find((data) => {
            let found = true;
            for (let i = 0, len = tableKeys.length; i < len; i++) {
                const key = tableKeys[i];
                if (data[key] !== rowData[key]) {
                    found = false;
                    break;
                }
            }
            return found;
        });
        if (Util.isDefined(record)) {
            Object.assign(record, rowData);
        }
    }
    getDataInformationByGroup(data, level) {
        const recordHash = {};
        data.forEach((row, i) => {
            const keys = {};
            for (let i = 0; i <= level; i++) {
                keys[this.table.groupedColumnsArray[i]] = this.table.getColumnDataByAttr(this.table.groupedColumnsArray[i], row);
            }
            const recordKey = JSON.stringify(keys);
            if (recordHash.hasOwnProperty(recordKey)) {
                recordHash[recordKey].push(i);
            }
            else {
                recordHash[recordKey] = [i];
            }
        });
        return recordHash;
    }
    recalculateColumnAggregate(columnAttr, row) {
        const aggregateConf = row.getActiveColumnAggregateConfiguration(columnAttr);
        const data = row.getColumnAggregateData(columnAttr);
        const value = this.calculateAggregate(data, aggregateConf.attr, aggregateConf.aggregateFunction || aggregateConf.aggregate);
        row.setColumnAggregateValue(columnAttr, value);
    }
    getSublevel(data, level, parent) {
        if (level >= this.table.groupedColumnsArray.length) {
            return data;
        }
        const recordHash = this.getDataInformationByGroup(data, level);
        let result = [];
        Object.keys(recordHash).forEach(recordKey => {
            const row = new OTableGroupedRow({
                column: this.table.groupedColumnsArray[level],
                keysAsString: recordKey,
                level: level + 1,
                parent: parent
            });
            this.groupedRowsSubscription.add(row.aggregateFunctionChange.subscribe(arg => {
                if (arg.changeAllGroupedRows) {
                    this.activeAggregates[arg.columnAttr] = arg.activeAggregate;
                    this.renderedData.filter(row => row instanceof OTableGroupedRow).forEach(row => {
                        row.setColumnActiveAggregateFunction(arg.columnAttr, arg.activeAggregate, false);
                        this.recalculateColumnAggregate(arg.columnAttr, row);
                    });
                }
                else {
                    this.recalculateColumnAggregate(arg.columnAttr, arg.row);
                }
            }));
            const affectedIndexes = recordHash[row.keysAsString];
            const groupData = data.filter((row, index) => affectedIndexes.includes(index));
            this.table.visibleColArray.forEach((columnAttr, i) => {
                if (i === 0) {
                    row.title = this.getTextGroupRow(row, affectedIndexes.length);
                }
                const useColumnAggregate = this.table.useColumnGroupingAggregate(columnAttr);
                if (useColumnAggregate) {
                    row.initializeColumnAggregate(columnAttr, this.table.getColumnGroupingComponent(columnAttr));
                    if (Util.isDefined(this.activeAggregates[columnAttr])) {
                        row.setColumnActiveAggregateFunction(columnAttr, this.activeAggregates[columnAttr], false);
                    }
                    if (row.hasActiveAggregate(columnAttr)) {
                        const aggregateData = groupData.map(x => { const obj = {}; obj[columnAttr] = x[columnAttr]; return obj; });
                        row.setColumnAggregateData(columnAttr, aggregateData);
                        const aggregateConf = row.getActiveColumnAggregateConfiguration(columnAttr);
                        const value = this.calculateAggregate(aggregateData, aggregateConf.attr, aggregateConf.aggregateFunction || aggregateConf.aggregate);
                        row.setColumnAggregateValue(columnAttr, value);
                    }
                }
            });
            row.expanded = this.getExpansionState(row);
            const subGroup = this.getSublevel(groupData, level + 1, row);
            subGroup.unshift(row);
            result = result.concat(subGroup);
        });
        return result;
    }
    filterCollapsedRowGroup(data) {
        return data.filter((row) => (row instanceof OTableGroupedRow) ? row.visible : this.belongsToExpandedGroupedRow(data, row));
    }
    belongsToExpandedGroupedRow(data, row) {
        let parent;
        let match = false;
        for (let index = 0; index < data.length && !match; index++) {
            if (data[index] instanceof OTableGroupedRow) {
                parent = data[index];
            }
            else if (Util.isEquivalent(data[index], row)) {
                match = true;
            }
        }
        return Util.isDefined(parent) ? (parent.visible && parent.expanded) : true;
    }
    updateGroupedColumns() {
        this.groupByColumnChange.next();
    }
    toggleGroupByColumn(rowGroup) {
        if (rowGroup.expandSameLevel(this.table.expandGroupsSameLevel)) {
            this.levelsExpansionState[rowGroup.level] = !rowGroup.expanded;
        }
        else {
            this.updateStateRowGrouped(rowGroup);
        }
        this.groupByColumnChange.next();
    }
    setRowGroupLevelExpansion(rowGroup, value) {
        this.levelsExpansionState[rowGroup.level] = value;
        this.groupByColumnChange.next();
    }
    updateStateRowGrouped(rowGroup) {
        const stateRowGrouped = this.groupedRowState.find(row => rowGroup.keysAsString === row.keysAsString && JSON.stringify(rowGroup.parent) === JSON.stringify(row.parent));
        if (Util.isDefined(stateRowGrouped)) {
            stateRowGrouped.expanded = !stateRowGrouped.expanded;
        }
        else {
            rowGroup.expanded = !rowGroup.expanded;
            this.groupedRowState.push(rowGroup);
        }
    }
    getTextGroupRow(group, totalCounts) {
        const field = this.table.groupedColumnsArray[group.level - 1];
        let value = JSON.parse(group.keysAsString)[this.table.groupedColumnsArray[group.level - 1]];
        const oCol = this.table.getOColumn(field);
        if (!value && Util.isDefined(oCol.renderer) && this.table.isInstanceOfOTableCellRendererServiceComponent(oCol.renderer)) {
            value = ' - ';
            if (!this.table.onDataLoadedCellRendererSubscription) {
                this.table.onDataLoadedCellRendererSubscription = oCol.renderer.onDataLoaded.subscribe(x => {
                    this.updateGroupedColumns();
                });
            }
        }
        return this.table.translateService.get(oCol.title) + ': ' + value + ' (' + totalCounts + ')';
    }
    getExpansionState(row) {
        let expansionState = !parent || !this.table.collapseGroupedColumns;
        if (row.expandSameLevel(this.table.expandGroupsSameLevel)) {
            expansionState = this.levelsExpansionState.hasOwnProperty(row.level) ? this.levelsExpansionState[row.level] : expansionState;
        }
        else {
            const rowGroup = this.groupedRowState.find(x => x.keysAsString === row.keysAsString && JSON.stringify(x.parent) === JSON.stringify(row.parent));
            expansionState = rowGroup ? rowGroup.expanded : expansionState;
        }
        return expansionState;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmYXVsdC1vLXRhYmxlLmRhdGFzb3VyY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vbnRpbWl6ZS13ZWItbmd4LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdGFibGUvZXh0ZW5zaW9ucy9kZWZhdWx0LW8tdGFibGUuZGF0YXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sMEJBQTBCLENBQUM7QUFDakUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU3QyxPQUFPLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBYyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkzRCxPQUFPLEVBQUUseUJBQXlCLEVBQXNCLE1BQU0saURBQWlELENBQUM7QUFDaEgsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFJMUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFHakUsTUFBTSxPQUFPLDBCQUEwQjtJQUdyQyxZQUFZLElBQWU7UUFDekIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDcEIsQ0FBQztDQUNGO0FBRUQsTUFBTSxPQUFPLHVCQUF3QixTQUFRLFVBQWU7SUFtQzFELFlBQXNCLEtBQXNCO1FBQzFDLEtBQUssRUFBRSxDQUFDO1FBRFksVUFBSyxHQUFMLEtBQUssQ0FBaUI7UUFsQzVDLHFCQUFnQixHQUFHLElBQUksZUFBZSxDQUFRLEVBQUUsQ0FBQyxDQUFDO1FBU3hDLHVCQUFrQixHQUFHLElBQUksZUFBZSxDQUE2QixJQUFJLDBCQUEwQixDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FB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QUFDO1FBQ25FLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLEVBQUU7WUFDekQsY0FBYyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUM7U0FDOUg7YUFBTTtZQUNMLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxHQUFHLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDaEosY0FBYyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1NBQ2hFO1FBQ0QsT0FBTyxjQUFjLENBQUM7SUFDeEIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YVNvdXJjZSwgTGlzdFJhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvbGxlY3Rpb25zJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0UGFnaW5hdG9yIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBtZXJnZSwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBPVGFibGVEYXRhU291cmNlIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9vLXRhYmxlLWRhdGFzb3VyY2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IE9UYWJsZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL28tdGFibGUtb3B0aW9ucy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvciwgT0NvbHVtblZhbHVlRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvdGFibGUvby1jb2x1bW4tdmFsdWUtZmlsdGVyLnR5cGUnO1xuaW1wb3J0IHsgQ29kZXMgfSBmcm9tICcuLi8uLi8uLi91dGlsJztcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi8uLi91dGlsL3V0aWwnO1xuaW1wb3J0IHsgT0NvbHVtbiB9IGZyb20gJy4uL2NvbHVtbi9vLWNvbHVtbi5jbGFzcyc7XG5pbXBvcnQgeyBPVGFibGVDb21wb25lbnQgfSBmcm9tICcuLi9vLXRhYmxlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBPVGFibGVEYW8gfSBmcm9tICcuL28tdGFibGUuZGFvJztcbmltcG9ydCB7IE9UYWJsZUdyb3VwZWRSb3cgfSBmcm9tICcuL3Jvdy9vLXRhYmxlLXJvdy1ncm91cC5jbGFzcyc7XG5pbXBvcnQgeyBPTWF0U29ydCB9IGZyb20gJy4vc29ydC9vLW1hdC1zb3J0JztcblxuZXhwb3J0IGNsYXNzIE9uUmFuZ2VDaGFuZ2VWaXJ0dWFsU2Nyb2xsIHtcbiAgcHVibGljIHJhbmdlOiBMaXN0UmFuZ2U7XG5cbiAgY29uc3RydWN0b3IoZGF0YTogTGlzdFJhbmdlKSB7XG4gICAgdGhpcy5yYW5nZSA9IGRhdGE7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERlZmF1bHRPVGFibGVEYXRhU291cmNlIGV4dGVuZHMgRGF0YVNvdXJjZTxhbnk+IGltcGxlbWVudHMgT1RhYmxlRGF0YVNvdXJjZSB7XG4gIGRhdGFUb3RhbHNDaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueVtdPihbXSk7XG5cbiAgZ2V0IGRhdGEoKTogYW55W10geyByZXR1cm4gdGhpcy5kYXRhVG90YWxzQ2hhbmdlLnZhbHVlOyB9XG5cbiAgcHJvdGVjdGVkIF9kYXRhYmFzZTogT1RhYmxlRGFvO1xuICBwcm90ZWN0ZWQgX3BhZ2luYXRvcjogTWF0UGFnaW5hdG9yO1xuICBwcm90ZWN0ZWQgX3RhYmxlT3B0aW9uczogT1RhYmxlT3B0aW9ucztcbiAgcHJvdGVjdGVkIF9zb3J0OiBPTWF0U29ydDtcblxuICBwcm90ZWN0ZWQgX3ZpcnR1YWxQYWdlQ2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxPblJhbmdlQ2hhbmdlVmlydHVhbFNjcm9sbD4obmV3IE9uUmFuZ2VDaGFuZ2VWaXJ0dWFsU2Nyb2xsKHsgc3RhcnQ6IDAsIGVuZDogMCB9KSk7XG4gIHByb3RlY3RlZCBfcXVpY2tGaWx0ZXJDaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KCcnKTtcbiAgcHJvdGVjdGVkIF9jb2x1bW5WYWx1ZUZpbHRlckNoYW5nZSA9IG5ldyBCZWhhdmlvclN1YmplY3QobnVsbCk7XG4gIHByb3RlY3RlZCBncm91cEJ5Q29sdW1uQ2hhbmdlID0gbmV3IFN1YmplY3QoKTtcblxuICBwcm90ZWN0ZWQgZmlsdGVyZWREYXRhOiBhbnlbXSA9IFtdO1xuICBwcm90ZWN0ZWQgYWdncmVnYXRlRGF0YTogYW55ID0ge307XG5cbiAgb25SZW5kZXJlZERhdGFDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cblxuICBwcm90ZWN0ZWQgX3JlbmRlcmVkRGF0YTogYW55W10gPSBbXTtcbiAgcmVzdWx0c0xlbmd0aDogbnVtYmVyID0gMDtcblxuICBnZXQgcXVpY2tGaWx0ZXIoKTogc3RyaW5nIHsgcmV0dXJuIHRoaXMuX3F1aWNrRmlsdGVyQ2hhbmdlLnZhbHVlIHx8ICcnOyB9XG4gIHNldCBxdWlja0ZpbHRlcihmaWx0ZXI6IHN0cmluZykge1xuICAgIHRoaXMuX3F1aWNrRmlsdGVyQ2hhbmdlLm5leHQoZmlsdGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgY29sdW1uVmFsdWVGaWx0ZXJzOiBBcnJheTxPQ29sdW1uVmFsdWVGaWx0ZXI+ID0gW107XG4gIHByaXZhdGUgZ3JvdXBlZFJvd1N0YXRlOiBPVGFibGVHcm91cGVkUm93W10gPSBbXTtcbiAgcHJpdmF0ZSBhY3RpdmVBZ2dyZWdhdGVzID0ge307XG4gIHByaXZhdGUgZ3JvdXBlZFJvd3NTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gIHByaXZhdGUgbGV2ZWxzRXhwYW5zaW9uU3RhdGUgPSB7fTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgdGFibGU6IE9UYWJsZUNvbXBvbmVudCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YWJhc2UgPSB0YWJsZS5kYW9UYWJsZTtcbiAgICBpZiAodGhpcy5fZGF0YWJhc2UpIHtcbiAgICAgIHRoaXMucmVzdWx0c0xlbmd0aCA9IHRoaXMuX2RhdGFiYXNlLmRhdGEubGVuZ3RoO1xuICAgIH1cbiAgICBpZiAodGFibGUucGFnaW5hdG9yKSB7XG4gICAgICB0aGlzLl9wYWdpbmF0b3IgPSB0YWJsZS5tYXRwYWdpbmF0b3I7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudGFibGUudmlydHVhbFNjcm9sbFZpZXdwb3J0KSB7XG4gICAgICB0aGlzLnRhYmxlLnZpcnR1YWxTY3JvbGxWaWV3cG9ydC5yZW5kZXJlZFJhbmdlU3RyZWFtXG4gICAgICAgIC5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpXG4gICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgKHZhbHVlOiBMaXN0UmFuZ2UpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3ZpcnR1YWxQYWdlQ2hhbmdlLm5leHQobmV3IE9uUmFuZ2VDaGFuZ2VWaXJ0dWFsU2Nyb2xsKHZhbHVlKSk7XG4gICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5fdGFibGVPcHRpb25zID0gdGFibGUub1RhYmxlT3B0aW9ucztcbiAgICB0aGlzLl9zb3J0ID0gdGFibGUuc29ydDtcblxuICB9XG5cbiAgc29ydEZ1bmN0aW9uKGE6IGFueSwgYjogYW55KTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fc29ydC5zb3J0RnVuY3Rpb24oYSwgYik7XG4gIH1cblxuICBnZXQgcmVuZGVyZWREYXRhKCk6IGFueVtdIHtcbiAgICByZXR1cm4gdGhpcy5fcmVuZGVyZWREYXRhO1xuICB9XG5cbiAgc2V0IHJlbmRlcmVkRGF0YShhcmc6IGFueVtdKSB7XG4gICAgdGhpcy5fcmVuZGVyZWREYXRhID0gYXJnO1xuICAgIHRoaXMub25SZW5kZXJlZERhdGFDaGFuZ2UuZW1pdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbm5lY3QgZnVuY3Rpb24gY2FsbGVkIGJ5IHRoZSB0YWJsZSB0byByZXRyaWV2ZSBvbmUgc3RyZWFtIGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gcmVuZGVyLlxuICAgKi9cbiAgY29ubmVjdCgpOiBPYnNlcnZhYmxlPGFueVtdPiB7XG4gICAgY29uc3QgZGlzcGxheURhdGFDaGFuZ2VzOiBhbnlbXSA9IFtcbiAgICAgIHRoaXMuX2RhdGFiYXNlLmRhdGFDaGFuZ2VcbiAgICBdO1xuXG4gICAgaWYgKCF0aGlzLnRhYmxlLnBhZ2VhYmxlKSB7XG5cblxuICAgICAgaWYgKHRoaXMuX3NvcnQpIHtcbiAgICAgICAgZGlzcGxheURhdGFDaGFuZ2VzLnB1c2godGhpcy5fc29ydC5vU29ydENoYW5nZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl90YWJsZU9wdGlvbnMuZmlsdGVyKSB7XG4gICAgICAgIGRpc3BsYXlEYXRhQ2hhbmdlcy5wdXNoKHRoaXMuX3F1aWNrRmlsdGVyQ2hhbmdlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX3BhZ2luYXRvcikge1xuICAgICAgICBkaXNwbGF5RGF0YUNoYW5nZXMucHVzaCh0aGlzLl9wYWdpbmF0b3IucGFnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudGFibGUudmlydHVhbFNjcm9sbFZpZXdwb3J0KSB7XG4gICAgICBkaXNwbGF5RGF0YUNoYW5nZXMucHVzaCh0aGlzLl92aXJ0dWFsUGFnZUNoYW5nZSk7XG4gICAgfVxuXG4gICAgZGlzcGxheURhdGFDaGFuZ2VzLnB1c2godGhpcy5fY29sdW1uVmFsdWVGaWx0ZXJDaGFuZ2UpO1xuXG4gICAgaWYgKHRoaXMudGFibGUuZ3JvdXBhYmxlKSB7XG4gICAgICBkaXNwbGF5RGF0YUNoYW5nZXMucHVzaCh0aGlzLmdyb3VwQnlDb2x1bW5DaGFuZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiBtZXJnZSguLi5kaXNwbGF5RGF0YUNoYW5nZXMpLnBpcGUoXG4gICAgICBtYXAoKHg6IGFueSkgPT4ge1xuICAgICAgICBsZXQgZGF0YSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuX2RhdGFiYXNlLmRhdGEpO1xuICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIE9uUmFuZ2VDaGFuZ2VWaXJ0dWFsU2Nyb2xsKSB7XG4gICAgICAgICAgLy8gcmVuZGVyIHN1YnNldCAocmFuZ2UpIG9mIHJlbmRlcmVkRGF0YSB3aGVuIG5ldyBPblJhbmdlQ2hhbmdlVmlydHVhbFNjcm9sbCBldmVudCBpcyBlbWl0dGVkXG4gICAgICAgICAgZGF0YSA9IHRoaXMuZ2V0VmlydHVhbFNjcm9sbERhdGEodGhpcy5yZW5kZXJlZERhdGEsIHgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8qXG4gICAgICAgICAgICBpdCBpcyBuZWNlc3NhcnkgdG8gZmlyc3QgY2FsY3VsYXRlIHRoZSBjYWxjdWxhdGVkIGNvbHVtbnMgYW5kXG4gICAgICAgICAgICB0aGVuIGZpbHRlciBhbmQgc29ydCB0aGUgZGF0YVxuICAgICAgICAgICovXG5cbiAgICAgICAgICBpZiAodGhpcy5leGlzdHNBbnlDYWxjdWxhdGVkQ29sdW1uKCkpIHtcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLmdldENvbHVtbkNhbGN1bGF0ZWREYXRhKGRhdGEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghdGhpcy50YWJsZS5wYWdlYWJsZSkge1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuZ2V0Q29sdW1uVmFsdWVGaWx0ZXJEYXRhKGRhdGEpO1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuZ2V0UXVpY2tGaWx0ZXJEYXRhKGRhdGEpO1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuZ2V0U29ydGVkRGF0YShkYXRhKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmZpbHRlcmVkRGF0YSA9IE9iamVjdC5hc3NpZ24oW10sIGRhdGEpO1xuXG4gICAgICAgICAgaWYgKHRoaXMudGFibGUucGFnZWFibGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsUmVjb3Jkc051bWJlciA9IHRoaXMudGFibGUuZ2V0VG90YWxSZWNvcmRzTnVtYmVyKCk7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHNMZW5ndGggPSB0b3RhbFJlY29yZHNOdW1iZXIgIT09IHVuZGVmaW5lZCA/IHRvdGFsUmVjb3Jkc051bWJlciA6IGRhdGEubGVuZ3RoO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHNMZW5ndGggPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLmdldFBhZ2luYXRpb25EYXRhKGRhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy50YWJsZS5ncm91cGFibGUgJiYgIVV0aWwuaXNBcnJheUVtcHR5KHRoaXMudGFibGUuZ3JvdXBlZENvbHVtbnNBcnJheSkgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBkYXRhID0gdGhpcy5nZXRHcm91cGVkRGF0YShkYXRhKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLnJlbmRlcmVkRGF0YSA9IGRhdGE7XG5cbiAgICAgICAgICAvKlxuICAgICAgICAgICAgd2hlbiB0aGUgZGF0YSBpcyB2ZXJ5IGxhcmdlLCB0aGUgYXBwbGljYXRpb24gY3Jhc2hlcyBzbyBpdCBnZXRzIGEgbGltaXRlZCByYW5nZSBvZiBkYXRhIHRoZSBmaXJzdCB0aW1lXG4gICAgICAgICAgICBiZWNhdXNlIGF0IG5leHQgdGhlIEN1c3RvbVZpcnR1YWxTY3JvbGxTdHJhdGVneSB3aWxsIGVtaXQgZXZlbnQgT25SYW5nZUNoYW5nZVZpcnR1YWxTY3JvbGxcbiAgICAgICAgICAqL1xuICAgICAgICAgIGlmICh0aGlzLnRhYmxlLnZpcnR1YWxTY3JvbGxWaWV3cG9ydCAmJiAhdGhpcy5fcGFnaW5hdG9yKSB7XG4gICAgICAgICAgICBkYXRhID0gdGhpcy5nZXRWaXJ0dWFsU2Nyb2xsRGF0YShkYXRhLCBuZXcgT25SYW5nZUNoYW5nZVZpcnR1YWxTY3JvbGwoeyBzdGFydDogMCwgZW5kOiBDb2Rlcy5MSU1JVF9TQ1JPTExWSVJUVUFMIH0pKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmFnZ3JlZ2F0ZURhdGEgPSB0aGlzLmdldEFnZ3JlZ2F0ZXNEYXRhKHRoaXMucmVuZGVyZWREYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIGdldEdyb3VwZWREYXRhKGRhdGE6IGFueVtdKSB7XG4gICAgZGF0YSA9IHRoaXMuZ2V0U3ViR3JvdXBzT2ZHcm91cGVkUm93KGRhdGEpO1xuICAgIC8qKiBkYXRhIGNvbnRhaW5zIHJvdyBncm91cCBoZWFkZXJzIChPVGFibGVHcm91cGVkUm93KSBhbmQgdGhlIGRhdGEgYmVsb25naW5nIHRvIGV4cGFuZGVkIGdyb3VwZWQgcm93cyAqL1xuICAgIGRhdGEgPSB0aGlzLmZpbHRlckNvbGxhcHNlZFJvd0dyb3VwKGRhdGEpO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgc3ViZ3JvdXBzIG9mIGdyb3VwZWQgcm93XG4gICAqIEBwYXJhbSBkYXRhXG4gICAqIEByZXR1cm5zIHN1Ymdyb3VwcyBvZiBncm91cGVkIHJvd1xuICAgKi9cbiAgZ2V0U3ViR3JvdXBzT2ZHcm91cGVkUm93KGRhdGE6IGFueVtdKTogYW55W10ge1xuICAgIHJldHVybiBkYXRhID0gdGhpcy5nZXRTdWJsZXZlbChkYXRhLCAwKTtcbiAgfVxuXG4gIGdldEFnZ3JlZ2F0ZXNEYXRhKGRhdGE6IGFueVtdKTogYW55IHtcbiAgICBjb25zdCBvYmogPSB7fTtcblxuICAgIGlmICh0eXBlb2YgdGhpcy5fdGFibGVPcHRpb25zID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG5cbiAgICB0aGlzLl90YWJsZU9wdGlvbnMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW46IE9Db2x1bW4pID0+IHtcbiAgICAgIGxldCB0b3RhbFZhbHVlID0gJyc7XG4gICAgICBpZiAoY29sdW1uLmFnZ3JlZ2F0ZSAmJiBjb2x1bW4udmlzaWJsZSkge1xuICAgICAgICB0b3RhbFZhbHVlID0gdGhpcy5jYWxjdWxhdGVBZ2dyZWdhdGUoZGF0YSwgY29sdW1uLmF0dHIsIGNvbHVtbi5hZ2dyZWdhdGUub3BlcmF0b3IpO1xuICAgICAgfVxuICAgICAgY29uc3Qga2V5ID0gY29sdW1uLmF0dHI7XG4gICAgICBvYmpba2V5XSA9IHRvdGFsVmFsdWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0aGF0IGdldCB2YWx1ZSB0aGUgY29sdW1ucyBjYWxjdWxhdGVkXG4gICAqIEBwYXJhbSBkYXRhIGRhdGEgb2YgdGhlIGRhdGFiYXNlXG4gICAqL1xuICBnZXRDb2x1bW5DYWxjdWxhdGVkRGF0YShkYXRhOiBhbnlbXSk6IGFueVtdIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBjb25zdCBjYWxjdWxhdGVkQ29scyA9IHRoaXMuX3RhYmxlT3B0aW9ucy5jb2x1bW5zLmZpbHRlcigob0NvbDogT0NvbHVtbikgPT4gb0NvbC52aXNpYmxlICYmIG9Db2wuY2FsY3VsYXRlICE9PSB1bmRlZmluZWQpO1xuICAgIHJldHVybiBkYXRhLm1hcCgocm93OiBhbnkpID0+IHtcbiAgICAgIGNhbGN1bGF0ZWRDb2xzLmZvckVhY2goKG9Db2x1bW46IE9Db2x1bW4pID0+IHtcbiAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICBpZiAodHlwZW9mIG9Db2x1bW4uY2FsY3VsYXRlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHZhbHVlID0gc2VsZi50cmFuc2Zvcm1Gb3JtdWxhKG9Db2x1bW4uY2FsY3VsYXRlLCByb3cpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvQ29sdW1uLmNhbGN1bGF0ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHZhbHVlID0gb0NvbHVtbi5jYWxjdWxhdGUocm93KTtcbiAgICAgICAgfVxuICAgICAgICByb3dbb0NvbHVtbi5hdHRyXSA9IGlzTmFOKHZhbHVlKSA/IDAgOiB2YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJvdztcbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0cmFuc2Zvcm1Gb3JtdWxhKGZvcm11bGFBcmcsIHJvdyk6IHN0cmluZyB7XG4gICAgbGV0IGZvcm11bGEgPSBmb3JtdWxhQXJnO1xuICAgIC8vIDEuIHJlcGxhY2UgY29sdW1ucyBieSB2YWx1ZXMgb2Ygcm93XG4gICAgY29uc3QgY29sdW1uc0F0dHIgPSB0aGlzLl90YWJsZU9wdGlvbnMuY29sdW1ucy5tYXAoKG9Db2w6IE9Db2x1bW4pID0+IG9Db2wuYXR0cik7XG4gICAgY29sdW1uc0F0dHIuZm9yRWFjaCgoY29sdW1uOiBzdHJpbmcpID0+IHtcbiAgICAgIGZvcm11bGEgPSBmb3JtdWxhLnJlcGxhY2UoY29sdW1uLCByb3dbY29sdW1uXSk7XG4gICAgfSk7XG5cbiAgICBsZXQgcmVzdWx0Rm9ybXVsYSA9ICcnO1xuICAgIC8vIDIuIFRyYW5zZm9ybSBmb3JtdWxhXG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdEZvcm11bGEgPSAobmV3IEZ1bmN0aW9uKCdyZXR1cm4gJyArIGZvcm11bGEpKSgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ09wZXJhdGlvbiBkZWZpbmVkIGluIHRoZSBjYWxjdWxhdGVkIGNvbHVtbiBpcyBpbmNvcnJlY3QgJyk7XG4gICAgfVxuICAgIC8vIDMuIFJldHVybiByZXN1bHRcbiAgICByZXR1cm4gcmVzdWx0Rm9ybXVsYTtcbiAgfVxuXG4gIGdldFF1aWNrRmlsdGVyRGF0YShkYXRhOiBhbnlbXSk6IGFueVtdIHtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5xdWlja0ZpbHRlcikgJiYgdGhpcy5xdWlja0ZpbHRlci5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWx0ZXJEYXRhID0gIXRoaXMuX3RhYmxlT3B0aW9ucy5maWx0ZXJDYXNlU2Vuc2l0aXZlID8gdGhpcy5xdWlja0ZpbHRlci50b0xvd2VyQ2FzZSgpIDogdGhpcy5xdWlja0ZpbHRlcjtcbiAgICAgIHJldHVybiBkYXRhLmZpbHRlcigoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIC8vIEdldHRpbmcgY3VzdG9tIGNvbHVtbnMgZmlsdGVyIGNvbHVtbnMgcmVzdWx0XG4gICAgICAgIGNvbnN0IHBhc3NDdXN0b21GaWx0ZXIgPSB0aGlzLmZ1bGZpbGxzQ3VzdG9tRmlsdGVyRnVuY3Rpb25zKGZpbHRlckRhdGEsIGl0ZW0pO1xuICAgICAgICAvLyBHZXR0aW5nIG90aGVyIHNlYXJjaGFibGUgY29sdW1ucyBzdGFuZGFyZCByZXN1bHRcbiAgICAgICAgY29uc3QgcGFzc1NlYXJjaFN0cmluZyA9IHRoaXMuZnVsZmlsbHNRdWlja2ZpbHRlcihmaWx0ZXJEYXRhLCBpdGVtKTtcbiAgICAgICAgcmV0dXJuIHBhc3NDdXN0b21GaWx0ZXIgfHwgcGFzc1NlYXJjaFN0cmluZztcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gIH1cblxuICBnZXRQYWdpbmF0aW9uRGF0YShkYXRhOiBhbnlbXSk6IGFueVtdIHtcbiAgICBpZiAoIXRoaXMuX3BhZ2luYXRvciB8fCBpc05hTih0aGlzLl9wYWdpbmF0b3IucGFnZVNpemUpKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgbGV0IHN0YXJ0SW5kZXggPSBpc05hTih0aGlzLl9wYWdpbmF0b3IucGFnZVNpemUpID8gMCA6IHRoaXMuX3BhZ2luYXRvci5wYWdlSW5kZXggKiB0aGlzLl9wYWdpbmF0b3IucGFnZVNpemU7XG4gICAgaWYgKGRhdGEubGVuZ3RoID4gMCAmJiBkYXRhLmxlbmd0aCA8IHN0YXJ0SW5kZXgpIHtcbiAgICAgIHN0YXJ0SW5kZXggPSAwO1xuICAgICAgdGhpcy5fcGFnaW5hdG9yLnBhZ2VJbmRleCA9IDA7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLnNwbGljZShzdGFydEluZGV4LCB0aGlzLl9wYWdpbmF0b3IucGFnZVNpemUpO1xuICB9XG5cbiAgZ2V0VmlydHVhbFNjcm9sbERhdGEoZGF0YTogYW55W10sIHg6IE9uUmFuZ2VDaGFuZ2VWaXJ0dWFsU2Nyb2xsKTogYW55W10ge1xuICAgIHJldHVybiBkYXRhLnNsaWNlKHgucmFuZ2Uuc3RhcnQsIHgucmFuZ2UuZW5kKVxuICB9XG5cbiAgZGlzY29ubmVjdCgpIHtcbiAgICB0aGlzLmRhdGFUb3RhbHNDaGFuZ2UuY29tcGxldGUoKTtcbiAgICB0aGlzLl9xdWlja0ZpbHRlckNoYW5nZS5jb21wbGV0ZSgpO1xuICAgIHRoaXMuX2NvbHVtblZhbHVlRmlsdGVyQ2hhbmdlLmNvbXBsZXRlKCk7XG4gICAgdGhpcy5ncm91cEJ5Q29sdW1uQ2hhbmdlLmNvbXBsZXRlKCk7XG4gICAgdGhpcy5fdmlydHVhbFBhZ2VDaGFuZ2UuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBmdWxmaWxsc0N1c3RvbUZpbHRlckZ1bmN0aW9ucyhmaWx0ZXI6IHN0cmluZywgaXRlbTogYW55KSB7XG4gICAgY29uc3QgY3VzdG9tRmlsdGVyQ29scyA9IHRoaXMudGFibGUub1RhYmxlT3B0aW9ucy5jb2x1bW5zLmZpbHRlcihvQ29sID0+IG9Db2wudXNlQ3VzdG9tRmlsdGVyRnVuY3Rpb24oKSk7XG4gICAgcmV0dXJuIGN1c3RvbUZpbHRlckNvbHMuc29tZShvQ29sID0+IG9Db2wucmVuZGVyZXIuZmlsdGVyRnVuY3Rpb24oaXRlbVtvQ29sLmF0dHJdLCBpdGVtLCBmaWx0ZXIpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBmdWxmaWxsc1F1aWNrZmlsdGVyKGZpbHRlcjogc3RyaW5nLCBpdGVtOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5fdGFibGVPcHRpb25zLmNvbHVtbnMuZmlsdGVyKChvQ29sOiBPQ29sdW1uKSA9PiBvQ29sLnVzZVF1aWNrZmlsdGVyRnVuY3Rpb24oKSk7XG4gICAgbGV0IHNlYXJjaFN0ciA9IGNvbHVtbnMubWFwKChvQ29sOiBPQ29sdW1uKSA9PiBvQ29sLmdldEZpbHRlclZhbHVlKGl0ZW1bb0NvbC5hdHRyXSwgaXRlbSkuam9pbignICcpKS5qb2luKCcgJyk7XG4gICAgaWYgKCF0aGlzLl90YWJsZU9wdGlvbnMuZmlsdGVyQ2FzZVNlbnNpdGl2ZSkge1xuICAgICAgc2VhcmNoU3RyID0gc2VhcmNoU3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIHJldHVybiBzZWFyY2hTdHIuaW5kZXhPZihmaWx0ZXIpICE9PSAtMTtcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIGEgc29ydGVkIGNvcHkgb2YgdGhlIGRhdGFiYXNlIGRhdGEuICovXG4gIHByb3RlY3RlZCBnZXRTb3J0ZWREYXRhKGRhdGE6IGFueVtdKTogYW55W10ge1xuICAgIHJldHVybiB0aGlzLl9zb3J0LmdldFNvcnRlZERhdGEoZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgZGF0YSB0aGUgdGFibGUgc3RvcmVzLiBObyBmaWx0ZXJzIGFyZSBhcHBsaWVkLlxuICAgKi9cbiAgZ2V0VGFibGVEYXRhKCk6IGFueVtdIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YWJhc2UuZGF0YTtcbiAgfVxuXG4gIC8qKiBSZXR1cm4gZGF0YSBvZiB0aGUgdmlzaWJsZSBjb2x1bW5zIG9mIHRoZSB0YWJsZSB3aXRob3V0IHJlbmRlcmluZyAqL1xuICBnZXRDdXJyZW50RGF0YSgpOiBhbnlbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RGF0YSgpO1xuICB9XG5cbiAgZ2V0Q3VycmVudEFsbERhdGEoKTogYW55W10ge1xuICAgIHJldHVybiB0aGlzLmdldEFsbERhdGEoZmFsc2UsIGZhbHNlKTtcbiAgfVxuXG4gIC8qKiBSZXR1cm4gZGF0YSBvZiB0aGUgdmlzaWJsZSBjb2x1bW5zIG9mIHRoZSB0YWJsZSAgcmVuZGVyaW5nICovXG4gIGdldEN1cnJlbnRSZW5kZXJlckRhdGEoKTogYW55W10ge1xuICAgIHJldHVybiB0aGlzLmdldFJlbmRlcmVkRGF0YSh0aGlzLnJlbmRlcmVkRGF0YSk7XG4gIH1cblxuICAvKiogUmV0dXJuIGFsbCBkYXRhIG9mIHRoZSB0YWJsZSByZW5kZXJpbmcgKi9cbiAgZ2V0QWxsUmVuZGVyZXJEYXRhKCk6IGFueVtdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBbGxEYXRhKHRydWUsIHRydWUpO1xuICB9XG5cbiAgLyoqIFJldHVybiBzcWwgdHlwZXMgb2YgdGhlIGN1cnJlbnQgZGF0YSAqL1xuICBnZXQgc3FsVHlwZXMoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YWJhc2Uuc3FsVHlwZXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0RGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlZERhdGE7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVuZGVyZWREYXRhKGRhdGE6IGFueVtdKTogYW55W10ge1xuICAgIGNvbnN0IHZpc2libGVDb2x1bW5zID0gdGhpcy5fdGFibGVPcHRpb25zLmNvbHVtbnMuZmlsdGVyKG9Db2wgPT4gb0NvbC52aXNpYmxlKTtcbiAgICByZXR1cm4gZGF0YS5tYXAoKHJvdykgPT4ge1xuICAgICAgY29uc3Qgb2JqID0ge307XG4gICAgICB2aXNpYmxlQ29sdW1ucy5mb3JFYWNoKChvQ29sOiBPQ29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZVJlbmRlcmVyID0gb0NvbC5yZW5kZXJlciAmJiBvQ29sLnJlbmRlcmVyLmdldENlbGxEYXRhO1xuICAgICAgICBvYmpbb0NvbC5hdHRyXSA9IHVzZVJlbmRlcmVyID8gb0NvbC5yZW5kZXJlci5nZXRDZWxsRGF0YShyb3dbb0NvbC5hdHRyXSwgcm93KSA6IHJvd1tvQ29sLmF0dHJdO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH0pO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFsbERhdGEodXNpbmdSZW5kZXJlcmVycz86IGJvb2xlYW4sIG9ubHlWaXNpYmxlQ29sdW1ucz86IGJvb2xlYW4pIHtcbiAgICBsZXQgdGFibGVDb2x1bW5zID0gdGhpcy5fdGFibGVPcHRpb25zLmNvbHVtbnM7XG4gICAgaWYgKG9ubHlWaXNpYmxlQ29sdW1ucykge1xuICAgICAgdGFibGVDb2x1bW5zID0gdGhpcy5fdGFibGVPcHRpb25zLmNvbHVtbnMuZmlsdGVyKG9Db2wgPT4gb0NvbC52aXNpYmxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyZWREYXRhLm1hcCgocm93KSA9PiB7XG4gICAgICBjb25zdCBvYmogPSB7fTtcbiAgICAgIHRhYmxlQ29sdW1ucy5mb3JFYWNoKChvQ29sOiBPQ29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZVJlbmRlcmVyID0gdXNpbmdSZW5kZXJlcmVycyAmJiBvQ29sLnJlbmRlcmVyICYmIG9Db2wucmVuZGVyZXIuZ2V0Q2VsbERhdGE7XG4gICAgICAgIG9ialtvQ29sLmF0dHJdID0gdXNlUmVuZGVyZXIgPyBvQ29sLnJlbmRlcmVyLmdldENlbGxEYXRhKHJvd1tvQ29sLmF0dHJdLCByb3cpIDogcm93W29Db2wuYXR0cl07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFJlbmRlcmVyc0RhdGEoZGF0YTogYW55W10sIHRhYmxlQ29sdW1uczogT0NvbHVtbltdKTogYW55W10ge1xuICAgIHJldHVybiBkYXRhLm1hcCgocm93KSA9PiB7XG4gICAgICAvLyByZW5kZXIgZWFjaCBjb2x1bW5cbiAgICAgIGNvbnN0IG9iaiA9IE9iamVjdC5hc3NpZ24oe30sIHJvdyk7XG4gICAgICB0YWJsZUNvbHVtbnMuZm9yRWFjaCgob0NvbDogT0NvbHVtbikgPT4ge1xuICAgICAgICBvYmpbb0NvbC5hdHRyXSA9IG9Db2wucmVuZGVyZXIuZ2V0Q2VsbERhdGEocm93W29Db2wuYXR0cl0sIHJvdyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q29sdW1uRGF0YShvY29sdW1uOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlZERhdGEubWFwKChyb3cpID0+IHtcbiAgICAgIC8vIHJlbmRlciBlYWNoIGNvbHVtblxuICAgICAgY29uc3Qgb2JqID0ge307XG4gICAgICBpZiAob2NvbHVtbikge1xuICAgICAgICBvYmpbb2NvbHVtbl0gPSByb3dbb2NvbHVtbl07XG4gICAgICB9XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH0pO1xuICB9XG5cbiAgaW5pdGlhbGl6ZUNvbHVtbnNGaWx0ZXJzKGZpbHRlcnM6IE9Db2x1bW5WYWx1ZUZpbHRlcltdKSB7XG4gICAgdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnMgPSBbXTtcbiAgICBmaWx0ZXJzLmZvckVhY2goZmlsdGVyID0+IHtcbiAgICAgIHRoaXMuY29sdW1uVmFsdWVGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgICB9KTtcbiAgICBpZiAoIXRoaXMudGFibGUucGFnZWFibGUpIHtcbiAgICAgIHRoaXMuX2NvbHVtblZhbHVlRmlsdGVyQ2hhbmdlLm5leHQobnVsbCk7XG4gICAgfVxuICB9XG5cbiAgaXNDb2x1bW5WYWx1ZUZpbHRlckFjdGl2ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnMubGVuZ3RoICE9PSAwO1xuICB9XG5cbiAgZ2V0Q29sdW1uVmFsdWVGaWx0ZXJzKCk6IE9Db2x1bW5WYWx1ZUZpbHRlcltdIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnM7XG4gIH1cblxuICBnZXRDb2x1bW5WYWx1ZUZpbHRlckJ5QXR0cihhdHRyOiBzdHJpbmcpOiBPQ29sdW1uVmFsdWVGaWx0ZXIge1xuICAgIHJldHVybiB0aGlzLmNvbHVtblZhbHVlRmlsdGVycy5maW5kKGl0ZW0gPT4gaXRlbS5hdHRyID09PSBhdHRyKTtcbiAgfVxuXG4gIGNsZWFyQ29sdW1uRmlsdGVycyh0cmlnZ2VyOiBib29sZWFuID0gdHJ1ZSwgY29sdW1uc0F0dHI/OiBzdHJpbmdbXSkge1xuICAgIGlmIChVdGlsLmlzRGVmaW5lZChjb2x1bW5zQXR0cikpIHtcbiAgICAgIHRoaXMuY29sdW1uVmFsdWVGaWx0ZXJzID0gdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnMuZmlsdGVyKHggPT4gIWNvbHVtbnNBdHRyLmluY2x1ZGVzKHguYXR0cikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbHVtblZhbHVlRmlsdGVycyA9IFtdO1xuICAgIH1cbiAgICBpZiAodHJpZ2dlcikge1xuICAgICAgdGhpcy5fY29sdW1uVmFsdWVGaWx0ZXJDaGFuZ2UubmV4dChudWxsKTtcbiAgICB9XG4gIH1cblxuICBjbGVhckNvbHVtbkZpbHRlcihhdHRyOiBzdHJpbmcsIHRyaWdnZXI6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnMgPSB0aGlzLmNvbHVtblZhbHVlRmlsdGVycy5maWx0ZXIoeCA9PiB4LmF0dHIgIT09IGF0dHIpO1xuICAgIGlmICh0cmlnZ2VyKSB7XG4gICAgICB0aGlzLl9jb2x1bW5WYWx1ZUZpbHRlckNoYW5nZS5uZXh0KG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIGFkZENvbHVtbkZpbHRlcihmaWx0ZXI6IE9Db2x1bW5WYWx1ZUZpbHRlcikge1xuICAgIGNvbnN0IGV4aXN0aW5nRmlsdGVySW5kZXggPSB0aGlzLmNvbHVtblZhbHVlRmlsdGVycy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmF0dHIgPT09IGZpbHRlci5hdHRyKTtcbiAgICBpZiAoZXhpc3RpbmdGaWx0ZXJJbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLmNvbHVtblZhbHVlRmlsdGVycy5zcGxpY2UoZXhpc3RpbmdGaWx0ZXJJbmRleCwgMSwgZmlsdGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHZhbGlkRmlsdGVyID0gVXRpbC5pc0RlZmluZWQoZmlsdGVyLnZhbHVlcyk7XG4gICAgICBpZiAodmFsaWRGaWx0ZXIpIHtcbiAgICAgICAgc3dpdGNoIChmaWx0ZXIub3BlcmF0b3IpIHtcbiAgICAgICAgICBjYXNlIENvbHVtblZhbHVlRmlsdGVyT3BlcmF0b3IuSU46XG4gICAgICAgICAgICB2YWxpZEZpbHRlciA9IGZpbHRlci52YWx1ZXMubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvci5CRVRXRUVOOlxuICAgICAgICAgICAgdmFsaWRGaWx0ZXIgPSBmaWx0ZXIudmFsdWVzLmxlbmd0aCA9PT0gMjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvci5FUVVBTDpcbiAgICAgICAgICBjYXNlIENvbHVtblZhbHVlRmlsdGVyT3BlcmF0b3IuTEVTU19FUVVBTDpcbiAgICAgICAgICBjYXNlIENvbHVtblZhbHVlRmlsdGVyT3BlcmF0b3IuTU9SRV9FUVVBTDpcbiAgICAgICAgICAgIHZhbGlkRmlsdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB2YWxpZEZpbHRlciA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWxpZEZpbHRlcikge1xuICAgICAgICAgIHRoaXMuY29sdW1uVmFsdWVGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBJZiB0aGUgdGFibGUgaXMgcGFnaW5hdGVkLCBmaWx0ZXIgd2lsbCBiZSBhcHBsaWVkIG9uIHJlbW90ZSBxdWVyeVxuICAgIGlmICghdGhpcy50YWJsZS5wYWdlYWJsZSkge1xuICAgICAgdGhpcy5fY29sdW1uVmFsdWVGaWx0ZXJDaGFuZ2UubmV4dChudWxsKTtcbiAgICB9XG4gIH1cblxuICBnZXRDb2x1bW5WYWx1ZUZpbHRlckRhdGEoZGF0YTogYW55W10pOiBhbnlbXSB7XG4gICAgdGhpcy5jb2x1bW5WYWx1ZUZpbHRlcnMuZm9yRWFjaChmaWx0ZXIgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyQ29sdW1uID0gdGhpcy50YWJsZS5vVGFibGVPcHRpb25zLmNvbHVtbnMuZmluZChjb2wgPT4gY29sLmF0dHIgPT09IGZpbHRlci5hdHRyKTtcbiAgICAgIGlmIChmaWx0ZXJDb2x1bW4pIHtcbiAgICAgICAgc3dpdGNoIChmaWx0ZXIub3BlcmF0b3IpIHtcbiAgICAgICAgICBjYXNlIENvbHVtblZhbHVlRmlsdGVyT3BlcmF0b3IuSU46XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZXMgPSAoZmlsdGVyLnZhbHVlcyB8fCBbXSkucmVkdWNlKChwcmV2aW91cywgY3VycmVudCkgPT5cbiAgICAgICAgICAgICAgcHJldmlvdXMuY29uY2F0KGZpbHRlckNvbHVtbi5nZXRGaWx0ZXJWYWx1ZShjdXJyZW50KS5tYXAoZiA9PiBVdGlsLm5vcm1hbGl6ZVN0cmluZyhmKSkpLCBbXSk7XG5cbiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmZpbHRlcigoaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgICAgIGlmIChmaWx0ZXJDb2x1bW4ucmVuZGVyZXIgJiYgZmlsdGVyQ29sdW1uLnJlbmRlcmVyLmZpbHRlckZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckNvbHVtbi5yZW5kZXJlci5maWx0ZXJGdW5jdGlvbihpdGVtW2ZpbHRlci5hdHRyXSwgaXRlbSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sVmFsdWVzID0gZmlsdGVyQ29sdW1uLmdldEZpbHRlclZhbHVlKGl0ZW1bZmlsdGVyLmF0dHJdLCBpdGVtKS5tYXAoZiA9PiBVdGlsLm5vcm1hbGl6ZVN0cmluZyhmKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlclZhbHVlcy5zb21lKHZhbHVlID0+IGNvbFZhbHVlcy5pbmRleE9mKHZhbHVlKSAhPT0gLTEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvci5FUVVBTDpcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRWYWx1ZSA9IFV0aWwubm9ybWFsaXplU3RyaW5nKGZpbHRlci52YWx1ZXMpO1xuICAgICAgICAgICAgZGF0YSA9IGRhdGEuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb2xWYWx1ZXMgPSBmaWx0ZXJDb2x1bW4uZ2V0RmlsdGVyVmFsdWUoaXRlbVtmaWx0ZXIuYXR0cl0sIGl0ZW0pLm1hcChmID0+IFV0aWwubm9ybWFsaXplU3RyaW5nKGYpKTtcbiAgICAgICAgICAgICAgbGV0IHJlZ0V4cDtcbiAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRWYWx1ZS5pbmNsdWRlcygnKicpKSB7XG4gICAgICAgICAgICAgICAgcmVnRXhwID0gbmV3IFJlZ0V4cCgnXicgKyBub3JtYWxpemVkVmFsdWUuc3BsaXQoJyonKS5qb2luKCcuKicpICsgJyQnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY29sVmFsdWVzLnNvbWUoY29sVmFsdWUgPT4gcmVnRXhwID8gcmVnRXhwLnRlc3QoY29sVmFsdWUpIDogY29sVmFsdWUuaW5jbHVkZXMobm9ybWFsaXplZFZhbHVlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvci5CRVRXRUVOOlxuICAgICAgICAgICAgZGF0YSA9IGRhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbVtmaWx0ZXIuYXR0cl0gPj0gZmlsdGVyLnZhbHVlc1swXSAmJiBpdGVtW2ZpbHRlci5hdHRyXSA8PSBmaWx0ZXIudmFsdWVzWzFdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29sdW1uVmFsdWVGaWx0ZXJPcGVyYXRvci5NT1JFX0VRVUFMOlxuICAgICAgICAgICAgZGF0YSA9IGRhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbVtmaWx0ZXIuYXR0cl0gPj0gZmlsdGVyLnZhbHVlcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIENvbHVtblZhbHVlRmlsdGVyT3BlcmF0b3IuTEVTU19FUVVBTDpcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmZpbHRlcihpdGVtID0+IGl0ZW1bZmlsdGVyLmF0dHJdIDw9IGZpbHRlci52YWx1ZXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGdldEFnZ3JlZ2F0ZURhdGEoY29sdW1uOiBPQ29sdW1uKSB7XG4gICAgY29uc3Qgb2JqID0ge307XG4gICAgbGV0IHRvdGFsVmFsdWUgPSAnJztcblxuICAgIGlmICh0eXBlb2YgdGhpcy5fdGFibGVPcHRpb25zID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIG5ldyBBcnJheShvYmopO1xuICAgIH1cbiAgICB0b3RhbFZhbHVlID0gdGhpcy5hZ2dyZWdhdGVEYXRhW2NvbHVtbi5hdHRyXTtcbiAgICByZXR1cm4gdG90YWxWYWx1ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjYWxjdWxhdGVBZ2dyZWdhdGUoZGF0YTogYW55W10sIGNvbHVtbkF0dHI6IHN0cmluZywgb3BlcmF0b3I6IHN0cmluZyB8IEZ1bmN0aW9uKTogYW55IHtcbiAgICBsZXQgcmVzdWx0QWdncmVnYXRlO1xuICAgIGlmICh0eXBlb2Ygb3BlcmF0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICBzd2l0Y2ggKG9wZXJhdG9yLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSAnY291bnQnOlxuICAgICAgICAgIHJlc3VsdEFnZ3JlZ2F0ZSA9IHRoaXMuY291bnQoY29sdW1uQXR0ciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21pbic6XG4gICAgICAgICAgcmVzdWx0QWdncmVnYXRlID0gdGhpcy5taW4oY29sdW1uQXR0ciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21heCc6XG4gICAgICAgICAgcmVzdWx0QWdncmVnYXRlID0gdGhpcy5tYXgoY29sdW1uQXR0ciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2F2Zyc6XG4gICAgICAgICAgcmVzdWx0QWdncmVnYXRlID0gdGhpcy5hdmcoY29sdW1uQXR0ciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmVzdWx0QWdncmVnYXRlID0gdGhpcy5zdW0oY29sdW1uQXR0ciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvbHVtbkRhdGE6IGFueVtdID0gdGhpcy5nZXRDb2x1bW5EYXRhKGNvbHVtbkF0dHIpO1xuICAgICAgaWYgKHR5cGVvZiBvcGVyYXRvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXN1bHRBZ2dyZWdhdGUgPSBvcGVyYXRvcihjb2x1bW5EYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdEFnZ3JlZ2F0ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzdW0oY29sdW1uLCBkYXRhKTogbnVtYmVyIHtcbiAgICBsZXQgdmFsdWUgPSAwO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICAvL0lmIHRoZSBkYXRhIGlzIGdyb3VwZWQsIHRoZSB2YWx1ZXMg4oCL4oCLb2YgdGhlIHN1Ymdyb3VwcyBpbiBsZXZlbCAxIGFyZSBzdW1tZWRcbiAgICAgIGlmIChkYXRhWzBdIGluc3RhbmNlb2YgT1RhYmxlR3JvdXBlZFJvdykge1xuICAgICAgICB0aGlzLmdldERhdGFGcm9tRmlyc3RMZXZlbFRhYmxlR3JvdXBSb3coZGF0YSkuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgICB2YWx1ZSA9IHguZ2V0Q29sdW1uQWdncmVnYXRlRGF0YShjb2x1bW4pLnJlZHVjZSgoYWN1bXVsYXRvciwgY3VycmVudFZhbHVlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYWN1bXVsYXRvciArIChpc05hTihjdXJyZW50VmFsdWVbY29sdW1uXSkgPyAwIDogY3VycmVudFZhbHVlW2NvbHVtbl0pO1xuICAgICAgICAgIH0sIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9IGRhdGEucmVkdWNlKChhY3VtdWxhdG9yLCBjdXJyZW50VmFsdWUpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWN1bXVsYXRvciArIChpc05hTihjdXJyZW50VmFsdWVbY29sdW1uXSkgPyAwIDogY3VycmVudFZhbHVlW2NvbHVtbl0pO1xuICAgICAgICB9LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiArKHZhbHVlKS50b0ZpeGVkKDIpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNvdW50KGNvbHVtbiwgZGF0YSk6IG51bWJlciB7XG4gICAgbGV0IHZhbHVlID0gMDtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgLy9JZiB0aGUgZGF0YSBpcyBncm91cGVkLCB0aGUgY291bnQgaXMgY2FsY3VsYXRlZCBieSBhZGRpbmcgdGhlIGNvdW50cyBmb3IgZWFjaCBzdWJncm91cCBpbiBsZXZlbCAxXG4gICAgICBpZiAoZGF0YVswXSBpbnN0YW5jZW9mIE9UYWJsZUdyb3VwZWRSb3cpIHtcbiAgICAgICAgdGhpcy5nZXREYXRhRnJvbUZpcnN0TGV2ZWxUYWJsZUdyb3VwUm93KGRhdGEpLmZvckVhY2goeCA9PiB7XG4gICAgICAgICAgdmFsdWUgPSB4LmdldENvbHVtbkFnZ3JlZ2F0ZURhdGEoY29sdW1uKS5yZWR1Y2UoKGFjdW11bGF0b3IpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBhY3VtdWxhdG9yICsgMTtcbiAgICAgICAgICB9LCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSBkYXRhLnJlZHVjZSgoYWN1bXVsYXRvcikgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3VtdWxhdG9yICsgMTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhdmcoY29sdW1uLCBkYXRhKTogbnVtYmVyIHtcbiAgICBjb25zdCB0b3RhbFN1bSA9IHRoaXMuc3VtKGNvbHVtbiwgZGF0YSk7XG4gICAgY29uc3QgdG90YWxDb3VudCA9IHRoaXMuY291bnQoY29sdW1uLCBkYXRhKTtcbiAgICByZXR1cm4gKygodG90YWxTdW0gPT09IDAgfHwgdG90YWxDb3VudCA9PT0gMCkgPyAwIDogKHRvdGFsU3VtIC8gdG90YWxDb3VudCkpLnRvRml4ZWQoMik7XG5cbiAgfVxuXG4gIHByb3RlY3RlZCBtaW4oY29sdW1uLCBkYXRhKTogbnVtYmVyIHtcbiAgICBsZXQgdGVtcE1pbiA9IFtdO1xuICAgIC8vSWYgdGhlIGRhdGEgaXMgZ3JvdXBlZCwgdGhlIG1pbmltdW0gaXMgY2FsY3VsYXRlZCB3aXRoIHRoZSBtaW5pbXVtIG9mIGVhY2ggc3ViZ3JvdXAgaW4gbGV2ZWwgMVxuICAgIGlmIChkYXRhWzBdIGluc3RhbmNlb2YgT1RhYmxlR3JvdXBlZFJvdykge1xuICAgICAgdGVtcE1pbiA9IHRoaXMuZ2V0RGF0YUZyb21GaXJzdExldmVsVGFibGVHcm91cFJvdyhkYXRhKS5tYXAoeCA9PiB7XG4gICAgICAgIHJldHVybiBNYXRoLm1pbiguLi54LmdldENvbHVtbkFnZ3JlZ2F0ZURhdGEoY29sdW1uKS5tYXAoeCA9PiB4W2NvbHVtbl0pKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZW1wTWluID0gZGF0YS5tYXAoeCA9PiB4W2NvbHVtbl0pO1xuICAgIH1cblxuICAgIHJldHVybiB0ZW1wTWluLmxlbmd0aCA+IDAgPyBNYXRoLm1pbiguLi50ZW1wTWluKSA6IDA7XG4gIH1cblxuICBwcm90ZWN0ZWQgbWF4KGNvbHVtbiwgZGF0YSk6IG51bWJlciB7XG4gICAgbGV0IHRlbXBNYXggPSBbXTtcbiAgICBpZiAoZGF0YVswXSBpbnN0YW5jZW9mIE9UYWJsZUdyb3VwZWRSb3cpIHtcbiAgICAgIC8vSWYgdGhlIGRhdGEgYXJlIGdyb3VwZWQsIHRoZSBtYXhpbXVtIGlzIGNhbGN1bGF0ZWQgd2l0aCB0aGUgbWF4aW11bSBvZiBlYWNoIHN1Ymdyb3VwIGluIGxldmVsIDFcbiAgICAgIHRlbXBNYXggPSB0aGlzLmdldERhdGFGcm9tRmlyc3RMZXZlbFRhYmxlR3JvdXBSb3coZGF0YSkubWFwKHggPT4ge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoLi4ueC5nZXRDb2x1bW5BZ2dyZWdhdGVEYXRhKGNvbHVtbikubWFwKHggPT4geFtjb2x1bW5dKSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGVtcE1heCA9IGRhdGEubWFwKHggPT4geFtjb2x1bW5dKTtcbiAgICB9XG4gICAgcmV0dXJuIHRlbXBNYXgubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnRlbXBNYXgpIDogMDtcbiAgfVxuXG4gIHByaXZhdGUgaXNGaXJzdExldmVsVGFibGVHcm91cFJvdyh0YWJsZVJvd0dyb3VwRGF0YTogYW55KSB7XG4gICAgcmV0dXJuIHRhYmxlUm93R3JvdXBEYXRhIGluc3RhbmNlb2YgT1RhYmxlR3JvdXBlZFJvdyAmJiB0YWJsZVJvd0dyb3VwRGF0YS5sZXZlbCA9PT0gMTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF0YUZyb21GaXJzdExldmVsVGFibGVHcm91cFJvdyhkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gZGF0YS5maWx0ZXIoeCA9PiB0aGlzLmlzRmlyc3RMZXZlbFRhYmxlR3JvdXBSb3coeCkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGV4aXN0c0FueUNhbGN1bGF0ZWRDb2x1bW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3RhYmxlT3B0aW9ucy5jb2x1bW5zLmZpbmQoKG9Db2w6IE9Db2x1bW4pID0+IG9Db2wuY2FsY3VsYXRlICE9PSB1bmRlZmluZWQpICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICB1cGRhdGVSZW5kZXJlZFJvd0RhdGEocm93RGF0YTogYW55KSB7XG4gICAgY29uc3QgdGFibGVLZXlzID0gdGhpcy50YWJsZS5nZXRLZXlzKCk7XG4gICAgY29uc3QgcmVjb3JkID0gdGhpcy5yZW5kZXJlZERhdGEuZmluZCgoZGF0YTogYW55KSA9PiB7XG4gICAgICBsZXQgZm91bmQgPSB0cnVlO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRhYmxlS2V5cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBjb25zdCBrZXkgPSB0YWJsZUtleXNbaV07XG4gICAgICAgIGlmIChkYXRhW2tleV0gIT09IHJvd0RhdGFba2V5XSkge1xuICAgICAgICAgIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmb3VuZDtcbiAgICB9KTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQocmVjb3JkKSkge1xuICAgICAgT2JqZWN0LmFzc2lnbihyZWNvcmQsIHJvd0RhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF0YUluZm9ybWF0aW9uQnlHcm91cChkYXRhOiBhbnlbXSwgbGV2ZWw6IG51bWJlcikge1xuICAgIGNvbnN0IHJlY29yZEhhc2ggPSB7fTtcbiAgICBkYXRhLmZvckVhY2goKHJvdywgaSkgPT4ge1xuICAgICAgY29uc3Qga2V5cyA9IHt9O1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbGV2ZWw7IGkrKykge1xuICAgICAgICBrZXlzW3RoaXMudGFibGUuZ3JvdXBlZENvbHVtbnNBcnJheVtpXV0gPSB0aGlzLnRhYmxlLmdldENvbHVtbkRhdGFCeUF0dHIodGhpcy50YWJsZS5ncm91cGVkQ29sdW1uc0FycmF5W2ldLCByb3cpO1xuICAgICAgfVxuICAgICAgY29uc3QgcmVjb3JkS2V5ID0gSlNPTi5zdHJpbmdpZnkoa2V5cyk7XG4gICAgICBpZiAocmVjb3JkSGFzaC5oYXNPd25Qcm9wZXJ0eShyZWNvcmRLZXkpKSB7XG4gICAgICAgIHJlY29yZEhhc2hbcmVjb3JkS2V5XS5wdXNoKGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVjb3JkSGFzaFtyZWNvcmRLZXldID0gW2ldO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZWNvcmRIYXNoO1xuICB9XG5cbiAgcHJpdmF0ZSByZWNhbGN1bGF0ZUNvbHVtbkFnZ3JlZ2F0ZShjb2x1bW5BdHRyOiBzdHJpbmcsIHJvdzogT1RhYmxlR3JvdXBlZFJvdykge1xuICAgIGNvbnN0IGFnZ3JlZ2F0ZUNvbmYgPSByb3cuZ2V0QWN0aXZlQ29sdW1uQWdncmVnYXRlQ29uZmlndXJhdGlvbihjb2x1bW5BdHRyKTtcbiAgICBjb25zdCBkYXRhID0gcm93LmdldENvbHVtbkFnZ3JlZ2F0ZURhdGEoY29sdW1uQXR0cik7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmNhbGN1bGF0ZUFnZ3JlZ2F0ZShkYXRhLCBhZ2dyZWdhdGVDb25mLmF0dHIsIGFnZ3JlZ2F0ZUNvbmYuYWdncmVnYXRlRnVuY3Rpb24gfHwgYWdncmVnYXRlQ29uZi5hZ2dyZWdhdGUpO1xuICAgIHJvdy5zZXRDb2x1bW5BZ2dyZWdhdGVWYWx1ZShjb2x1bW5BdHRyLCB2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGdldFN1YmxldmVsKGRhdGE6IGFueVtdLCBsZXZlbDogbnVtYmVyLCBwYXJlbnQ/OiBPVGFibGVHcm91cGVkUm93KTogYW55W10ge1xuICAgIGlmIChsZXZlbCA+PSB0aGlzLnRhYmxlLmdyb3VwZWRDb2x1bW5zQXJyYXkubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgY29uc3QgcmVjb3JkSGFzaCA9IHRoaXMuZ2V0RGF0YUluZm9ybWF0aW9uQnlHcm91cChkYXRhLCBsZXZlbCk7XG5cbiAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgT2JqZWN0LmtleXMocmVjb3JkSGFzaCkuZm9yRWFjaChyZWNvcmRLZXkgPT4ge1xuXG4gICAgICBjb25zdCByb3cgPSBuZXcgT1RhYmxlR3JvdXBlZFJvdyh7XG4gICAgICAgIGNvbHVtbjogdGhpcy50YWJsZS5ncm91cGVkQ29sdW1uc0FycmF5W2xldmVsXSxcbiAgICAgICAga2V5c0FzU3RyaW5nOiByZWNvcmRLZXksXG4gICAgICAgIGxldmVsOiBsZXZlbCArIDEsXG4gICAgICAgIHBhcmVudDogcGFyZW50XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5ncm91cGVkUm93c1N1YnNjcmlwdGlvbi5hZGQocm93LmFnZ3JlZ2F0ZUZ1bmN0aW9uQ2hhbmdlLnN1YnNjcmliZShhcmcgPT4ge1xuICAgICAgICBpZiAoYXJnLmNoYW5nZUFsbEdyb3VwZWRSb3dzKSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVBZ2dyZWdhdGVzW2FyZy5jb2x1bW5BdHRyXSA9IGFyZy5hY3RpdmVBZ2dyZWdhdGU7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlZERhdGEuZmlsdGVyKHJvdyA9PiByb3cgaW5zdGFuY2VvZiBPVGFibGVHcm91cGVkUm93KS5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICAgICAgICByb3cuc2V0Q29sdW1uQWN0aXZlQWdncmVnYXRlRnVuY3Rpb24oYXJnLmNvbHVtbkF0dHIsIGFyZy5hY3RpdmVBZ2dyZWdhdGUsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMucmVjYWxjdWxhdGVDb2x1bW5BZ2dyZWdhdGUoYXJnLmNvbHVtbkF0dHIsIHJvdyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5yZWNhbGN1bGF0ZUNvbHVtbkFnZ3JlZ2F0ZShhcmcuY29sdW1uQXR0ciwgYXJnLnJvdyk7XG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICAgIGNvbnN0IGFmZmVjdGVkSW5kZXhlcyA9IHJlY29yZEhhc2hbcm93LmtleXNBc1N0cmluZ107XG4gICAgICBjb25zdCBncm91cERhdGEgPSBkYXRhLmZpbHRlcigocm93LCBpbmRleCkgPT4gYWZmZWN0ZWRJbmRleGVzLmluY2x1ZGVzKGluZGV4KSk7XG4gICAgICB0aGlzLnRhYmxlLnZpc2libGVDb2xBcnJheS5mb3JFYWNoKChjb2x1bW5BdHRyLCBpKSA9PiB7XG4gICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgcm93LnRpdGxlID0gdGhpcy5nZXRUZXh0R3JvdXBSb3cocm93LCBhZmZlY3RlZEluZGV4ZXMubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1c2VDb2x1bW5BZ2dyZWdhdGUgPSB0aGlzLnRhYmxlLnVzZUNvbHVtbkdyb3VwaW5nQWdncmVnYXRlKGNvbHVtbkF0dHIpO1xuICAgICAgICBpZiAodXNlQ29sdW1uQWdncmVnYXRlKSB7XG4gICAgICAgICAgcm93LmluaXRpYWxpemVDb2x1bW5BZ2dyZWdhdGUoY29sdW1uQXR0ciwgdGhpcy50YWJsZS5nZXRDb2x1bW5Hcm91cGluZ0NvbXBvbmVudChjb2x1bW5BdHRyKSk7XG5cbiAgICAgICAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5hY3RpdmVBZ2dyZWdhdGVzW2NvbHVtbkF0dHJdKSkge1xuICAgICAgICAgICAgcm93LnNldENvbHVtbkFjdGl2ZUFnZ3JlZ2F0ZUZ1bmN0aW9uKGNvbHVtbkF0dHIsIHRoaXMuYWN0aXZlQWdncmVnYXRlc1tjb2x1bW5BdHRyXSwgZmFsc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyb3cuaGFzQWN0aXZlQWdncmVnYXRlKGNvbHVtbkF0dHIpKSB7XG4gICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGVEYXRhID0gZ3JvdXBEYXRhLm1hcCh4ID0+IHsgY29uc3Qgb2JqID0ge307IG9ialtjb2x1bW5BdHRyXSA9IHhbY29sdW1uQXR0cl07IHJldHVybiBvYmo7IH0pO1xuICAgICAgICAgICAgcm93LnNldENvbHVtbkFnZ3JlZ2F0ZURhdGEoY29sdW1uQXR0ciwgYWdncmVnYXRlRGF0YSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFnZ3JlZ2F0ZUNvbmYgPSByb3cuZ2V0QWN0aXZlQ29sdW1uQWdncmVnYXRlQ29uZmlndXJhdGlvbihjb2x1bW5BdHRyKTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jYWxjdWxhdGVBZ2dyZWdhdGUoYWdncmVnYXRlRGF0YSwgYWdncmVnYXRlQ29uZi5hdHRyLCBhZ2dyZWdhdGVDb25mLmFnZ3JlZ2F0ZUZ1bmN0aW9uIHx8IGFnZ3JlZ2F0ZUNvbmYuYWdncmVnYXRlKTtcbiAgICAgICAgICAgIHJvdy5zZXRDb2x1bW5BZ2dyZWdhdGVWYWx1ZShjb2x1bW5BdHRyLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJvdy5leHBhbmRlZCA9IHRoaXMuZ2V0RXhwYW5zaW9uU3RhdGUocm93KTtcbiAgICAgIGNvbnN0IHN1Ykdyb3VwID0gdGhpcy5nZXRTdWJsZXZlbChncm91cERhdGEsIGxldmVsICsgMSwgcm93KTtcbiAgICAgIHN1Ykdyb3VwLnVuc2hpZnQocm93KTtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoc3ViR3JvdXApO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVycyBjb2xsYXBzZWQgcm93IGdyb3VwXG4gICAqIEBwYXJhbSBkYXRhXG4gICAqIEByZXR1cm5zIGNvbGxhcHNlZCByb3cgZ3JvdXBcbiAgICovXG4gIGZpbHRlckNvbGxhcHNlZFJvd0dyb3VwKGRhdGE6IGFueSk6IGFueVtdIHtcbiAgICByZXR1cm4gZGF0YS5maWx0ZXIoKHJvdzogYW55KSA9PiAocm93IGluc3RhbmNlb2YgT1RhYmxlR3JvdXBlZFJvdykgPyByb3cudmlzaWJsZSA6IHRoaXMuYmVsb25nc1RvRXhwYW5kZWRHcm91cGVkUm93KGRhdGEsIHJvdykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJlbG9uZ3MgdG8gYW4gZXhwYW5kZWQgZ3JvdXBlZCByb3dcbiAgICogQHBhcmFtIGRhdGFcbiAgICogQHBhcmFtIHJvd1xuICAgKiBAcmV0dXJucyB0cnVlIGlmIHRvIGV4cGFuZGVkIGdyb3VwZWQgcm93XG4gICAqL1xuICBiZWxvbmdzVG9FeHBhbmRlZEdyb3VwZWRSb3coZGF0YTogYW55LCByb3c6IGFueSk6IGJvb2xlYW4ge1xuICAgIGxldCBwYXJlbnQ6IE9UYWJsZUdyb3VwZWRSb3c7XG4gICAgbGV0IG1hdGNoID0gZmFsc2U7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGRhdGEubGVuZ3RoICYmICFtYXRjaDsgaW5kZXgrKykge1xuICAgICAgaWYgKGRhdGFbaW5kZXhdIGluc3RhbmNlb2YgT1RhYmxlR3JvdXBlZFJvdykge1xuICAgICAgICBwYXJlbnQgPSBkYXRhW2luZGV4XTtcbiAgICAgIH0gZWxzZSBpZiAoVXRpbC5pc0VxdWl2YWxlbnQoZGF0YVtpbmRleF0sIHJvdykpIHtcbiAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gVXRpbC5pc0RlZmluZWQocGFyZW50KSA/IChwYXJlbnQudmlzaWJsZSAmJiBwYXJlbnQuZXhwYW5kZWQpIDogdHJ1ZTtcbiAgfVxuXG4gIHVwZGF0ZUdyb3VwZWRDb2x1bW5zKCkge1xuICAgIHRoaXMuZ3JvdXBCeUNvbHVtbkNoYW5nZS5uZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlcyBncm91cCBieSBjb2x1bW5cbiAgICogQHBhcmFtIHJvd0dyb3VwXG4gICAqL1xuICB0b2dnbGVHcm91cEJ5Q29sdW1uKHJvd0dyb3VwOiBPVGFibGVHcm91cGVkUm93KSB7XG4gICAgaWYgKHJvd0dyb3VwLmV4cGFuZFNhbWVMZXZlbCh0aGlzLnRhYmxlLmV4cGFuZEdyb3Vwc1NhbWVMZXZlbCkpIHtcbiAgICAgIHRoaXMubGV2ZWxzRXhwYW5zaW9uU3RhdGVbcm93R3JvdXAubGV2ZWxdID0gIXJvd0dyb3VwLmV4cGFuZGVkO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlUm93R3JvdXBlZChyb3dHcm91cCk7XG4gICAgfVxuICAgIHRoaXMuZ3JvdXBCeUNvbHVtbkNoYW5nZS5uZXh0KCk7XG4gIH1cblxuICBzZXRSb3dHcm91cExldmVsRXhwYW5zaW9uKHJvd0dyb3VwOiBPVGFibGVHcm91cGVkUm93LCB2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMubGV2ZWxzRXhwYW5zaW9uU3RhdGVbcm93R3JvdXAubGV2ZWxdID0gdmFsdWU7XG4gICAgdGhpcy5ncm91cEJ5Q29sdW1uQ2hhbmdlLm5leHQoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU3RhdGVSb3dHcm91cGVkKHJvd0dyb3VwOiBPVGFibGVHcm91cGVkUm93KSB7XG4gICAgY29uc3Qgc3RhdGVSb3dHcm91cGVkID0gdGhpcy5ncm91cGVkUm93U3RhdGUuZmluZChyb3cgPT4gcm93R3JvdXAua2V5c0FzU3RyaW5nID09PSByb3cua2V5c0FzU3RyaW5nICYmIEpTT04uc3RyaW5naWZ5KHJvd0dyb3VwLnBhcmVudCkgPT09IEpTT04uc3RyaW5naWZ5KHJvdy5wYXJlbnQpKTtcbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoc3RhdGVSb3dHcm91cGVkKSkge1xuICAgICAgc3RhdGVSb3dHcm91cGVkLmV4cGFuZGVkID0gIXN0YXRlUm93R3JvdXBlZC5leHBhbmRlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcm93R3JvdXAuZXhwYW5kZWQgPSAhcm93R3JvdXAuZXhwYW5kZWQ7XG4gICAgICB0aGlzLmdyb3VwZWRSb3dTdGF0ZS5wdXNoKHJvd0dyb3VwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFRleHRHcm91cFJvdyhncm91cDogT1RhYmxlR3JvdXBlZFJvdywgdG90YWxDb3VudHM6IG51bWJlcikge1xuICAgIGNvbnN0IGZpZWxkID0gdGhpcy50YWJsZS5ncm91cGVkQ29sdW1uc0FycmF5W2dyb3VwLmxldmVsIC0gMV07XG4gICAgbGV0IHZhbHVlID0gSlNPTi5wYXJzZShncm91cC5rZXlzQXNTdHJpbmcpW3RoaXMudGFibGUuZ3JvdXBlZENvbHVtbnNBcnJheVtncm91cC5sZXZlbCAtIDFdXTtcblxuICAgIGNvbnN0IG9Db2wgPSB0aGlzLnRhYmxlLmdldE9Db2x1bW4oZmllbGQpO1xuXG4gICAgaWYgKCF2YWx1ZSAmJiBVdGlsLmlzRGVmaW5lZChvQ29sLnJlbmRlcmVyKSAmJiAodGhpcy50YWJsZSBhcyBhbnkpLmlzSW5zdGFuY2VPZk9UYWJsZUNlbGxSZW5kZXJlclNlcnZpY2VDb21wb25lbnQob0NvbC5yZW5kZXJlcikpIHtcbiAgICAgIHZhbHVlID0gJyAtICc7XG4gICAgICBpZiAoIXRoaXMudGFibGUub25EYXRhTG9hZGVkQ2VsbFJlbmRlcmVyU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgIHRoaXMudGFibGUub25EYXRhTG9hZGVkQ2VsbFJlbmRlcmVyU3Vic2NyaXB0aW9uID0gKG9Db2wucmVuZGVyZXIgYXMgYW55KS5vbkRhdGFMb2FkZWQuc3Vic2NyaWJlKHggPT4ge1xuICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBlZENvbHVtbnMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAodGhpcy50YWJsZSBhcyBhbnkpLnRyYW5zbGF0ZVNlcnZpY2UuZ2V0KG9Db2wudGl0bGUpICsgJzogJyArIHZhbHVlICsgJyAoJyArIHRvdGFsQ291bnRzICsgJyknO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeHBhbnNpb25TdGF0ZShyb3c6IE9UYWJsZUdyb3VwZWRSb3cpOiBib29sZWFuIHtcbiAgICBsZXQgZXhwYW5zaW9uU3RhdGUgPSAhcGFyZW50IHx8ICF0aGlzLnRhYmxlLmNvbGxhcHNlR3JvdXBlZENvbHVtbnM7XG4gICAgaWYgKHJvdy5leHBhbmRTYW1lTGV2ZWwodGhpcy50YWJsZS5leHBhbmRHcm91cHNTYW1lTGV2ZWwpKSB7XG4gICAgICBleHBhbnNpb25TdGF0ZSA9IHRoaXMubGV2ZWxzRXhwYW5zaW9uU3RhdGUuaGFzT3duUHJvcGVydHkocm93LmxldmVsKSA/IHRoaXMubGV2ZWxzRXhwYW5zaW9uU3RhdGVbcm93LmxldmVsXSA6IGV4cGFuc2lvblN0YXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByb3dHcm91cCA9IHRoaXMuZ3JvdXBlZFJvd1N0YXRlLmZpbmQoeCA9PiB4LmtleXNBc1N0cmluZyA9PT0gcm93LmtleXNBc1N0cmluZyAmJiBKU09OLnN0cmluZ2lmeSh4LnBhcmVudCkgPT09IEpTT04uc3RyaW5naWZ5KHJvdy5wYXJlbnQpKTtcbiAgICAgIGV4cGFuc2lvblN0YXRlID0gcm93R3JvdXAgPyByb3dHcm91cC5leHBhbmRlZCA6IGV4cGFuc2lvblN0YXRlO1xuICAgIH1cbiAgICByZXR1cm4gZXhwYW5zaW9uU3RhdGU7XG4gIH1cbn1cblxuXG5cbiJdfQ==