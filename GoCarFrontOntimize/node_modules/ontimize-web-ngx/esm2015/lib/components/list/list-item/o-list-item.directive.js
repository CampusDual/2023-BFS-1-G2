import { Directive, ElementRef, EventEmitter, HostListener, Input, Renderer2, ViewContainerRef } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { Subscription } from 'rxjs';
import { instanceOfIListItem } from '../../../interfaces/o-list-item.interface';
import { Codes } from '../../../util/codes';
import { Util } from '../../../util/util';
export class OListItemDirective {
    constructor(_viewContainerRef, _el, renderer, actRoute) {
        this._viewContainerRef = _viewContainerRef;
        this._el = _el;
        this.renderer = renderer;
        this.actRoute = actRoute;
        this.onClick = new EventEmitter();
        this.onDoubleClick = new EventEmitter();
        this.selectable = false;
        this.subscription = new Subscription();
    }
    ngOnInit() {
        const hostComponent = this._viewContainerRef["_data"].componentView.component;
        if (instanceOfIListItem(hostComponent)) {
            this.listItem = hostComponent;
        }
        this.subscription.add(this.actRoute.params.subscribe(params => this.updateActiveState(params)));
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    onMouseEnter() {
        if (!this.selectable && this._list && this._list.detailMode !== Codes.DETAIL_MODE_NONE) {
            this.renderer.setStyle(this._el.nativeElement, 'cursor', 'pointer');
        }
    }
    updateActiveState(params) {
        if (this._list) {
            const aKeys = this._list.getKeys();
            if (this.modelData) {
                let _act = false;
                if (aKeys.length > 0) {
                    for (let k = 0; k < aKeys.length; ++k) {
                        const key = aKeys[k];
                        const id = params[key];
                        _act = (this.modelData[key] === id);
                        if (_act === false) {
                            break;
                        }
                    }
                }
                if (_act) {
                    this._el.nativeElement.classList.add('mat-active');
                }
                else {
                    this._el.nativeElement.classList.remove('mat-active');
                }
            }
            else {
                this._el.nativeElement.classList.remove('mat-active');
            }
        }
    }
    onItemClicked(e) {
        if (!this.selectable && this._list) {
            this._list.onItemDetailClick(this);
            this.onClick.emit(this.getItemData());
        }
    }
    onItemDoubleClicked(e) {
        if (!this.selectable && this._list) {
            this._list.onItemDetailDoubleClick(this);
            this.onDoubleClick.emit(this.getItemData());
        }
    }
    isSelected() {
        return this._list && this._list.isItemSelected(this.modelData);
    }
    setListComponent(list) {
        this._list = list;
    }
    setItemData(data) {
        if (!Util.isDefined(this.modelData) || this.modelData !== 'object') {
            this.modelData = data;
        }
        if (Util.isDefined(this.listItem)) {
            this.listItem.setItemData(this.modelData);
        }
    }
    getItemData() {
        return this.modelData;
    }
}
OListItemDirective.decorators = [
    { type: Directive, args: [{
                selector: 'o-list-item, mat-list-item[o-list-item], mat-card[o-list-item]',
                exportAs: 'olistitem',
                host: {
                    '[class.o-list-item]': 'true',
                    '(click)': 'onItemClicked($event)',
                    '(dblclick)': 'onItemDoubleClicked($event)'
                }
            },] }
];
OListItemDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ElementRef },
    { type: Renderer2 },
    { type: ActivatedRoute }
];
OListItemDirective.propDecorators = {
    modelData: [{ type: Input, args: ['o-list-item',] }],
    selectable: [{ type: Input }],
    onMouseEnter: [{ type: HostListener, args: ['mouseenter',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1saXN0LWl0ZW0uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpc3QvbGlzdC1pdGVtL28tbGlzdC1pdGVtLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osWUFBWSxFQUNaLEtBQUssRUFHTCxTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXBDLE9BQU8sRUFBYSxtQkFBbUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBRTNGLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFXMUMsTUFBTSxPQUFPLGtCQUFrQjtJQWU3QixZQUNVLGlCQUFtQyxFQUNwQyxHQUFlLEVBQ2QsUUFBbUIsRUFDcEIsUUFBd0I7UUFIdkIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFrQjtRQUNwQyxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ2QsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNwQixhQUFRLEdBQVIsUUFBUSxDQUFnQjtRQWpCMUIsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hELGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFNdEQsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUl6QixpQkFBWSxHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO0lBT3RELENBQUM7SUFFRSxRQUFRO1FBQ2IsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLGFB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LEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVNLGdCQUFnQixDQUFDLElBQVc7UUFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDcEIsQ0FBQztJQUVNLFdBQVcsQ0FBQyxJQUFTO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLFFBQVEsRUFBRTtZQUNsRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztTQUN2QjtRQUNELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztJQUVNLFdBQVc7UUFDaEIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hCLENBQUM7OztZQTdHRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGdFQUFnRTtnQkFDMUUsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLElBQUksRUFBRTtvQkFDSixxQkFBcUIsRUFBRSxNQUFNO29CQUM3QixTQUFTLEVBQUUsdUJBQXVCO29CQUNsQyxZQUFZLEVBQUUsNkJBQTZCO2lCQUM1QzthQUNGOzs7WUFsQkMsZ0JBQWdCO1lBUGhCLFVBQVU7WUFNVixTQUFTO1lBR0YsY0FBYzs7O3dCQXNCcEIsS0FBSyxTQUFDLGFBQWE7eUJBR25CLEtBQUs7MkJBMEJMLFlBQVksU0FBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDb250YWluZXJSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgSUxpc3RJdGVtLCBpbnN0YW5jZU9mSUxpc3RJdGVtIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9vLWxpc3QtaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSUxpc3QgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL28tbGlzdC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ29kZXMgfSBmcm9tICcuLi8uLi8uLi91dGlsL2NvZGVzJztcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi8uLi8uLi91dGlsL3V0aWwnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdvLWxpc3QtaXRlbSwgbWF0LWxpc3QtaXRlbVtvLWxpc3QtaXRlbV0sIG1hdC1jYXJkW28tbGlzdC1pdGVtXScsXG4gIGV4cG9ydEFzOiAnb2xpc3RpdGVtJyxcbiAgaG9zdDoge1xuICAgICdbY2xhc3Muby1saXN0LWl0ZW1dJzogJ3RydWUnLFxuICAgICcoY2xpY2spJzogJ29uSXRlbUNsaWNrZWQoJGV2ZW50KScsXG4gICAgJyhkYmxjbGljayknOiAnb25JdGVtRG91YmxlQ2xpY2tlZCgkZXZlbnQpJ1xuICB9XG59KVxuZXhwb3J0IGNsYXNzIE9MaXN0SXRlbURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBwdWJsaWMgb25DbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHB1YmxpYyBvbkRvdWJsZUNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBASW5wdXQoJ28tbGlzdC1pdGVtJylcbiAgcHVibGljIG1vZGVsRGF0YTogYW55O1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZWxlY3RhYmxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJvdGVjdGVkIF9saXN0OiBJTGlzdDtcbiAgcHJvdGVjdGVkIGxpc3RJdGVtOiBJTGlzdEl0ZW07XG4gIHByb3RlY3RlZCBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF92aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHB1YmxpYyBfZWw6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHB1YmxpYyBhY3RSb3V0ZTogQWN0aXZhdGVkUm91dGVcbiAgKSB7IH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgaG9zdENvbXBvbmVudCA9IHRoaXMuX3ZpZXdDb250YWluZXJSZWZbXCJfZGF0YVwiXS5jb21wb25lbnRWaWV3LmNvbXBvbmVudDtcbiAgICBpZiAoaW5zdGFuY2VPZklMaXN0SXRlbShob3N0Q29tcG9uZW50KSkge1xuICAgICAgdGhpcy5saXN0SXRlbSA9IGhvc3RDb21wb25lbnRcbiAgICB9XG4gICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKHRoaXMuYWN0Um91dGUucGFyYW1zLnN1YnNjcmliZShwYXJhbXMgPT4gdGhpcy51cGRhdGVBY3RpdmVTdGF0ZShwYXJhbXMpKSk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuICBwdWJsaWMgb25Nb3VzZUVudGVyKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5zZWxlY3RhYmxlICYmIHRoaXMuX2xpc3QgJiYgdGhpcy5fbGlzdC5kZXRhaWxNb2RlICE9PSBDb2Rlcy5ERVRBSUxfTU9ERV9OT05FKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQsICdjdXJzb3InLCAncG9pbnRlcicpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVBY3RpdmVTdGF0ZShwYXJhbXMpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fbGlzdCkge1xuICAgICAgY29uc3QgYUtleXMgPSB0aGlzLl9saXN0LmdldEtleXMoKTtcbiAgICAgIGlmICh0aGlzLm1vZGVsRGF0YSkge1xuICAgICAgICBsZXQgX2FjdCA9IGZhbHNlO1xuICAgICAgICBpZiAoYUtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYUtleXMubGVuZ3RoOyArK2spIHtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGFLZXlzW2tdO1xuICAgICAgICAgICAgY29uc3QgaWQgPSBwYXJhbXNba2V5XTtcbiAgICAgICAgICAgIF9hY3QgPSAodGhpcy5tb2RlbERhdGFba2V5XSA9PT0gaWQpO1xuICAgICAgICAgICAgaWYgKF9hY3QgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoX2FjdCkge1xuICAgICAgICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbWF0LWFjdGl2ZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbWF0LWFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ21hdC1hY3RpdmUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25JdGVtQ2xpY2tlZChlPzogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuc2VsZWN0YWJsZSAmJiB0aGlzLl9saXN0KSB7XG4gICAgICB0aGlzLl9saXN0Lm9uSXRlbURldGFpbENsaWNrKHRoaXMpO1xuICAgICAgdGhpcy5vbkNsaWNrLmVtaXQodGhpcy5nZXRJdGVtRGF0YSgpKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbkl0ZW1Eb3VibGVDbGlja2VkKGU/OiBFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5zZWxlY3RhYmxlICYmIHRoaXMuX2xpc3QpIHtcbiAgICAgIHRoaXMuX2xpc3Qub25JdGVtRGV0YWlsRG91YmxlQ2xpY2sodGhpcyk7XG4gICAgICB0aGlzLm9uRG91YmxlQ2xpY2suZW1pdCh0aGlzLmdldEl0ZW1EYXRhKCkpXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGlzU2VsZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2xpc3QgJiYgdGhpcy5fbGlzdC5pc0l0ZW1TZWxlY3RlZCh0aGlzLm1vZGVsRGF0YSk7XG4gIH1cblxuICBwdWJsaWMgc2V0TGlzdENvbXBvbmVudChsaXN0OiBJTGlzdCk6IHZvaWQge1xuICAgIHRoaXMuX2xpc3QgPSBsaXN0O1xuICB9XG5cbiAgcHVibGljIHNldEl0ZW1EYXRhKGRhdGE6IGFueSk6IHZvaWQge1xuICAgIGlmICghVXRpbC5pc0RlZmluZWQodGhpcy5tb2RlbERhdGEpIHx8IHRoaXMubW9kZWxEYXRhICE9PSAnb2JqZWN0Jykge1xuICAgICAgdGhpcy5tb2RlbERhdGEgPSBkYXRhO1xuICAgIH1cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQodGhpcy5saXN0SXRlbSkpIHtcbiAgICAgIHRoaXMubGlzdEl0ZW0uc2V0SXRlbURhdGEodGhpcy5tb2RlbERhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRJdGVtRGF0YSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLm1vZGVsRGF0YTtcbiAgfVxuXG59XG4iXX0=