import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Injector, ViewChild, ViewContainerRef, ViewEncapsulation } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { InputConverter } from '../../../decorators/input-converter';
import { DialogService } from '../../../services/dialog.service';
import { NavigationService } from '../../../services/navigation.service';
import { SnackBarService } from '../../../services/snackbar.service';
import { Codes } from '../../../util/codes';
import { PermissionsUtils } from '../../../util/permissions';
import { Util } from '../../../util/util';
import { OFormComponent } from '../o-form.component';
export const DEFAULT_INPUTS_O_FORM_TOOLBAR = [
    'labelHeader: label-header',
    'labelHeaderAlign: label-header-align',
    'headeractions: header-actions',
    'showHeaderActionsText: show-header-actions-text',
    'showHeaderNavigation:show-header-navigation'
];
export const DEFAULT_OUTPUTS_O_FORM_TOOLBAR = [
    'onCancel'
];
export class OFormToolbarComponent {
    constructor(_form, element, injector) {
        this._form = _form;
        this.element = element;
        this.injector = injector;
        this.labelHeader = '';
        this.headeractions = '';
        this.labelHeaderAlign = 'center';
        this.showHeaderActionsText = true;
        this.showHeaderNavigation = true;
        this.isDetail = true;
        this.editMode = false;
        this.insertMode = false;
        this.initialMode = true;
        this.refreshBtnEnabled = false;
        this.insertBtnEnabled = false;
        this.deleteBtnEnabled = false;
        this.onCancel = new EventEmitter();
        this._changesToSave = false;
        this._editBtnEnabled = false;
        this._saveBtnEnabled = false;
        this.mutationObservers = [];
        this._isSaveBtnEnabledSubject = new BehaviorSubject(false);
        this._isEditBtnEnabledSubject = new BehaviorSubject(false);
        this._existsChangesToSaveSubject = new BehaviorSubject(false);
        this.isSaveBtnEnabled = this._isSaveBtnEnabledSubject.asObservable();
        this.isEditBtnEnabled = this._isEditBtnEnabledSubject.asObservable();
        this.existsChangesToSave = this._existsChangesToSaveSubject.asObservable();
        this._form.registerToolbar(this);
        this._dialogService = this.injector.get(DialogService);
        this._navigationService = this.injector.get(NavigationService);
        this.snackBarService = this.injector.get(SnackBarService);
    }
    get changesToSave() {
        return this._changesToSave;
    }
    set changesToSave(val) {
        this._changesToSave = val;
        const attr = this._form.isEditableDetail() ? PermissionsUtils.ACTION_UPDATE : PermissionsUtils.ACTION_INSERT;
        const permissions = (this.actionsPermissions || []).find(p => p.attr === attr);
        if (Util.isDefined(permissions) && permissions.enabled === false) {
            return;
        }
        this._existsChangesToSaveSubject.next(val);
    }
    get editBtnEnabled() {
        return this._editBtnEnabled;
    }
    set editBtnEnabled(value) {
        this._editBtnEnabled = value;
        this._isEditBtnEnabledSubject.next(this._editBtnEnabled);
    }
    get saveBtnEnabled() {
        return this._saveBtnEnabled;
    }
    set saveBtnEnabled(value) {
        this._saveBtnEnabled = value;
        this._isSaveBtnEnabledSubject.next(this._saveBtnEnabled);
    }
    ngOnInit() {
        this.formActions = Util.parseArray(this.headeractions);
        if (this.formActions && this.formActions.length > 0) {
            this.refreshBtnEnabled = this.formActions.indexOf('R') !== -1;
            this.insertBtnEnabled = this.formActions.indexOf('I') !== -1;
            this.editBtnEnabled = this.formActions.indexOf('U') !== -1;
            this.deleteBtnEnabled = !this.insertMode && this.formActions.indexOf('D') !== -1;
        }
        if (this._navigationService) {
            const self = this;
            this._navigationService.onTitleChange(title => {
                self.labelHeader = title;
            });
        }
        this.includeBreadcrumb = this._form.includeBreadcrumb && this._form.formContainer.breadcrumb;
        if (this.includeBreadcrumb) {
            this._form.formContainer.breadcrumb = false;
        }
    }
    ngOnDestroy() {
        if (this.formCacheSubscription) {
            this.formCacheSubscription.unsubscribe();
        }
        if (this.mutationObservers) {
            this.mutationObservers.forEach((m) => {
                m.disconnect();
            });
        }
    }
    ngAfterViewInit() {
        this.parsePermissions();
        if (this.includeBreadcrumb) {
            this._form.formContainer.createBreadcrumb(this.breadContainer);
        }
    }
    setInitialMode() {
        this.manageEditableDetail();
        this.initialMode = true;
        this.insertMode = false;
        this.editMode = false;
    }
    setInsertMode() {
        this.initialMode = false;
        this.insertMode = true;
        this.editMode = false;
    }
    setEditMode() {
        this.initialMode = false;
        this.insertMode = false;
        this.editMode = true;
    }
    onCloseDetail(options) {
        this._form.executeToolbarAction(Codes.CLOSE_DETAIL_ACTION, Object.assign(options || {}, {
            changeToolbarMode: true
        }));
    }
    onBack(options) {
        this._form.executeToolbarAction(Codes.BACK_ACTION, options);
    }
    onReload() {
        if (!this.checkEnabledPermission(PermissionsUtils.ACTION_REFRESH)) {
            return;
        }
        this._form.showConfirmDiscardChanges().then(val => {
            if (val) {
                this._form.executeToolbarAction(Codes.RELOAD_ACTION, { exitWithoutConfirmation: true });
            }
        });
    }
    onInsert() {
        if (!this.checkEnabledPermission(PermissionsUtils.ACTION_INSERT)) {
            return;
        }
        this._form.executeToolbarAction(Codes.GO_INSERT_ACTION, {
            changeToolbarMode: true
        });
    }
    onEdit() {
        if (!this.checkEnabledPermission(PermissionsUtils.ACTION_UPDATE)) {
            return;
        }
        this._form.executeToolbarAction(Codes.GO_EDIT_ACTION, {
            changeToolbarMode: true
        });
    }
    onDelete() {
        if (!this.checkEnabledPermission(PermissionsUtils.ACTION_DELETE)) {
            return;
        }
        this.showConfirmDelete();
    }
    onSave() {
        if (!this.checkEnabledPermission(PermissionsUtils.ACTION_UPDATE)) {
            return;
        }
        this.handleAcceptEditOperation();
    }
    cancelOperation() {
        this._form.showConfirmDiscardChanges().then(val => {
            if (val) {
                this.editMode = false;
                this.onCancel.emit();
                const closeOptions = { exitWithoutConfirmation: true };
                if (this.isDetail) {
                    this.onCloseDetail(closeOptions);
                }
                else if (this.insertMode) {
                    this.onBack(closeOptions);
                }
                else {
                    this.onReload();
                    this._form.setInitialMode();
                }
            }
        });
    }
    acceptOperation() {
        if (this.editMode) {
            if (!this.checkEnabledPermission(PermissionsUtils.ACTION_UPDATE)) {
                return;
            }
            this.handleAcceptEditOperation();
        }
        else if (this.insertMode) {
            if (!this.checkEnabledPermission(PermissionsUtils.ACTION_INSERT)) {
                return;
            }
            this.handleAcceptInsertOperation();
        }
    }
    handleAcceptInsertOperation() {
        this._form.executeToolbarAction(Codes.INSERT_ACTION);
    }
    handleAcceptEditOperation() {
        this._form.executeToolbarAction(Codes.EDIT_ACTION);
    }
    showConfirmDelete() {
        this._dialogService.confirm(this._form.messageService.getDeleteConfirmationDialogTitle(), this._form.messageService.getDeleteConfirmationMessage()).then(res => {
            if (res) {
                this._form.executeToolbarAction(Codes.DELETE_ACTION).subscribe(resp => {
                    this._form.onDelete.emit(resp);
                    this.onCloseDetail({ exitWithoutConfirmation: true });
                }, err => {
                    console.error('OFormToolbar.delete error', err);
                });
            }
        });
    }
    get showNavigation() {
        return this.showHeaderNavigation && !(this._form.getFormManager() && this._form.getFormManager().isTabMode());
    }
    getLabelHeaderAlign() {
        return this.labelHeaderAlign;
    }
    get showUndoButton() {
        return this._form.undoButton && (!this.initialMode || this._form.isEditableDetail());
    }
    get isChangesStackEmpty() {
        return this._form.isCacheStackEmpty;
    }
    onUndoLastChange() {
        this._form.executeToolbarAction(Codes.UNDO_LAST_CHANGE_ACTION);
    }
    get isRefreshBtnEnabled() {
        return this.refreshBtnEnabled;
    }
    get isInsertBtnEnabled() {
        return this.insertBtnEnabled;
    }
    get isDeleteBtnEnabled() {
        return this.deleteBtnEnabled;
    }
    hasEnabledPermission(permission) {
        return permission ? permission.enabled : true;
    }
    get includeBreadcrumb() {
        return this._includeBreadcrumb;
    }
    set includeBreadcrumb(arg) {
        this._includeBreadcrumb = arg;
    }
    manageEditableDetail() {
        const isEditableDetail = this._form.isEditableDetail();
        const updatePermissions = (this.actionsPermissions || []).find(p => p.attr === PermissionsUtils.ACTION_UPDATE);
        if (this.hasEnabledPermission(updatePermissions)) {
            this.saveBtnEnabled = isEditableDetail;
        }
        this.refreshBtnEnabled = this.refreshBtnEnabled && isEditableDetail;
        this.insertBtnEnabled = this.insertBtnEnabled && isEditableDetail;
        this.editBtnEnabled = this.editBtnEnabled && !isEditableDetail;
        this.formCacheSubscription = this._form.getFormCache().onCacheStateChanges.subscribe((value) => {
            if (this._form.isEditableDetail()) {
                this.changesToSave = this._form.isInitialStateChanged();
            }
        });
    }
    parsePermissions() {
        if (this._form.oattr) {
            this.actionsPermissions = this._form.getActionsPermissions();
            if (!Util.isDefined(this.actionsPermissions)) {
                return;
            }
            const self = this;
            this.actionsPermissions.forEach((permission) => {
                self.permissionManagement(permission);
                if (PermissionsUtils.STANDARD_ACTIONS.indexOf(permission.attr) > -1) {
                    if (permission.attr === PermissionsUtils.ACTION_UPDATE) {
                        self.permissionManagement(permission, 'edit');
                    }
                }
            });
        }
    }
    permissionManagement(permission, attr) {
        const attrAction = Util.isDefined(attr) ? attr : permission.attr;
        const elementByAction = this.element.nativeElement.querySelector('[attr="' + attrAction + '"]');
        if (Util.isDefined(elementByAction)) {
            if (!permission.visible) {
                elementByAction.remove();
            }
            else {
                if (!permission.enabled) {
                    elementByAction.disabled = true;
                    const mutationObserver = PermissionsUtils.registerDisabledChangesInDom(elementByAction);
                    this.mutationObservers.push(mutationObserver);
                }
            }
        }
    }
    checkEnabledPermission(attr) {
        const permissions = (this.actionsPermissions || []).find(p => p.attr === attr);
        const enabledPermision = PermissionsUtils.checkEnabledPermission(permissions);
        if (!enabledPermision) {
            this.snackBarService.open(this._form.messageService.getActionPermissionNotEnabledMessage());
        }
        return enabledPermision;
    }
}
OFormToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'o-form-toolbar',
                template: "<mat-toolbar class=\"o-form-toolbar-header\" [class.breadcrumb]=\"includeBreadcrumb\" fxLayout=\"column\" fxLayoutAlign=\"center center\">\n\n  <ng-template *ngIf=\"includeBreadcrumb\" #breadcrumb></ng-template>\n\n  <div class=\"mat-toolbar-tools\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n    <button type=\"button\" mat-icon-button (click)=\"onBack()\" *ngIf=\"isDetail\" class=\"o-form-toolbar-button o-form-toolbar-back\">\n      <mat-icon svgIcon=\"ontimize:arrow_back\"></mat-icon>\n    </button>\n\n    <o-form-navigation #formNavigation *ngIf=\"showNavigation\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n    </o-form-navigation>\n\n    <span *ngIf=\"getLabelHeaderAlign() === 'center' || getLabelHeaderAlign() === 'end'\" class=\"fill-remaining\"></span>\n    <div *ngIf=\"labelHeader!=''\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\n      <span>{{ labelHeader | oTranslate }}</span>\n    </div>\n    <span *ngIf=\"getLabelHeaderAlign() === 'start' || getLabelHeaderAlign() === 'center'\" class=\"fill-remaining\"></span>\n\n    <ng-content select=\"[o-custom-form-toolbar-buttons-wrapper]\"></ng-content>\n\n    <ng-template [ngIf]=\"showHeaderActionsText\" [ngIfElse]=\"undoBtnWithoutText\">\n      <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-undo\" mat-stroked-button (click)=\"onUndoLastChange()\"\n        [disabled]=\"isChangesStackEmpty\" *ngIf=\"showUndoButton\">\n        <mat-icon svgIcon=\"ontimize:undo\"></mat-icon>\n        <span>{{ 'UNDO' | oTranslate }}</span>\n      </button>\n    </ng-template>\n    <ng-template #undoBtnWithoutText>\n      <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-undo\" mat-icon-button (click)=\"onUndoLastChange()\"\n        [disabled]=\"isChangesStackEmpty\" *ngIf=\"showUndoButton\">\n        <mat-icon svgIcon=\"ontimize:undo\"></mat-icon>\n      </button>\n    </ng-template>\n\n    <ng-container *ngIf=\"initialMode\">\n      <ng-template [ngIf]=\"showHeaderActionsText\" [ngIfElse]=\"buttonsWithouText\">\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-refresh\" mat-stroked-button (click)=\"onReload()\"\n          *ngIf=\"isRefreshBtnEnabled\" attr=\"refresh\">\n          <mat-icon svgIcon=\"ontimize:autorenew\"></mat-icon>\n          <span>{{ 'REFRESH' | oTranslate }}</span>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-insert\" mat-stroked-button (click)=\"onInsert()\"\n          *ngIf=\"isInsertBtnEnabled\" attr=\"insert\">\n          <mat-icon svgIcon=\"ontimize:add\"></mat-icon>\n          <span>{{ 'ADD' | oTranslate }}</span>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-edit\" mat-stroked-button (click)=\"onEdit()\"\n          *ngIf=\"isEditBtnEnabled | async\" attr=\"edit\">\n          <mat-icon svgIcon=\"ontimize:edit\"></mat-icon>\n          <span>{{ 'EDIT' | oTranslate }}</span>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-delete\" mat-stroked-button (click)=\"onDelete()\"\n          *ngIf=\"isDeleteBtnEnabled\" attr=\"delete\">\n          <mat-icon svgIcon=\"ontimize:delete\"></mat-icon>\n          <span>{{ 'DELETE' | oTranslate }}</span>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-save\" mat-stroked-button (click)=\"onSave()\"\n          [disabled]=\"!(existsChangesToSave | async)\" *ngIf=\"isSaveBtnEnabled | async\" attr=\"update\">\n          <mat-icon svgIcon=\"ontimize:save\"></mat-icon>\n          <span>{{ 'SAVE' | oTranslate }}</span>\n        </button>\n      </ng-template>\n      <ng-template #buttonsWithouText>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-refresh\" mat-icon-button (click)=\"onReload()\"\n          *ngIf=\"isRefreshBtnEnabled\" attr=\"refresh\">\n          <mat-icon svgIcon=\"ontimize:autorenew\"></mat-icon>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-insert\" mat-icon-button (click)=\"onInsert()\"\n          *ngIf=\"isInsertBtnEnabled\" attr=\"insert\">\n          <mat-icon svgIcon=\"ontimize:add\"></mat-icon>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button-o-form-toolbar-button-edit\" mat-icon-button (click)=\"onEdit()\"\n          *ngIf=\"isEditBtnEnabled | async\" attr=\"edit\">\n          <mat-icon svgIcon=\"ontimize:edit\"></mat-icon>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-delete\" mat-icon-button (click)=\"onDelete()\"\n          *ngIf=\"isDeleteBtnEnabled\" attr=\"delete\">\n          <mat-icon svgIcon=\"ontimize:delete\"></mat-icon>\n        </button>\n        <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-save\" mat-icon-button (click)=\"onSave()\"\n          [disabled]=\"!existsChangesToSave\" *ngIf=\"isSaveBtnEnabled | async\" attr=\"update\">\n          <mat-icon svgIcon=\"ontimize:save\"></mat-icon>\n        </button>\n      </ng-template>\n    </ng-container>\n\n    <ng-container *ngIf=\"editMode || insertMode\">\n      <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-cancel\" mat-stroked-button (click)=\"cancelOperation()\">\n        <mat-icon svgIcon=\"ontimize:clear\"></mat-icon>\n        <span *ngIf=\"showHeaderActionsText\">{{ 'CANCEL' | oTranslate }}</span>\n      </button>\n      <button type=\"button\" class=\"o-form-toolbar-button o-form-toolbar-button-insert\" mat-stroked-button color=\"primary\" (click)=\"acceptOperation()\">\n        <mat-icon svgIcon=\"ontimize:done\"></mat-icon>\n        <span *ngIf=\"showHeaderActionsText\">{{ 'INSERT' | oTranslate }}</span>\n      </button>\n    </ng-container>\n  </div>\n\n</mat-toolbar>\n",
                inputs: DEFAULT_INPUTS_O_FORM_TOOLBAR,
                outputs: DEFAULT_OUTPUTS_O_FORM_TOOLBAR,
                encapsulation: ViewEncapsulation.None,
                host: {
                    '[class.o-form-toolbar]': 'true'
                },
                styles: [".o-form-toolbar{flex:none;display:block}.o-form-toolbar .o-form-toolbar-header{min-height:50px;max-height:50px;padding:0 16px 0 4px}.o-form-toolbar .o-form-toolbar-header.breadcrumb{padding:16px;min-height:84px;max-height:84px}.o-form-toolbar .o-form-toolbar-header .mat-toolbar-tools{width:100%}.o-form-toolbar .o-form-toolbar-header .mat-toolbar-tools button.o-form-toolbar-button.mat-icon-button.mat-button-base{padding:0;margin:0;background:0 0}.o-form-toolbar .o-form-toolbar-header .o-breadcrumb{width:100%;height:32px;min-height:initial}.o-form-toolbar .o-form-toolbar-header .o-breadcrumb .mat-toolbar{padding:0;min-height:initial;max-height:initial;height:100%}"]
            }] }
];
OFormToolbarComponent.ctorParameters = () => [
    { type: OFormComponent },
    { type: ElementRef },
    { type: Injector }
];
OFormToolbarComponent.propDecorators = {
    breadContainer: [{ type: ViewChild, args: ['breadcrumb', { read: ViewContainerRef, static: false },] }]
};
tslib_1.__decorate([
    InputConverter(),
    tslib_1.__metadata("design:type", Boolean)
], OFormToolbarComponent.prototype, "showHeaderActionsText", void 0);
tslib_1.__decorate([
    InputConverter(),
    tslib_1.__metadata("design:type", Boolean)
], OFormToolbarComponent.prototype, "showHeaderNavigation", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby1mb3JtLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Zvcm0vdG9vbGJhci9vLWZvcm0tdG9vbGJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFxQixTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEssT0FBTyxFQUFFLGVBQWUsRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFFakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUN6RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFckUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzdELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFckQsTUFBTSxDQUFDLE1BQU0sNkJBQTZCLEdBQUc7SUFDM0MsMkJBQTJCO0lBQzNCLHNDQUFzQztJQUN0QywrQkFBK0I7SUFDL0IsaURBQWlEO0lBRWpELDZDQUE2QztDQUM5QyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sOEJBQThCLEdBQUc7SUFDNUMsVUFBVTtDQUNYLENBQUM7QUFhRixNQUFNLE9BQU8scUJBQXFCO0lBZ0ZoQyxZQUNVLEtBQXFCLEVBQ3RCLE9BQW1CLEVBQ2hCLFFB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QThDO2dCQUU5QyxNQUFNLEVBQUUsNkJBQTZCO2dCQUNyQyxPQUFPLEVBQUUsOEJBQThCO2dCQUN2QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtnQkFDckMsSUFBSSxFQUFFO29CQUNKLHdCQUF3QixFQUFFLE1BQU07aUJBQ2pDOzthQUNGOzs7WUF6QlEsY0FBYztZQVhZLFVBQVU7WUFBZ0IsUUFBUTs7OzZCQTJEbEUsU0FBUyxTQUFDLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOztBQWRsRTtJQURDLGNBQWMsRUFBRTs7b0VBQzRCO0FBRTdDO0lBREMsY0FBYyxFQUFFOzttRUFDMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBJbnB1dENvbnZlcnRlciB9IGZyb20gJy4uLy4uLy4uL2RlY29yYXRvcnMvaW5wdXQtY29udmVydGVyJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9kaWFsb2cuc2VydmljZSc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL25hdmlnYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBTbmFja0JhclNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9zbmFja2Jhci5zZXJ2aWNlJztcbmltcG9ydCB7IE9QZXJtaXNzaW9ucyB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL28tcGVybWlzc2lvbnMudHlwZSc7XG5pbXBvcnQgeyBDb2RlcyB9IGZyb20gJy4uLy4uLy4uL3V0aWwvY29kZXMnO1xuaW1wb3J0IHsgUGVybWlzc2lvbnNVdGlscyB9IGZyb20gJy4uLy4uLy4uL3V0aWwvcGVybWlzc2lvbnMnO1xuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uLy4uLy4uL3V0aWwvdXRpbCc7XG5pbXBvcnQgeyBPRm9ybUNvbXBvbmVudCB9IGZyb20gJy4uL28tZm9ybS5jb21wb25lbnQnO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9JTlBVVFNfT19GT1JNX1RPT0xCQVIgPSBbXG4gICdsYWJlbEhlYWRlcjogbGFiZWwtaGVhZGVyJyxcbiAgJ2xhYmVsSGVhZGVyQWxpZ246IGxhYmVsLWhlYWRlci1hbGlnbicsXG4gICdoZWFkZXJhY3Rpb25zOiBoZWFkZXItYWN0aW9ucycsXG4gICdzaG93SGVhZGVyQWN0aW9uc1RleHQ6IHNob3ctaGVhZGVyLWFjdGlvbnMtdGV4dCcsXG4gIC8vIHNob3ctaGVhZGVyLW5hdmlnYXRpb24gW3N0cmluZ11beWVzfG5vfHRydWV8ZmFsc2VdOiBJbmNsdWRlIG5hdmlnYXRpb25zIGJ1dHRvbnMgaW4gZm9ybS10b29sYmFyLiBEZWZhdWx0OiB0cnVlO1xuICAnc2hvd0hlYWRlck5hdmlnYXRpb246c2hvdy1oZWFkZXItbmF2aWdhdGlvbidcbl07XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX09VVFBVVFNfT19GT1JNX1RPT0xCQVIgPSBbXG4gICdvbkNhbmNlbCdcbl07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ28tZm9ybS10b29sYmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL28tZm9ybS10b29sYmFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vby1mb3JtLXRvb2xiYXIuY29tcG9uZW50LnNjc3MnXSxcbiAgaW5wdXRzOiBERUZBVUxUX0lOUFVUU19PX0ZPUk1fVE9PTEJBUixcbiAgb3V0cHV0czogREVGQVVMVF9PVVRQVVRTX09fRk9STV9UT09MQkFSLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5vLWZvcm0tdG9vbGJhcl0nOiAndHJ1ZSdcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBPRm9ybVRvb2xiYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgLyogQmluZGluZ3MgKi9cbiAgcHVibGljIGxhYmVsSGVhZGVyOiBzdHJpbmcgPSAnJztcbiAgcHVibGljIGhlYWRlcmFjdGlvbnM6IHN0cmluZyA9ICcnO1xuICBwdWJsaWMgbGFiZWxIZWFkZXJBbGlnbjogc3RyaW5nID0gJ2NlbnRlcic7XG5cbiAgQElucHV0Q29udmVydGVyKClcbiAgcHVibGljIHNob3dIZWFkZXJBY3Rpb25zVGV4dDogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dENvbnZlcnRlcigpXG4gIHB1YmxpYyBzaG93SGVhZGVyTmF2aWdhdGlvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgcHVibGljIGZvcm1BY3Rpb25zOiBzdHJpbmdbXTtcbiAgcHVibGljIGlzRGV0YWlsOiBib29sZWFuID0gdHJ1ZTtcblxuICBwdWJsaWMgZWRpdE1vZGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHVibGljIGluc2VydE1vZGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHVibGljIGluaXRpYWxNb2RlOiBib29sZWFuID0gdHJ1ZTtcbiAgcHVibGljIHJlZnJlc2hCdG5FbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBpbnNlcnRCdG5FbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBkZWxldGVCdG5FbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgQFZpZXdDaGlsZCgnYnJlYWRjcnVtYicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiwgc3RhdGljOiBmYWxzZSB9KVxuICBwdWJsaWMgYnJlYWRDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgcHVibGljIG9uQ2FuY2VsOiBFdmVudEVtaXR0ZXI8bnVsbD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHVibGljIGlzU2F2ZUJ0bkVuYWJsZWQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XG4gIHB1YmxpYyBpc0VkaXRCdG5FbmFibGVkOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBwdWJsaWMgZXhpc3RzQ2hhbmdlc1RvU2F2ZTogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICBnZXQgY2hhbmdlc1RvU2F2ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fY2hhbmdlc1RvU2F2ZTtcbiAgfVxuXG4gIHNldCBjaGFuZ2VzVG9TYXZlKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuX2NoYW5nZXNUb1NhdmUgPSB2YWw7XG4gICAgY29uc3QgYXR0ciA9IHRoaXMuX2Zvcm0uaXNFZGl0YWJsZURldGFpbCgpID8gUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fVVBEQVRFIDogUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fSU5TRVJUO1xuICAgIGNvbnN0IHBlcm1pc3Npb25zOiBPUGVybWlzc2lvbnMgPSAodGhpcy5hY3Rpb25zUGVybWlzc2lvbnMgfHwgW10pLmZpbmQocCA9PiBwLmF0dHIgPT09IGF0dHIpO1xuICAgIGlmIChVdGlsLmlzRGVmaW5lZChwZXJtaXNzaW9ucykgJiYgcGVybWlzc2lvbnMuZW5hYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9leGlzdHNDaGFuZ2VzVG9TYXZlU3ViamVjdC5uZXh0KHZhbCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgX2NoYW5nZXNUb1NhdmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBnZXQgZWRpdEJ0bkVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2VkaXRCdG5FbmFibGVkO1xuICB9XG4gIHNldCBlZGl0QnRuRW5hYmxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2VkaXRCdG5FbmFibGVkID0gdmFsdWU7XG4gICAgdGhpcy5faXNFZGl0QnRuRW5hYmxlZFN1YmplY3QubmV4dCh0aGlzLl9lZGl0QnRuRW5hYmxlZCk7XG4gIH1cbiAgcHJvdGVjdGVkIF9lZGl0QnRuRW5hYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIGdldCBzYXZlQnRuRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fc2F2ZUJ0bkVuYWJsZWQ7XG4gIH1cbiAgc2V0IHNhdmVCdG5FbmFibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2F2ZUJ0bkVuYWJsZWQgPSB2YWx1ZTtcbiAgICB0aGlzLl9pc1NhdmVCdG5FbmFibGVkU3ViamVjdC5uZXh0KHRoaXMuX3NhdmVCdG5FbmFibGVkKTtcbiAgfVxuICBwcm90ZWN0ZWQgX3NhdmVCdG5FbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJvdGVjdGVkIF9kaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlO1xuICBwcm90ZWN0ZWQgX25hdmlnYXRpb25TZXJ2aWNlOiBOYXZpZ2F0aW9uU2VydmljZTtcbiAgcHJvdGVjdGVkIG11dGF0aW9uT2JzZXJ2ZXJzOiBNdXRhdGlvbk9ic2VydmVyW10gPSBbXTtcblxuICBwcm90ZWN0ZWQgZm9ybUNhY2hlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByb3RlY3RlZCBhY3Rpb25zUGVybWlzc2lvbnM6IE9QZXJtaXNzaW9uc1tdO1xuICBwcm90ZWN0ZWQgc25hY2tCYXJTZXJ2aWNlOiBTbmFja0JhclNlcnZpY2U7XG5cbiAgcHJvdGVjdGVkIF9pbmNsdWRlQnJlYWRjcnVtYjogYm9vbGVhbjtcblxuICBwcm90ZWN0ZWQgX2lzU2F2ZUJ0bkVuYWJsZWRTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gIHByb3RlY3RlZCBfaXNFZGl0QnRuRW5hYmxlZFN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcbiAgcHJvdGVjdGVkIF9leGlzdHNDaGFuZ2VzVG9TYXZlU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2Zvcm06IE9Gb3JtQ29tcG9uZW50LFxuICAgIHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7XG4gICAgdGhpcy5pc1NhdmVCdG5FbmFibGVkID0gdGhpcy5faXNTYXZlQnRuRW5hYmxlZFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5pc0VkaXRCdG5FbmFibGVkID0gdGhpcy5faXNFZGl0QnRuRW5hYmxlZFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gICAgdGhpcy5leGlzdHNDaGFuZ2VzVG9TYXZlID0gdGhpcy5fZXhpc3RzQ2hhbmdlc1RvU2F2ZVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG5cbiAgICB0aGlzLl9mb3JtLnJlZ2lzdGVyVG9vbGJhcih0aGlzKTtcbiAgICB0aGlzLl9kaWFsb2dTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoRGlhbG9nU2VydmljZSk7XG4gICAgdGhpcy5fbmF2aWdhdGlvblNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChOYXZpZ2F0aW9uU2VydmljZSk7XG4gICAgdGhpcy5zbmFja0JhclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChTbmFja0JhclNlcnZpY2UpO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZm9ybUFjdGlvbnMgPSBVdGlsLnBhcnNlQXJyYXkodGhpcy5oZWFkZXJhY3Rpb25zKTtcbiAgICBpZiAodGhpcy5mb3JtQWN0aW9ucyAmJiB0aGlzLmZvcm1BY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMucmVmcmVzaEJ0bkVuYWJsZWQgPSB0aGlzLmZvcm1BY3Rpb25zLmluZGV4T2YoJ1InKSAhPT0gLTE7XG4gICAgICB0aGlzLmluc2VydEJ0bkVuYWJsZWQgPSB0aGlzLmZvcm1BY3Rpb25zLmluZGV4T2YoJ0knKSAhPT0gLTE7XG4gICAgICB0aGlzLmVkaXRCdG5FbmFibGVkID0gdGhpcy5mb3JtQWN0aW9ucy5pbmRleE9mKCdVJykgIT09IC0xO1xuICAgICAgdGhpcy5kZWxldGVCdG5FbmFibGVkID0gIXRoaXMuaW5zZXJ0TW9kZSAmJiB0aGlzLmZvcm1BY3Rpb25zLmluZGV4T2YoJ0QnKSAhPT0gLTE7XG4gICAgfVxuICAgIGlmICh0aGlzLl9uYXZpZ2F0aW9uU2VydmljZSkge1xuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLl9uYXZpZ2F0aW9uU2VydmljZS5vblRpdGxlQ2hhbmdlKHRpdGxlID0+IHtcbiAgICAgICAgc2VsZi5sYWJlbEhlYWRlciA9IHRpdGxlO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuaW5jbHVkZUJyZWFkY3J1bWIgPSB0aGlzLl9mb3JtLmluY2x1ZGVCcmVhZGNydW1iICYmIHRoaXMuX2Zvcm0uZm9ybUNvbnRhaW5lci5icmVhZGNydW1iO1xuICAgIGlmICh0aGlzLmluY2x1ZGVCcmVhZGNydW1iKSB7XG4gICAgICB0aGlzLl9mb3JtLmZvcm1Db250YWluZXIuYnJlYWRjcnVtYiA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5mb3JtQ2FjaGVTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuZm9ybUNhY2hlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLm11dGF0aW9uT2JzZXJ2ZXJzKSB7XG4gICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXJzLmZvckVhY2goKG06IE11dGF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgbS5kaXNjb25uZWN0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMucGFyc2VQZXJtaXNzaW9ucygpO1xuICAgIGlmICh0aGlzLmluY2x1ZGVCcmVhZGNydW1iKSB7XG4gICAgICB0aGlzLl9mb3JtLmZvcm1Db250YWluZXIuY3JlYXRlQnJlYWRjcnVtYih0aGlzLmJyZWFkQ29udGFpbmVyKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2V0SW5pdGlhbE1vZGUoKTogdm9pZCB7XG4gICAgdGhpcy5tYW5hZ2VFZGl0YWJsZURldGFpbCgpO1xuICAgIHRoaXMuaW5pdGlhbE1vZGUgPSB0cnVlO1xuICAgIHRoaXMuaW5zZXJ0TW9kZSA9IGZhbHNlO1xuICAgIHRoaXMuZWRpdE1vZGUgPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRJbnNlcnRNb2RlKCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdGlhbE1vZGUgPSBmYWxzZTtcbiAgICB0aGlzLmluc2VydE1vZGUgPSB0cnVlO1xuICAgIHRoaXMuZWRpdE1vZGUgPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRFZGl0TW9kZSgpOiB2b2lkIHtcbiAgICB0aGlzLmluaXRpYWxNb2RlID0gZmFsc2U7XG4gICAgdGhpcy5pbnNlcnRNb2RlID0gZmFsc2U7XG4gICAgdGhpcy5lZGl0TW9kZSA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgb25DbG9zZURldGFpbChvcHRpb25zPzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5fZm9ybS5leGVjdXRlVG9vbGJhckFjdGlvbihDb2Rlcy5DTE9TRV9ERVRBSUxfQUNUSU9OLCBPYmplY3QuYXNzaWduKG9wdGlvbnMgfHwge30sIHtcbiAgICAgIGNoYW5nZVRvb2xiYXJNb2RlOiB0cnVlXG4gICAgfSkpO1xuICB9XG5cbiAgcHVibGljIG9uQmFjayhvcHRpb25zPzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5fZm9ybS5leGVjdXRlVG9vbGJhckFjdGlvbihDb2Rlcy5CQUNLX0FDVElPTiwgb3B0aW9ucyk7XG4gIH1cblxuICBwdWJsaWMgb25SZWxvYWQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fUkVGUkVTSCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fZm9ybS5zaG93Q29uZmlybURpc2NhcmRDaGFuZ2VzKCkudGhlbih2YWwgPT4ge1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICB0aGlzLl9mb3JtLmV4ZWN1dGVUb29sYmFyQWN0aW9uKENvZGVzLlJFTE9BRF9BQ1RJT04sIHsgZXhpdFdpdGhvdXRDb25maXJtYXRpb246IHRydWUgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25JbnNlcnQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fSU5TRVJUKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2Zvcm0uZXhlY3V0ZVRvb2xiYXJBY3Rpb24oQ29kZXMuR09fSU5TRVJUX0FDVElPTiwge1xuICAgICAgY2hhbmdlVG9vbGJhck1vZGU6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbkVkaXQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fVVBEQVRFKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2Zvcm0uZXhlY3V0ZVRvb2xiYXJBY3Rpb24oQ29kZXMuR09fRURJVF9BQ1RJT04sIHtcbiAgICAgIGNoYW5nZVRvb2xiYXJNb2RlOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25EZWxldGUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fREVMRVRFKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd0NvbmZpcm1EZWxldGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBvblNhdmUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fVVBEQVRFKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaGFuZGxlQWNjZXB0RWRpdE9wZXJhdGlvbigpO1xuICB9XG5cbiAgcHVibGljIGNhbmNlbE9wZXJhdGlvbigpOiB2b2lkIHtcbiAgICB0aGlzLl9mb3JtLnNob3dDb25maXJtRGlzY2FyZENoYW5nZXMoKS50aGVuKHZhbCA9PiB7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgIC8vIGVuc3VyaW5nIGVkaXRNb2RlIHRvIGZhbHNlIHRvIGF2b2lkIG8tZm9ybSBjYW5EZWFjdGl2YXRlIGZ1bmN0aW9uIHRyaWdnZXJpbmdcbiAgICAgICAgdGhpcy5lZGl0TW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9uQ2FuY2VsLmVtaXQoKTtcbiAgICAgICAgY29uc3QgY2xvc2VPcHRpb25zID0geyBleGl0V2l0aG91dENvbmZpcm1hdGlvbjogdHJ1ZSB9O1xuICAgICAgICBpZiAodGhpcy5pc0RldGFpbCkge1xuICAgICAgICAgIHRoaXMub25DbG9zZURldGFpbChjbG9zZU9wdGlvbnMpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaW5zZXJ0TW9kZSkge1xuICAgICAgICAgIHRoaXMub25CYWNrKGNsb3NlT3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vblJlbG9hZCgpO1xuICAgICAgICAgIHRoaXMuX2Zvcm0uc2V0SW5pdGlhbE1vZGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGFjY2VwdE9wZXJhdGlvbigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lZGl0TW9kZSkge1xuICAgICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fVVBEQVRFKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmhhbmRsZUFjY2VwdEVkaXRPcGVyYXRpb24oKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaW5zZXJ0TW9kZSkge1xuICAgICAgaWYgKCF0aGlzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24oUGVybWlzc2lvbnNVdGlscy5BQ1RJT05fSU5TRVJUKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmhhbmRsZUFjY2VwdEluc2VydE9wZXJhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVBY2NlcHRJbnNlcnRPcGVyYXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5fZm9ybS5leGVjdXRlVG9vbGJhckFjdGlvbihDb2Rlcy5JTlNFUlRfQUNUSU9OKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVBY2NlcHRFZGl0T3BlcmF0aW9uKCk6IHZvaWQge1xuICAgIHRoaXMuX2Zvcm0uZXhlY3V0ZVRvb2xiYXJBY3Rpb24oQ29kZXMuRURJVF9BQ1RJT04pO1xuICB9XG5cbiAgcHVibGljIHNob3dDb25maXJtRGVsZXRlKCk6IHZvaWQge1xuICAgIHRoaXMuX2RpYWxvZ1NlcnZpY2UuY29uZmlybShcbiAgICAgIHRoaXMuX2Zvcm0ubWVzc2FnZVNlcnZpY2UuZ2V0RGVsZXRlQ29uZmlybWF0aW9uRGlhbG9nVGl0bGUoKSxcbiAgICAgIHRoaXMuX2Zvcm0ubWVzc2FnZVNlcnZpY2UuZ2V0RGVsZXRlQ29uZmlybWF0aW9uTWVzc2FnZSgpKS50aGVuKHJlcyA9PiB7XG4gICAgICAgIGlmIChyZXMpIHtcbiAgICAgICAgICB0aGlzLl9mb3JtLmV4ZWN1dGVUb29sYmFyQWN0aW9uKENvZGVzLkRFTEVURV9BQ1RJT04pLnN1YnNjcmliZShyZXNwID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2Zvcm0ub25EZWxldGUuZW1pdChyZXNwKTtcbiAgICAgICAgICAgIHRoaXMub25DbG9zZURldGFpbCh7IGV4aXRXaXRob3V0Q29uZmlybWF0aW9uOiB0cnVlIH0pO1xuICAgICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdPRm9ybVRvb2xiYXIuZGVsZXRlIGVycm9yJywgZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgKTtcbiAgfVxuXG4gIGdldCBzaG93TmF2aWdhdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zaG93SGVhZGVyTmF2aWdhdGlvbiAmJiAhKHRoaXMuX2Zvcm0uZ2V0Rm9ybU1hbmFnZXIoKSAmJiB0aGlzLl9mb3JtLmdldEZvcm1NYW5hZ2VyKCkuaXNUYWJNb2RlKCkpO1xuICB9XG5cbiAgcHVibGljIGdldExhYmVsSGVhZGVyQWxpZ24oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5sYWJlbEhlYWRlckFsaWduO1xuICB9XG5cbiAgZ2V0IHNob3dVbmRvQnV0dG9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9mb3JtLnVuZG9CdXR0b24gJiYgKCF0aGlzLmluaXRpYWxNb2RlIHx8IHRoaXMuX2Zvcm0uaXNFZGl0YWJsZURldGFpbCgpKTtcbiAgfVxuXG4gIGdldCBpc0NoYW5nZXNTdGFja0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9mb3JtLmlzQ2FjaGVTdGFja0VtcHR5O1xuICB9XG5cbiAgcHVibGljIG9uVW5kb0xhc3RDaGFuZ2UoKTogdm9pZCB7XG4gICAgdGhpcy5fZm9ybS5leGVjdXRlVG9vbGJhckFjdGlvbihDb2Rlcy5VTkRPX0xBU1RfQ0hBTkdFX0FDVElPTik7XG4gIH1cblxuICBnZXQgaXNSZWZyZXNoQnRuRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yZWZyZXNoQnRuRW5hYmxlZDtcbiAgfVxuXG4gIGdldCBpc0luc2VydEJ0bkVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5zZXJ0QnRuRW5hYmxlZDtcbiAgfVxuXG4gIGdldCBpc0RlbGV0ZUJ0bkVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGVsZXRlQnRuRW5hYmxlZDtcbiAgfVxuXG4gIHB1YmxpYyBoYXNFbmFibGVkUGVybWlzc2lvbihwZXJtaXNzaW9uOiBPUGVybWlzc2lvbnMpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcGVybWlzc2lvbiA/IHBlcm1pc3Npb24uZW5hYmxlZCA6IHRydWU7XG4gIH1cblxuICBnZXQgaW5jbHVkZUJyZWFkY3J1bWIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2luY2x1ZGVCcmVhZGNydW1iO1xuICB9XG5cbiAgc2V0IGluY2x1ZGVCcmVhZGNydW1iKGFyZzogYm9vbGVhbikge1xuICAgIHRoaXMuX2luY2x1ZGVCcmVhZGNydW1iID0gYXJnO1xuICB9XG5cbiAgcHJvdGVjdGVkIG1hbmFnZUVkaXRhYmxlRGV0YWlsKCk6IHZvaWQge1xuICAgIGNvbnN0IGlzRWRpdGFibGVEZXRhaWwgPSB0aGlzLl9mb3JtLmlzRWRpdGFibGVEZXRhaWwoKTtcblxuICAgIGNvbnN0IHVwZGF0ZVBlcm1pc3Npb25zOiBPUGVybWlzc2lvbnMgPSAodGhpcy5hY3Rpb25zUGVybWlzc2lvbnMgfHwgW10pLmZpbmQocCA9PiBwLmF0dHIgPT09IFBlcm1pc3Npb25zVXRpbHMuQUNUSU9OX1VQREFURSk7XG4gICAgaWYgKHRoaXMuaGFzRW5hYmxlZFBlcm1pc3Npb24odXBkYXRlUGVybWlzc2lvbnMpKSB7XG4gICAgICB0aGlzLnNhdmVCdG5FbmFibGVkID0gaXNFZGl0YWJsZURldGFpbDtcbiAgICB9XG5cbiAgICB0aGlzLnJlZnJlc2hCdG5FbmFibGVkID0gdGhpcy5yZWZyZXNoQnRuRW5hYmxlZCAmJiBpc0VkaXRhYmxlRGV0YWlsO1xuICAgIHRoaXMuaW5zZXJ0QnRuRW5hYmxlZCA9IHRoaXMuaW5zZXJ0QnRuRW5hYmxlZCAmJiBpc0VkaXRhYmxlRGV0YWlsO1xuICAgIHRoaXMuZWRpdEJ0bkVuYWJsZWQgPSB0aGlzLmVkaXRCdG5FbmFibGVkICYmICFpc0VkaXRhYmxlRGV0YWlsO1xuXG4gICAgdGhpcy5mb3JtQ2FjaGVTdWJzY3JpcHRpb24gPSB0aGlzLl9mb3JtLmdldEZvcm1DYWNoZSgpLm9uQ2FjaGVTdGF0ZUNoYW5nZXMuc3Vic2NyaWJlKCh2YWx1ZTogYW55KSA9PiB7XG4gICAgICBpZiAodGhpcy5fZm9ybS5pc0VkaXRhYmxlRGV0YWlsKCkpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VzVG9TYXZlID0gdGhpcy5fZm9ybS5pc0luaXRpYWxTdGF0ZUNoYW5nZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwYXJzZVBlcm1pc3Npb25zKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9mb3JtLm9hdHRyKSB7XG4gICAgICB0aGlzLmFjdGlvbnNQZXJtaXNzaW9ucyA9IHRoaXMuX2Zvcm0uZ2V0QWN0aW9uc1Blcm1pc3Npb25zKCk7XG5cbiAgICAgIGlmICghVXRpbC5pc0RlZmluZWQodGhpcy5hY3Rpb25zUGVybWlzc2lvbnMpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy5hY3Rpb25zUGVybWlzc2lvbnMuZm9yRWFjaCgocGVybWlzc2lvbjogT1Blcm1pc3Npb25zKSA9PiB7XG4gICAgICAgIC8vIG90aGVycyBhY3Rpb25zXG4gICAgICAgIHNlbGYucGVybWlzc2lvbk1hbmFnZW1lbnQocGVybWlzc2lvbik7XG5cbiAgICAgICAgaWYgKFBlcm1pc3Npb25zVXRpbHMuU1RBTkRBUkRfQUNUSU9OUy5pbmRleE9mKHBlcm1pc3Npb24uYXR0cikgPiAtMSkge1xuICAgICAgICAgIC8vIGFjdGlvbnMgUjtJO1U7RFxuICAgICAgICAgIGlmIChwZXJtaXNzaW9uLmF0dHIgPT09IFBlcm1pc3Npb25zVXRpbHMuQUNUSU9OX1VQREFURSkge1xuICAgICAgICAgICAgc2VsZi5wZXJtaXNzaW9uTWFuYWdlbWVudChwZXJtaXNzaW9uLCAnZWRpdCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBwZXJtaXNzaW9uTWFuYWdlbWVudChwZXJtaXNzaW9uOiBPUGVybWlzc2lvbnMsIGF0dHI/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBhdHRyQWN0aW9uID0gVXRpbC5pc0RlZmluZWQoYXR0cikgPyBhdHRyIDogcGVybWlzc2lvbi5hdHRyO1xuICAgIGNvbnN0IGVsZW1lbnRCeUFjdGlvbiA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1thdHRyPVwiJyArIGF0dHJBY3Rpb24gKyAnXCJdJyk7XG5cbiAgICBpZiAoVXRpbC5pc0RlZmluZWQoZWxlbWVudEJ5QWN0aW9uKSkge1xuICAgICAgaWYgKCFwZXJtaXNzaW9uLnZpc2libGUpIHtcbiAgICAgICAgZWxlbWVudEJ5QWN0aW9uLnJlbW92ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFwZXJtaXNzaW9uLmVuYWJsZWQpIHtcbiAgICAgICAgICBlbGVtZW50QnlBY3Rpb24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIGNvbnN0IG11dGF0aW9uT2JzZXJ2ZXIgPSBQZXJtaXNzaW9uc1V0aWxzLnJlZ2lzdGVyRGlzYWJsZWRDaGFuZ2VzSW5Eb20oZWxlbWVudEJ5QWN0aW9uKTtcbiAgICAgICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXJzLnB1c2gobXV0YXRpb25PYnNlcnZlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRW5hYmxlZFBlcm1pc3Npb24oYXR0cik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHBlcm1pc3Npb25zOiBPUGVybWlzc2lvbnMgPSAodGhpcy5hY3Rpb25zUGVybWlzc2lvbnMgfHwgW10pLmZpbmQocCA9PiBwLmF0dHIgPT09IGF0dHIpO1xuICAgIGNvbnN0IGVuYWJsZWRQZXJtaXNpb24gPSBQZXJtaXNzaW9uc1V0aWxzLmNoZWNrRW5hYmxlZFBlcm1pc3Npb24ocGVybWlzc2lvbnMpO1xuICAgIGlmICghZW5hYmxlZFBlcm1pc2lvbikge1xuICAgICAgdGhpcy5zbmFja0JhclNlcnZpY2Uub3Blbih0aGlzLl9mb3JtLm1lc3NhZ2VTZXJ2aWNlLmdldEFjdGlvblBlcm1pc3Npb25Ob3RFbmFibGVkTWVzc2FnZSgpKTtcbiAgICB9XG4gICAgcmV0dXJuIGVuYWJsZWRQZXJtaXNpb247XG4gIH1cblxufVxuIl19