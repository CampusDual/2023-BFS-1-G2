import { Util } from '../util';
import * as lpn from 'google-libphonenumber';
const EMAIL_REGEXP = /^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/;
const DNI_PATTERN = '^(([0-9]{8})([-]?)([a-zA-Z]{1}))$';
const NIE_PATTERN = '^(([x-zX-Z]{1})([-]?)([0-9]{7})([-]?)([a-zA-Z]{1}))$';
const DNI_CHECK = 'TRWAGMYFPDXBNJZSQVHLCKET';
const NUMBERS = '0123456789';
export const TWELVE_HOUR_FORMAT_PATTERN = '^(([0-9]|([01]?[0-9])):([0-9]|([0-5][0-9])) *([AaPp][Mm])*)$';
export const TWENTY_FOUR_HOUR_FORMAT_PATTERN = '^([0-9]|([01]?[0-9]|2[0-3])):[0-9]|([0-5][0-9])$';
export class OValidators {
    static twelveHourFormatValidator(control) {
        const regExp = new RegExp(TWELVE_HOUR_FORMAT_PATTERN);
        if (control.value && typeof control.value === 'string' && !regExp.test(control.value)) {
            return { invalidFormatHour: true };
        }
        return {};
    }
    static twentyFourHourFormatValidator(control) {
        const regExp = new RegExp(TWENTY_FOUR_HOUR_FORMAT_PATTERN);
        if (control.value && typeof control.value === 'string' && !regExp.test(control.value)) {
            return { invalidFormatHour: true };
        }
        return {};
    }
    static emailValidator(control) {
        if (control.value && control.value.length > 0 && !EMAIL_REGEXP.test(control.value)) {
            return { invalidEmailAddress: true };
        }
        return {};
    }
    static phoneValidator(control, countryCode) {
        if (!control || !control.value) {
            return {};
        }
        const phoneNumberUtilInstance = lpn.PhoneNumberUtil.getInstance();
        const error = { validatePhoneNumber: { valid: false } };
        let number;
        let isValidForRegion = false;
        try {
            number = phoneNumberUtilInstance.parse(control.value, countryCode);
            if (number) {
                isValidForRegion = phoneNumberUtilInstance.isValidNumberForRegion(number, countryCode);
            }
        }
        catch (e) {
            return error;
        }
        if (control.value && (!number || !isValidForRegion)) {
            return error;
        }
        return {};
    }
    static nifValidator(control) {
        const newValue = control.value;
        const regExp = new RegExp(DNI_PATTERN + '|' + NIE_PATTERN);
        let valueWithoutDashes = '';
        for (const i in newValue) {
            if (newValue[i] !== '-') {
                valueWithoutDashes = valueWithoutDashes + newValue[i];
            }
        }
        if (valueWithoutDashes.length > 1) {
            const firstChar = valueWithoutDashes.charAt(0);
            if (NUMBERS.indexOf(firstChar) !== -1) {
                const number = valueWithoutDashes.substring(0, valueWithoutDashes.length - 1);
                const pos = parseInt(number, 10) % 23;
                const expectedLetter = DNI_CHECK.substring(pos, pos + 1);
                const letter = valueWithoutDashes.charAt(valueWithoutDashes.length - 1);
                const dniLetterError = (expectedLetter !== letter.toUpperCase());
                if (dniLetterError) {
                    return { invalidNIFLetter: true };
                }
                else {
                    if (!regExp.test(valueWithoutDashes)) {
                        return { invalidNIF: true };
                    }
                }
            }
            else {
                if (!regExp.test(valueWithoutDashes)) {
                    return { invalidNIF: true };
                }
            }
        }
        return undefined;
    }
    static patternValidator(regex, key) {
        if (!Util.isDefined(regex)) {
            console.warn('Regex param must be defined in patternValidator ');
        }
        if (!Util.isDefined(key)) {
            console.warn('Validation key param must be defined in patternValidator ');
        }
        let validator = (control) => {
            if (!Util.isDefined(regex) || !Util.isDefined(key) || !control.value) {
                return undefined;
            }
            const valid = regex.test(control.value);
            let result = {};
            if (valid) {
                result = undefined;
            }
            else {
                result[key] = !valid;
            }
            return result;
        };
        return validator;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby12YWxpZGF0b3JzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi92YWxpZGF0b3JzL28tdmFsaWRhdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sS0FBSyxHQUFHLE1BQU0sdUJBQXVCLENBQUM7QUFFN0MsTUFBTSxZQUFZLEdBQUcsaUtBQWlLLENBQUM7QUFHdkwsTUFBTSxXQUFXLEdBQUcsbUNBQW1DLENBQUM7QUFDeEQsTUFBTSxXQUFXLEdBQUcsc0RBQXNELENBQUM7QUFDM0UsTUFBTSxTQUFTLEdBQUcsMEJBQTBCLENBQUM7QUFDN0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDO0FBQzdCLE1BQU0sQ0FBQyxNQUFNLDBCQUEwQixHQUFHLDhEQUE4RCxDQUFDO0FBQ3pHLE1BQU0sQ0FBQyxNQUFNLCtCQUErQixHQUFHLGtEQUFrRCxDQUFDO0FBRWxHLE1BQU0sT0FBTyxXQUFXO0lBS2YsTUFBTSxDQUFDLHlCQUF5QixDQUFDLE9BQW9CO1FBQzFELE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEQsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sT0FBTyxDQUFDLEtBQUssS0FBSyxRQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNyRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsSUFBSSxFQUFFLENBQUM7U0FDcEM7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFLTSxNQUFNLENBQUMsNkJBQTZCLENBQUMsT0FBb0I7UUFDOUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUMzRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxPQUFPLENBQUMsS0FBSyxLQUFLLFFBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3JGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUNwQztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUtNLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBb0I7UUFDL0MsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2xGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUN0QztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUtNLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBb0IsRUFBRSxXQUFpQjtRQUNsRSxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtZQUM5QixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsTUFBTSx1QkFBdUIsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2xFLE1BQU0sS0FBSyxHQUFHLEVBQUUsbUJBQW1CLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQztRQUV4RCxJQUFJLE1BQXVCLENBQUM7UUFDNUIsSUFBSSxnQkFBZ0IsR0FBWSxLQUFLLENBQUE7UUFDckMsSUFBSTtZQUNGLE1BQU0sR0FBRyx1QkFBdUIsQ0FBQyxLQUFLLENBQ3BDLE9BQU8sQ0FBQyxLQUFLLEVBQ2IsV0FBVyxDQUNaLENBQUM7WUFDRixJQUFJLE1BQU0sRUFBRTtnQkFDVixnQkFBZ0IsR0FBRyx1QkFBdUIsQ0FBQyxzQkFBc0IsQ0FDL0QsTUFBTSxFQUNOLFdBQVcsQ0FDWixDQUFBO2FBQ0Y7U0FDRjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtZQUNuRCxPQUFPLEtBQUssQ0FBQTtTQUNiO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBS00sTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFvQjtRQUM3QyxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQy9CLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLFdBQVcsR0FBRyxHQUFHLEdBQUcsV0FBVyxDQUFDLENBQUM7UUFHM0QsSUFBSSxrQkFBa0IsR0FBRyxFQUFFLENBQUM7UUFDNUIsS0FBSyxNQUFNLENBQUMsSUFBSSxRQUFRLEVBQUU7WUFDeEIsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO2dCQUN2QixrQkFBa0IsR0FBRyxrQkFBa0IsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDdkQ7U0FDRjtRQUNELElBQUksa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQyxNQUFNLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO2dCQUNyQyxNQUFNLE1BQU0sR0FBRyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDOUUsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQ3RDLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDekQsTUFBTSxNQUFNLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDeEUsTUFBTSxjQUFjLEdBQUcsQ0FBQyxjQUFjLEtBQUssTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7Z0JBQ2pFLElBQUksY0FBYyxFQUFFO29CQUNsQixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFFLENBQUM7aUJBQ25DO3FCQUFNO29CQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEVBQUU7d0JBQ3BDLE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUM7cUJBQzdCO2lCQUNGO2FBQ0Y7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRTtvQkFDcEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQztpQkFDN0I7YUFDRjtTQUNGO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQVNNLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFhLEVBQUUsR0FBVztRQUN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQixPQUFPLENBQUMsSUFBSSxDQUFDLGtEQUFrRCxDQUFDLENBQUE7U0FDakU7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLDJEQUEyRCxDQUFDLENBQUE7U0FDMUU7UUFFRCxJQUFJLFNBQVMsR0FBZ0IsQ0FBQyxPQUFvQixFQUEwQixFQUFFO1lBQzVFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBRXBFLE9BQU8sU0FBUyxDQUFDO2FBQ2xCO1lBR0QsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEMsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBR2hCLElBQUksS0FBSyxFQUFFO2dCQUNULE1BQU0sR0FBRyxTQUFTLENBQUM7YUFDcEI7aUJBQU07Z0JBQ0wsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO2FBQ3RCO1lBQ0QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxTQUFTLENBQUM7SUFFbkIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMsIFZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgVXRpbCB9IGZyb20gJy4uL3V0aWwnO1xuaW1wb3J0ICogYXMgbHBuIGZyb20gJ2dvb2dsZS1saWJwaG9uZW51bWJlcic7XG5cbmNvbnN0IEVNQUlMX1JFR0VYUCA9IC9eW2EtekEtWjAtOSEjJCUmJyorLz0/Xl9ge3x9fi1dKyg/OlxcLlthLXpBLVowLTkhIyQlJicqKy89P15fYHt8fX4tXSspKkAoPzpbYS16QS1aMC05XSg/OlthLXpBLVowLTktXSpbYS16QS1aMC05XSk/XFwuKStbYS16QS1aMC05XSg/OlthLXpBLVowLTktXSpbYS16QS1aMC05XSk/JC87XG5cbi8vIE5JRiBSZWd1bGFyIEV4cHJlc3Npb25zXG5jb25zdCBETklfUEFUVEVSTiA9ICdeKChbMC05XXs4fSkoWy1dPykoW2EtekEtWl17MX0pKSQnO1xuY29uc3QgTklFX1BBVFRFUk4gPSAnXigoW3gtelgtWl17MX0pKFstXT8pKFswLTldezd9KShbLV0/KShbYS16QS1aXXsxfSkpJCc7XG5jb25zdCBETklfQ0hFQ0sgPSAnVFJXQUdNWUZQRFhCTkpaU1FWSExDS0VUJztcbmNvbnN0IE5VTUJFUlMgPSAnMDEyMzQ1Njc4OSc7XG5leHBvcnQgY29uc3QgVFdFTFZFX0hPVVJfRk9STUFUX1BBVFRFUk4gPSAnXigoWzAtOV18KFswMV0/WzAtOV0pKTooWzAtOV18KFswLTVdWzAtOV0pKSAqKFtBYVBwXVtNbV0pKikkJztcbmV4cG9ydCBjb25zdCBUV0VOVFlfRk9VUl9IT1VSX0ZPUk1BVF9QQVRURVJOID0gJ14oWzAtOV18KFswMV0/WzAtOV18MlswLTNdKSk6WzAtOV18KFswLTVdWzAtOV0pJCc7XG5cbmV4cG9ydCBjbGFzcyBPVmFsaWRhdG9ycyB7XG5cbiAgLyoqXG4gICAqIEhvdXIgdmFsaWRhdG9yIGhoOm1tIGFtL3BtIGZvcm1hdFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0d2VsdmVIb3VyRm9ybWF0VmFsaWRhdG9yKGNvbnRyb2w6IEZvcm1Db250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB7XG4gICAgY29uc3QgcmVnRXhwID0gbmV3IFJlZ0V4cChUV0VMVkVfSE9VUl9GT1JNQVRfUEFUVEVSTik7XG4gICAgaWYgKGNvbnRyb2wudmFsdWUgJiYgdHlwZW9mIGNvbnRyb2wudmFsdWUgPT09ICdzdHJpbmcnICYmICFyZWdFeHAudGVzdChjb250cm9sLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIHsgaW52YWxpZEZvcm1hdEhvdXI6IHRydWUgfTtcbiAgICB9XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhvdXIgdmFsaWRhdG9yIEhIOm1tIGZvcm1hdFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0d2VudHlGb3VySG91ckZvcm1hdFZhbGlkYXRvcihjb250cm9sOiBGb3JtQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMge1xuICAgIGNvbnN0IHJlZ0V4cCA9IG5ldyBSZWdFeHAoVFdFTlRZX0ZPVVJfSE9VUl9GT1JNQVRfUEFUVEVSTik7XG4gICAgaWYgKGNvbnRyb2wudmFsdWUgJiYgdHlwZW9mIGNvbnRyb2wudmFsdWUgPT09ICdzdHJpbmcnICYmICFyZWdFeHAudGVzdChjb250cm9sLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIHsgaW52YWxpZEZvcm1hdEhvdXI6IHRydWUgfTtcbiAgICB9XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEVtYWlsIHZhbGlkYXRvclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBlbWFpbFZhbGlkYXRvcihjb250cm9sOiBGb3JtQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMge1xuICAgIGlmIChjb250cm9sLnZhbHVlICYmIGNvbnRyb2wudmFsdWUubGVuZ3RoID4gMCAmJiAhRU1BSUxfUkVHRVhQLnRlc3QoY29udHJvbC52YWx1ZSkpIHtcbiAgICAgIHJldHVybiB7IGludmFsaWRFbWFpbEFkZHJlc3M6IHRydWUgfTtcbiAgICB9XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIFBob25lIHZhbGlkYXRvclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBwaG9uZVZhbGlkYXRvcihjb250cm9sOiBGb3JtQ29udHJvbCwgY291bnRyeUNvZGU/OiBhbnkpOiBWYWxpZGF0aW9uRXJyb3JzIHtcbiAgICBpZiAoIWNvbnRyb2wgfHwgIWNvbnRyb2wudmFsdWUpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY29uc3QgcGhvbmVOdW1iZXJVdGlsSW5zdGFuY2UgPSBscG4uUGhvbmVOdW1iZXJVdGlsLmdldEluc3RhbmNlKCk7XG4gICAgY29uc3QgZXJyb3IgPSB7IHZhbGlkYXRlUGhvbmVOdW1iZXI6IHsgdmFsaWQ6IGZhbHNlIH0gfTtcblxuICAgIGxldCBudW1iZXI6IGxwbi5QaG9uZU51bWJlcjtcbiAgICBsZXQgaXNWYWxpZEZvclJlZ2lvbjogYm9vbGVhbiA9IGZhbHNlXG4gICAgdHJ5IHtcbiAgICAgIG51bWJlciA9IHBob25lTnVtYmVyVXRpbEluc3RhbmNlLnBhcnNlKFxuICAgICAgICBjb250cm9sLnZhbHVlLFxuICAgICAgICBjb3VudHJ5Q29kZVxuICAgICAgKTtcbiAgICAgIGlmIChudW1iZXIpIHtcbiAgICAgICAgaXNWYWxpZEZvclJlZ2lvbiA9IHBob25lTnVtYmVyVXRpbEluc3RhbmNlLmlzVmFsaWROdW1iZXJGb3JSZWdpb24oXG4gICAgICAgICAgbnVtYmVyLFxuICAgICAgICAgIGNvdW50cnlDb2RlXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZXJyb3I7XG4gICAgfVxuICAgIGlmIChjb250cm9sLnZhbHVlICYmICghbnVtYmVyIHx8ICFpc1ZhbGlkRm9yUmVnaW9uKSkge1xuICAgICAgcmV0dXJuIGVycm9yXG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOSUYgdmFsaWRhdG9yXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIG5pZlZhbGlkYXRvcihjb250cm9sOiBGb3JtQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMge1xuICAgIGNvbnN0IG5ld1ZhbHVlID0gY29udHJvbC52YWx1ZTtcbiAgICBjb25zdCByZWdFeHAgPSBuZXcgUmVnRXhwKEROSV9QQVRURVJOICsgJ3wnICsgTklFX1BBVFRFUk4pO1xuXG4gICAgLy8gcmVtb3ZpbmcgZGFzaGVzXG4gICAgbGV0IHZhbHVlV2l0aG91dERhc2hlcyA9ICcnO1xuICAgIGZvciAoY29uc3QgaSBpbiBuZXdWYWx1ZSkge1xuICAgICAgaWYgKG5ld1ZhbHVlW2ldICE9PSAnLScpIHtcbiAgICAgICAgdmFsdWVXaXRob3V0RGFzaGVzID0gdmFsdWVXaXRob3V0RGFzaGVzICsgbmV3VmFsdWVbaV07XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWx1ZVdpdGhvdXREYXNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgZmlyc3RDaGFyID0gdmFsdWVXaXRob3V0RGFzaGVzLmNoYXJBdCgwKTtcbiAgICAgIGlmIChOVU1CRVJTLmluZGV4T2YoZmlyc3RDaGFyKSAhPT0gLTEpIHtcbiAgICAgICAgY29uc3QgbnVtYmVyID0gdmFsdWVXaXRob3V0RGFzaGVzLnN1YnN0cmluZygwLCB2YWx1ZVdpdGhvdXREYXNoZXMubGVuZ3RoIC0gMSk7XG4gICAgICAgIGNvbnN0IHBvcyA9IHBhcnNlSW50KG51bWJlciwgMTApICUgMjM7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkTGV0dGVyID0gRE5JX0NIRUNLLnN1YnN0cmluZyhwb3MsIHBvcyArIDEpO1xuICAgICAgICBjb25zdCBsZXR0ZXIgPSB2YWx1ZVdpdGhvdXREYXNoZXMuY2hhckF0KHZhbHVlV2l0aG91dERhc2hlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgY29uc3QgZG5pTGV0dGVyRXJyb3IgPSAoZXhwZWN0ZWRMZXR0ZXIgIT09IGxldHRlci50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgaWYgKGRuaUxldHRlckVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaW52YWxpZE5JRkxldHRlcjogdHJ1ZSB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghcmVnRXhwLnRlc3QodmFsdWVXaXRob3V0RGFzaGVzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaW52YWxpZE5JRjogdHJ1ZSB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFyZWdFeHAudGVzdCh2YWx1ZVdpdGhvdXREYXNoZXMpKSB7XG4gICAgICAgICAgcmV0dXJuIHsgaW52YWxpZE5JRjogdHJ1ZSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogUGF0dGVybnMgdmFsaWRhdG9yXG4gICAqIEBwYXJhbSByZWdleFxuICAgKiBAcGFyYW0ga2V5XG4gICAqIEByZXR1cm5zIHZhbGlkYXRvclxuICAgKlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBwYXR0ZXJuVmFsaWRhdG9yKHJlZ2V4OiBSZWdFeHAsIGtleTogc3RyaW5nKTogVmFsaWRhdG9yRm4ge1xuICAgIGlmICghVXRpbC5pc0RlZmluZWQocmVnZXgpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1JlZ2V4IHBhcmFtIG11c3QgYmUgZGVmaW5lZCBpbiBwYXR0ZXJuVmFsaWRhdG9yICcpXG4gICAgfVxuXG4gICAgaWYgKCFVdGlsLmlzRGVmaW5lZChrZXkpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1ZhbGlkYXRpb24ga2V5IHBhcmFtIG11c3QgYmUgZGVmaW5lZCBpbiBwYXR0ZXJuVmFsaWRhdG9yICcpXG4gICAgfVxuXG4gICAgbGV0IHZhbGlkYXRvcjogVmFsaWRhdG9yRm4gPSAoY29udHJvbDogRm9ybUNvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcbiAgICAgIGlmICghVXRpbC5pc0RlZmluZWQocmVnZXgpIHx8ICFVdGlsLmlzRGVmaW5lZChrZXkpIHx8ICFjb250cm9sLnZhbHVlKSB7XG4gICAgICAgIC8vIGlmIHJlZ2V4IGlzIG5vdCBkZWZpbmVkIG9yIGtleSBpcyBub3QgZGVmaW5lZCBvciBjb250cm9sIGlzIGVtcHR5IHJldHVybiBubyBlcnJvclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICAvLyB0ZXN0IHRoZSB2YWx1ZSBvZiB0aGUgY29udHJvbCBhZ2FpbnN0IHRoZSByZWdleHAgc3VwcGxpZWRcbiAgICAgIGNvbnN0IHZhbGlkID0gcmVnZXgudGVzdChjb250cm9sLnZhbHVlKTtcblxuICAgICAgbGV0IHJlc3VsdCA9IHt9O1xuXG4gICAgICAvLyBpZiB0cnVlLCByZXR1cm4gbm8gZXJyb3IgKG5vIGVycm9yKSwgZWxzZSByZXR1cm4gZXJyb3IgcGFzc2VkIGluIHRoZSBzZWNvbmQgcGFyYW1ldGVyXG4gICAgICBpZiAodmFsaWQpIHtcbiAgICAgICAgcmVzdWx0ID0gdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSAhdmFsaWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgcmV0dXJuIHZhbGlkYXRvcjtcblxuICB9XG59XG4iXX0=