import { Injectable, Injector } from '@angular/core';
import { NavigationEnd, Router } from '@angular/router';
import { Subject } from 'rxjs';
import { AppConfig } from '../config/app-config';
import { Codes } from '../util/codes';
import { Util } from '../util/util';
import * as i0 from "@angular/core";
export class AppMenuService {
    constructor(injector) {
        this.injector = injector;
        this.onClick = new Subject();
        this._config = this.injector.get(AppConfig);
        this.MENU_ROOTS = this._config.getMenuConfiguration();
        this.router = this.injector.get(Router);
        this.router.events.subscribe((event) => {
            if (event instanceof NavigationEnd) {
                this.setActiveItem();
            }
        });
        this.ALL_MENU_ITEMS = [];
        for (let i = 0, len = this.MENU_ROOTS.length; i < len; i++) {
            const item = this.MENU_ROOTS[i];
            this.ALL_MENU_ITEMS = this.ALL_MENU_ITEMS.concat(this.getMenuItems(item));
        }
    }
    getMenuRoots() {
        return this.MENU_ROOTS;
    }
    getMenuRootById(id) {
        return this.MENU_ROOTS.find(c => c.id === id);
    }
    getAllMenuItems() {
        return this.ALL_MENU_ITEMS;
    }
    getMenuItemById(id) {
        return this.ALL_MENU_ITEMS.find(i => i.id === id);
    }
    getMenuItemType(item) {
        let type;
        switch (true) {
            case (item.route === Codes.LOGIN_ROUTE):
                type = 'logout';
                break;
            case (item.action !== undefined):
                type = 'action';
                break;
            case (item.locale !== undefined):
                type = 'locale';
                break;
            case (item.user !== undefined):
                type = 'user-info';
                break;
            case (item.items !== undefined):
                type = 'group';
                break;
            default:
                type = 'default';
                break;
        }
        return type;
    }
    isMenuGroup(item) {
        return this.getMenuItemType(item) === 'group';
    }
    isMenuGroupRoute(item) {
        return this.getMenuItemType(item) === 'group' && item.hasOwnProperty('route');
    }
    isItemActive(item) {
        return this.activeItem && this.activeItem.route === item.route;
    }
    isRouteItem(item) {
        return Util.isDefined(item.route);
    }
    getMenuItems(item) {
        const menuGroup = item;
        const items = menuGroup.items;
        if (items !== undefined) {
            if (this.isMenuGroupRoute(menuGroup)) {
                return [item].concat(items);
            }
            return items;
        }
        return [item];
    }
    setActiveItem() {
        let activeItem;
        const routeItems = this.ALL_MENU_ITEMS.filter(item => this.isRouteItem(item));
        const pathMatchFullItems = routeItems.filter(item => item.pathMatch === 'full');
        if (pathMatchFullItems.length > 0) {
            activeItem = pathMatchFullItems.find(item => item.route === this.router.url);
        }
        if (!activeItem) {
            activeItem = routeItems.find(item => this.router.url.startsWith(item.route));
        }
        this.activeItem = activeItem;
    }
}
AppMenuService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
AppMenuService.ctorParameters = () => [
    { type: Injector }
];
AppMenuService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function AppMenuService_Factory() { return new AppMenuService(i0.ɵɵinject(i0.INJECTOR)); }, token: AppMenuService, providedIn: "root" });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLW1lbnUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL29udGltaXplLXdlYi1uZ3gvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvYXBwLW1lbnUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBV2pELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGNBQWMsQ0FBQzs7QUFLcEMsTUFBTSxPQUFPLGNBQWM7SUFVekIsWUFBc0IsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUZqQyxZQUFPLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFHM0MsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUN0RCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3JDLElBQUksS0FBSyxZQUFZLGFBQWEsRUFBRTtnQkFDbEMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQ3RCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsY0FB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U0FBUyxDQUFDLEVBQUU7Z0JBQ3BDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDNUI7WUFDRCxPQUFPLEtBQUssQ0FBQztTQUNkO1FBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hCLENBQUM7SUFFTyxhQUFhO1FBQ25CLElBQUksVUFBeUIsQ0FBQztRQUM5QixNQUFNLFVBQVUsR0FBb0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFvQixDQUFDO1FBQ2xILE1BQU0sa0JBQWtCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssTUFBTSxDQUFDLENBQUM7UUFDaEYsSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2pDLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDOUU7UUFDRCxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2YsVUFBVSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFDRCxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDOzs7WUE5R0YsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7WUFwQm9CLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmF2aWdhdGlvbkVuZCwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgQXBwQ29uZmlnIH0gZnJvbSAnLi4vY29uZmlnL2FwcC1jb25maWcnO1xuaW1wb3J0IHtcbiAgTWVudUdyb3VwLFxuICBNZW51SXRlbSxcbiAgTWVudUl0ZW1BY3Rpb24sXG4gIE1lbnVJdGVtTG9jYWxlLFxuICBNZW51SXRlbUxvZ291dCxcbiAgTWVudUl0ZW1Sb3V0ZSxcbiAgTWVudUl0ZW1Vc2VySW5mb1xufSBmcm9tICcuLi9pbnRlcmZhY2VzL2FwcC1tZW51LmludGVyZmFjZSc7XG5pbXBvcnQgeyBNZW51Um9vdEl0ZW0gfSBmcm9tICcuLi90eXBlcy9tZW51LXJvb3QtaXRlbS50eXBlJztcbmltcG9ydCB7IENvZGVzIH0gZnJvbSAnLi4vdXRpbC9jb2Rlcyc7XG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vdXRpbC91dGlsJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQXBwTWVudVNlcnZpY2Uge1xuXG4gIHByb3RlY3RlZCByb3V0ZXI6IFJvdXRlcjtcbiAgcHJvdGVjdGVkIF9jb25maWc6IEFwcENvbmZpZztcbiAgcHJvdGVjdGVkIE1FTlVfUk9PVFM6IE1lbnVSb290SXRlbVtdO1xuICBwcm90ZWN0ZWQgQUxMX01FTlVfSVRFTVM6IE1lbnVSb290SXRlbVtdO1xuICBwcm90ZWN0ZWQgYWN0aXZlSXRlbTogTWVudUl0ZW1Sb3V0ZTtcblxuICBwdWJsaWMgb25DbGljazogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yKSB7XG4gICAgdGhpcy5fY29uZmlnID0gdGhpcy5pbmplY3Rvci5nZXQoQXBwQ29uZmlnKTtcbiAgICB0aGlzLk1FTlVfUk9PVFMgPSB0aGlzLl9jb25maWcuZ2V0TWVudUNvbmZpZ3VyYXRpb24oKTtcbiAgICB0aGlzLnJvdXRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJvdXRlcik7XG4gICAgdGhpcy5yb3V0ZXIuZXZlbnRzLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLkFMTF9NRU5VX0lURU1TID0gW107XG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuTUVOVV9ST09UUy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uc3QgaXRlbTogTWVudVJvb3RJdGVtID0gdGhpcy5NRU5VX1JPT1RTW2ldO1xuICAgICAgdGhpcy5BTExfTUVOVV9JVEVNUyA9IHRoaXMuQUxMX01FTlVfSVRFTVMuY29uY2F0KHRoaXMuZ2V0TWVudUl0ZW1zKGl0ZW0pKTtcbiAgICB9XG4gIH1cblxuICBnZXRNZW51Um9vdHMoKTogTWVudVJvb3RJdGVtW10ge1xuICAgIHJldHVybiB0aGlzLk1FTlVfUk9PVFM7XG4gIH1cblxuICBnZXRNZW51Um9vdEJ5SWQoaWQ6IHN0cmluZyk6IE1lbnVSb290SXRlbSB7XG4gICAgcmV0dXJuIHRoaXMuTUVOVV9ST09UUy5maW5kKGMgPT4gYy5pZCA9PT0gaWQpO1xuICB9XG5cbiAgZ2V0QWxsTWVudUl0ZW1zKCk6IE1lbnVSb290SXRlbVtdIHtcbiAgICByZXR1cm4gdGhpcy5BTExfTUVOVV9JVEVNUztcbiAgfVxuXG4gIGdldE1lbnVJdGVtQnlJZChpZDogc3RyaW5nKTogTWVudUl0ZW0gfCBNZW51R3JvdXAge1xuICAgIHJldHVybiB0aGlzLkFMTF9NRU5VX0lURU1TLmZpbmQoaSA9PiBpLmlkID09PSBpZCk7XG4gIH1cblxuICBnZXRNZW51SXRlbVR5cGUoaXRlbTogTWVudVJvb3RJdGVtKTogc3RyaW5nIHtcbiAgICBsZXQgdHlwZTogc3RyaW5nO1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgY2FzZSAoKGl0ZW0gYXMgTWVudUl0ZW1Mb2dvdXQpLnJvdXRlID09PSBDb2Rlcy5MT0dJTl9ST1VURSk6XG4gICAgICAgIHR5cGUgPSAnbG9nb3V0JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICgoaXRlbSBhcyBNZW51SXRlbUFjdGlvbikuYWN0aW9uICE9PSB1bmRlZmluZWQpOlxuICAgICAgICB0eXBlID0gJ2FjdGlvbic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAoKGl0ZW0gYXMgTWVudUl0ZW1Mb2NhbGUpLmxvY2FsZSAhPT0gdW5kZWZpbmVkKTpcbiAgICAgICAgdHlwZSA9ICdsb2NhbGUnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgKChpdGVtIGFzIE1lbnVJdGVtVXNlckluZm8pLnVzZXIgIT09IHVuZGVmaW5lZCk6XG4gICAgICAgIHR5cGUgPSAndXNlci1pbmZvJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICgoaXRlbSBhcyBNZW51R3JvdXApLml0ZW1zICE9PSB1bmRlZmluZWQpOlxuICAgICAgICB0eXBlID0gJ2dyb3VwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0eXBlID0gJ2RlZmF1bHQnO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBpc01lbnVHcm91cChpdGVtOiBNZW51Um9vdEl0ZW0pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNZW51SXRlbVR5cGUoaXRlbSkgPT09ICdncm91cCc7XG4gIH1cblxuICBpc01lbnVHcm91cFJvdXRlKGl0ZW06IE1lbnVSb290SXRlbSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdldE1lbnVJdGVtVHlwZShpdGVtKSA9PT0gJ2dyb3VwJyAmJiBpdGVtLmhhc093blByb3BlcnR5KCdyb3V0ZScpO1xuICB9XG5cbiAgaXNJdGVtQWN0aXZlKGl0ZW06IE1lbnVJdGVtUm91dGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVJdGVtICYmIHRoaXMuYWN0aXZlSXRlbS5yb3V0ZSA9PT0gaXRlbS5yb3V0ZTtcbiAgfVxuXG4gIGlzUm91dGVJdGVtKGl0ZW06IE1lbnVJdGVtUm91dGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gVXRpbC5pc0RlZmluZWQoaXRlbS5yb3V0ZSk7XG4gIH1cblxuICBwcml2YXRlIGdldE1lbnVJdGVtcyhpdGVtOiBNZW51Um9vdEl0ZW0pOiBNZW51Um9vdEl0ZW1bXSB7XG4gICAgY29uc3QgbWVudUdyb3VwID0gaXRlbSBhcyBNZW51R3JvdXA7XG4gICAgY29uc3QgaXRlbXMgPSBtZW51R3JvdXAuaXRlbXM7XG4gICAgaWYgKGl0ZW1zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICh0aGlzLmlzTWVudUdyb3VwUm91dGUobWVudUdyb3VwKSkge1xuICAgICAgICByZXR1cm4gW2l0ZW1dLmNvbmNhdChpdGVtcylcbiAgICAgIH1cbiAgICAgIHJldHVybiBpdGVtcztcbiAgICB9XG4gICAgcmV0dXJuIFtpdGVtXTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWN0aXZlSXRlbSgpOiB2b2lkIHtcbiAgICBsZXQgYWN0aXZlSXRlbTogTWVudUl0ZW1Sb3V0ZTtcbiAgICBjb25zdCByb3V0ZUl0ZW1zOiBNZW51SXRlbVJvdXRlW10gPSB0aGlzLkFMTF9NRU5VX0lURU1TLmZpbHRlcihpdGVtID0+IHRoaXMuaXNSb3V0ZUl0ZW0oaXRlbSkpIGFzIE1lbnVJdGVtUm91dGVbXTtcbiAgICBjb25zdCBwYXRoTWF0Y2hGdWxsSXRlbXMgPSByb3V0ZUl0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ucGF0aE1hdGNoID09PSAnZnVsbCcpO1xuICAgIGlmIChwYXRoTWF0Y2hGdWxsSXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgYWN0aXZlSXRlbSA9IHBhdGhNYXRjaEZ1bGxJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5yb3V0ZSA9PT0gdGhpcy5yb3V0ZXIudXJsKTtcbiAgICB9XG4gICAgaWYgKCFhY3RpdmVJdGVtKSB7XG4gICAgICBhY3RpdmVJdGVtID0gcm91dGVJdGVtcy5maW5kKGl0ZW0gPT4gdGhpcy5yb3V0ZXIudXJsLnN0YXJ0c1dpdGgoaXRlbS5yb3V0ZSkpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUl0ZW0gPSBhY3RpdmVJdGVtO1xuICB9XG5cbn1cbiJdfQ==